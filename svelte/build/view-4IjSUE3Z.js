import{n as F,i as Gl,a as bn,l as hn,c as kn,d as vn,S as ce,b as me,e as oe,f as be,g as C,h as D,j as h,k as u,s as _e,t as I,m as We,r as Ne,o as g,p as R,q as Ct,u as wn,v as L,w as J,x as Ce,y as Se,z as Fe,A as $n,B as yn,C as Mn,D as T,E as je,F as Ee,G as z,H as we,I as Ze,J as Hl,K as Me,L as ie,M as re,N as K,O as W,P as X,Q as G,R as nt,T as Dt,U as ue,V as $e,W as Te,X as Le,Y as xe,Z as ge,_ as Cn,$ as Ol,a0 as Re,a1 as Ue,a2 as mt,a3 as Ie,a4 as Jl,a5 as Vl,a6 as Be,a7 as St,a8 as it,a9 as Tt,aa as ut,ab as Ye,ac as ct,ad as Kl,ae as Qe,af as Lt,ag as Dn,ah as Ve,ai as Ke,aj as Sn,ak as Wl,al as Tn,am as Ln,an as Xl,ao as zn,ap as ot,aq as jn}from"./global-tKP1ARur.js";const et=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Yl(l,e,t,s){if(!e)return F;const n=l.getBoundingClientRect();if(e.left===n.left&&e.right===n.right&&e.top===n.top&&e.bottom===n.bottom)return F;const{delay:i=0,duration:r=300,easing:o=Gl,start:a=bn()+i,end:f=a+r,tick:d=F,css:m}=t(l,{from:e,to:n},s);let c=!0,_=!1,b;function p(){m&&(b=kn(l,0,1,r,i,o,m)),i||(_=!0)}function v(){m&&vn(l,b),c=!1}return hn(w=>{if(!_&&w>=a&&(_=!0),_&&w>=f&&(d(1,0),v()),!c)return!1;if(_){const M=w-a,$=0+1*o(M/r);d($,1-$)}return!0}),p(),d(0,1),v}function Ql(l){const e=getComputedStyle(l);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:s}=e,n=l.getBoundingClientRect();l.style.position="absolute",l.style.width=t,l.style.height=s,dt(l,n)}}function dt(l,e){const t=l.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const s=getComputedStyle(l),n=s.transform==="none"?"":s.transform;l.style.transform=`${n} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}var Pe=(l=>(l[l.NotDeleted=0]="NotDeleted",l[l.Deleted=1]="Deleted",l[l.DeletedForever=2]="DeletedForever",l))(Pe||{}),rt=(l=>(l[l.No=0]="No",l[l.Separate=1]="Separate",l[l.Visible=2]="Visible",l))(rt||{}),Ae=(l=>(l.TO="to",l.CC="cc",l.BCC="bcc",l))(Ae||{}),de=(l=>(l[l.SM=576]="SM",l[l.MD=768]="MD",l[l.LG=992]="LG",l[l.XL=1200]="XL",l))(de||{});function zt(l){let e;function t(i,r){return i[2]?An:Nn}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),u(e,"class","local-mail-course-link mt-n2 mb-3 mb-lg-4")},m(i,r){C(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&D(e),n.d()}}}function Nn(l){let e;return{c(){e=I(" ")},m(t,s){C(t,e,s)},p:F,d(t){t&&D(e)}}}function An(l){let e,t,s=We(l[2],l[1].settings.courselink)+"",n,i,r;return{c(){e=h("nav"),t=h("a"),n=I(s),u(t,"class","text-truncate"),u(t,"href",i=window.M.cfg.wwwroot+"/course/view.php?id="+l[1].params.courseid),u(t,"title",r=Ne(l[1].strings.gotocourse,We(l[2],"fullname"))),u(e,"class","d-flex align-items-center")},m(o,a){C(o,e,a),g(e,t),g(t,n)},p(o,a){a&6&&s!==(s=We(o[2],o[1].settings.courselink)+"")&&R(n,s),a&2&&i!==(i=window.M.cfg.wwwroot+"/course/view.php?id="+o[1].params.courseid)&&u(t,"href",i),a&6&&r!==(r=Ne(o[1].strings.gotocourse,We(o[2],"fullname")))&&u(t,"title",r)},d(o){o&&D(e)}}}function qn(l){let e=["shortname","fullname"].includes(l[1].settings.courselink),t,s=e&&zt(l);return{c(){s&&s.c(),t=be()},m(n,i){s&&s.m(n,i),C(n,t,i)},p(n,[i]){i&2&&(e=["shortname","fullname"].includes(n[1].settings.courselink)),e?s?s.p(n,i):(s=zt(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:F,o:F,d(n){n&&D(t),s&&s.d(n)}}}function Bn(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,a=>t(1,n=a)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;return r(),l.$$set=a=>{"store"in a&&r(t(0,o=a.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=n.courses.find(a=>a.id==n.params.courseid))},[o,n,s]}class En extends ce{constructor(e){super(),me(this,e,Bn,qn,oe,{store:0})}}function Zl(l){const e=l-1;return e*e*e+1}function qe(l,{delay:e=0,duration:t=400,easing:s=Gl}={}){const n=+getComputedStyle(l).opacity;return{delay:e,duration:t,easing:s,css:i=>`opacity: ${i*n}`}}function at(l,{delay:e=0,duration:t=400,easing:s=Zl,x:n=0,y:i=0,opacity:r=0}={}){const o=getComputedStyle(l),a=+o.opacity,f=o.transform==="none"?"":o.transform,d=a*(1-r),[m,c]=Ct(n),[_,b]=Ct(i);return{delay:e,duration:t,easing:s,css:(p,v)=>`
			transform: ${f} translate(${(1-p)*m}${c}, ${(1-p)*_}${b});
			opacity: ${a-d*v}`}}const{document:In}=et;function jt(l){let e,t,s=l[1]&&Nt(l),n=l[2]&&l[4]&&At(l);return{c(){e=h("div"),s&&s.c(),t=L(),n&&n.c(),u(e,"class","modal-footer")},m(i,r){C(i,e,r),s&&s.m(e,null),g(e,t),n&&n.m(e,null)},p(i,r){i[1]?s?s.p(i,r):(s=Nt(i),s.c(),s.m(e,t)):s&&(s.d(1),s=null),i[2]&&i[4]?n?n.p(i,r):(n=At(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(i){i&&D(e),s&&s.d(),n&&n.d()}}}function Nt(l){let e,t,s,n;return{c(){e=h("button"),t=I(l[1]),u(e,"type","button"),u(e,"class","btn btn-secondary")},m(i,r){C(i,e,r),g(e,t),s||(n=J(e,"click",function(){Ce(l[3])&&l[3].apply(this,arguments)}),s=!0)},p(i,r){l=i,r&2&&R(t,l[1])},d(i){i&&D(e),s=!1,n()}}}function At(l){let e,t,s,n,i;return{c(){e=h("button"),t=I(l[2]),u(e,"type","button"),u(e,"class",s="btn "+l[5]),e.disabled=l[6]},m(r,o){C(r,e,o),g(e,t),n||(i=J(e,"click",function(){Ce(l[4])&&l[4].apply(this,arguments)}),n=!0)},p(r,o){l=r,o&4&&R(t,l[2]),o&32&&s!==(s="btn "+l[5])&&u(e,"class",s),o&64&&(e.disabled=l[6])},d(r){r&&D(e),n=!1,i()}}}function Pn(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,M,$,k,y;const q=l[10].default,S=wn(q,l,l[9],null);let N=(l[1]||l[2]&&l[4])&&jt(l);return{c(){e=L(),t=h("div"),s=h("div"),n=h("div"),i=h("div"),r=h("h5"),o=I(l[0]),a=L(),f=h("button"),d=h("span"),d.textContent="×",m=L(),c=h("div"),S&&S.c(),_=L(),N&&N.c(),v=L(),w=h("div"),u(r,"class","modal-title"),u(d,"aria-hidden","true"),u(f,"type","button"),u(f,"class","close"),u(f,"aria-label",l[1]),u(i,"class","modal-header"),u(c,"class","modal-body"),u(n,"class","modal-content"),u(s,"class","modal-dialog"),u(t,"class","modal show"),u(t,"tabindex","-1"),u(t,"role","dialog"),u(t,"aria-label",l[0]),u(t,"aria-modal","true"),u(w,"class","modal-backdrop show")},m(j,B){C(j,e,B),C(j,t,B),g(t,s),g(s,n),g(n,i),g(i,r),g(r,o),g(i,a),g(i,f),g(f,d),g(n,m),g(n,c),S&&S.m(c,null),g(n,_),N&&N.m(n,null),l[11](t),C(j,v,B),C(j,w,B),$=!0,k||(y=[J(In.body,"keyup",l[8]),J(f,"click",function(){Ce(l[3])&&l[3].apply(this,arguments)}),Se(b=Fe.call(null,t,l[3]))],k=!0)},p(j,[B]){l=j,(!$||B&1)&&R(o,l[0]),(!$||B&2)&&u(f,"aria-label",l[1]),S&&S.p&&(!$||B&512)&&$n(S,q,l,l[9],$?Mn(q,l[9],B,null):yn(l[9]),null),l[1]||l[2]&&l[4]?N?N.p(l,B):(N=jt(l),N.c(),N.m(n,null)):N&&(N.d(1),N=null),(!$||B&1)&&u(t,"aria-label",l[0]),b&&Ce(b.update)&&B&8&&b.update.call(null,l[3])},i(j){$||(T(S,j),je(()=>{$&&(p||(p=Ee(t,at,{y:-100},!0)),p.run(1))}),je(()=>{$&&(M||(M=Ee(w,qe,{},!0)),M.run(1))}),$=!0)},o(j){z(S,j),p||(p=Ee(t,at,{y:-100},!1)),p.run(0),M||(M=Ee(w,qe,{},!1)),M.run(0),$=!1},d(j){j&&(D(e),D(t),D(v),D(w)),S&&S.d(j),N&&N.d(),l[11](null),j&&p&&p.end(),j&&M&&M.end(),k=!1,we(y)}}}function Rn(l,e,t){let{$$slots:s={},$$scope:n}=e,{title:i}=e,{cancelText:r=""}=e,{confirmText:o=""}=e,{onCancel:a}=e,{onConfirm:f=void 0}=e,{confirmClass:d="btn-primary"}=e,{confirmDisabled:m=!1}=e,c;Ze(()=>{document.body.classList.add("modal-open"),c.focus()}),Hl(()=>{document.body.classList.remove("modal-open")});const _=p=>{p.key=="Escape"&&a()};function b(p){Me[p?"unshift":"push"](()=>{c=p,t(7,c)})}return l.$$set=p=>{"title"in p&&t(0,i=p.title),"cancelText"in p&&t(1,r=p.cancelText),"confirmText"in p&&t(2,o=p.confirmText),"onCancel"in p&&t(3,a=p.onCancel),"onConfirm"in p&&t(4,f=p.onConfirm),"confirmClass"in p&&t(5,d=p.confirmClass),"confirmDisabled"in p&&t(6,m=p.confirmDisabled),"$$scope"in p&&t(9,n=p.$$scope)},[i,r,o,a,f,d,m,c,_,n,s,b]}class Ge extends ce{constructor(e){super(),me(this,e,Rn,Pn,oe,{title:0,cancelText:1,confirmText:2,onCancel:3,onConfirm:4,confirmClass:5,confirmDisabled:6})}}function qt(l){let e,t;return e=new Ge({props:{title:l[1].strings.error,onCancel:l[2],$$slots:{default:[Fn]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.title=s[1].strings.error),n&1&&(i.onCancel=s[2]),n&10&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Bt(l){var n;let e,t=((n=l[1].error)==null?void 0:n.debuginfo)+"",s;return{c(){e=h("p"),s=I(t)},m(i,r){C(i,e,r),g(e,s)},p(i,r){var o;r&2&&t!==(t=((o=i[1].error)==null?void 0:o.debuginfo)+"")&&R(s,t)},d(i){i&&D(e)}}}function Et(l){var n;let e,t=((n=l[1].error)==null?void 0:n.stacktrace)+"",s;return{c(){e=h("pre"),s=I(t)},m(i,r){C(i,e,r),g(e,s)},p(i,r){var o;r&2&&t!==(t=((o=i[1].error)==null?void 0:o.stacktrace)+"")&&R(s,t)},d(i){i&&D(e)}}}function Fn(l){var f,d,m;let e,t=((f=l[1].error)==null?void 0:f.message)+"",s,n,i,r,o=((d=l[1].error)==null?void 0:d.debuginfo)&&Bt(l),a=((m=l[1].error)==null?void 0:m.stacktrace)&&Et(l);return{c(){e=h("p"),s=I(t),n=L(),o&&o.c(),i=L(),a&&a.c(),r=be()},m(c,_){C(c,e,_),g(e,s),C(c,n,_),o&&o.m(c,_),C(c,i,_),a&&a.m(c,_),C(c,r,_)},p(c,_){var b,p,v;_&2&&t!==(t=((b=c[1].error)==null?void 0:b.message)+"")&&R(s,t),(p=c[1].error)!=null&&p.debuginfo?o?o.p(c,_):(o=Bt(c),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null),(v=c[1].error)!=null&&v.stacktrace?a?a.p(c,_):(a=Et(c),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null)},d(c){c&&(D(e),D(n),D(i),D(r)),o&&o.d(c),a&&a.d(c)}}}function Un(l){let e,t,s=l[1].error&&qt(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),C(n,e,i),t=!0},p(n,[i]){n[1].error?s?(s.p(n,i),i&2&&T(s,1)):(s=qt(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function Gn(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=()=>r.setError();return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class Hn extends ce{constructor(e){super(),me(this,e,Gn,Un,oe,{store:0})}}function On(l){let e,t,s,n,i,r;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-trash"),u(e,"type","button"),u(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.movetotrash),G(e,"btn-secondary",!l[1]),G(e,"disabled",!l[2].selectedMessages.size)},m(o,a){C(o,e,a),g(e,t),i||(r=J(e,"click",l[3]),i=!0)},p(o,[a]){a&4&&s!==(s=!o[2].selectedMessages.size)&&(e.disabled=s),a&4&&n!==(n=o[2].strings.movetotrash)&&u(e,"title",n),a&2&&G(e,"btn-secondary",!o[1]),a&4&&G(e,"disabled",!o[2].selectedMessages.size)},i:F,o:F,d(o){o&&D(e),i=!1,r()}}}function Jn(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:o=!1}=e;const a=()=>r.setDeleted(Array.from(s.selectedMessages.keys()),Pe.Deleted,!0);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"transparent"in f&&t(1,o=f.transparent)},[r,o,s,a]}class xl extends ce{constructor(e){super(),me(this,e,Jn,On,oe,{store:0,transparent:1})}}function It(l){let e,t;return e=new Ge({props:{title:l[2].strings.deleteforever,cancelText:l[2].strings.cancel,confirmText:l[2].strings.deleteforever,confirmClass:"btn-danger",onCancel:l[5],onConfirm:l[3],$$slots:{default:[Vn]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.deleteforever),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.deleteforever),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Vn(l){let e=l[2].strings[l[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"",t;return{c(){t=I(e)},m(s,n){C(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings[s[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"")&&R(t,e)},d(s){s&&D(t)}}}function Kn(l){let e,t,s,n,i,r,o,a,f,d=l[2].params.dialog=="deleteforever"&&It(l);return{c(){e=h("button"),t=h("i"),i=L(),d&&d.c(),r=be(),u(t,"class","fa fa-fw fa-trash"),u(e,"type","button"),u(e,"class","local-mail-action-delete-forever btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.deleteforever),G(e,"btn-secondary",!l[1]),G(e,"disabled",!l[2].selectedMessages.size)},m(m,c){C(m,e,c),g(e,t),C(m,i,c),d&&d.m(m,c),C(m,r,c),o=!0,a||(f=J(e,"click",l[4]),a=!0)},p(m,[c]){(!o||c&4&&s!==(s=!m[2].selectedMessages.size))&&(e.disabled=s),(!o||c&4&&n!==(n=m[2].strings.deleteforever))&&u(e,"title",n),(!o||c&2)&&G(e,"btn-secondary",!m[1]),(!o||c&4)&&G(e,"disabled",!m[2].selectedMessages.size),m[2].params.dialog=="deleteforever"?d?(d.p(m,c),c&4&&T(d,1)):(d=It(m),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(ie(),z(d,1,1,()=>{d=null}),re())},i(m){o||(T(d),o=!0)},o(m){z(d),o=!1},d(m){m&&(D(e),D(i),D(r)),d&&d.d(m),a=!1,f()}}}function Wn(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,m=>t(2,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:o=!1}=e;const a=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Pe.DeletedForever,!0)},f=()=>r.showDialog("deleteforever"),d=()=>r.hideDialog();return l.$$set=m=>{"store"in m&&i(t(0,r=m.store)),"transparent"in m&&t(1,o=m.transparent)},[r,o,s,a,f,d]}class en extends ce{constructor(e){super(),me(this,e,Wn,Kn,oe,{store:0,transparent:1})}}function Pt(l,e,t){const s=l.slice();return s[16]=e[t],s}function Xn(l){let e;return{c(){e=I(" ")},m(t,s){C(t,e,s)},p:F,d(t){t&&D(e)}}}function Yn(l){let e=l[5].strings.errorrepeatedlabelname+"",t;return{c(){t=I(e)},m(s,n){C(s,t,n)},p(s,n){n&32&&e!==(e=s[5].strings.errorrepeatedlabelname+"")&&R(t,e)},d(s){s&&D(t)}}}function Qn(l){let e;return{c(){e=h("span"),e.textContent="a",u(e,"aria-hidden","true")},m(t,s){C(t,e,s)},d(t){t&&D(e)}}}function Zn(l){let e;return{c(){e=h("i"),u(e,"class","fa fa-check local-mail-label-modal-color-option-check")},m(t,s){C(t,e,s)},d(t){t&&D(e)}}}function Rt(l,e){let t,s,n,i,r,o;function a(c,_){return c[16]==c[7]?Zn:Qn}let f=a(e),d=f(e);function m(){return e[15](e[16])}return{key:l,first:null,c(){t=h("button"),d.c(),s=L(),u(t,"role","radio"),u(t,"aria-checked",n=e[16]==e[7]),u(t,"tabindex","0"),u(t,"title",i=e[5].strings[`color${e[16]}`]),u(t,"class","local-mail-label-modal-color-option btn"),u(t,"style",`color: var(--local-mail-color-${e[16]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${e[16]}-bg, var(--local-mail-color-gray-bg))`),this.first=t},m(c,_){C(c,t,_),d.m(t,null),g(t,s),r||(o=J(t,"click",Te(m)),r=!0)},p(c,_){e=c,f!==(f=a(e))&&(d.d(1),d=f(e),d&&(d.c(),d.m(t,s))),_&128&&n!==(n=e[16]==e[7])&&u(t,"aria-checked",n),_&32&&i!==(i=e[5].strings[`color${e[16]}`])&&u(t,"title",i)},d(c){c&&D(t),d.d(),r=!1,o()}}}function xn(l){let e,t,s,n=l[5].strings.name+"",i,r,o,a,f,d,m,c,_,b,p,v=l[5].strings.color+"",w,M,$,k,y=[],q=new Map,S,N,j;function B(V,te){return V[4]?Yn:Xn}let H=B(l),P=H(l),O=ue(nt);const x=V=>V[16];for(let V=0;V<O.length;V+=1){let te=Pt(l,O,V),ae=x(te);q.set(ae,y[V]=Rt(ae,te))}return{c(){e=h("form"),t=h("div"),s=h("label"),i=I(n),r=L(),o=h("input"),f=L(),d=h("div"),P.c(),m=L(),c=h("div"),c.textContent=" ",_=L(),b=h("div"),p=h("label"),w=I(v),$=L(),k=h("div");for(let V=0;V<y.length;V+=1)y[V].c();u(s,"for","local-mail-label-modal-name"),u(o,"type","text"),o.required=!0,u(o,"class","form-control is-invalid"),u(o,"id",a=l[9]+"-name"),G(o,"is-valid",l[8]),G(o,"is-invalid",!l[8]),u(d,"class","invalid-feedback"),u(c,"class","valid-feedback"),u(t,"class","form-group mb-0"),u(p,"for",M=l[9]+"-color"),u(k,"role","radiogroup"),u(k,"class","local-mail-label-modal-color"),u(k,"id",S=l[9]+"-color"),u(b,"class","form-group")},m(V,te){C(V,e,te),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),l[13](o),$e(o,l[3]),g(t,f),g(t,d),P.m(d,null),g(t,m),g(t,c),g(e,_),g(e,b),g(b,p),g(p,w),g(b,$),g(b,k);for(let ae=0;ae<y.length;ae+=1)y[ae]&&y[ae].m(k,null);N||(j=[J(o,"input",l[14]),J(e,"submit",Te(l[10]))],N=!0)},p(V,te){te&32&&n!==(n=V[5].strings.name+"")&&R(i,n),te&512&&a!==(a=V[9]+"-name")&&u(o,"id",a),te&8&&o.value!==V[3]&&$e(o,V[3]),te&256&&G(o,"is-valid",V[8]),te&256&&G(o,"is-invalid",!V[8]),H===(H=B(V))&&P?P.p(V,te):(P.d(1),P=H(V),P&&(P.c(),P.m(d,null))),te&32&&v!==(v=V[5].strings.color+"")&&R(w,v),te&512&&M!==(M=V[9]+"-color")&&u(p,"for",M),te&160&&(O=ue(nt),y=Le(y,te,x,1,V,O,q,k,xe,Rt,null,Pt)),te&512&&S!==(S=V[9]+"-color")&&u(k,"id",S)},d(V){V&&D(e),l[13](null),P.d();for(let te=0;te<y.length;te+=1)y[te].d();N=!1,we(j)}}}function ei(l){let e,t;return e=new Ge({props:{title:l[5].strings[l[1]?"editlabel":"newlabel"],cancelText:l[5].strings.cancel,onCancel:l[2],confirmText:l[5].strings[l[1]?"save":"create"],confirmDisabled:!l[8],onConfirm:l[10],$$slots:{default:[xn]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,[n]){const i={};n&34&&(i.title=s[5].strings[s[1]?"editlabel":"newlabel"]),n&32&&(i.cancelText=s[5].strings.cancel),n&4&&(i.onCancel=s[2]),n&34&&(i.confirmText=s[5].strings[s[1]?"save":"create"]),n&256&&(i.confirmDisabled=!s[8]),n&525304&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function ti(l,e,t){let s,n,i,r,o,a,f,d=F,m=()=>(d(),d=_e(c,y=>t(5,f=y)),c);l.$$.on_destroy.push(()=>d());let{store:c}=e;m();let{label:_=void 0}=e,{onCancel:b}=e,{onSubmit:p}=e,v;const w=async()=>{p(n,i)};Ze(()=>v.focus());function M(y){Me[y?"unshift":"push"](()=>{v=y,t(6,v)})}function $(){n=this.value,t(3,n),t(1,_)}const k=y=>{t(7,i=y)};return l.$$set=y=>{"store"in y&&m(t(0,c=y.store)),"label"in y&&t(1,_=y.label),"onCancel"in y&&t(2,b=y.onCancel),"onSubmit"in y&&t(11,p=y.onSubmit)},l.$$.update=()=>{l.$$.dirty&2&&t(9,s=`local-mail-label-modal-${(_==null?void 0:_.id)||"new"}`),l.$$.dirty&2&&t(3,n=(_==null?void 0:_.name)||""),l.$$.dirty&2&&t(7,i=(_==null?void 0:_.color)||nt[0]),l.$$.dirty&8&&t(12,r=Dt(n)==""),l.$$.dirty&42&&t(4,o=f.labels.some(y=>y.id!=(_==null?void 0:_.id)&&y.name==Dt(n))),l.$$.dirty&4112&&t(8,a=!r&&!o)},[c,_,b,n,o,f,v,i,a,s,w,p,r,M,$,k]}class tn extends ce{constructor(e){super(),me(this,e,ti,ei,oe,{store:0,label:1,onCancel:2,onSubmit:11})}}const{Map:si}=et;function Ft(l,e,t){const s=l.slice();return s[16]=e[t],s}function Ut(l){let e,t=[],s=new si,n,i,r=ue(l[3].labels);const o=c=>c[16].id;for(let c=0;c<r.length;c+=1){let _=Ft(l,r,c),b=o(_);s.set(b,t[c]=Gt(b,_))}let a=l[3].labels.length>0&&Ht();function f(c,_){return c[6]?ni:li}let d=f(l),m=d(l);return{c(){e=h("div");for(let c=0;c<t.length;c+=1)t[c].c();n=L(),a&&a.c(),i=L(),m.c(),u(e,"class","dropdown-menu show")},m(c,_){C(c,e,_);for(let b=0;b<t.length;b+=1)t[b]&&t[b].m(e,null);g(e,n),a&&a.m(e,null),g(e,i),m.m(e,null)},p(c,_){_&552&&(r=ue(c[3].labels),t=Le(t,_,o,1,c,r,s,e,xe,Gt,n,Ft)),c[3].labels.length>0?a||(a=Ht(),a.c(),a.m(e,i)):a&&(a.d(1),a=null),d===(d=f(c))&&m?m.p(c,_):(m.d(1),m=d(c),m&&(m.c(),m.m(e,null)))},d(c){c&&D(e);for(let _=0;_<t.length;_+=1)t[_].d();a&&a.d(),m.d()}}}function Gt(l,e){let t,s,n,i,r=e[16].name+"",o,a,f;function d(){return e[14](e[16])}return{key:l,first:null,c(){t=h("button"),s=h("i"),i=L(),o=I(r),u(s,"class",n="fa fa-fw "+e[5](e[16].id)),u(t,"type","button"),u(t,"class","dropdown-item local-mail-action-label-button-item"),this.first=t},m(m,c){C(m,t,c),g(t,s),g(t,i),g(t,o),a||(f=J(t,"click",d),a=!0)},p(m,c){e=m,c&40&&n!==(n="fa fa-fw "+e[5](e[16].id))&&u(s,"class",n),c&8&&r!==(r=e[16].name+"")&&R(o,r)},d(m){m&&D(t),a=!1,f()}}}function Ht(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider")},m(t,s){C(t,e,s)},d(t){t&&D(e)}}}function li(l){let e,t=l[3].strings.newlabel+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,o){C(r,e,o),g(e,s),n||(i=J(e,"click",l[11]),n=!0)},p(r,o){o&8&&t!==(t=r[3].strings.newlabel+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function ni(l){let e,t=l[3].strings.apply+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,o){C(r,e,o),g(e,s),n||(i=J(e,"click",l[10]),n=!0)},p(r,o){o&8&&t!==(t=r[3].strings.apply+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Ot(l){let e,t;return e=new tn({props:{store:l[0],onCancel:l[15],onSubmit:l[12]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[15]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function ii(l){let e,t,s,n,i,r,o,a,f,d,m=l[4]&&Ut(l),c=l[3].params.dialog=="createlabel"&&Ot(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=L(),m&&m.c(),o=L(),c&&c.c(),u(s,"class","fa fa-fw fa-tag"),u(t,"type","button"),u(t,"class","local-mail-action-label-button btn dropdown-toggle"),t.disabled=n=!l[3].selectedMessages.size,u(t,"aria-expanded",l[4]),u(t,"title",i=l[3].strings.labels),G(t,"btn-secondary",!l[1]),G(t,"disabled",!l[3].selectedMessages.size),u(e,"class","btn-group"),u(e,"role","group"),G(e,"dropup",l[2])},m(_,b){C(_,e,b),g(e,t),g(t,s),g(e,r),m&&m.m(e,null),g(e,o),c&&c.m(e,null),a=!0,f||(d=[J(t,"click",l[8]),Se(Fe.call(null,e,l[7]))],f=!0)},p(_,[b]){(!a||b&8&&n!==(n=!_[3].selectedMessages.size))&&(t.disabled=n),(!a||b&16)&&u(t,"aria-expanded",_[4]),(!a||b&8&&i!==(i=_[3].strings.labels))&&u(t,"title",i),(!a||b&2)&&G(t,"btn-secondary",!_[1]),(!a||b&8)&&G(t,"disabled",!_[3].selectedMessages.size),_[4]?m?m.p(_,b):(m=Ut(_),m.c(),m.m(e,o)):m&&(m.d(1),m=null),_[3].params.dialog=="createlabel"?c?(c.p(_,b),b&8&&T(c,1)):(c=Ot(_),c.c(),T(c,1),c.m(e,null)):c&&(ie(),z(c,1,1,()=>{c=null}),re()),(!a||b&4)&&G(e,"dropup",_[2])},i(_){a||(T(c),a=!0)},o(_){z(c),a=!1},d(_){_&&D(e),m&&m.d(),c&&c.d(),f=!1,we(d)}}}function ri(l,e,t){let s,n,i,r=F,o=()=>(r(),r=_e(a,y=>t(3,i=y)),a);l.$$.on_destroy.push(()=>r());let{store:a}=e;o();let{transparent:f=!1}=e,{dropup:d=!1}=e,m=!1,c=new Map;const _=()=>{t(4,m=!1)},b=()=>{t(4,m=!m)},p=y=>{t(13,c=new Map(Array.from(c.entries()).map(([q,S])=>[q,q==y?S=="true"?"false":"true":S])))},v=()=>{t(4,m=!1),a.setLabels(Array.from(c.keys()).filter(y=>c.get(y)=="true"),Array.from(c.keys()).filter(y=>c.get(y)=="false"))},w=()=>{_(),a.showDialog("createlabel")},M=async(y,q)=>{a.hideDialog();const S=await a.createLabel(y,q);S&&a.setLabels([S],[])},$=y=>p(y.id),k=()=>a.hideDialog();return l.$$set=y=>{"store"in y&&o(t(0,a=y.store)),"transparent"in y&&t(1,f=y.transparent),"dropup"in y&&t(2,d=y.dropup)},l.$$.update=()=>{l.$$.dirty&8&&t(13,c=new Map(i.labels.map(y=>{const q=Array.from(i.selectedMessages.values()).filter(S=>S.labels.some(N=>N.id==y.id));return[y.id,q.length==0?"false":q.length<i.selectedMessages.size?"mixed":"true"]}))),l.$$.dirty&8200&&t(6,s=Array.from(c.entries()).some(([y,q])=>Array.from(i.selectedMessages.values()).some(S=>q=="true"&&S.labels.every(N=>N.id!=y)||q=="false"&&S.labels.some(N=>N.id==y)))),l.$$.dirty&8192&&t(5,n=y=>c.get(y)=="false"?"fa-square-o":c.get(y)=="mixed"?"fa-minus-square-o":"fa-check-square-o")},[a,f,d,i,m,n,s,_,b,p,v,w,M,c,$,k]}class sn extends ce{constructor(e){super(),me(this,e,ri,ii,oe,{store:0,transparent:1,dropup:2})}}function Jt(l){let e;function t(i,r){return i[8].params.tray=="trash"?oi:ai}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),u(e,"class","dropdown-menu show")},m(i,r){C(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&D(e),n.d()}}}function ai(l){let e,t,s,n,i,r=l[6]&&Vt(l),o=l[7]&&Kt(l),a=l[4]&&Wt(l),f=l[5]&&Xt(l),d=l[3]&&Yt(l);return{c(){r&&r.c(),e=L(),o&&o.c(),t=L(),a&&a.c(),s=L(),f&&f.c(),n=L(),d&&d.c(),i=be()},m(m,c){r&&r.m(m,c),C(m,e,c),o&&o.m(m,c),C(m,t,c),a&&a.m(m,c),C(m,s,c),f&&f.m(m,c),C(m,n,c),d&&d.m(m,c),C(m,i,c)},p(m,c){m[6]?r?r.p(m,c):(r=Vt(m),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),m[7]?o?o.p(m,c):(o=Kt(m),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),m[4]?a?a.p(m,c):(a=Wt(m),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null),m[5]?f?f.p(m,c):(f=Xt(m),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null),m[3]?d?d.p(m,c):(d=Yt(m),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null)},d(m){m&&(D(e),D(t),D(s),D(n),D(i)),r&&r.d(m),o&&o.d(m),a&&a.d(m),f&&f.d(m),d&&d.d(m)}}}function oi(l){let e,t=l[8].strings.emptytrash+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){C(r,e,o),g(e,s),n||(i=J(e,"click",l[19]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.emptytrash+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Vt(l){let e,t=l[8].strings.markasread+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){C(r,e,o),g(e,s),n||(i=J(e,"click",l[22]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.markasread+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Kt(l){let e,t=l[8].strings.markasunread+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){C(r,e,o),g(e,s),n||(i=J(e,"click",l[23]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.markasunread+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Wt(l){let e,t=l[8].strings.markasstarred+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){C(r,e,o),g(e,s),n||(i=J(e,"click",l[24]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.markasstarred+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Xt(l){let e,t=l[8].strings.markasunstarred+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){C(r,e,o),g(e,s),n||(i=J(e,"click",l[25]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.markasunstarred+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Yt(l){let e,t,s=l[8].strings.editlabel+"",n,i,r,o=l[8].strings.deletelabel+"",a,f,d,m=(l[6]||l[7]||l[4]||l[5])&&Qt();return{c(){m&&m.c(),e=L(),t=h("button"),n=I(s),i=L(),r=h("button"),a=I(o),u(t,"type","button"),u(t,"class","dropdown-item"),u(r,"type","button"),u(r,"class","dropdown-item")},m(c,_){m&&m.m(c,_),C(c,e,_),C(c,t,_),g(t,n),C(c,i,_),C(c,r,_),g(r,a),f||(d=[J(t,"click",l[15]),J(r,"click",l[17])],f=!0)},p(c,_){c[6]||c[7]||c[4]||c[5]?m||(m=Qt(),m.c(),m.m(e.parentNode,e)):m&&(m.d(1),m=null),_&256&&s!==(s=c[8].strings.editlabel+"")&&R(n,s),_&256&&o!==(o=c[8].strings.deletelabel+"")&&R(a,o)},d(c){c&&(D(e),D(t),D(i),D(r)),m&&m.d(c),f=!1,we(d)}}}function Qt(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider")},m(t,s){C(t,e,s)},d(t){t&&D(e)}}}function fi(l){let e,t,s,n;const i=[mi,ci],r=[];function o(a,f){return a[8].params.dialog=="editlabel"?0:a[8].params.dialog=="deletelabel"?1:-1}return~(e=o(l))&&(t=r[e]=i[e](l)),{c(){t&&t.c(),s=be()},m(a,f){~e&&r[e].m(a,f),C(a,s,f),n=!0},p(a,f){let d=e;e=o(a),e===d?~e&&r[e].p(a,f):(t&&(ie(),z(r[d],1,1,()=>{r[d]=null}),re()),~e?(t=r[e],t?t.p(a,f):(t=r[e]=i[e](a),t.c()),T(t,1),t.m(s.parentNode,s)):t=null)},i(a){n||(T(t),n=!0)},o(a){z(t),n=!1},d(a){a&&D(s),~e&&r[e].d(a)}}}function ui(l){let e,t,s=l[8].params.dialog=="emptytrash"&&Zt(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),C(n,e,i),t=!0},p(n,i){n[8].params.dialog=="emptytrash"?s?(s.p(n,i),i&256&&T(s,1)):(s=Zt(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function ci(l){let e,t;return e=new Ge({props:{title:l[8].strings.deletelabel,cancelText:l[8].strings.cancel,confirmText:l[8].strings.deletelabel,confirmClass:"btn-danger",onCancel:l[28],onConfirm:l[18],$$slots:{default:[di]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&256&&(i.title=s[8].strings.deletelabel),n&256&&(i.cancelText=s[8].strings.cancel),n&256&&(i.confirmText=s[8].strings.deletelabel),n&1&&(i.onCancel=s[28]),n&536871176&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function mi(l){let e,t;return e=new tn({props:{store:l[0],label:l[3],onCancel:l[27],onSubmit:l[16]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.label=s[3]),n&1&&(i.onCancel=s[27]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function di(l){let e=Ne(l[8].strings.deletelabelconfirm,l[3].name)+"",t;return{c(){t=I(e)},m(s,n){C(s,t,n)},p(s,n){n&264&&e!==(e=Ne(s[8].strings.deletelabelconfirm,s[3].name)+"")&&R(t,e)},d(s){s&&D(t)}}}function Zt(l){let e,t;return e=new Ge({props:{title:l[8].strings.emptytrash,cancelText:l[8].strings.cancel,confirmText:l[8].strings.emptytrash,confirmClass:"btn-danger",onCancel:l[26],onConfirm:l[20],$$slots:{default:[_i]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&256&&(i.title=s[8].strings.emptytrash),n&256&&(i.cancelText=s[8].strings.cancel),n&256&&(i.confirmText=s[8].strings.emptytrash),n&1&&(i.onCancel=s[26]),n&536871168&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function _i(l){let e=l[8].strings.emptytrashconfirm+"",t;return{c(){t=I(e)},m(s,n){C(s,t,n)},p(s,n){n&256&&e!==(e=s[8].strings.emptytrashconfirm+"")&&R(t,e)},d(s){s&&D(t)}}}function gi(l){let e,t,s,n,i,r,o,a,f,d,m,c,_=l[9]&&Jt(l);const b=[ui,fi],p=[];function v(w,M){return w[8].params.tray=="trash"?0:w[3]?1:-1}return~(o=v(l))&&(a=p[o]=b[o](l)),{c(){e=h("div"),t=h("button"),s=h("i"),i=L(),_&&_.c(),r=L(),a&&a.c(),f=be(),u(s,"class","fa fa-fw fa-ellipsis-v"),u(t,"type","button"),u(t,"class","local-mail-action-more-button btn dropdown-toggle"),t.disabled=l[10],u(t,"aria-expanded",l[9]),u(t,"title",n=l[8].strings.more),G(t,"btn-secondary",!l[1]),G(t,"disabled",l[10]),u(e,"class","btn-group"),G(e,"dropup",l[2])},m(w,M){C(w,e,M),g(e,t),g(t,s),g(e,i),_&&_.m(e,null),C(w,r,M),~o&&p[o].m(w,M),C(w,f,M),d=!0,m||(c=[J(t,"click",l[12]),Se(Fe.call(null,e,l[11]))],m=!0)},p(w,[M]){(!d||M&1024)&&(t.disabled=w[10]),(!d||M&512)&&u(t,"aria-expanded",w[9]),(!d||M&256&&n!==(n=w[8].strings.more))&&u(t,"title",n),(!d||M&2)&&G(t,"btn-secondary",!w[1]),(!d||M&1024)&&G(t,"disabled",w[10]),w[9]?_?_.p(w,M):(_=Jt(w),_.c(),_.m(e,null)):_&&(_.d(1),_=null),(!d||M&4)&&G(e,"dropup",w[2]);let $=o;o=v(w),o===$?~o&&p[o].p(w,M):(a&&(ie(),z(p[$],1,1,()=>{p[$]=null}),re()),~o?(a=p[o],a?a.p(w,M):(a=p[o]=b[o](w),a.c()),T(a,1),a.m(f.parentNode,f)):a=null)},i(w){d||(T(a),d=!0)},o(w){z(a),d=!1},d(w){w&&(D(e),D(r),D(f)),_&&_.d(),~o&&p[o].d(w),m=!1,we(c)}}}function pi(l,e,t){let s,n,i,r,o,a,f,d,m=F,c=()=>(m(),m=_e(_,Y=>t(8,d=Y)),_);l.$$.on_destroy.push(()=>m());let{store:_}=e;c();let{transparent:b=!1}=e,{dropup:p=!1}=e,v=!1;const w=()=>{t(9,v=!1)},M=()=>{t(9,v=!v)},$=Y=>{w(),_.setUnread(n.filter(Q=>!Q.draft).map(Q=>Q.id),Y)},k=Y=>{w(),_.setStarred(n.map(Q=>Q.id),Y)},y=()=>{w(),_.showDialog("editlabel")},q=(Y,Q)=>{_.hideDialog(),s&&_.updateLabel(s.id,Y,Q)},S=()=>{w(),_.showDialog("deletelabel")},N=()=>{_.hideDialog(),_.deleteLabel(d.params.labelid||0)},j=()=>{w(),_.showDialog("emptytrash")},B=()=>{_.hideDialog(),_.emptyTrash(d.params.courseid)},H=()=>$(!1),P=()=>$(!0),O=()=>k(!0),x=()=>k(!1),V=()=>_.hideDialog(),te=()=>_.hideDialog(),ae=()=>_.hideDialog();return l.$$set=Y=>{"store"in Y&&c(t(0,_=Y.store)),"transparent"in Y&&t(1,b=Y.transparent),"dropup"in Y&&t(2,p=Y.dropup)},l.$$.update=()=>{l.$$.dirty&256&&t(3,s=d.params.tray=="label"&&d.message==null?d.labels.find(Y=>Y.id==d.params.labelid):null),l.$$.dirty&256&&t(21,n=Array.from(d.selectedMessages.values())),l.$$.dirty&2097152&&t(7,i=n.some(Y=>!Y.draft&&!Y.unread)),l.$$.dirty&2097152&&t(6,r=n.some(Y=>!Y.draft&&Y.unread)),l.$$.dirty&2097152&&t(5,o=n.some(Y=>Y.starred)),l.$$.dirty&2097152&&t(4,a=n.some(Y=>!Y.starred)),l.$$.dirty&504&&t(10,f=d.params.tray=="trash"?!d.totalCount:!s&&!i&&!r&&!o&&!a)},[_,b,p,s,a,o,r,i,d,v,f,w,M,$,k,y,q,S,N,j,B,n,H,P,O,x,V,te,ae]}class ln extends ce{constructor(e){super(),me(this,e,pi,gi,oe,{store:0,transparent:1,dropup:2})}}function xt(l){let e,t;return{c(){e=h("div"),t=I(l[4]),u(e,"class","align-self-center text-nowrap")},m(s,n){C(s,e,n),g(e,t)},p(s,n){n&16&&R(t,s[4])},d(s){s&&D(e)}}}function es(l){let e,t;return{c(){e=h("div"),t=I(l[4]),u(e,"class","text-truncate align-self-center mx-2")},m(s,n){C(s,e,n),g(e,t)},p(s,n){n&16&&R(t,s[4])},d(s){s&&D(e)}}}function bi(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,M=!l[2]&&xt(l),$=l[2]&&es(l);return{c(){e=h("div"),M&&M.c(),t=L(),s=h("div"),n=h("button"),i=h("i"),f=L(),$&&$.c(),d=L(),m=h("button"),c=h("i"),u(i,"class","fa fa-w fa-chevron-left"),u(i,"aria-label",r=l[3].strings.previouspage),u(n,"type","button"),u(n,"class","btn btn-secondary"),n.disabled=o=!l[5],u(n,"title",a=l[3].strings[l[3].message?"previousmessage":"previouspage"]),G(n,"btn-secondary",!l[1]),u(c,"class","fa fa-w fa-chevron-right"),u(c,"aria-label",_=l[3].strings.nextpage),u(m,"type","button"),u(m,"class","btn"),m.disabled=b=!l[6],u(m,"title",p=l[3].strings[l[3].message?"nextmessage":"nextpage"]),G(m,"btn-secondary",!l[1]),u(s,"class","btn-group d-flex"),u(s,"role","group"),G(s,"btn-group",!l[2]),u(e,"class","local-mail-paging-buttons d-flex"),G(e,"ml-auto",!l[2])},m(k,y){C(k,e,y),M&&M.m(e,null),g(e,t),g(e,s),g(s,n),g(n,i),g(s,f),$&&$.m(s,null),g(s,d),g(s,m),g(m,c),v||(w=[J(n,"click",Te(l[9])),J(m,"click",Te(l[10]))],v=!0)},p(k,[y]){k[2]?M&&(M.d(1),M=null):M?M.p(k,y):(M=xt(k),M.c(),M.m(e,t)),y&8&&r!==(r=k[3].strings.previouspage)&&u(i,"aria-label",r),y&32&&o!==(o=!k[5])&&(n.disabled=o),y&8&&a!==(a=k[3].strings[k[3].message?"previousmessage":"previouspage"])&&u(n,"title",a),y&2&&G(n,"btn-secondary",!k[1]),k[2]?$?$.p(k,y):($=es(k),$.c(),$.m(s,d)):$&&($.d(1),$=null),y&8&&_!==(_=k[3].strings.nextpage)&&u(c,"aria-label",_),y&64&&b!==(b=!k[6])&&(m.disabled=b),y&8&&p!==(p=k[3].strings[k[3].message?"nextmessage":"nextpage"])&&u(m,"title",p),y&2&&G(m,"btn-secondary",!k[1]),y&4&&G(s,"btn-group",!k[2]),y&4&&G(e,"ml-auto",!k[2])},i:F,o:F,d(k){k&&D(e),M&&M.d(),$&&$.d(),v=!1,we(w)}}}function hi(l,e,t){let s,n,i,r,o,a,f=F,d=()=>(f(),f=_e(m,v=>t(3,a=v)),m);l.$$.on_destroy.push(()=>f());let{store:m}=e;d();let{transparent:c=!1}=e,{compact:_=!1}=e;const b=()=>m.navigate(r),p=()=>m.navigate(i);return l.$$set=v=>{"store"in v&&d(t(0,m=v.store)),"transparent"in v&&t(1,c=v.transparent),"compact"in v&&t(2,_=v.compact)},l.$$.update=()=>{var v;l.$$.dirty&8&&t(8,s=a.nextMessageId||!a.params.search&&(a.params.offset||0)+a.preferences.perpage<a.totalCount),l.$$.dirty&8&&t(7,n=a.prevMessageId||!a.params.search&&(a.params.offset||0)),l.$$.dirty&264&&t(6,i=s?a.message?{...a.params,messageid:a.nextMessageId,offset:(a.params.offset||0)+1}:{...a.params,messageid:void 0,offset:(a.params.offset||0)+a.preferences.perpage,search:a.params.search?{...a.params.search,startid:(v=a.listMessages[a.listMessages.length-1])==null?void 0:v.id,reverse:!1}:void 0}:void 0),l.$$.dirty&136&&t(5,r=n?a.message?{...a.params,messageid:a.prevMessageId,offset:Math.max(0,(a.params.offset||0)-1)}:{...a.params,messageid:void 0,offset:Math.max(0,(a.params.offset||0)-a.preferences.perpage),search:a.params.search?{...a.params.search,startid:a.listMessages[0].id,reverse:!0}:void 0}:void 0),l.$$.dirty&8&&t(4,o=a.message?a.params.search?(a.params.offset||0)+1:Ne(a.strings.pagingsingle,{index:(a.messageOffset||0)+1,total:a.totalCount}):a.listMessages.length==0?"":a.params.search?Ne(a.strings.pagingrange,{first:(a.params.offset||0)+1,last:(a.params.offset||0)+a.listMessages.length}):Ne(a.strings.pagingrangetotal,{first:(a.params.offset||0)+1,last:(a.params.offset||0)+a.listMessages.length,total:a.totalCount}))},[m,c,_,a,o,r,i,n,s,b,p]}class nn extends ce{constructor(e){super(),me(this,e,hi,bi,oe,{store:0,transparent:1,compact:2})}}function ts(l){let e,t;return e=new Ge({props:{title:l[2].strings.restore,cancelText:l[2].strings.cancel,confirmText:l[2].strings.restore,onCancel:l[5],onConfirm:l[3],$$slots:{default:[ki]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.restore),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.restore),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function ki(l){let e=l[2].strings.restoremessageconfirm+"",t;return{c(){t=I(e)},m(s,n){C(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings.restoremessageconfirm+"")&&R(t,e)},d(s){s&&D(t)}}}function vi(l){let e,t,s,n,i,r,o,a,f,d=l[2].params.dialog=="restore"&&ts(l);return{c(){e=h("button"),t=h("i"),i=L(),d&&d.c(),r=be(),u(t,"class","fa fa-fw fa-undo"),u(e,"type","button"),u(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.restore),G(e,"btn-secondary",!l[1]),G(e,"disabled",!l[2].selectedMessages.size)},m(m,c){C(m,e,c),g(e,t),C(m,i,c),d&&d.m(m,c),C(m,r,c),o=!0,a||(f=J(e,"click",l[4]),a=!0)},p(m,[c]){(!o||c&4&&s!==(s=!m[2].selectedMessages.size))&&(e.disabled=s),(!o||c&4&&n!==(n=m[2].strings.restore))&&u(e,"title",n),(!o||c&2)&&G(e,"btn-secondary",!m[1]),(!o||c&4)&&G(e,"disabled",!m[2].selectedMessages.size),m[2].params.dialog=="restore"?d?(d.p(m,c),c&4&&T(d,1)):(d=ts(m),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(ie(),z(d,1,1,()=>{d=null}),re())},i(m){o||(T(d),o=!0)},o(m){z(d),o=!1},d(m){m&&(D(e),D(i),D(r)),d&&d.d(m),a=!1,f()}}}function wi(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,m=>t(2,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:o=!1}=e;const a=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Pe.NotDeleted,!0)},f=()=>r.showDialog("restore"),d=()=>r.hideDialog();return l.$$set=m=>{"store"in m&&i(t(0,r=m.store)),"transparent"in m&&t(1,o=m.transparent)},[r,o,s,a,f,d]}class rn extends ce{constructor(e){super(),me(this,e,wi,vi,oe,{store:0,transparent:1})}}function $i(l){let e,t,s,n;return e=new sn({props:{store:l[0],transparent:!0,dropup:!0}}),s=new xl({props:{store:l[0],transparent:!0}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){W(e,i,r),C(i,t,r),W(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),X(e,i),X(s,i)}}}function yi(l){let e,t,s,n;return e=new rn({props:{store:l[0],transparent:!0}}),s=new en({props:{store:l[0],transparent:!0}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){W(e,i,r),C(i,t,r),W(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),X(e,i),X(s,i)}}}function Mi(l){let e,t,s,n,i,r,o,a,f,d,m;const c=[yi,$i],_=[];function b(p,v){return p[4].params.tray=="trash"?0:1}return n=b(l),i=_[n]=c[n](l),o=new ln({props:{store:l[0],transparent:!0,dropup:!0}}),f=new nn({props:{store:l[0],transparent:!0,compact:!0}}),{c(){e=h("div"),t=h("div"),s=h("div"),i.c(),r=L(),K(o.$$.fragment),a=L(),K(f.$$.fragment),u(s,"class","w-100 d-flex justify-content-around"),u(s,"role","group"),u(t,"role","toolbar"),u(t,"class","local-mail-toolbar d-flex w-100 py-3 border-top svelte-hn1exj"),je(()=>l[5].call(t)),G(t,"position-fixed",l[3]),G(t,"position-absolute",!l[3]),G(t,"fixed-bottom",l[3]),G(t,"border-bottom",!l[3]),G(t,"bg-white",!l[3]),G(t,"bg-light",l[3]),u(e,"class","row position-relative"),ge(e,"height",l[1]+"px")},m(p,v){C(p,e,v),g(e,t),g(t,s),_[n].m(s,null),g(s,r),W(o,s,null),g(s,a),W(f,s,null),d=Cn(t,l[5].bind(t)),l[6](e),m=!0},p(p,[v]){let w=n;n=b(p),n===w?_[n].p(p,v):(ie(),z(_[w],1,1,()=>{_[w]=null}),re(),i=_[n],i?i.p(p,v):(i=_[n]=c[n](p),i.c()),T(i,1),i.m(s,r));const M={};v&1&&(M.store=p[0]),o.$set(M);const $={};v&1&&($.store=p[0]),f.$set($),(!m||v&8)&&G(t,"position-fixed",p[3]),(!m||v&8)&&G(t,"position-absolute",!p[3]),(!m||v&8)&&G(t,"fixed-bottom",p[3]),(!m||v&8)&&G(t,"border-bottom",!p[3]),(!m||v&8)&&G(t,"bg-white",!p[3]),(!m||v&8)&&G(t,"bg-light",p[3]),(!m||v&2)&&ge(e,"height",p[1]+"px")},i(p){m||(T(i),T(o.$$.fragment,p),T(f.$$.fragment,p),m=!0)},o(p){z(i),z(o.$$.fragment,p),z(f.$$.fragment,p),m=!1},d(p){p&&D(e),_[n].d(),X(o),X(f),d(),l[6](null)}}}function Ci(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,c=>t(4,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let o,a,f=!1;Ze(()=>{const c=new IntersectionObserver(_=>{for(const b of _)t(3,f=b.intersectionRatio<1&&b.boundingClientRect.top>=b.boundingClientRect.height)},{threshold:1});return c.observe(a),()=>c.disconnect()});function d(){o=this.offsetHeight,t(1,o)}function m(c){Me[c?"unshift":"push"](()=>{a=c,t(2,a)})}return l.$$set=c=>{"store"in c&&i(t(0,r=c.store))},[r,o,a,f,s,d,m]}class Di extends ce{constructor(e){super(),me(this,e,Ci,Mi,oe,{store:0})}}function an(l,{from:e,to:t},s={}){const n=getComputedStyle(l),i=n.transform==="none"?"":n.transform,[r,o]=n.transformOrigin.split(" ").map(parseFloat),a=e.left+e.width*r/t.width-(t.left+r),f=e.top+e.height*o/t.height-(t.top+o),{delay:d=0,duration:m=_=>Math.sqrt(_)*120,easing:c=Zl}=s;return{delay:d,duration:Ce(m)?m(Math.sqrt(a*a+f*f)):m,easing:c,css:(_,b)=>{const p=b*a,v=b*f,w=_+b*e.width/t.width,M=_+b*e.height/t.height;return`transform: ${i} translate(${p}px, ${v}px) scale(${w}, ${M});`}}}function Si(l){let e,t,s,n,i,r,o;return{c(){e=h("button"),t=h("i"),u(t,"class",s="fa align-middle "+l[3]),u(e,"type","button"),u(e,"class","btn px-2"),u(e,"role","checkbox"),u(e,"aria-checked",n=!!l[2].selectedMessages.has(l[1].id)),u(e,"title",i=l[2].strings.select)},m(a,f){C(a,e,f),g(e,t),r||(o=J(e,"click",Ol(Te(l[4]))),r=!0)},p(a,[f]){f&8&&s!==(s="fa align-middle "+a[3])&&u(t,"class",s),f&6&&n!==(n=!!a[2].selectedMessages.has(a[1].id))&&u(e,"aria-checked",n),f&4&&i!==(i=a[2].strings.select)&&u(e,"title",i)},i:F,o:F,d(a){a&&D(e),r=!1,o()}}}function Ti(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,d=>t(2,n=d)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;const f=()=>o.toggleSelected(a.id);return l.$$set=d=>{"store"in d&&r(t(0,o=d.store)),"message"in d&&t(1,a=d.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=n.selectedMessages.has(a.id)?"fa-check-square-o":"fa-square-o")},[o,a,n,s,f]}class on extends ce{constructor(e){super(),me(this,e,Ti,Si,oe,{store:0,message:1})}}function Li(l){let e,t,s,n,i,r,o,a;return{c(){e=h("button"),t=h("i"),u(t,"class",s="fa "+l[2]),u(e,"type","button"),u(e,"class","btn px-2"),u(e,"role","checkbox"),u(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,u(e,"title",r=l[1].deleted?l[3].strings[l[1].starred?"starred":"unstarred"]:l[3].strings[l[1].starred?"markasunstarred":"markasstarred"])},m(f,d){C(f,e,d),g(e,t),o||(a=J(e,"click",Ol(Te(l[4]))),o=!0)},p(f,[d]){d&4&&s!==(s="fa "+f[2])&&u(t,"class",s),d&2&&n!==(n=f[1].starred)&&u(e,"aria-checked",n),d&2&&i!==(i=f[1].deleted)&&(e.disabled=i),d&10&&r!==(r=f[1].deleted?f[3].strings[f[1].starred?"starred":"unstarred"]:f[3].strings[f[1].starred?"markasunstarred":"markasstarred"])&&u(e,"title",r)},i:F,o:F,d(f){f&&D(e),o=!1,a()}}}function zi(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,d=>t(3,n=d)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;const f=()=>o.setStarred([a.id],!a.starred);return l.$$set=d=>{"store"in d&&r(t(0,o=d.store)),"message"in d&&t(1,a=d.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=a.starred?"fa-star text-warning":"fa-star-o")},[o,a,s,n,f]}class fn extends ce{constructor(e){super(),me(this,e,zi,Li,oe,{store:0,message:1})}}function ji(l){let e,t=l[1].join(", ")+"",s,n,i,r;return{c(){e=h("div"),s=I(t)},m(o,a){C(o,e,a),g(e,s),i||(r=Se(n=Re.call(null,e,l[1].join(`
`))),i=!0)},p(o,[a]){a&2&&t!==(t=o[1].join(", ")+"")&&R(s,t),n&&Ce(n.update)&&a&2&&n.update.call(null,o[1].join(`
`))},i:F,o:F,d(o){o&&D(e),i=!1,r()}}}function Ni(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,f=>t(3,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;return l.$$set=f=>{"store"in f&&r(t(0,o=f.store)),"message"in f&&t(2,a=f.message)},l.$$.update=()=>{l.$$.dirty&12&&t(1,s=n.params.tray=="sent"||n.params.tray=="drafts"?a.recipients.length>0?a.recipients.map(f=>f.fullname):[n.strings.norecipient]:[a.sender.fullname])},[o,s,a,n]}class _t extends ce{constructor(e){super(),me(this,e,Ni,ji,oe,{store:0,message:2})}}function ss(l){let e,t=l[2].strings.draft+"",s;return{c(){e=h("span"),s=I(t),u(e,"class","mr-2 text-danger")},m(n,i){C(n,e,i),g(e,s)},p(n,i){i&4&&t!==(t=n[2].strings.draft+"")&&R(s,t)},d(n){n&&D(e)}}}function Ai(l){let e,t,s=(l[1].subject||l[2].strings.nosubject)+"",n,i,r,o,a=l[1].draft&&ss(l);return{c(){e=h("div"),a&&a.c(),t=L(),n=I(s)},m(f,d){C(f,e,d),a&&a.m(e,null),g(e,t),g(e,n),r||(o=Se(i=Re.call(null,e,l[1].subject||l[2].strings.nosubject)),r=!0)},p(f,[d]){f[1].draft?a?a.p(f,d):(a=ss(f),a.c(),a.m(e,t)):a&&(a.d(1),a=null),d&6&&s!==(s=(f[1].subject||f[2].strings.nosubject)+"")&&R(n,s),i&&Ce(i.update)&&d&6&&i.update.call(null,f[1].subject||f[2].strings.nosubject)},i:F,o:F,d(f){f&&D(e),a&&a.d(),r=!1,o()}}}function qi(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class gt extends ce{constructor(e){super(),me(this,e,qi,Ai,oe,{store:0,message:1})}}function ls(l){let e,t,s,n,i;return{c(){e=h("span"),t=I(l[2]),u(e,"class","local-mail-course-badge badge px-2 mr-2 mb-2"),ge(e,"min-width","3rem"),ge(e,"max-width","calc("+l[1]+"ch + 1.5rem)")},m(r,o){C(r,e,o),g(e,t),n||(i=Se(s=Re.call(null,e,l[2])),n=!0)},p(r,o){o&4&&R(t,r[2]),o&2&&ge(e,"max-width","calc("+r[1]+"ch + 1.5rem)"),s&&Ce(s.update)&&o&4&&s.update.call(null,r[2])},d(r){r&&D(e),n=!1,i()}}}function Bi(l){let e=["shortname","fullname"].includes(l[0].coursebadges),t,s=e&&ls(l);return{c(){s&&s.c(),t=be()},m(n,i){s&&s.m(n,i),C(n,t,i)},p(n,[i]){i&1&&(e=["shortname","fullname"].includes(n[0].coursebadges)),e?s?s.p(n,i):(s=ls(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:F,o:F,d(n){n&&D(t),s&&s.d(n)}}}function Ei(l,e,t){let s,n,{course:i}=e,{settings:r}=e;return l.$$set=o=>{"course"in o&&t(3,i=o.course),"settings"in o&&t(0,r=o.settings)},l.$$.update=()=>{l.$$.dirty&9&&t(2,s=We(i,r.coursebadges)),l.$$.dirty&1&&t(1,n=r.coursebadgeslength||20)},[r,n,s,i]}class pt extends ce{constructor(e){super(),me(this,e,Ei,Bi,oe,{course:3,settings:0})}}function Ii(l){let e,t=l[0].name+"",s,n;return{c(){e=h("span"),s=I(t),u(e,"class","local-mail-label-badge badge flex-shrink-0 px-2 mr-2 mb-2"),u(e,"style",n=`color: var(--local-mail-color-${l[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${l[1]}-bg, var(--local-mail-color-gray-bg))`)},m(i,r){C(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].name+"")&&R(s,t),r&2&&n!==(n=`color: var(--local-mail-color-${i[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${i[1]}-bg, var(--local-mail-color-gray-bg))`)&&u(e,"style",n)},i:F,o:F,d(i){i&&D(e)}}}function Pi(l,e,t){let s,{label:n}=e;return l.$$set=i=>{"label"in i&&t(0,n=i.label)},l.$$.update=()=>{l.$$.dirty&1&&t(1,s=nt.includes(n.color)?n.color:"gray")},[n,s]}class bt extends ce{constructor(e){super(),me(this,e,Pi,Ii,oe,{label:0})}}function ns(l,e,t){const s=l.slice();return s[3]=e[t],s}function is(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&rs(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),C(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&T(s,1)):(s=rs(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function rs(l){let e,t;return e=new pt({props:{course:l[1].course,settings:l[2].settings}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function as(l){let e,t;return e=new bt({props:{label:l[3]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.label=s[3]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function os(l,e){let t,s,n,i=(e[2].params.tray!="label"||e[2].params.labelid!=e[3].id)&&as(e);return{key:l,first:null,c(){t=be(),i&&i.c(),s=be(),this.first=t},m(r,o){C(r,t,o),i&&i.m(r,o),C(r,s,o),n=!0},p(r,o){e=r,e[2].params.tray!="label"||e[2].params.labelid!=e[3].id?i?(i.p(e,o),o&6&&T(i,1)):(i=as(e),i.c(),T(i,1),i.m(s.parentNode,s)):i&&(ie(),z(i,1,1,()=>{i=null}),re())},i(r){n||(T(i),n=!0)},o(r){z(i),n=!1},d(r){r&&(D(t),D(s)),i&&i.d(r)}}}function fs(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&us(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),C(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&T(s,1)):(s=us(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function us(l){let e,t;return e=new pt({props:{course:l[1].course,settings:l[2].settings}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Ri(l){let e,t=[],s=new Map,n,i,r,o=l[2].viewportSize<de.MD&&is(l),a=ue(l[1].labels);const f=m=>m[3].id;for(let m=0;m<a.length;m+=1){let c=ns(l,a,m),_=f(c);s.set(_,t[m]=os(_,c))}let d=l[2].viewportSize>=de.MD&&fs(l);return{c(){o&&o.c(),e=L();for(let m=0;m<t.length;m+=1)t[m].c();n=L(),d&&d.c(),i=be()},m(m,c){o&&o.m(m,c),C(m,e,c);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(m,c);C(m,n,c),d&&d.m(m,c),C(m,i,c),r=!0},p(m,[c]){m[2].viewportSize<de.MD?o?(o.p(m,c),c&4&&T(o,1)):(o=is(m),o.c(),T(o,1),o.m(e.parentNode,e)):o&&(ie(),z(o,1,1,()=>{o=null}),re()),c&6&&(a=ue(m[1].labels),ie(),t=Le(t,c,f,1,m,a,s,n.parentNode,Ue,os,n,ns),re()),m[2].viewportSize>=de.MD?d?(d.p(m,c),c&4&&T(d,1)):(d=fs(m),d.c(),T(d,1),d.m(i.parentNode,i)):d&&(ie(),z(d,1,1,()=>{d=null}),re())},i(m){if(!r){T(o);for(let c=0;c<a.length;c+=1)T(t[c]);T(d),r=!0}},o(m){z(o);for(let c=0;c<t.length;c+=1)z(t[c]);z(d),r=!1},d(m){m&&(D(e),D(n),D(i)),o&&o.d(m);for(let c=0;c<t.length;c+=1)t[c].d(m);d&&d.d(m)}}}function Fi(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class un extends ce{constructor(e){super(),me(this,e,Fi,Ri,oe,{store:0,message:1})}}function cs(l){let e,t,s,n,i;return{c(){e=h("span"),t=h("i"),u(t,"class",s="fa fa-fw "+(l[1].numattachments>0?"fa-paperclip":"")),u(t,"aria-hidden",!0),u(e,"class","-shrink-0 mr-2"),u(e,"aria-hidden",n=l[1].numattachments==0),u(e,"title",i=l[1].numattachments>0?l[2].strings.hasattachments:void 0)},m(r,o){C(r,e,o),g(e,t)},p(r,o){o&2&&s!==(s="fa fa-fw "+(r[1].numattachments>0?"fa-paperclip":""))&&u(t,"class",s),o&2&&n!==(n=r[1].numattachments==0)&&u(e,"aria-hidden",n),o&6&&i!==(i=r[1].numattachments>0?r[2].strings.hasattachments:void 0)&&u(e,"title",i)},d(r){r&&D(e)}}}function Ui(l){let e,t=(l[1].numattachments>0||l[2].viewportSize>=de.MD)&&cs(l);return{c(){t&&t.c(),e=be()},m(s,n){t&&t.m(s,n),C(s,e,n)},p(s,[n]){s[1].numattachments>0||s[2].viewportSize>=de.MD?t?t.p(s,n):(t=cs(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:F,o:F,d(s){s&&D(e),t&&t.d(s)}}}function Gi(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class cn extends ce{constructor(e){super(),me(this,e,Gi,Ui,oe,{store:0,message:1})}}function Hi(l){let e,t=l[0].shorttime+"",s,n;return{c(){e=h("span"),s=I(t),u(e,"class","local-mail-list-message-time d-shrink-0 text-nowrap text-right"),u(e,"title",n=l[0].fulltime),G(e,"local-mail-list-message-time-md",l[2].viewportSize>=de.MD)},m(i,r){C(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].shorttime+"")&&R(s,t),r&1&&n!==(n=i[0].fulltime)&&u(e,"title",n),r&4&&G(e,"local-mail-list-message-time-md",i[2].viewportSize>=de.MD)},i:F,o:F,d(i){i&&D(e)}}}function Oi(l,e,t){let s,n=F,i=()=>(n(),n=_e(o,a=>t(2,s=a)),o);l.$$.on_destroy.push(()=>n());let{message:r}=e,{store:o}=e;return i(),l.$$set=a=>{"message"in a&&t(0,r=a.message),"store"in a&&i(t(1,o=a.store))},[r,o,s]}class mn extends ce{constructor(e){super(),me(this,e,Oi,Hi,oe,{message:0,store:1})}}function ms(l){let e,t,s=l[1].strings.nomessagesfound+"",n,i,r,o=l[1].totalCount>0&&ds(l);return{c(){e=h("div"),t=h("div"),n=I(s),i=L(),o&&o.c(),u(e,"class","alert alert-info")},m(a,f){C(a,e,f),g(e,t),g(t,n),g(e,i),o&&o.m(e,null)},p(a,f){f&2&&s!==(s=a[1].strings.nomessagesfound+"")&&R(n,s),a[1].totalCount>0?o?o.p(a,f):(o=ds(a),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(a){a&&(r||je(()=>{r=mt(e,qe,{delay:400}),r.start()}))},o:F,d(a){a&&D(e),o&&o.d()}}}function ds(l){let e,t=l[1].strings.showrecentmessages+"",s,n,i,r;return{c(){e=h("a"),s=I(t),u(e,"class","btn btn-info text-white mt-3"),u(e,"href",n=Ie(l[2]))},m(o,a){C(o,e,a),g(e,s),i||(r=J(e,"click",Te(l[3])),i=!0)},p(o,a){a&2&&t!==(t=o[1].strings.showrecentmessages+"")&&R(s,t),a&4&&n!==(n=Ie(o[2]))&&u(e,"href",n)},d(o){o&&D(e),i=!1,r()}}}function Ji(l){let e,t=!l[1].listMessages.length&&ms(l);return{c(){t&&t.c(),e=be()},m(s,n){t&&t.m(s,n),C(s,e,n)},p(s,[n]){s[1].listMessages.length?t&&(t.d(1),t=null):t?(t.p(s,n),n&2&&T(t,1)):(t=ms(s),t.c(),T(t,1),t.m(e.parentNode,e))},i(s){T(t)},o:F,d(s){s&&D(e),t&&t.d(s)}}}function Vi(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,f=>t(1,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();const a=()=>o.navigate(s);return l.$$set=f=>{"store"in f&&r(t(0,o=f.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s={tray:n.params.tray,courseid:n.params.courseid,labelid:n.params.labelid})},[o,n,s,a]}class Ki extends ce{constructor(e){super(),me(this,e,Vi,Ji,oe,{store:0})}}function _s(l,e,t){const s=l.slice();return s[4]=e[t],s[6]=t,s}function Wi(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,M,$,k,y;return t=new on({props:{store:l[0],message:l[4]}}),r=new _t({props:{store:l[0],message:l[4]}}),a=new cn({props:{store:l[0],message:l[4]}}),m=new mn({props:{store:l[0],message:l[4]}}),p=new gt({props:{store:l[0],message:l[4]}}),w=new fn({props:{store:l[0],message:l[4]}}),k=new un({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),K(t.$$.fragment),s=L(),n=h("div"),i=h("div"),K(r.$$.fragment),o=L(),K(a.$$.fragment),f=L(),d=h("div"),K(m.$$.fragment),c=L(),_=h("div"),b=h("div"),K(p.$$.fragment),v=L(),K(w.$$.fragment),M=L(),$=h("div"),K(k.$$.fragment),u(d,"class","ml-auto mr-2"),u(i,"class","d-flex mt-2"),u(b,"class","d-flex w-100 my-2 mr-2"),ge(b,"min-width","0"),u(_,"class","d-flex"),u($,"class","d-flex flex-wrap ml-n2 mr-2"),u(n,"class","w-100 ml-1"),ge(n,"min-width","0"),u(e,"class","d-flex align-items-start pt-1 pb-2 pl-1 pr-2")},m(q,S){C(q,e,S),W(t,e,null),g(e,s),g(e,n),g(n,i),W(r,i,null),g(i,o),W(a,i,null),g(i,f),g(i,d),W(m,d,null),g(n,c),g(n,_),g(_,b),W(p,b,null),g(_,v),W(w,_,null),g(n,M),g(n,$),W(k,$,null),y=!0},p(q,S){const N={};S&1&&(N.store=q[0]),S&2&&(N.message=q[4]),t.$set(N);const j={};S&1&&(j.store=q[0]),S&2&&(j.message=q[4]),r.$set(j);const B={};S&1&&(B.store=q[0]),S&2&&(B.message=q[4]),a.$set(B);const H={};S&1&&(H.store=q[0]),S&2&&(H.message=q[4]),m.$set(H);const P={};S&1&&(P.store=q[0]),S&2&&(P.message=q[4]),p.$set(P);const O={};S&1&&(O.store=q[0]),S&2&&(O.message=q[4]),w.$set(O);const x={};S&1&&(x.store=q[0]),S&2&&(x.message=q[4]),k.$set(x)},i(q){y||(T(t.$$.fragment,q),T(r.$$.fragment,q),T(a.$$.fragment,q),T(m.$$.fragment,q),T(p.$$.fragment,q),T(w.$$.fragment,q),T(k.$$.fragment,q),y=!0)},o(q){z(t.$$.fragment,q),z(r.$$.fragment,q),z(a.$$.fragment,q),z(m.$$.fragment,q),z(p.$$.fragment,q),z(w.$$.fragment,q),z(k.$$.fragment,q),y=!1},d(q){q&&D(e),X(t),X(r),X(a),X(m),X(p),X(w),X(k)}}}function Xi(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,M,$;return t=new on({props:{store:l[0],message:l[4]}}),n=new fn({props:{store:l[0],message:l[4]}}),a=new _t({props:{store:l[0],message:l[4]}}),m=new gt({props:{store:l[0],message:l[4]}}),b=new un({props:{store:l[0],message:l[4]}}),v=new cn({props:{store:l[0],message:l[4]}}),M=new mn({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),K(t.$$.fragment),s=L(),K(n.$$.fragment),i=L(),r=h("div"),o=h("div"),K(a.$$.fragment),f=L(),d=h("div"),K(m.$$.fragment),c=L(),_=h("div"),K(b.$$.fragment),p=L(),K(v.$$.fragment),w=L(),K(M.$$.fragment),u(o,"class","flex-grow-1 mx-2"),ge(o,"width","25%"),ge(o,"min-width","0"),u(_,"class","d-flex text-truncate flex-shrink-0 justify-content-end mb-n2 ml-auto"),ge(_,"max-width","80%"),u(d,"class","flex-grow-1 d-flex my-2 mx-2"),ge(d,"width","75%"),ge(d,"min-width","0"),u(r,"class","d-flex w-100 flex-grow-1 align-items-center"),ge(r,"min-width","0"),u(e,"class","d-flex align-items-center pl-1 pr-3")},m(k,y){C(k,e,y),W(t,e,null),g(e,s),W(n,e,null),g(e,i),g(e,r),g(r,o),W(a,o,null),g(r,f),g(r,d),W(m,d,null),g(d,c),g(d,_),W(b,_,null),g(e,p),W(v,e,null),g(e,w),W(M,e,null),$=!0},p(k,y){const q={};y&1&&(q.store=k[0]),y&2&&(q.message=k[4]),t.$set(q);const S={};y&1&&(S.store=k[0]),y&2&&(S.message=k[4]),n.$set(S);const N={};y&1&&(N.store=k[0]),y&2&&(N.message=k[4]),a.$set(N);const j={};y&1&&(j.store=k[0]),y&2&&(j.message=k[4]),m.$set(j);const B={};y&1&&(B.store=k[0]),y&2&&(B.message=k[4]),b.$set(B);const H={};y&1&&(H.store=k[0]),y&2&&(H.message=k[4]),v.$set(H);const P={};y&1&&(P.store=k[0]),y&2&&(P.message=k[4]),M.$set(P)},i(k){$||(T(t.$$.fragment,k),T(n.$$.fragment,k),T(a.$$.fragment,k),T(m.$$.fragment,k),T(b.$$.fragment,k),T(v.$$.fragment,k),T(M.$$.fragment,k),$=!0)},o(k){z(t.$$.fragment,k),z(n.$$.fragment,k),z(a.$$.fragment,k),z(m.$$.fragment,k),z(b.$$.fragment,k),z(v.$$.fragment,k),z(M.$$.fragment,k),$=!1},d(k){k&&D(e),X(t),X(n),X(a),X(m),X(b),X(v),X(M)}}}function gs(l,e){let t,s,n,i,r,o,a,f=F,d,m,c;const _=[Xi,Wi],b=[];function p(w,M){return w[1].viewportSize>=de.MD?0:1}s=p(e),n=b[s]=_[s](e);function v(){return e[3](e[4],e[6])}return{key:l,first:null,c(){t=h("a"),n.c(),u(t,"class","local-mail-list-message list-group-item list-group-item-action p-0"),u(t,"href",i=Ie(e[2](e[4],e[6]))),G(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),G(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),G(t,"font-weight-bold",e[4].unread),this.first=t},m(w,M){C(w,t,M),b[s].m(t,null),d=!0,m||(c=J(t,"click",Te(v)),m=!0)},p(w,M){e=w;let $=s;s=p(e),s===$?b[s].p(e,M):(ie(),z(b[$],1,1,()=>{b[$]=null}),re(),n=b[s],n?n.p(e,M):(n=b[s]=_[s](e),n.c()),T(n,1),n.m(t,null)),(!d||M&2&&i!==(i=Ie(e[2](e[4],e[6]))))&&u(t,"href",i),(!d||M&2)&&G(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),(!d||M&2)&&G(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),(!d||M&2)&&G(t,"font-weight-bold",e[4].unread)},r(){a=t.getBoundingClientRect()},f(){Ql(t),f(),dt(t,a)},a(){f(),f=Yl(t,a,an,{delay:400,duration:400})},i(w){d||(T(n),w&&je(()=>{d&&(o&&o.end(1),r=mt(t,qe,{delay:400}),r.start())}),d=!0)},o(w){z(n),r&&r.invalidate(),w&&(o=Vl(t,qe,{duration:400})),d=!1},d(w){w&&D(t),b[s].d(),w&&o&&o.end(),m=!1,c()}}}function ps(l){let e,t=[],s=new Map,n,i,r,o=ue(l[1].listMessages);const a=f=>f[4].id;for(let f=0;f<o.length;f+=1){let d=_s(l,o,f),m=a(d);s.set(m,t[f]=gs(m,d))}return i=new Ki({props:{store:l[0]}}),{c(){e=h("div");for(let f=0;f<t.length;f+=1)t[f].c();n=L(),K(i.$$.fragment),u(e,"class","list-group")},m(f,d){C(f,e,d);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(e,null);g(e,n),W(i,e,null),r=!0},p(f,d){if(d&7){o=ue(f[1].listMessages),ie();for(let c=0;c<t.length;c+=1)t[c].r();t=Le(t,d,a,1,f,o,s,e,Jl,gs,n,_s);for(let c=0;c<t.length;c+=1)t[c].a();re()}const m={};d&1&&(m.store=f[0]),i.$set(m)},i(f){if(!r){for(let d=0;d<o.length;d+=1)T(t[d]);T(i.$$.fragment,f),r=!0}},o(f){for(let d=0;d<t.length;d+=1)z(t[d]);z(i.$$.fragment,f),r=!1},d(f){f&&D(e);for(let d=0;d<t.length;d+=1)t[d].d();X(i)}}}function Yi(l){let e=l[1].navigationId,t,s,n=ps(l);return{c(){n.c(),t=be()},m(i,r){n.m(i,r),C(i,t,r),s=!0},p(i,[r]){r&2&&oe(e,e=i[1].navigationId)?(ie(),z(n,1,1,F),re(),n=ps(i),n.c(),T(n,1),n.m(t.parentNode,t)):n.p(i,r)},i(i){s||(T(n),s=!0)},o(i){z(n),s=!1},d(i){i&&D(t),n.d(i)}}}function Qi(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=(f,d)=>({...s.params,messageid:f.id,offset:(s.params.offset||0)+d}),a=(f,d)=>r.navigate(o(f,d));return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,o,a]}class Zi extends ce{constructor(e){super(),me(this,e,Qi,Yi,oe,{store:0})}}function bs(l){let e,t,s,n,i,r,o,a=l[3]&&hs(l);return{c(){e=h("div"),t=h("button"),s=h("i"),i=L(),a&&a.c(),u(s,"class","fa fa-fw fa-ellipsis-v align-middle"),u(t,"type","button"),u(t,"class","btn"),u(t,"aria-expanded",l[3]),u(t,"title",n=l[5].strings.more),u(e,"class","dropdown")},m(f,d){C(f,e,d),g(e,t),g(t,s),g(e,i),a&&a.m(e,null),r||(o=[J(t,"click",l[6]),Se(Fe.call(null,e,l[7]))],r=!0)},p(f,d){d&8&&u(t,"aria-expanded",f[3]),d&32&&n!==(n=f[5].strings.more)&&u(t,"title",n),f[3]?a?a.p(f,d):(a=hs(f),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(f){f&&D(e),a&&a.d(),r=!1,we(o)}}}function hs(l){let e,t,s,n,i=l[5].strings.reply+"",r,o,a,f,d,m=l[5].strings.replyall+"",c,_,b,p,v,w,M=l[5].strings.forward+"",$,k,y;return{c(){e=h("div"),t=h("button"),s=h("i"),n=L(),r=I(i),o=L(),a=h("button"),f=h("i"),d=L(),c=I(m),b=L(),p=h("button"),v=h("i"),w=L(),$=I(M),u(s,"class","fa fa-fw fa-reply"),u(s,"aria-hidden","true"),u(t,"type","button"),u(t,"class","dropdown-item"),u(f,"class","fa fa-fw fa-reply-all"),u(f,"aria-hidden","true"),u(a,"type","button"),a.disabled=_=!l[2],u(a,"class","dropdown-item"),G(a,"disabled",!l[2]),u(v,"class","fa fa-fw fa-share"),u(v,"aria-hidden","true"),u(p,"type","button"),u(p,"class","dropdown-item"),u(e,"class","dropdown-menu dropdown-menu-right show")},m(q,S){C(q,e,S),g(e,t),g(t,s),g(t,n),g(t,r),g(e,o),g(e,a),g(a,f),g(a,d),g(a,c),g(e,b),g(e,p),g(p,v),g(p,w),g(p,$),k||(y=[J(t,"click",l[9]),J(a,"click",l[10]),J(p,"click",l[11])],k=!0)},p(q,S){S&32&&i!==(i=q[5].strings.reply+"")&&R(r,i),S&32&&m!==(m=q[5].strings.replyall+"")&&R(c,m),S&4&&_!==(_=!q[2])&&(a.disabled=_),S&4&&G(a,"disabled",!q[2]),S&32&&M!==(M=q[5].strings.forward+"")&&R($,M)},d(q){q&&D(e),k=!1,we(y)}}}function ks(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b;return{c(){e=h("button"),t=h("i"),n=L(),i=h("button"),r=h("i"),f=L(),d=h("button"),m=h("i"),u(t,"class","fa fa-fw fa-reply"),u(t,"aria-hidden","true"),u(e,"type","button"),u(e,"title",s=l[5].strings.reply),u(e,"class","btn py-2 border-0"),u(r,"class","fa fa-fw fa-reply-all"),u(r,"aria-hidden","true"),u(i,"type","button"),i.disabled=o=!l[2],u(i,"title",a=l[5].strings.replyall),u(i,"class","btn py-2 border-0"),G(i,"disabled",!l[2]),u(m,"class","fa fa-fw fa-share"),u(m,"aria-hidden","true"),u(d,"type","button"),u(d,"title",c=l[5].strings.forward),u(d,"class","btn py-2 border-0")},m(p,v){C(p,e,v),g(e,t),C(p,n,v),C(p,i,v),g(i,r),C(p,f,v),C(p,d,v),g(d,m),_||(b=[J(e,"click",l[12]),J(i,"click",l[13]),J(d,"click",l[14])],_=!0)},p(p,v){v&32&&s!==(s=p[5].strings.reply)&&u(e,"title",s),v&4&&o!==(o=!p[2])&&(i.disabled=o),v&32&&a!==(a=p[5].strings.replyall)&&u(i,"title",a),v&4&&G(i,"disabled",!p[2]),v&32&&c!==(c=p[5].strings.forward)&&u(d,"title",c)},d(p){p&&(D(e),D(n),D(i),D(f),D(d)),_=!1,we(b)}}}function xi(l){let e,t,s,n,i,r,o,a,f,d,m,c=l[5].viewportSize<de.SM&&bs(l),_=l[5].viewportSize>=de.SM&&ks(l);return{c(){e=h("button"),t=h("i"),o=L(),c&&c.c(),a=L(),_&&_.c(),f=be(),u(t,"class",s="fa "+l[4]),u(e,"type","button"),u(e,"class","btn py-2 border-0"),u(e,"role","checkbox"),u(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,u(e,"title",r=l[1].starred?l[5].strings.markasunstarred:l[5].strings.markasstarred)},m(b,p){C(b,e,p),g(e,t),C(b,o,p),c&&c.m(b,p),C(b,a,p),_&&_.m(b,p),C(b,f,p),d||(m=J(e,"click",l[8]),d=!0)},p(b,[p]){p&16&&s!==(s="fa "+b[4])&&u(t,"class",s),p&2&&n!==(n=b[1].starred)&&u(e,"aria-checked",n),p&2&&i!==(i=b[1].deleted)&&(e.disabled=i),p&34&&r!==(r=b[1].starred?b[5].strings.markasunstarred:b[5].strings.markasstarred)&&u(e,"title",r),b[5].viewportSize<de.SM?c?c.p(b,p):(c=bs(b),c.c(),c.m(a.parentNode,a)):c&&(c.d(1),c=null),b[5].viewportSize>=de.SM?_?_.p(b,p):(_=ks(b),_.c(),_.m(f.parentNode,f)):_&&(_.d(1),_=null)},i:F,o:F,d(b){b&&(D(e),D(o),D(a),D(f)),c&&c.d(b),_&&_.d(b),d=!1,m()}}}function er(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,k=>t(5,n=k)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e,{canReplyAll:f}=e,d=!1;const m=()=>{t(3,d=!d)},c=()=>{t(3,d=!1)},_=()=>o.setStarred([a.id],!a.starred),b=()=>o.reply(a,!1),p=()=>o.reply(a,!0),v=()=>o.forward(a),w=()=>o.reply(a,!1),M=()=>o.reply(a,!0),$=()=>o.forward(a);return l.$$set=k=>{"store"in k&&r(t(0,o=k.store)),"message"in k&&t(1,a=k.message),"canReplyAll"in k&&t(2,f=k.canReplyAll)},l.$$.update=()=>{l.$$.dirty&2&&t(4,s=a.starred?"fa-star text-warning":"fa-star-o")},[o,a,f,d,s,n,m,c,_,b,p,v,w,M,$]}class tr extends ce{constructor(e){super(),me(this,e,er,xi,oe,{store:0,message:1,canReplyAll:2})}}function vs(l,e,t){const s=l.slice();return s[3]=e[t],s}function ws(l){let e,t,s,n,i,r,o,a,f,d=l[2](l[3])+"",m,c,_,b,p=St(l[3].filesize)+"",v,w,M,$;return{c(){e=h("a"),t=h("img"),i=L(),r=h("i"),o=L(),a=h("div"),f=h("div"),m=I(d),_=L(),b=h("div"),v=I(p),u(t,"aria-hidden","true"),u(t,"alt",s=l[3].filename),it(t.src,n=l[3].iconurl)||u(t,"src",n),u(t,"width","24"),u(t,"height","24"),u(t,"class","flex-shrink-0"),u(r,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),u(r,"aria-hidden","true"),ge(r,"width","24px"),ge(r,"height","24px"),u(b,"class","text-left text-muted"),u(a,"class","ml-2 mr-1"),ge(a,"min-width","0"),u(e,"href",w=l[3].fileurl),u(e,"class","local-mail-message-attachments-file btn btn-light d-flex align-items-center px-2 py-1 mr-3 mb-3")},m(k,y){C(k,e,y),g(e,t),g(e,i),g(e,r),g(e,o),g(e,a),g(a,f),g(f,m),g(a,_),g(a,b),g(b,v),M||($=Se(c=Re.call(null,f,l[2](l[3]))),M=!0)},p(k,y){l=k,y&2&&s!==(s=l[3].filename)&&u(t,"alt",s),y&2&&!it(t.src,n=l[3].iconurl)&&u(t,"src",n),y&2&&d!==(d=l[2](l[3])+"")&&R(m,d),c&&Ce(c.update)&&y&2&&c.update.call(null,l[2](l[3])),y&2&&p!==(p=St(l[3].filesize)+"")&&R(v,p),y&2&&w!==(w=l[3].fileurl)&&u(e,"href",w)},d(k){k&&D(e),M=!1,$()}}}function $s(l){let e,t,s,n,i=l[0].downloadall+"",r,o;return{c(){e=h("a"),t=h("i"),s=L(),n=h("div"),r=I(i),u(t,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),u(t,"aria-hidden","true"),ge(t,"width","24px"),ge(t,"height","24px"),u(n,"class","text-truncate ml-2"),u(e,"href",o=Tt(l[1].id)),u(e,"class","btn btn-light d-flex align-items-center p-2 mr-3 mb-3")},m(a,f){C(a,e,f),g(e,t),g(e,s),g(e,n),g(n,r)},p(a,f){f&1&&i!==(i=a[0].downloadall+"")&&R(r,i),f&2&&o!==(o=Tt(a[1].id))&&u(e,"href",o)},d(a){a&&D(e)}}}function sr(l){let e,t,s=ue(l[1].attachments),n=[];for(let r=0;r<s.length;r+=1)n[r]=ws(vs(l,s,r));let i=l[1].attachments.length>1&&$s(l);return{c(){e=h("div");for(let r=0;r<n.length;r+=1)n[r].c();t=L(),i&&i.c(),u(e,"class","local-mail-message-attachments d-sm-flex flex-wrap mr-n3 mt-3 mb-sm-n3")},m(r,o){C(r,e,o);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null);g(e,t),i&&i.m(e,null)},p(r,[o]){if(o&6){s=ue(r[1].attachments);let a;for(a=0;a<s.length;a+=1){const f=vs(r,s,a);n[a]?n[a].p(f,o):(n[a]=ws(f),n[a].c(),n[a].m(e,t))}for(;a<n.length;a+=1)n[a].d(1);n.length=s.length}r[1].attachments.length>1?i?i.p(r,o):(i=$s(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i:F,o:F,d(r){r&&D(e),Be(n,r),i&&i.d()}}}function lr(l,e,t){let{strings:s}=e,{message:n}=e;const i=r=>(r.filepath+r.filename).replace(/^\//,"");return l.$$set=r=>{"strings"in r&&t(0,s=r.strings),"message"in r&&t(1,n=r.message)},[s,n,i]}class dn extends ce{constructor(e){super(),me(this,e,lr,sr,oe,{strings:0,message:1})}}function nr(l){let e,t,s,n=l[3].strings.reply+"",i,r,o,a,f,d=l[3].strings.replyall+"",m,c,_,b,p,v,w=l[3].strings.forward+"",M,$,k;return{c(){e=h("button"),t=h("i"),s=L(),i=I(n),r=L(),o=h("button"),a=h("i"),f=L(),m=I(d),_=L(),b=h("button"),p=h("i"),v=L(),M=I(w),u(t,"class","fa fa-fw fa-reply mr-2"),u(e,"type","button"),u(e,"class","btn btn-primary mr-3 mb-3"),u(a,"class","fa fa-fw fa-reply-all mr-2"),u(o,"type","button"),o.disabled=c=!l[2],u(o,"class","btn mr-3 mb-3"),G(o,"disabled",!l[2]),G(o,"btn-primary",l[2]),G(o,"btn-secondary",!l[2]),u(p,"class","fa fa-fw fa-share mr-2"),u(b,"type","button"),u(b,"class","btn btn-primary mr-3 mb-3")},m(y,q){C(y,e,q),g(e,t),g(e,s),g(e,i),C(y,r,q),C(y,o,q),g(o,a),g(o,f),g(o,m),C(y,_,q),C(y,b,q),g(b,p),g(b,v),g(b,M),$||(k=[J(e,"click",l[4]),J(o,"click",l[5]),J(b,"click",l[6])],$=!0)},p(y,[q]){q&8&&n!==(n=y[3].strings.reply+"")&&R(i,n),q&8&&d!==(d=y[3].strings.replyall+"")&&R(m,d),q&4&&c!==(c=!y[2])&&(o.disabled=c),q&4&&G(o,"disabled",!y[2]),q&4&&G(o,"btn-primary",y[2]),q&4&&G(o,"btn-secondary",!y[2]),q&8&&w!==(w=y[3].strings.forward+"")&&R(M,w)},i:F,o:F,d(y){y&&(D(e),D(r),D(o),D(_),D(b)),$=!1,we(k)}}}function ir(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,c=>t(3,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e,{canReplyAll:a}=e;const f=()=>r.reply(o,!1),d=()=>r.reply(o,!0),m=()=>r.forward(o);return l.$$set=c=>{"store"in c&&i(t(0,r=c.store)),"message"in c&&t(1,o=c.message),"canReplyAll"in c&&t(2,a=c.canReplyAll)},[r,o,a,s,f,d,m]}class rr extends ce{constructor(e){super(),me(this,e,ir,nr,oe,{store:0,message:1,canReplyAll:2})}}function ys(l,e,t){const s=l.slice();return s[3]=e[t],s}function Ms(l){let e,t;return e=new pt({props:{course:l[1].course,settings:l[2].settings}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Cs(l,e){let t,s,n;return s=new bt({props:{label:e[3]}}),{key:l,first:null,c(){t=be(),K(s.$$.fragment),this.first=t},m(i,r){C(i,t,r),W(s,i,r),n=!0},p(i,r){e=i;const o={};r&2&&(o.label=e[3]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&D(t),X(s,i)}}}function ar(l){let e,t=[],s=new Map,n,i,r=l[1].course.id!=l[2].params.courseid&&Ms(l),o=ue(l[1].labels);const a=f=>f[3].id;for(let f=0;f<o.length;f+=1){let d=ys(l,o,f),m=a(d);s.set(m,t[f]=Cs(m,d))}return{c(){r&&r.c(),e=L();for(let f=0;f<t.length;f+=1)t[f].c();n=be()},m(f,d){r&&r.m(f,d),C(f,e,d);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(f,d);C(f,n,d),i=!0},p(f,[d]){f[1].course.id!=f[2].params.courseid?r?(r.p(f,d),d&6&&T(r,1)):(r=Ms(f),r.c(),T(r,1),r.m(e.parentNode,e)):r&&(ie(),z(r,1,1,()=>{r=null}),re()),d&2&&(o=ue(f[1].labels),ie(),t=Le(t,d,a,1,f,o,s,n.parentNode,Ue,Cs,n,ys),re())},i(f){if(!i){T(r);for(let d=0;d<o.length;d+=1)T(t[d]);i=!0}},o(f){z(r);for(let d=0;d<t.length;d+=1)z(t[d]);i=!1},d(f){f&&(D(e),D(n)),r&&r.d(f);for(let d=0;d<t.length;d+=1)t[d].d(f)}}}function or(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class fr extends ce{constructor(e){super(),me(this,e,or,ar,oe,{store:0,message:1})}}function ur(l){let e;function t(i,r){if(i[0])return dr;if(i[1])return mr}let s=t(l),n=s&&s(l);return{c(){e=h("span"),n&&n.c(),u(e,"class","local-mail-user-picture-fallback m-0")},m(i,r){C(i,e,r),n&&n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n&&n.d(1),n=s&&s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&D(e),n&&n.d()}}}function cr(l){let e,t;return{c(){e=h("img"),it(e.src,t=l[0].pictureurl)||u(e,"src",t),u(e,"width","35"),u(e,"height","35"),u(e,"alt",""),u(e,"aria-hidden","true"),u(e,"class","rounded-circle")},m(s,n){C(s,e,n)},p(s,n){n&1&&!it(e.src,t=s[0].pictureurl)&&u(e,"src",t)},d(s){s&&D(e)}}}function mr(l){let e,t;return{c(){e=h("i"),u(e,"class",t="fa "+l[1])},m(s,n){C(s,e,n)},p(s,n){n&2&&t!==(t="fa "+s[1])&&u(e,"class",t)},d(s){s&&D(e)}}}function dr(l){let e=l[0].firstname.slice(0,1)+"",t,s=l[0].lastname.slice(0,1)+"",n;return{c(){t=I(e),n=I(s)},m(i,r){C(i,t,r),C(i,n,r)},p(i,r){r&1&&e!==(e=i[0].firstname.slice(0,1)+"")&&R(t,e),r&1&&s!==(s=i[0].lastname.slice(0,1)+"")&&R(n,s)},d(i){i&&(D(t),D(n))}}}function _r(l){let e;function t(i,r){var o;return(o=i[0])!=null&&o.pictureurl?cr:ur}let s=t(l),n=s(l);return{c(){n.c(),e=be()},m(i,r){n.m(i,r),C(i,e,r)},p(i,[r]){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e.parentNode,e)))},i:F,o:F,d(i){i&&D(e),n.d(i)}}}function gr(l,e,t){let{user:s=void 0}=e,{icon:n=void 0}=e;return l.$$set=i=>{"user"in i&&t(0,s=i.user),"icon"in i&&t(1,n=i.icon)},[s,n]}class tt extends ce{constructor(e){super(),me(this,e,gr,_r,oe,{user:0,icon:1})}}function Ds(l){let e,t,s,n;return s=new dn({props:{strings:l[0],message:l[1]}}),{c(){e=h("hr"),t=L(),K(s.$$.fragment)},m(i,r){C(i,e,r),C(i,t,r),W(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.strings=i[0]),r&2&&(o.message=i[1]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&(D(e),D(t)),X(s,i)}}}function pr(l){let e,t,s,n=l[1].subject+"",i,r,o,a,f,d,m,c,_,b=l[1].sender.fullname+"",p,v,w,M,$=l[1].fulltime+"",k,y,q,S,N,j=l[1].content+"",B,H;d=new tt({props:{user:l[1].sender}});let P=l[1].attachments.length>0&&Ds(l);return{c(){e=h("div"),t=h("div"),s=h("h5"),i=I(n),r=L(),o=h("div"),a=h("div"),f=h("div"),K(d.$$.fragment),m=L(),c=h("div"),_=h("a"),p=I(b),w=L(),M=h("div"),k=I($),y=L(),q=h("hr"),S=L(),N=h("div"),B=L(),P&&P.c(),u(s,"class","h5 card-title mb-3"),u(f,"class","mr-3"),u(_,"href",v=l[1].sender.profileurl),u(c,"class","mt-1"),u(a,"class","d-flex mb-3 mb-sm-0"),u(M,"class","mt-1 ml-auto"),u(o,"class","d-sm-flex mb-n1"),u(N,"class","local-mail-message-reference-content"),u(t,"class","card-body p-3 px-xl-4"),u(e,"class","card mb-4")},m(O,x){C(O,e,x),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),g(o,a),g(a,f),W(d,f,null),g(a,m),g(a,c),g(c,_),g(_,p),g(o,w),g(o,M),g(M,k),g(t,y),g(t,q),g(t,S),g(t,N),N.innerHTML=j,g(t,B),P&&P.m(t,null),H=!0},p(O,[x]){(!H||x&2)&&n!==(n=O[1].subject+"")&&R(i,n);const V={};x&2&&(V.user=O[1].sender),d.$set(V),(!H||x&2)&&b!==(b=O[1].sender.fullname+"")&&R(p,b),(!H||x&2&&v!==(v=O[1].sender.profileurl))&&u(_,"href",v),(!H||x&2)&&$!==($=O[1].fulltime+"")&&R(k,$),(!H||x&2)&&j!==(j=O[1].content+"")&&(N.innerHTML=j),O[1].attachments.length>0?P?(P.p(O,x),x&2&&T(P,1)):(P=Ds(O),P.c(),T(P,1),P.m(t,null)):P&&(ie(),z(P,1,1,()=>{P=null}),re())},i(O){H||(T(d.$$.fragment,O),T(P),H=!0)},o(O){z(d.$$.fragment,O),z(P),H=!1},d(O){O&&D(e),X(d),P&&P.d()}}}function br(l,e,t){let{strings:s}=e,{reference:n}=e;return l.$$set=i=>{"strings"in i&&t(0,s=i.strings),"reference"in i&&t(1,n=i.reference)},[s,n]}class _n extends ce{constructor(e){super(),me(this,e,br,pr,oe,{strings:0,reference:1})}}function Ss(l,e,t){const s=l.slice();return s[4]=e[t],s}function Ts(l,e,t){const s=l.slice();return s[7]=e[t],s[9]=t,s}function Ls(l){let e,t,s=l[3].strings[l[4]]+"",n,i,r,o=[],a=new Map,f,d=ue(l[2](l[4]));const m=c=>c[7].id;for(let c=0;c<d.length;c+=1){let _=Ts(l,d,c),b=m(_);a.set(b,o[c]=js(b,_))}return{c(){e=h("div"),t=h("span"),n=I(s),i=I(":"),r=L();for(let c=0;c<o.length;c+=1)o[c].c();f=L(),u(e,"class","mb-2")},m(c,_){C(c,e,_),g(e,t),g(t,n),g(t,i),g(e,r);for(let b=0;b<o.length;b+=1)o[b]&&o[b].m(e,null);g(e,f)},p(c,_){_&8&&s!==(s=c[3].strings[c[4]]+"")&&R(n,s),_&4&&(d=ue(c[2](c[4])),o=Le(o,_,m,1,c,d,a,e,xe,js,f,Ts))},d(c){c&&D(e);for(let _=0;_<o.length;_+=1)o[_].d()}}}function zs(l){let e;return{c(){e=I(",")},m(t,s){C(t,e,s)},d(t){t&&D(e)}}}function js(l,e){let t,s,n,i=e[7].fullname+"",r,o,a=e[9]>0&&zs();return{key:l,first:null,c(){t=be(),a&&a.c(),s=L(),n=h("a"),r=I(i),u(n,"href",o=e[7].profileurl),this.first=t},m(f,d){C(f,t,d),a&&a.m(f,d),C(f,s,d),C(f,n,d),g(n,r)},p(f,d){e=f,e[9]>0?a||(a=zs(),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null),d&4&&i!==(i=e[7].fullname+"")&&R(r,i),d&4&&o!==(o=e[7].profileurl)&&u(n,"href",o)},d(f){f&&(D(t),D(s),D(n)),a&&a.d(f)}}}function Ns(l){let e=l[2](l[4]).length>0,t,s=e&&Ls(l);return{c(){s&&s.c(),t=be()},m(n,i){s&&s.m(n,i),C(n,t,i)},p(n,i){i&4&&(e=n[2](n[4]).length>0),e?s?s.p(n,i):(s=Ls(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},d(n){n&&D(t),s&&s.d(n)}}}function hr(l){let e,t,s,n,i,r,o,a=l[1].sender.fullname+"",f,d,m,c;s=new tt({props:{user:l[1].sender}});let _=ue(Object.values(Ae)),b=[];for(let p=0;p<_.length;p+=1)b[p]=Ns(Ss(l,_,p));return{c(){e=h("div"),t=h("div"),K(s.$$.fragment),n=L(),i=h("div"),r=h("div"),o=h("a"),f=I(a),m=L();for(let p=0;p<b.length;p+=1)b[p].c();u(t,"class","mr-3"),u(o,"href",d=l[1].sender.profileurl),u(r,"class","mt-1 mb-2"),u(i,"class","d-flex flex-column"),u(e,"class","local-mail-message-users d-flex mb-n2")},m(p,v){C(p,e,v),g(e,t),W(s,t,null),g(e,n),g(e,i),g(i,r),g(r,o),g(o,f),g(i,m);for(let w=0;w<b.length;w+=1)b[w]&&b[w].m(i,null);c=!0},p(p,[v]){const w={};if(v&2&&(w.user=p[1].sender),s.$set(w),(!c||v&2)&&a!==(a=p[1].sender.fullname+"")&&R(f,a),(!c||v&2&&d!==(d=p[1].sender.profileurl))&&u(o,"href",d),v&12){_=ue(Object.values(Ae));let M;for(M=0;M<_.length;M+=1){const $=Ss(p,_,M);b[M]?b[M].p($,v):(b[M]=Ns($),b[M].c(),b[M].m(i,null))}for(;M<b.length;M+=1)b[M].d(1);b.length=_.length}},i(p){c||(T(s.$$.fragment,p),c=!0)},o(p){z(s.$$.fragment,p),c=!1},d(p){p&&D(e),X(s),Be(b,p)}}}function kr(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,f=>t(3,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;return l.$$set=f=>{"store"in f&&r(t(0,o=f.store)),"message"in f&&t(1,a=f.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=f=>a.recipients.filter(d=>d.type==f))},[o,a,s,n]}class vr extends ce{constructor(e){super(),me(this,e,kr,hr,oe,{store:0,message:1})}}function As(l,e,t){const s=l.slice();return s[4]=e[t],s}function qs(l){let e,t,s,n;return s=new dn({props:{strings:l[2].strings,message:l[1]}}),{c(){e=h("hr"),t=L(),K(s.$$.fragment)},m(i,r){C(i,e,r),C(i,t,r),W(s,i,r),n=!0},p(i,r){const o={};r&4&&(o.strings=i[2].strings),r&2&&(o.message=i[1]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&(D(e),D(t)),X(s,i)}}}function Bs(l){let e,t=l[2].strings.references+"",s,n,i=[],r=new Map,o,a,f=ue(l[1].references);const d=m=>m[4].id;for(let m=0;m<f.length;m+=1){let c=As(l,f,m),_=d(c);r.set(_,i[m]=Es(_,c))}return{c(){e=h("div"),s=I(t),n=L();for(let m=0;m<i.length;m+=1)i[m].c();o=be(),u(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(m,c){C(m,e,c),g(e,s),C(m,n,c);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(m,c);C(m,o,c),a=!0},p(m,c){(!a||c&4)&&t!==(t=m[2].strings.references+"")&&R(s,t),c&6&&(f=ue(m[1].references),ie(),i=Le(i,c,d,1,m,f,r,o.parentNode,Ue,Es,o,As),re())},i(m){if(!a){for(let c=0;c<f.length;c+=1)T(i[c]);a=!0}},o(m){for(let c=0;c<i.length;c+=1)z(i[c]);a=!1},d(m){m&&(D(e),D(n),D(o));for(let c=0;c<i.length;c+=1)i[c].d(m)}}}function Es(l,e){let t,s,n;return s=new _n({props:{strings:e[2].strings,reference:e[4]}}),{key:l,first:null,c(){t=be(),K(s.$$.fragment),this.first=t},m(i,r){C(i,t,r),W(s,i,r),n=!0},p(i,r){e=i;const o={};r&4&&(o.strings=e[2].strings),r&2&&(o.reference=e[4]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&D(t),X(s,i)}}}function wr(l){let e,t,s,n=l[1].subject+"",i,r,o,a,f,d,m,c,_=l[1].fulltime+"",b,p,v,w,M,$,k,y,q,S,N=l[1].content+"",j,B,H,P,O,x,V,te,ae;f=new fr({props:{store:l[0],message:l[1]}}),w=new tr({props:{store:l[0],message:l[1],canReplyAll:l[3]}}),$=new vr({props:{store:l[0],message:l[1]}});let Y=l[1].attachments.length>0&&qs(l);x=new rr({props:{store:l[0],message:l[1],canReplyAll:l[3]}});let Q=l[1].references.length>0&&Bs(l);return{c(){e=h("div"),t=h("div"),s=h("h3"),i=I(n),r=L(),o=h("div"),a=h("div"),K(f.$$.fragment),d=L(),m=h("div"),c=h("div"),b=I(_),p=L(),v=h("div"),K(w.$$.fragment),M=L(),K($.$$.fragment),k=L(),y=h("hr"),q=L(),S=h("div"),j=L(),Y&&Y.c(),B=L(),H=h("hr"),P=L(),O=h("div"),K(x.$$.fragment),V=L(),Q&&Q.c(),te=be(),u(s,"class","h4 card-title mb-3 mb-md-2"),u(a,"class","d-flex flex-wrap mx-n2 mt-2"),ge(a,"min-width","0"),u(c,"class","my-2 text-truncate"),u(v,"class","d-flex flex-shrink-0 ml-3 mr-n2"),u(m,"class","d-flex justify-content-between flex-shrink-0 ml-auto"),u(o,"class","d-md-flex align-items-start mb-2"),u(S,"class","local-mail-message-content"),u(O,"class","mt-3 d-flex mr-n3 mb-n3 flex-column flex-sm-row justify-content-end"),u(t,"class","card-body p-3 px-xl-4"),u(e,"class","card")},m(A,E){C(A,e,E),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),g(o,a),W(f,a,null),g(o,d),g(o,m),g(m,c),g(c,b),g(m,p),g(m,v),W(w,v,null),g(t,M),W($,t,null),g(t,k),g(t,y),g(t,q),g(t,S),S.innerHTML=N,g(t,j),Y&&Y.m(t,null),g(t,B),g(t,H),g(t,P),g(t,O),W(x,O,null),C(A,V,E),Q&&Q.m(A,E),C(A,te,E),ae=!0},p(A,[E]){(!ae||E&2)&&n!==(n=A[1].subject+"")&&R(i,n);const se={};E&1&&(se.store=A[0]),E&2&&(se.message=A[1]),f.$set(se),(!ae||E&2)&&_!==(_=A[1].fulltime+"")&&R(b,_);const le={};E&1&&(le.store=A[0]),E&2&&(le.message=A[1]),E&8&&(le.canReplyAll=A[3]),w.$set(le);const U={};E&1&&(U.store=A[0]),E&2&&(U.message=A[1]),$.$set(U),(!ae||E&2)&&N!==(N=A[1].content+"")&&(S.innerHTML=N),A[1].attachments.length>0?Y?(Y.p(A,E),E&2&&T(Y,1)):(Y=qs(A),Y.c(),T(Y,1),Y.m(t,B)):Y&&(ie(),z(Y,1,1,()=>{Y=null}),re());const fe={};E&1&&(fe.store=A[0]),E&2&&(fe.message=A[1]),E&8&&(fe.canReplyAll=A[3]),x.$set(fe),A[1].references.length>0?Q?(Q.p(A,E),E&2&&T(Q,1)):(Q=Bs(A),Q.c(),T(Q,1),Q.m(te.parentNode,te)):Q&&(ie(),z(Q,1,1,()=>{Q=null}),re())},i(A){ae||(T(f.$$.fragment,A),T(w.$$.fragment,A),T($.$$.fragment,A),T(Y),T(x.$$.fragment,A),T(Q),ae=!0)},o(A){z(f.$$.fragment,A),z(w.$$.fragment,A),z($.$$.fragment,A),z(Y),z(x.$$.fragment,A),z(Q),ae=!1},d(A){A&&(D(e),D(V),D(te)),X(f),X(w),X($),Y&&Y.d(),X(x),Q&&Q.d(A)}}}function $r(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,f=>t(2,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;return l.$$set=f=>{"store"in f&&r(t(0,o=f.store)),"message"in f&&t(1,a=f.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=a.sender.id==n.userid?a.recipients.filter(f=>f.type=="cc").length>0:a.recipients.filter(f=>["to","cc"].includes(f.type)&&f.id!=n.userid).length>0)},[o,a,n,s]}class yr extends ce{constructor(e){super(),me(this,e,$r,wr,oe,{store:0,message:1})}}function Is(l,e,t){const s=l.slice();s[6]=e[t];const n=Array.from(s[1].values()).filter(function(...r){return l[5](s[6],...r)});return s[7]=n,s}function Ps(l,e,t){const s=l.slice();return s[10]=e[t],s}function Rs(l){let e,t,s=l[3].strings[l[6]]+"",n,i,r,o,a=[],f=new Map,d,m,c,_=ue(l[7]);const b=p=>p[10].id;for(let p=0;p<_.length;p+=1){let v=Ps(l,_,p),w=b(v);f.set(w,a[p]=Fs(w,v))}return{c(){e=h("div"),t=h("div"),n=I(s),i=I(":"),r=L(),o=h("div");for(let p=0;p<a.length;p+=1)a[p].c();d=L(),u(t,"class","local-mail-draft-form-recipients-type flex-shrink-0 py-2 mr-2"),u(o,"class","d-flex flex-wrap"),ge(o,"min-width","0"),u(e,"class","d-flex mb-2")},m(p,v){C(p,e,v),g(e,t),g(t,n),g(t,i),g(e,r),g(e,o);for(let w=0;w<a.length;w+=1)a[w]&&a[w].m(o,null);g(e,d),c=!0},p(p,v){(!c||v&8)&&s!==(s=p[3].strings[p[6]]+"")&&R(n,s),v&14&&(_=ue(p[7]),ie(),a=Le(a,v,b,1,p,_,f,o,Ue,Fs,null,Ps),re())},i(p){if(!c){for(let v=0;v<_.length;v+=1)T(a[v]);p&&je(()=>{c&&(m||(m=Ee(e,qe,{},!0)),m.run(1))}),c=!0}},o(p){for(let v=0;v<a.length;v+=1)z(a[v]);p&&(m||(m=Ee(e,qe,{},!1)),m.run(0)),c=!1},d(p){p&&D(e);for(let v=0;v<a.length;v+=1)a[v].d();p&&m&&m.end()}}}function Mr(l){let e,t,s;return{c(){e=h("div"),t=h("i"),u(t,"class","fa fa-exclamation-circle"),u(e,"class","m-0 d-flex justify-content-center align-items-center"),ge(e,"width","35px"),ge(e,"height","35px"),u(e,"title",s=l[3].strings.cannotsendmailtouser)},m(n,i){C(n,e,i),g(e,t)},p(n,i){i&8&&s!==(s=n[3].strings.cannotsendmailtouser)&&u(e,"title",s)},i:F,o:F,d(n){n&&D(e)}}}function Cr(l){let e,t;return e=new tt({props:{user:l[10]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.user=s[10]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Fs(l,e){let t,s,n,i,r,o,a=e[10].fullname+"",f,d,m,c,_,b,p,v,w,M,$,k;const y=[Cr,Mr],q=[];function S(j,B){return j[10].isvalid?0:1}n=S(e),i=q[n]=y[n](e);function N(){return e[4](e[10])}return{key:l,first:null,c(){t=h("div"),s=h("div"),i.c(),r=L(),o=h("div"),f=I(a),m=L(),c=h("button"),_=h("i"),p=L(),u(s,"class","d-flex m-1 mr-2"),u(o,"class","py-2"),u(_,"class","fa fa-fw fa-times"),u(c,"type","button"),u(c,"class","btn align-self-middle p-2 align-bottom"),u(c,"title",b=e[3].strings.delete),u(t,"class","local-mail-draft-form-recipients-user d-flex flex-shrink align-items-center mr-2 mb-2"),G(t,"alert-danger",!e[10].isvalid),this.first=t},m(j,B){C(j,t,B),g(t,s),q[n].m(s,null),g(t,r),g(t,o),g(o,f),g(t,m),g(t,c),g(c,_),g(t,p),M=!0,$||(k=[Se(d=Re.call(null,o,e[10].fullname)),J(c,"click",N),Se(v=Re.call(null,t,e[10].fullname))],$=!0)},p(j,B){e=j;let H=n;n=S(e),n===H?q[n].p(e,B):(ie(),z(q[H],1,1,()=>{q[H]=null}),re(),i=q[n],i?i.p(e,B):(i=q[n]=y[n](e),i.c()),T(i,1),i.m(s,null)),(!M||B&2)&&a!==(a=e[10].fullname+"")&&R(f,a),d&&Ce(d.update)&&B&2&&d.update.call(null,e[10].fullname),(!M||B&8&&b!==(b=e[3].strings.delete))&&u(c,"title",b),v&&Ce(v.update)&&B&2&&v.update.call(null,e[10].fullname),(!M||B&2)&&G(t,"alert-danger",!e[10].isvalid)},i(j){M||(T(i),j&&je(()=>{M&&(w||(w=Ee(t,qe,{},!0)),w.run(1))}),M=!0)},o(j){z(i),j&&(w||(w=Ee(t,qe,{},!1)),w.run(0)),M=!1},d(j){j&&D(t),q[n].d(),j&&w&&w.end(),$=!1,we(k)}}}function Us(l){let e,t,s=l[7].length&&Rs(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),C(n,e,i),t=!0},p(n,i){n[7].length?s?(s.p(n,i),i&2&&T(s,1)):(s=Rs(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function Dr(l){let e,t,s=ue(Object.values(Ae)),n=[];for(let r=0;r<s.length;r+=1)n[r]=Us(Is(l,s,r));const i=r=>z(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=be()},m(r,o){for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(r,o);C(r,e,o),t=!0},p(r,[o]){if(o&14){s=ue(Object.values(Ae));let a;for(a=0;a<s.length;a+=1){const f=Is(r,s,a);n[a]?(n[a].p(f,o),T(n[a],1)):(n[a]=Us(f),n[a].c(),T(n[a],1),n[a].m(e.parentNode,e))}for(ie(),a=s.length;a<n.length;a+=1)i(a);re()}},i(r){if(!t){for(let o=0;o<s.length;o+=1)T(n[o]);t=!0}},o(r){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)z(n[o]);t=!1},d(r){r&&D(e),Be(n,r)}}}function Sr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,m=>t(3,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{recipients:o}=e,{onDelete:a}=e;const f=m=>a(m),d=(m,c)=>c.type==m;return l.$$set=m=>{"store"in m&&i(t(0,r=m.store)),"recipients"in m&&t(1,o=m.recipients),"onDelete"in m&&t(2,a=m.onDelete)},[r,o,a,s,f,d]}class Tr extends ce{constructor(e){super(),me(this,e,Sr,Dr,oe,{store:0,recipients:1,onDelete:2})}}function Gs(l,e,t){const s=l.slice();return s[4]=e[t],s}function Lr(l){let e,t,s=l[1].shorttime+"",n;return{c(){e=h("i"),t=L(),n=I(s),u(e,"class","fa fa-clock-o mr-1"),u(e,"aria-hidden","true")},m(i,r){C(i,e,r),C(i,t,r),C(i,n,r)},p(i,r){r&2&&s!==(s=i[1].shorttime+"")&&R(n,s)},d(i){i&&(D(e),D(t),D(n))}}}function zr(l){let e,t,s=l[2].strings.draftsaved+"",n;return{c(){e=h("i"),t=L(),n=I(s),u(e,"class","fa fa-check mr-1"),u(e,"aria-hidden","true")},m(i,r){C(i,e,r),C(i,t,r),C(i,n,r)},p(i,r){r&4&&s!==(s=i[2].strings.draftsaved+"")&&R(n,s)},d(i){i&&(D(e),D(t),D(n))}}}function Hs(l){let e,t=[],s=new Map,n,i=ue(l[1].labels);const r=o=>o[4].id;for(let o=0;o<i.length;o+=1){let a=Gs(l,i,o),f=r(a);s.set(f,t[o]=Os(f,a))}return{c(){e=h("div");for(let o=0;o<t.length;o+=1)t[o].c();u(e,"class","d-flex flex-wrap mt-2 mr-2"),ge(e,"min-width","0")},m(o,a){C(o,e,a);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(o,a){a&2&&(i=ue(o[1].labels),ie(),t=Le(t,a,r,1,o,i,s,e,Ue,Os,null,Gs),re())},i(o){if(!n){for(let a=0;a<i.length;a+=1)T(t[a]);n=!0}},o(o){for(let a=0;a<t.length;a+=1)z(t[a]);n=!1},d(o){o&&D(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function Os(l,e){let t,s,n;return s=new bt({props:{label:e[4]}}),{key:l,first:null,c(){t=be(),K(s.$$.fragment),this.first=t},m(i,r){C(i,t,r),W(s,i,r),n=!0},p(i,r){e=i;const o={};r&2&&(o.label=e[4]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&D(t),X(s,i)}}}function jr(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p;function v(k,y){return k[2].draftSaved?zr:Lr}let w=v(l),M=w(l),$=l[1].labels&&Hs(l);return{c(){e=h("div"),t=h("div"),s=h("div"),M.c(),i=L(),r=h("button"),o=h("i"),c=L(),$&&$.c(),u(s,"class","align-self-center alert-info px-2 text-truncate"),u(s,"title",n=l[1].fulltime),u(o,"class",a="fa "+(l[1].starred?"fa-star text-warning":"fa-star-o")),u(r,"type","button"),u(r,"class","btn border-0 py-2 ml-auto mr-3 mr-sm-2"),u(r,"role","checkbox"),u(r,"aria-checked",f=l[1].starred),r.disabled=d=l[1].deleted,u(r,"title",m=l[1].starred?l[2].strings.markasunstarred:l[2].strings.markasstarred),u(t,"class","d-flex flex-grow-1"),u(e,"class","d-sm-flex justify-content-between mb-2 mr-n3")},m(k,y){C(k,e,y),g(e,t),g(t,s),M.m(s,null),g(t,i),g(t,r),g(r,o),g(e,c),$&&$.m(e,null),_=!0,b||(p=J(r,"click",l[3]),b=!0)},p(k,[y]){w===(w=v(k))&&M?M.p(k,y):(M.d(1),M=w(k),M&&(M.c(),M.m(s,null))),(!_||y&2&&n!==(n=k[1].fulltime))&&u(s,"title",n),(!_||y&2&&a!==(a="fa "+(k[1].starred?"fa-star text-warning":"fa-star-o")))&&u(o,"class",a),(!_||y&2&&f!==(f=k[1].starred))&&u(r,"aria-checked",f),(!_||y&2&&d!==(d=k[1].deleted))&&(r.disabled=d),(!_||y&6&&m!==(m=k[1].starred?k[2].strings.markasunstarred:k[2].strings.markasstarred))&&u(r,"title",m),k[1].labels?$?($.p(k,y),y&2&&T($,1)):($=Hs(k),$.c(),T($,1),$.m(e,null)):$&&(ie(),z($,1,1,()=>{$=null}),re())},i(k){_||(T($),_=!0)},o(k){z($),_=!1},d(k){k&&D(e),M.d(),$&&$.d(),b=!1,p()}}}function Nr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;const a=()=>r.setStarred([o.id],!o.starred);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"message"in f&&t(1,o=f.message)},[r,o,s,a]}class Ar extends ce{constructor(e){super(),me(this,e,Nr,jr,oe,{store:0,message:1})}}async function Xe(l){const e=await ut("core/ajax"),t=Array.from(l).map(({methodname:s,...n})=>({methodname:`local_mail_${s}`,args:n}));try{return await Promise.all(e.call(t))}catch(s){throw typeof s=="string"?{message:s}:s}}function Js(l,e,t){var i;const s=l.slice();s[31]=e[t];const n=(i=s[2].get(s[31].id))==null?void 0:i.type;return s[32]=n,s}function Vs(l,e,t){const s=l.slice();return s[35]=e[t],s}function Ks(l,e,t){const s=l.slice();s[35]=e[t];const n=s[10].every(function(...r){return l[28](s[35],...r)});return s[38]=n,s}function Ws(l,e,t){const s=l.slice();return s[41]=e[t],s}function Xs(l,e,t){const s=l.slice();return s[44]=e[t],s}function Ys(l){let e,t,s,n,i,r=l[14].strings.allroles+"",o,a=[],f=new Map,d,m,c,_,b,p,v,w=ue(l[8]);const M=S=>S[44].id;for(let S=0;S<w.length;S+=1){let N=Xs(l,w,S),j=M(N);f.set(j,a[S]=Qs(j,N))}let $=l[9].length>0&&Zs(l);const k=[Er,Br,qr],y=[];function q(S,N){return S[10].length?S[11]?1:2:0}return c=q(l),_=y[c]=k[c](l),{c(){e=h("div"),t=h("div"),s=h("div"),n=h("select"),i=h("option"),o=I(r);for(let S=0;S<a.length;S+=1)a[S].c();d=L(),$&&$.c(),m=L(),_.c(),i.__value=0,$e(i,i.__value),u(n,"class","form-control text-truncate"),l[12]===void 0&&je(()=>l[23].call(n)),u(s,"class","flex-grow-1 mx-2"),u(t,"class","list-group-item d-sm-flex px-2 py-2"),u(e,"class","local-mail-draft-form-user-search-dropdown dropdown-menu dropdown-menu-left list-group show p-0 w-100"),ge(e,"min-width","18rem")},m(S,N){C(S,e,N),g(e,t),g(t,s),g(s,n),g(n,i),g(i,o);for(let j=0;j<a.length;j+=1)a[j]&&a[j].m(n,null);Ye(n,l[12],!0),g(t,d),$&&$.m(t,null),g(e,m),y[c].m(e,null),b=!0,p||(v=[J(n,"change",l[23]),J(n,"change",l[24])],p=!0)},p(S,N){(!b||N[0]&16384)&&r!==(r=S[14].strings.allroles+"")&&R(o,r),N[0]&256&&(w=ue(S[8]),a=Le(a,N,M,1,S,w,f,n,xe,Qs,null,Xs)),N[0]&4352&&Ye(n,S[12]),S[9].length>0?$?$.p(S,N):($=Zs(S),$.c(),$.m(t,null)):$&&($.d(1),$=null);let j=c;c=q(S),c===j?y[c].p(S,N):(ie(),z(y[j],1,1,()=>{y[j]=null}),re(),_=y[c],_?_.p(S,N):(_=y[c]=k[c](S),_.c()),T(_,1),_.m(e,null))},i(S){b||(T(_),b=!0)},o(S){z(_),b=!1},d(S){S&&D(e);for(let N=0;N<a.length;N+=1)a[N].d();$&&$.d(),y[c].d(),p=!1,we(v)}}}function Qs(l,e){let t,s=e[44].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=I(s),i=L(),t.__value=r=e[44].id,$e(t,t.__value),this.first=t},m(o,a){C(o,t,a),g(t,n),g(t,i)},p(o,a){e=o,a[0]&256&&s!==(s=e[44].name+"")&&R(n,s),a[0]&256&&r!==(r=e[44].id)&&(t.__value=r,$e(t,t.__value))},d(o){o&&D(t)}}}function Zs(l){let e,t,s,n=[],i=new Map,r,o,a=l[1].groupmode!=rt.Separate&&xs(l),f=ue(l[9]);const d=m=>m[41].id;for(let m=0;m<f.length;m+=1){let c=Ws(l,f,m),_=d(c);i.set(_,n[m]=el(_,c))}return{c(){e=h("div"),t=h("select"),a&&a.c(),s=be();for(let m=0;m<n.length;m+=1)n[m].c();u(t,"class","form-control text-truncate"),ge(t,"min-width","0"),l[13]===void 0&&je(()=>l[25].call(t)),u(e,"class","flex-grow-1 mx-2 mt-2 mt-sm-0")},m(m,c){C(m,e,c),g(e,t),a&&a.m(t,null),g(t,s);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(t,null);Ye(t,l[13],!0),r||(o=[J(t,"change",l[25]),J(t,"change",l[26])],r=!0)},p(m,c){m[1].groupmode!=rt.Separate?a?a.p(m,c):(a=xs(m),a.c(),a.m(t,s)):a&&(a.d(1),a=null),c[0]&512&&(f=ue(m[9]),n=Le(n,c,d,1,m,f,i,t,xe,el,null,Ws)),c[0]&8704&&Ye(t,m[13])},d(m){m&&D(e),a&&a.d();for(let c=0;c<n.length;c+=1)n[c].d();r=!1,we(o)}}}function xs(l){let e,t=l[14].strings.allgroups+"",s;return{c(){e=h("option"),s=I(t),e.__value=0,$e(e,e.__value)},m(n,i){C(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.allgroups+"")&&R(s,t)},d(n){n&&D(e)}}}function el(l,e){let t,s=e[41].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=I(s),i=L(),t.__value=r=e[41].id,$e(t,t.__value),u(t,"class","text-truncate"),this.first=t},m(o,a){C(o,t,a),g(t,n),g(t,i)},p(o,a){e=o,a[0]&512&&s!==(s=e[41].name+"")&&R(n,s),a[0]&512&&r!==(r=e[41].id)&&(t.__value=r,$e(t,t.__value))},d(o){o&&D(t)}}}function qr(l){let e,t,s,n,i,r,o=l[14].strings.allusers+"",a,f,d,m,c,_=[],b=new Map,p,v,w,M;s=new tt({props:{icon:"fa-users"}});let $=ue(Object.values(Ae)),k=[];for(let S=0;S<$.length;S+=1)k[S]=tl(Ks(l,$,S));let y=ue(l[10]);const q=S=>S[31].id;for(let S=0;S<y.length;S+=1){let N=Js(l,y,S),j=q(N);b.set(j,_[S]=ll(j,N))}return{c(){e=h("div"),t=h("div"),K(s.$$.fragment),n=L(),i=h("div"),r=h("div"),a=I(o),d=L(),m=h("div");for(let S=0;S<k.length;S+=1)k[S].c();c=L();for(let S=0;S<_.length;S+=1)_[S].c();p=be(),u(t,"class","mx-3 my-2"),u(r,"class","py-2 mr-3"),u(m,"class","d-flex ml-auto mr-2"),u(i,"class","d-sm-flex align-items-center flex-grow-1"),u(e,"class","list-group-item d-flex align-items-sm-center p-0")},m(S,N){C(S,e,N),g(e,t),W(s,t,null),g(e,n),g(e,i),g(i,r),g(r,a),g(i,d),g(i,m);for(let j=0;j<k.length;j+=1)k[j]&&k[j].m(m,null);C(S,c,N);for(let j=0;j<_.length;j+=1)_[j]&&_[j].m(S,N);C(S,p,N),v=!0,w||(M=Se(f=Re.call(null,r,l[14].strings.allusers)),w=!0)},p(S,N){if((!v||N[0]&16384)&&o!==(o=S[14].strings.allusers+"")&&R(a,o),f&&Ce(f.update)&&N[0]&16384&&f.update.call(null,S[14].strings.allusers),N[0]&17420){$=ue(Object.values(Ae));let j;for(j=0;j<$.length;j+=1){const B=Ks(S,$,j);k[j]?k[j].p(B,N):(k[j]=tl(B),k[j].c(),k[j].m(m,null))}for(;j<k.length;j+=1)k[j].d(1);k.length=$.length}N[0]&17420&&(y=ue(S[10]),ie(),_=Le(_,N,q,1,S,y,b,p.parentNode,Ue,ll,p,Js),re())},i(S){if(!v){T(s.$$.fragment,S);for(let N=0;N<y.length;N+=1)T(_[N]);v=!0}},o(S){z(s.$$.fragment,S);for(let N=0;N<_.length;N+=1)z(_[N]);v=!1},d(S){S&&(D(e),D(c),D(p)),X(s),Be(k,S);for(let N=0;N<_.length;N+=1)_[N].d(S);w=!1,M()}}}function Br(l){let e,t=l[14].strings.toomanyusersfound+"",s;return{c(){e=h("div"),s=I(t),u(e,"class","list-group-item text-danger")},m(n,i){C(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.toomanyusersfound+"")&&R(s,t)},i:F,o:F,d(n){n&&D(e)}}}function Er(l){let e,t=l[14].strings.nousersfound+"",s;return{c(){e=h("div"),s=I(t),u(e,"class","list-group-item text-danger")},m(n,i){C(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.nousersfound+"")&&R(s,t)},i:F,o:F,d(n){n&&D(e)}}}function tl(l){let e,t=l[14].strings[l[35]]+"",s,n,i,r,o;function a(){return l[27](l[38],l[35])}return{c(){e=h("button"),s=I(t),n=L(),u(e,"type","button"),u(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),u(e,"aria-pressed",i=l[38]),G(e,"btn-primary",l[38]),G(e,"btn-secondary",!l[38])},m(f,d){C(f,e,d),g(e,s),g(e,n),r||(o=J(e,"click",a),r=!0)},p(f,d){l=f,d[0]&16384&&t!==(t=l[14].strings[l[35]]+"")&&R(s,t),d[0]&1028&&i!==(i=l[38])&&u(e,"aria-pressed",i),d[0]&1028&&G(e,"btn-primary",l[38]),d[0]&1028&&G(e,"btn-secondary",!l[38])},d(f){f&&D(e),r=!1,o()}}}function sl(l){let e,t=l[14].strings[l[35]]+"",s,n,i,r,o;function a(){return l[29](l[31],l[32],l[35])}return{c(){e=h("button"),s=I(t),n=L(),u(e,"type","button"),u(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),u(e,"aria-pressed",i=l[32]==l[35]),G(e,"btn-primary",l[32]==l[35]),G(e,"btn-secondary",l[32]!=l[35])},m(f,d){C(f,e,d),g(e,s),g(e,n),r||(o=J(e,"click",a),r=!0)},p(f,d){l=f,d[0]&16384&&t!==(t=l[14].strings[l[35]]+"")&&R(s,t),d[0]&1028&&i!==(i=l[32]==l[35])&&u(e,"aria-pressed",i),d[0]&1028&&G(e,"btn-primary",l[32]==l[35]),d[0]&1028&&G(e,"btn-secondary",l[32]!=l[35])},d(f){f&&D(e),r=!1,o()}}}function ll(l,e){let t,s,n,i,r,o,a=e[31].fullname+"",f,d,m,c,_;n=new tt({props:{user:e[31]}});let b=ue(Object.values(Ae)),p=[];for(let v=0;v<b.length;v+=1)p[v]=sl(Vs(e,b,v));return{key:l,first:null,c(){t=h("div"),s=h("div"),K(n.$$.fragment),i=L(),r=h("div"),o=h("div"),f=I(a),d=L(),m=h("div");for(let v=0;v<p.length;v+=1)p[v].c();c=L(),u(s,"class","mx-3 my-2"),u(o,"class","py-2 mr-3 align-self-center"),u(m,"class","d-flex ml-auto mr-2 align-self-start"),u(r,"class","d-sm-flex flex-grow-1"),u(t,"class","list-group-item d-flex p-0"),this.first=t},m(v,w){C(v,t,w),g(t,s),W(n,s,null),g(t,i),g(t,r),g(r,o),g(o,f),g(r,d),g(r,m);for(let M=0;M<p.length;M+=1)p[M]&&p[M].m(m,null);g(t,c),_=!0},p(v,w){e=v;const M={};if(w[0]&1024&&(M.user=e[31]),n.$set(M),(!_||w[0]&1024)&&a!==(a=e[31].fullname+"")&&R(f,a),w[0]&17420){b=ue(Object.values(Ae));let $;for($=0;$<b.length;$+=1){const k=Vs(e,b,$);p[$]?p[$].p(k,w):(p[$]=sl(k),p[$].c(),p[$].m(m,null))}for(;$<p.length;$+=1)p[$].d(1);p.length=b.length}},i(v){_||(T(n.$$.fragment,v),_=!0)},o(v){z(n.$$.fragment,v),_=!1},d(v){v&&D(t),X(n),Be(p,v)}}}function Ir(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,M,$=l[4]&&Ys(l);return{c(){e=h("div"),t=h("div"),s=h("i"),i=L(),r=h("input"),f=L(),d=h("div"),m=h("button"),c=h("i"),p=L(),$&&$.c(),u(s,"class",n="fa fa-fw "+(l[7]?"fa-spinner fa-pulse":"fa-user")),u(s,"aria-hidden","true"),u(t,"class","position-absolute h-100 d-flex justify-content-center align-items-center px-2"),ge(t,"top","0"),ge(t,"left","0"),u(r,"type","text"),u(r,"class","form-control px-5"),u(r,"placeholder",o=l[14].strings.addrecipients),u(r,"aria-label",a=l[14].strings.addrecipients),u(r,"autocomplete","off"),G(r,"is-invalid",!l[2].size),u(c,"class",_="fa fa-fw "+(l[5]?"fa-times":l[4]?"fa-caret-up":"fa-caret-down")),u(c,"aria-hidden","true"),u(m,"type","button"),u(m,"aria-expanded",l[4]),u(m,"class","btn px-2"),u(m,"title",b=l[14].strings.addrecipients),u(d,"class","position-absolute h-100 d-flex align-items-center"),ge(d,"top","0"),ge(d,"right","0"),u(e,"class","local-mail-draft-form-user-search-input form-group position-relative")},m(k,y){C(k,e,y),g(e,t),g(t,s),g(e,i),g(e,r),$e(r,l[5]),l[21](r),g(e,f),g(e,d),g(d,m),g(m,c),g(e,p),$&&$.m(e,null),v=!0,w||(M=[J(r,"input",l[20]),J(r,"input",l[22]),J(r,"focus",l[18]),J(m,"click",Te(l[15])),Se(Fe.call(null,e,l[17]))],w=!0)},p(k,y){(!v||y[0]&128&&n!==(n="fa fa-fw "+(k[7]?"fa-spinner fa-pulse":"fa-user")))&&u(s,"class",n),(!v||y[0]&16384&&o!==(o=k[14].strings.addrecipients))&&u(r,"placeholder",o),(!v||y[0]&16384&&a!==(a=k[14].strings.addrecipients))&&u(r,"aria-label",a),y[0]&32&&r.value!==k[5]&&$e(r,k[5]),(!v||y[0]&4)&&G(r,"is-invalid",!k[2].size),(!v||y[0]&48&&_!==(_="fa fa-fw "+(k[5]?"fa-times":k[4]?"fa-caret-up":"fa-caret-down")))&&u(c,"class",_),(!v||y[0]&16)&&u(m,"aria-expanded",k[4]),(!v||y[0]&16384&&b!==(b=k[14].strings.addrecipients))&&u(m,"title",b),k[4]?$?($.p(k,y),y[0]&16&&T($,1)):($=Ys(k),$.c(),T($,1),$.m(e,null)):$&&(ie(),z($,1,1,()=>{$=null}),re())},i(k){v||(T($),v=!0)},o(k){z($),v=!1},d(k){k&&D(e),l[21](null),$&&$.d(),w=!1,we(M)}}}const Pr=500;function Rr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,A=>t(14,s=A)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{course:o}=e,{recipients:a}=e,{onChange:f}=e,d=!1,m="",c,_=!1,b,p=[],v=[],w=[],M=!1,$=o.id,k=0,y=0;const q=async()=>{d?(t(5,m=""),t(4,d=!1),window.clearTimeout(b)):(S(!1),c.focus())},S=async A=>{const E=s.settings.usersearchlimit;t(7,_=!0),window.clearTimeout(b),b=window.setTimeout(async()=>{var U;const se=[{methodname:"get_roles",courseid:o.id},{methodname:"get_groups",courseid:o.id},{methodname:"search_users",query:{courseid:o.id,fullname:m,roleid:k,groupid:y},limit:E+1}];let le;try{le=await Xe(se)}catch(fe){r.setError(fe),t(7,_=!1),t(4,d=!1),t(11,M=!1),t(10,w=[]);return}t(10,w=le.pop()),t(11,M=w.length>E),t(10,w=w.slice(0,E)),t(9,v=le.pop()),t(13,y=v.find(fe=>fe.id==y)?y:o.groupmode==rt.Separate&&((U=v[0])==null?void 0:U.id)||0),t(8,p=le.pop()),t(12,k=p.find(fe=>fe.id==k)?k:0),t(7,_=!1),t(4,d=!0)},A?Pr:0)},N=()=>{t(5,m=""),t(4,d=!1)},j=()=>{d||S(!1)};function B(){m=this.value,t(5,m)}function H(A){Me[A?"unshift":"push"](()=>{c=A,t(6,c)})}const P=()=>S(!0);function O(){k=ct(this),t(12,k),t(19,$),t(1,o),t(8,p)}const x=()=>S(!1);function V(){y=ct(this),t(13,y),t(19,$),t(1,o),t(9,v)}const te=()=>S(!1),ae=(A,E)=>f(w,A?null:E),Y=(A,E)=>{var se;return((se=a.get(E.id))==null?void 0:se.type)==A},Q=(A,E,se)=>f([A],E==se?null:se);return l.$$set=A=>{"store"in A&&i(t(0,r=A.store)),"course"in A&&t(1,o=A.course),"recipients"in A&&t(2,a=A.recipients),"onChange"in A&&t(3,f=A.onChange)},l.$$.update=()=>{l.$$.dirty[0]&524290&&$!=o.id&&(t(19,$=o.id),t(12,k=0),t(13,y=0))},[r,o,a,f,d,m,c,_,p,v,w,M,k,y,s,q,S,N,j,$,B,H,P,O,x,V,te,ae,Y,Q]}class Fr extends ce{constructor(e){super(),me(this,e,Rr,Ir,oe,{store:0,course:1,recipients:2,onChange:3},null,[-1,-1])}}function Ur(l){let e,t,s,n=l[1].strings.send+"",i,r,o,a;return{c(){e=h("button"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-send mr-2"),u(e,"type","button"),u(e,"class","local-mail-action-send btn btn-primary flex-shrink-0 text-nowrap px-3 text-truncate ml-auto"),u(e,"title",r=l[1].strings.send)},m(f,d){C(f,e,d),g(e,t),g(e,s),g(e,i),o||(a=J(e,"click",l[2]),o=!0)},p(f,[d]){d&2&&n!==(n=f[1].strings.send+"")&&R(i,n),d&2&&r!==(r=f[1].strings.send)&&u(e,"title",r)},i:F,o:F,d(f){f&&D(e),o=!1,a()}}}function Gr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=()=>r.sendMessage();return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class gn extends ce{constructor(e){super(),me(this,e,Gr,Ur,oe,{store:0})}}const{Map:Hr}=et;function nl(l,e,t){const s=l.slice();return s[20]=e[t],s}function il(l){let e,t,s,n=l[7].strings.errorinvalidrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,o){C(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=r[7].strings.errorinvalidrecipients+"")&&R(i,n)},d(r){r&&D(e)}}}function Or(l){let e,t,s,n=Ne(l[7].strings.errortoomanyrecipients,l[7].settings.maxrecipients)+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,o){C(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=Ne(r[7].strings.errortoomanyrecipients,r[7].settings.maxrecipients)+"")&&R(i,n)},d(r){r&&D(e)}}}function Jr(l){let e,t,s,n=l[7].strings.erroremptyrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,o){C(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=r[7].strings.erroremptyrecipients+"")&&R(i,n)},d(r){r&&D(e)}}}function rl(l){let e,t,s,n=l[7].strings.erroremptysubject+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,o){C(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=r[7].strings.erroremptysubject+"")&&R(i,n)},d(r){r&&D(e)}}}function al(l){let e,t=l[7].strings.references+"",s,n,i=[],r=new Hr,o,a,f=ue(l[1].references);const d=m=>m[20].id;for(let m=0;m<f.length;m+=1){let c=nl(l,f,m),_=d(c);r.set(_,i[m]=ol(_,c))}return{c(){e=h("div"),s=I(t),n=L();for(let m=0;m<i.length;m+=1)i[m].c();o=be(),u(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(m,c){C(m,e,c),g(e,s),C(m,n,c);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(m,c);C(m,o,c),a=!0},p(m,c){(!a||c&128)&&t!==(t=m[7].strings.references+"")&&R(s,t),c&130&&(f=ue(m[1].references),ie(),i=Le(i,c,d,1,m,f,r,o.parentNode,Ue,ol,o,nl),re())},i(m){if(!a){for(let c=0;c<f.length;c+=1)T(i[c]);a=!0}},o(m){for(let c=0;c<i.length;c+=1)z(i[c]);a=!1},d(m){m&&(D(e),D(n),D(o));for(let c=0;c<i.length;c+=1)i[c].d(m)}}}function ol(l,e){let t,s,n;return s=new _n({props:{strings:e[7].strings,reference:e[20]}}),{key:l,first:null,c(){t=be(),K(s.$$.fragment),this.first=t},m(i,r){C(i,t,r),W(s,i,r),n=!0},p(i,r){e=i;const o={};r&128&&(o.strings=e[7].strings),r&2&&(o.reference=e[20]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&D(t),X(s,i)}}}function Vr(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,M,$,k,y=l[2].editorhtml+"",q,S,N=l[2].filemanagerhtml+"",j,B=Array.from(l[5].values()).some(fl),H,P,O=!l[4].trim(),x,V,te,ae,Y,Q,A,E;n=new Ar({props:{store:l[0],message:l[1]}}),a=new Kl({props:{settings:l[7].settings,strings:l[7].strings,courses:l[7].courses,label:l[7].strings.course,selected:l[6].id,required:!0,readonly:l[1].references.length>0,style:"filter-left",onChange:l[8]}}),m=new Fr({props:{store:l[0],course:l[6],recipients:l[5],onChange:l[9]}}),_=new Tr({props:{store:l[0],recipients:l[5],onDelete:l[10]}});let se=B&&il(l);function le(Z,ne){if(Z[5].size==0)return Jr;if(Z[5].size>Z[7].settings.maxrecipients)return Or}let U=le(l),fe=U&&U(l),ee=O&&rl(l);te=new gn({props:{store:l[0]}});let he=l[1].references.length>0&&al(l);return{c(){e=h("hr"),t=L(),s=h("form"),K(n.$$.fragment),i=L(),r=h("div"),o=h("div"),K(a.$$.fragment),f=L(),d=h("div"),K(m.$$.fragment),c=L(),K(_.$$.fragment),b=L(),p=h("div"),v=h("input"),$=L(),k=h("div"),q=L(),S=h("div"),j=L(),se&&se.c(),H=L(),fe&&fe.c(),P=L(),ee&&ee.c(),x=L(),V=h("div"),K(te.$$.fragment),ae=L(),he&&he.c(),Y=be(),u(e,"class","d-lg-none mt-0 mb-3 mb-sm-2"),u(o,"class","form-group col-12 col-xl-5"),u(d,"class","col-12 col-xl-7"),u(r,"class","row"),u(v,"type","text"),u(v,"id","local-mail-message-form-subject"),u(v,"class","form-control"),u(v,"placeholder",w=l[7].strings.subject),u(v,"aria-label",M=l[7].strings.subject),u(v,"autocomplete","off"),u(v,"maxlength","100"),G(v,"is-invalid",!l[4].trim()),u(p,"class","form-group"),u(k,"class","form-group"),u(S,"class","form-group"),u(V,"class","d-flex justify-content-end align-items-center"),u(s,"class","pt-lg-2 pb-3 px-lg-4"),G(s,"card",l[7].viewportSize>=de.LG)},m(Z,ne){C(Z,e,ne),C(Z,t,ne),C(Z,s,ne),W(n,s,null),g(s,i),g(s,r),g(r,o),W(a,o,null),g(r,f),g(r,d),W(m,d,null),g(s,c),W(_,s,null),g(s,b),g(s,p),g(p,v),$e(v,l[4]),g(s,$),g(s,k),k.innerHTML=y,g(s,q),g(s,S),S.innerHTML=N,g(s,j),se&&se.m(s,null),g(s,H),fe&&fe.m(s,null),g(s,P),ee&&ee.m(s,null),g(s,x),g(s,V),W(te,V,null),l[15](s),C(Z,ae,ne),he&&he.m(Z,ne),C(Z,Y,ne),Q=!0,A||(E=[J(v,"input",l[12]),J(v,"input",l[13]),J(k,"change",l[14]),J(s,"submit",Te(l[16]))],A=!0)},p(Z,[ne]){const pe={};ne&1&&(pe.store=Z[0]),ne&2&&(pe.message=Z[1]),n.$set(pe);const De={};ne&128&&(De.settings=Z[7].settings),ne&128&&(De.strings=Z[7].strings),ne&128&&(De.courses=Z[7].courses),ne&128&&(De.label=Z[7].strings.course),ne&64&&(De.selected=Z[6].id),ne&2&&(De.readonly=Z[1].references.length>0),a.$set(De);const ze={};ne&1&&(ze.store=Z[0]),ne&64&&(ze.course=Z[6]),ne&32&&(ze.recipients=Z[5]),m.$set(ze);const ye={};ne&1&&(ye.store=Z[0]),ne&32&&(ye.recipients=Z[5]),_.$set(ye),(!Q||ne&128&&w!==(w=Z[7].strings.subject))&&u(v,"placeholder",w),(!Q||ne&128&&M!==(M=Z[7].strings.subject))&&u(v,"aria-label",M),ne&16&&v.value!==Z[4]&&$e(v,Z[4]),(!Q||ne&16)&&G(v,"is-invalid",!Z[4].trim()),(!Q||ne&4)&&y!==(y=Z[2].editorhtml+"")&&(k.innerHTML=y),(!Q||ne&4)&&N!==(N=Z[2].filemanagerhtml+"")&&(S.innerHTML=N),ne&32&&(B=Array.from(Z[5].values()).some(fl)),B?se?se.p(Z,ne):(se=il(Z),se.c(),se.m(s,H)):se&&(se.d(1),se=null),U===(U=le(Z))&&fe?fe.p(Z,ne):(fe&&fe.d(1),fe=U&&U(Z),fe&&(fe.c(),fe.m(s,P))),ne&16&&(O=!Z[4].trim()),O?ee?ee.p(Z,ne):(ee=rl(Z),ee.c(),ee.m(s,x)):ee&&(ee.d(1),ee=null);const ke={};ne&1&&(ke.store=Z[0]),te.$set(ke),(!Q||ne&128)&&G(s,"card",Z[7].viewportSize>=de.LG),Z[1].references.length>0?he?(he.p(Z,ne),ne&2&&T(he,1)):(he=al(Z),he.c(),T(he,1),he.m(Y.parentNode,Y)):he&&(ie(),z(he,1,1,()=>{he=null}),re())},i(Z){Q||(T(n.$$.fragment,Z),T(a.$$.fragment,Z),T(m.$$.fragment,Z),T(_.$$.fragment,Z),T(te.$$.fragment,Z),T(he),Q=!0)},o(Z){z(n.$$.fragment,Z),z(a.$$.fragment,Z),z(m.$$.fragment,Z),z(_.$$.fragment,Z),z(te.$$.fragment,Z),z(he),Q=!1},d(Z){Z&&(D(e),D(t),D(s),D(ae),D(Y)),X(n),X(a),X(m),X(_),se&&se.d(),fe&&fe.d(),ee&&ee.d(),X(te),l[15](null),he&&he.d(Z),A=!1,we(E)}}}const fl=l=>!l.isvalid;function Kr(l,e,t){let s,n,i,r,o=F,a=()=>(o(),o=_e(f,j=>t(7,r=j)),f);l.$$.on_destroy.push(()=>o());let{store:f}=e;a();let{message:d}=e,{form:m}=e,c,_;Ze(()=>{_==null||_.addEventListener("core_form/uploadChanged",()=>$(!1));const j=b();return()=>{c==null||c.remove(),j()}});const b=()=>{let j,B;const H=()=>{B==null||B.save(),$(!1)},P=O=>{O.editor.id==`local-mail-compose-editor-${d.id}`&&(B==null||B.off("input",H),B==null||B.off("ExecCommand",H),B=O.editor,O.editor.on("input",H),O.editor.on("ExecCommand",H))};return ut("editor_tiny/loader").then(async O=>{j=await O.getTinyMCE(),j.EditorManager.get().forEach(x=>P({editor:x})),j.EditorManager.on("SetupEditor",P)}),()=>{j==null||j.EditorManager.off("SetupEditor",P),B==null||B.off("input",H),B==null||B.off("ExecCommand",H)}},p=async j=>{const B=await ut("core/fragment");c==null||c.remove(),await Qe(),c=document.createElement("script"),c.setAttribute("type","text/javascript"),c.innerHTML=B.processCollectedJavascript(j),document.head.append(c)},v=j=>{t(6,s=r.courses.find(B=>B.id==j)||r.courses[0]),$(!0)},w=(j,B)=>{const H=new Map(i);for(const O of j)B?H.set(O.id,{...O,type:B,isvalid:!0}):H.delete(O.id);const P=Array.from(H.values());P.sort((O,x)=>O.sortorder.localeCompare(x.sortorder)),t(5,i=new Map(P.map(O=>[O.id,O]))),$(!1)},M=j=>{w([j],null)},$=async j=>{var P,O,x;if(!_)return;const B=new FormData(_),H={courseid:s.id,to:Array.from(i.values()).filter(V=>V.type=="to").map(V=>V.id),cc:Array.from(i.values()).filter(V=>V.type=="cc").map(V=>V.id),bcc:Array.from(i.values()).filter(V=>V.type=="bcc").map(V=>V.id),subject:n,content:((P=B.get("content[text]"))==null?void 0:P.toString())||"",format:parseInt(((O=B.get("content[format]"))==null?void 0:O.toString())||"")||1,draftitemid:parseInt(((x=B.get("content[itemid]"))==null?void 0:x.toString())||"")||0};await f.updateDraft(H,j)};function k(){n=this.value,t(4,n),t(1,d)}const y=()=>$(!1),q=()=>$(!1);function S(j){Me[j?"unshift":"push"](()=>{_=j,t(3,_)})}const N=()=>$(!0);return l.$$set=j=>{"store"in j&&a(t(0,f=j.store)),"message"in j&&t(1,d=j.message),"form"in j&&t(2,m=j.form)},l.$$.update=()=>{l.$$.dirty&2&&t(6,s=d.course),l.$$.dirty&2&&t(4,n=d.subject),l.$$.dirty&2&&t(5,i=new Map(d.recipients.map(j=>[j.id,j]))),l.$$.dirty&4&&p(m.javascript)},[f,d,m,_,n,i,s,r,v,w,M,$,k,y,q,S,N]}class Wr extends ce{constructor(e){super(),me(this,e,Kr,Vr,oe,{store:0,message:1,form:2})}}function ul(l,e,t){const s=l.slice();return s[7]=e[t],s}function cl(l){let e,t=l[7]+"",s,n;return{c(){e=h("option"),s=I(t),e.__value=n=l[7],$e(e,e.__value)},m(i,r){C(i,e,r),g(e,s)},p(i,r){r&8&&t!==(t=i[7]+"")&&R(s,t),r&8&&n!==(n=i[7])&&(e.__value=n,$e(e,e.__value))},d(i){i&&D(e)}}}function Xr(l){let e,t,s,n=l[1].strings.messagesperpage+"",i,r,o,a,f,d,m=ue(l[3]),c=[];for(let _=0;_<m.length;_+=1)c[_]=cl(ul(l,m,_));return{c(){e=h("div"),t=h("div"),s=h("label"),i=I(n),r=I(":"),o=L(),a=h("select");for(let _=0;_<c.length;_+=1)c[_].c();u(s,"for","local-mail-perpage-select"),u(a,"id","local-mail-perpage-select"),u(a,"class","custom-select"),l[2]===void 0&&je(()=>l[4].call(a)),u(t,"class","form-group"),u(e,"class","form-inline justify-content-end mt-3")},m(_,b){C(_,e,b),g(e,t),g(t,s),g(s,i),g(s,r),g(t,o),g(t,a);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(a,null);Ye(a,l[2],!0),f||(d=[J(a,"change",l[4]),J(a,"change",l[5])],f=!0)},p(_,[b]){if(b&2&&n!==(n=_[1].strings.messagesperpage+"")&&R(i,n),b&8){m=ue(_[3]);let p;for(p=0;p<m.length;p+=1){const v=ul(_,m,p);c[p]?c[p].p(v,b):(c[p]=cl(v),c[p].c(),c[p].m(a,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=m.length}b&12&&Ye(a,_[2])},i:F,o:F,d(_){_&&D(e),Be(c,_),f=!1,we(d)}}}function Yr(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,c=>t(1,n=c)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();const a=[5,10,20,50,100];let f=n.preferences.perpage;function d(){f=ct(this),t(2,f),t(3,s),t(1,n)}const m=()=>o.savePreferences({perpage:f});return l.$$set=c=>{"store"in c&&r(t(0,o=c.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=a.includes(n.preferences.perpage)?a:a.concat([n.preferences.perpage]).sort((c,_)=>c-_))},[o,n,f,s,d,m]}class Qr extends ce{constructor(e){super(),me(this,e,Yr,Xr,oe,{store:0})}}function ml(l,e,t){const s=l.slice();return s[9]=e[t],s}function dl(l){let e,t,s=l[4].strings.locked+"",n,i;return{c(){e=h("span"),t=I("("),n=I(s),i=I(")"),u(e,"class","ml-1")},m(r,o){C(r,e,o),g(e,t),g(e,n),g(e,i)},p(r,o){o&16&&s!==(s=r[4].strings.locked+"")&&R(n,s)},d(r){r&&D(e)}}}function _l(l){let e,t,s,n,i,r,o,a=l[9].displayname+"",f,d,m,c,_;function b(){return l[8](l[9])}let p=l[9].locked&&dl(l);return{c(){e=h("div"),t=h("input"),r=L(),o=h("label"),f=I(a),d=L(),p&&p.c(),u(t,"id",s="local-mail-preferences-messageprocessor-"+l[9].name),u(t,"class","custom-control-input"),u(t,"type","checkbox"),t.checked=n=l[9].locked?l[9].enabled:l[3].includes(l[9].name),t.disabled=i=l[9].locked,u(o,"for",m="local-mail-preferences-messageprocessor-"+l[9].name),u(o,"class","custom-control-label pl-1"),u(e,"class","custom-control custom-switch my-2")},m(v,w){C(v,e,w),g(e,t),g(e,r),g(e,o),g(o,f),g(o,d),p&&p.m(o,null),c||(_=J(t,"click",b),c=!0)},p(v,w){l=v,w&16&&s!==(s="local-mail-preferences-messageprocessor-"+l[9].name)&&u(t,"id",s),w&24&&n!==(n=l[9].locked?l[9].enabled:l[3].includes(l[9].name))&&(t.checked=n),w&16&&i!==(i=l[9].locked)&&(t.disabled=i),w&16&&a!==(a=l[9].displayname+"")&&R(f,a),l[9].locked?p?p.p(l,w):(p=dl(l),p.c(),p.m(o,null)):p&&(p.d(1),p=null),w&16&&m!==(m="local-mail-preferences-messageprocessor-"+l[9].name)&&u(o,"for",m)},d(v){v&&D(e),p&&p.d(),c=!1,_()}}}function Zr(l){let e,t=l[4].strings.notifications+"",s,n,i,r,o,a,f,d,m,c=l[4].strings.markmessagesasread+"",_,b,p,v=ue(l[4].settings.messageprocessors),w=[];for(let M=0;M<v.length;M+=1)w[M]=_l(ml(l,v,M));return{c(){e=h("h6"),s=I(t),n=L();for(let M=0;M<w.length;M+=1)w[M].c();i=L(),r=h("div"),o=h("input"),d=L(),m=h("label"),_=I(c),u(e,"class","mb-3"),u(o,"id","local-mail-preferences-markasread"),u(o,"class","custom-control-input"),u(o,"type","checkbox"),o.checked=a=l[2]&&l[3].length>0,o.disabled=f=l[3].length==0,u(m,"for","local-mail-preferences-markasread"),u(m,"class","custom-control-label pl-1"),u(r,"class","custom-control custom-switch my-2 mt-3")},m(M,$){C(M,e,$),g(e,s),C(M,n,$);for(let k=0;k<w.length;k+=1)w[k]&&w[k].m(M,$);C(M,i,$),C(M,r,$),g(r,o),g(r,d),g(r,m),g(m,_),b||(p=J(o,"click",l[6]),b=!0)},p(M,$){if($&16&&t!==(t=M[4].strings.notifications+"")&&R(s,t),$&152){v=ue(M[4].settings.messageprocessors);let k;for(k=0;k<v.length;k+=1){const y=ml(M,v,k);w[k]?w[k].p(y,$):(w[k]=_l(y),w[k].c(),w[k].m(i.parentNode,i))}for(;k<w.length;k+=1)w[k].d(1);w.length=v.length}$&12&&a!==(a=M[2]&&M[3].length>0)&&(o.checked=a),$&8&&f!==(f=M[3].length==0)&&(o.disabled=f),$&16&&c!==(c=M[4].strings.markmessagesasread+"")&&R(_,c)},d(M){M&&(D(e),D(n),D(i),D(r)),Be(w,M),b=!1,p()}}}function xr(l){let e,t;return e=new Ge({props:{title:l[4].strings.preferences,confirmText:l[4].strings.save,cancelText:l[4].strings.cancel,onConfirm:l[5],onCancel:l[1],$$slots:{default:[Zr]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,[n]){const i={};n&16&&(i.title=s[4].strings.preferences),n&16&&(i.confirmText=s[4].strings.save),n&16&&(i.cancelText=s[4].strings.cancel),n&2&&(i.onCancel=s[1]),n&4124&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function ea(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,b=>t(4,s=b)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{onCancel:o}=e,a=s.preferences.markasread,f=s.settings.messageprocessors.map(b=>b.name).filter(b=>s.preferences.notifications.includes(b));const d=()=>{o(),r.savePreferences({markasread:a,notifications:f})},m=()=>{t(2,a=!a)},c=b=>{t(3,f=f.includes(b)?f.filter(p=>p!=b):[...f,b])},_=b=>c(b.name);return l.$$set=b=>{"store"in b&&i(t(0,r=b.store)),"onCancel"in b&&t(1,o=b.onCancel)},[r,o,a,f,s,d,m,c,_]}class ta extends ce{constructor(e){super(),me(this,e,ea,xr,oe,{store:0,onCancel:1})}}function sa(l){let e,t,s,n;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-question-circle text-info"),u(t,"role","img"),u(t,"title",s=l[2].strings.help),u(e,"type","button"),u(e,"class","btn btn-help p-0"),u(e,"data-container","body"),u(e,"data-toggle","popover"),u(e,"data-placement","top"),u(e,"data-content",l[1]),u(e,"data-trigger","focus"),u(e,"aria-label",n=l[2].strings.help)},m(i,r){C(i,e,r),g(e,t)},p(i,[r]){r&4&&s!==(s=i[2].strings.help)&&u(t,"title",s),r&2&&u(e,"data-content",i[1]),r&4&&n!==(n=i[2].strings.help)&&u(e,"aria-label",n)},i:F,o:F,d(i){i&&D(e)}}}function la(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class na extends ce{constructor(e){super(),me(this,e,la,sa,oe,{store:0,message:1})}}function ia(l){let e,t,s,n=l[9].strings.searchfrom+"",i,r,o,a,f,d,m,c=l[9].strings.searchto+"",_,b,p,v,w,M,$,k=l[9].strings.searchdate+"",y,q,S,N,j,B,H,P,O,x,V,te,ae=l[9].strings.searchunreadonly+"",Y,Q,A,E,se,le,U=l[9].strings.searchhasattachments+"",fe,ee,he,Z,ne,pe,De,ze;return S=new na({props:{store:l[4],message:l[9].strings.searchdatehelp}}),{c(){e=h("div"),t=h("div"),s=h("label"),i=I(n),r=L(),o=h("div"),a=h("input"),f=L(),d=h("div"),m=h("label"),_=I(c),b=L(),p=h("div"),v=h("input"),w=L(),M=h("div"),$=h("label"),y=I(k),q=L(),K(S.$$.fragment),N=L(),j=h("div"),B=h("input"),H=L(),P=h("div"),O=h("div"),x=h("input"),V=L(),te=h("label"),Y=I(ae),Q=L(),A=h("div"),E=h("input"),se=L(),le=h("label"),fe=I(U),ee=L(),he=h("input"),u(s,"for","local-mail-search-input-sendername"),u(s,"class","col-4 col-form-label pr-0"),u(a,"type","text"),u(a,"class","form-control"),u(a,"id","local-mail-search-input-sendername"),u(o,"class","col-8"),u(t,"class","form-group row"),u(m,"for","local-mail-search-input-recipientname"),u(m,"class","col-4 col-form-label pr-0"),u(v,"type","text"),u(v,"class","form-control"),u(v,"id","local-mail-search-input-recipientname"),u(p,"class","col-8 p"),u(d,"class","form-group row"),u($,"for","local-mail-search-input-maxdate"),u($,"class","col-4 col-form-label pr-0"),u(B,"type","date"),u(B,"class","form-control"),u(B,"id","local-mail-search-input-maxdate"),u(B,"max",l[10]),B.value=l[8],u(j,"class","col-8"),u(M,"class","form-group row"),u(x,"class","form-check-input"),u(x,"type","checkbox"),u(x,"id","local-mail-search-input-unread"),u(te,"class","form-check-label"),u(te,"for","local-mail-search-input-unread"),u(O,"class","form-check"),u(E,"class","form-check-input"),u(E,"type","checkbox"),u(E,"id","local-mail-search-input-withfilesonly"),u(le,"class","form-check-label"),u(le,"for","local-mail-search-input-withfilesonly"),u(A,"class","form-check"),u(he,"type","submit"),he.disabled=Z=!l[6],u(he,"class","btn btn-primary px-3 ml-auto"),he.value=ne=l[9].strings.search,u(P,"class","d-flex flex-wrap align-items-center"),ge(P,"column-gap","2rem"),ge(P,"row-gap","1rem"),u(e,"class","dropdown-menu dropdown-menu-left show p-3 w-100"),ge(e,"min-width","18rem")},m(ye,ke){C(ye,e,ke),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),g(o,a),$e(a,l[0]),l[15](a),g(e,f),g(e,d),g(d,m),g(m,_),g(d,b),g(d,p),g(p,v),$e(v,l[1]),g(e,w),g(e,M),g(M,$),g($,y),g($,q),W(S,$,null),g(M,N),g(M,j),g(j,B),g(e,H),g(e,P),g(P,O),g(O,x),x.checked=l[2],g(O,V),g(O,te),g(te,Y),g(P,Q),g(P,A),g(A,E),E.checked=l[3],g(A,se),g(A,le),g(le,fe),g(P,ee),g(P,he),pe=!0,De||(ze=[J(a,"input",l[14]),J(v,"input",l[16]),J(B,"input",l[11]),J(x,"change",l[17]),J(E,"change",l[18]),J(he,"click",Te(function(){Ce(l[5])&&l[5].apply(this,arguments)}))],De=!0)},p(ye,[ke]){l=ye,(!pe||ke&512)&&n!==(n=l[9].strings.searchfrom+"")&&R(i,n),ke&1&&a.value!==l[0]&&$e(a,l[0]),(!pe||ke&512)&&c!==(c=l[9].strings.searchto+"")&&R(_,c),ke&2&&v.value!==l[1]&&$e(v,l[1]),(!pe||ke&512)&&k!==(k=l[9].strings.searchdate+"")&&R(y,k);const He={};ke&16&&(He.store=l[4]),ke&512&&(He.message=l[9].strings.searchdatehelp),S.$set(He),(!pe||ke&256)&&(B.value=l[8]),ke&4&&(x.checked=l[2]),(!pe||ke&512)&&ae!==(ae=l[9].strings.searchunreadonly+"")&&R(Y,ae),ke&8&&(E.checked=l[3]),(!pe||ke&512)&&U!==(U=l[9].strings.searchhasattachments+"")&&R(fe,U),(!pe||ke&64&&Z!==(Z=!l[6]))&&(he.disabled=Z),(!pe||ke&512&&ne!==(ne=l[9].strings.search))&&(he.value=ne)},i(ye){pe||(T(S.$$.fragment,ye),pe=!0)},o(ye){z(S.$$.fragment,ye),pe=!1},d(ye){ye&&D(e),l[15](null),X(S),De=!1,we(ze)}}}function ra(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,N=>t(9,n=N)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{sendername:a=""}=e,{recipientname:f=""}=e,{unread:d=!1}=e,{withfilesonly:m=!1}=e,{maxtime:c=0}=e,{submit:_}=e,{submitEnabled:b}=e;function p(){v.focus()}let v,w=Lt(Math.floor(new Date().getTime()/1e3));const M=N=>{t(12,c=Dn(N.target.value))};function $(){a=this.value,t(0,a)}function k(N){Me[N?"unshift":"push"](()=>{v=N,t(7,v)})}function y(){f=this.value,t(1,f)}function q(){d=this.checked,t(2,d)}function S(){m=this.checked,t(3,m)}return l.$$set=N=>{"store"in N&&r(t(4,o=N.store)),"sendername"in N&&t(0,a=N.sendername),"recipientname"in N&&t(1,f=N.recipientname),"unread"in N&&t(2,d=N.unread),"withfilesonly"in N&&t(3,m=N.withfilesonly),"maxtime"in N&&t(12,c=N.maxtime),"submit"in N&&t(5,_=N.submit),"submitEnabled"in N&&t(6,b=N.submitEnabled)},l.$$.update=()=>{l.$$.dirty&4096&&t(8,s=Lt(c))},[a,f,d,m,o,_,b,v,s,n,w,M,c,p,$,k,y,q,S]}class aa extends ce{constructor(e){super(),me(this,e,ra,ia,oe,{store:4,sendername:0,recipientname:1,unread:2,withfilesonly:3,maxtime:12,submit:5,submitEnabled:6,focus:13})}get focus(){return this.$$.ctx[13]}}const{Boolean:oa}=et;function gl(l,e,t){const s=l.slice();return s[14]=e[t],s[16]=t,s}function pl(l){let e,t,s,n=ue(l[4]),i=[];for(let d=0;d<n.length;d+=1)i[d]=bl(gl(l,n,d));const r=d=>z(i[d],1,1,()=>{i[d]=null});function o(d,m){if(d[5])return ca;if(!d[4].length)return ua}let a=o(l),f=a&&a(l);return{c(){e=h("div");for(let d=0;d<i.length;d+=1)i[d].c();t=L(),f&&f.c(),u(e,"class","dropdown-menu dropdown-menu-left overflow-hidden show p-0 w-100"),ge(e,"min-width","18rem")},m(d,m){C(d,e,m);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);g(e,t),f&&f.m(e,null),s=!0},p(d,m){if(m&401){n=ue(d[4]);let c;for(c=0;c<n.length;c+=1){const _=gl(d,n,c);i[c]?(i[c].p(_,m),T(i[c],1)):(i[c]=bl(_),i[c].c(),T(i[c],1),i[c].m(e,t))}for(ie(),c=n.length;c<i.length;c+=1)r(c);re()}a===(a=o(d))&&f?f.p(d,m):(f&&f.d(1),f=a&&a(d),f&&(f.c(),f.m(e,null)))},i(d){if(!s){for(let m=0;m<n.length;m+=1)T(i[m]);s=!0}},o(d){i=i.filter(oa);for(let m=0;m<i.length;m+=1)z(i[m]);s=!1},d(d){d&&D(e),Be(i,d),f&&f.d()}}}function fa(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider my-0")},m(t,s){C(t,e,s)},d(t){t&&D(e)}}}function bl(l){let e,t,s,n,i,r,o,a,f=l[14].shorttime+"",d,m,c,_,b,p,v=l[16]>0&&fa();return s=new gt({props:{store:l[0],message:l[14]}}),r=new _t({props:{store:l[0],message:l[14]}}),{c(){v&&v.c(),e=L(),t=h("a"),K(s.$$.fragment),n=L(),i=h("div"),K(r.$$.fragment),o=L(),a=h("div"),d=I(f),u(a,"title",m=l[14].fulltime),u(a,"class","ml-auto"),u(i,"class","local-mail-incremental-search-muted d-flex"),u(t,"class","dropdown-item local-mail-incremental-search-item"),u(t,"href",c=Ie(l[7](l[14],l[16]))),G(t,"font-weight-bold",l[14].unread)},m(w,M){v&&v.m(w,M),C(w,e,M),C(w,t,M),W(s,t,null),g(t,n),g(t,i),W(r,i,null),g(i,o),g(i,a),g(a,d),_=!0,b||(p=J(t,"click",function(){Ce(l[8](l[14],l[16]))&&l[8](l[14],l[16]).apply(this,arguments)}),b=!0)},p(w,M){l=w;const $={};M&1&&($.store=l[0]),M&16&&($.message=l[14]),s.$set($);const k={};M&1&&(k.store=l[0]),M&16&&(k.message=l[14]),r.$set(k),(!_||M&16)&&f!==(f=l[14].shorttime+"")&&R(d,f),(!_||M&16&&m!==(m=l[14].fulltime))&&u(a,"title",m),(!_||M&144&&c!==(c=Ie(l[7](l[14],l[16]))))&&u(t,"href",c),(!_||M&16)&&G(t,"font-weight-bold",l[14].unread)},i(w){_||(T(s.$$.fragment,w),T(r.$$.fragment,w),_=!0)},o(w){z(s.$$.fragment,w),z(r.$$.fragment,w),_=!1},d(w){w&&(D(e),D(t)),v&&v.d(w),X(s),X(r),b=!1,p()}}}function ua(l){let e,t=l[3].strings.nomessagesfound+"",s;return{c(){e=h("div"),s=I(t),u(e,"class","px-4 py-2 text-danger")},m(n,i){C(n,e,i),g(e,s)},p(n,i){i&8&&t!==(t=n[3].strings.nomessagesfound+"")&&R(s,t)},d(n){n&&D(e)}}}function ca(l){let e,t,s,n=l[3].strings.searchallmessages+"",i,r,o,a;return{c(){e=h("div"),t=L(),s=h("a"),i=I(n),u(e,"class","dropdown-divider my-0"),u(s,"class","dropdown-item py-2"),u(s,"href",r=Ie(l[6]))},m(f,d){C(f,e,d),C(f,t,d),C(f,s,d),g(s,i),o||(a=J(s,"click",Te(l[12])),o=!0)},p(f,d){d&8&&n!==(n=f[3].strings.searchallmessages+"")&&R(i,n),d&64&&r!==(r=Ie(f[6]))&&u(s,"href",r)},d(f){f&&(D(e),D(t),D(s)),o=!1,a()}}}function ma(l){let e,t,s=l[1]&&l[4]!=null&&pl(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),C(n,e,i),t=!0},p(n,[i]){n[1]&&n[4]!=null?s?(s.p(n,i),i&18&&T(s,1)):(s=pl(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}const ft=10,da=500;function _a(l,e,t){let s,n,i,r=F,o=()=>(r(),r=_e(a,$=>t(3,i=$)),a);l.$$.on_destroy.push(()=>r());let{store:a}=e;o();let{enabled:f}=e,{content:d}=e,{loading:m=!1}=e,{onClick:c}=e,_,b,p=!1;const v=async $=>{t(9,m=!0),window.clearTimeout(_),t(11,_=window.setTimeout(async()=>{const k=i.params,q={methodname:"search_messages",query:{courseid:k.courseid,labelid:k.tray=="label"?k.labelid:void 0,draft:k.tray=="drafts"?!0:k.tray=="sent"?!1:void 0,roles:k.tray=="inbox"?Object.values(Ae):k.tray=="sent"?["from"]:void 0,starred:k.tray=="starred"?!0:void 0,deleted:k.tray=="trash",content:$.trim(),stopid:i.incrementalSearchStopId},limit:ft+1};let S;try{S=await Xe([q])}catch(N){a.setError(N),t(9,m=!1),t(4,b=void 0);return}t(9,m=!1),t(4,b=S[0]),t(5,p=b.length>ft||!!i.incrementalSearchStopId),t(4,b=b.slice(0,ft))},da))},w=($,k)=>y=>{$.draft||(y.preventDefault(),c(s($,k)))};Hl(()=>{window.clearTimeout(_)});const M=()=>c(n);return l.$$set=$=>{"store"in $&&o(t(0,a=$.store)),"enabled"in $&&t(1,f=$.enabled),"content"in $&&t(10,d=$.content),"loading"in $&&t(9,m=$.loading),"onClick"in $&&t(2,c=$.onClick)},l.$$.update=()=>{l.$$.dirty&3074&&(f?v(d):(t(4,b=void 0),t(9,m=!1),window.clearTimeout(_))),l.$$.dirty&1032&&t(7,s=($,k)=>({...i.params,messageid:$.id,offset:k,search:{content:d.trim()}})),l.$$.dirty&1032&&t(6,n={...i.params,messageid:void 0,offset:0,search:{content:d.trim()}})},[a,f,c,i,b,p,n,s,w,m,d,_,M]}class ga extends ce{constructor(e){super(),me(this,e,_a,ma,oe,{store:0,enabled:1,content:10,loading:9,onClick:2})}}function hl(l,e,t){const s=l.slice();return s[35]=e[t].label,s[36]=e[t].value,s[38]=t,s}function pa(l){let e,t,s,n=ue(l[15]),i=[];for(let r=0;r<n.length;r+=1)i[r]=vl(hl(l,n,r));return{c(){e=h("button");for(let r=0;r<i.length;r+=1)i[r].c();u(e,"type","button"),u(e,"class","local-mail-search-box-input-enabled alert-primary form-control text-left text-truncate")},m(r,o){C(r,e,o);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null);t||(s=J(e,"click",l[16]),t=!0)},p(r,o){if(o[0]&32768){n=ue(r[15]);let a;for(a=0;a<n.length;a+=1){const f=hl(r,n,a);i[a]?i[a].p(f,o):(i[a]=vl(f),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}},d(r){r&&D(e),Be(i,r),t=!1,s()}}}function ba(l){let e,t,s,n,i;return{c(){e=h("input"),u(e,"type","text"),u(e,"class","local-mail-search-box-input form-control"),u(e,"placeholder",t=l[7].strings.search),u(e,"aria-label",s=l[7].strings.search),u(e,"autocomplete","off"),G(e,"local-mail-search-box-input-enabled",l[14]||l[13])},m(r,o){C(r,e,o),$e(e,l[1]),l[26](e),n||(i=[J(e,"input",l[25]),J(e,"keypress",l[21])],n=!0)},p(r,o){o[0]&128&&t!==(t=r[7].strings.search)&&u(e,"placeholder",t),o[0]&128&&s!==(s=r[7].strings.search)&&u(e,"aria-label",s),o[0]&2&&e.value!==r[1]&&$e(e,r[1]),o[0]&24576&&G(e,"local-mail-search-box-input-enabled",r[14]||r[13])},d(r){r&&D(e),l[26](null),n=!1,we(i)}}}function ha(l){let e;return{c(){e=h("span"),e.textContent=", ",u(e,"class","dimmed_text")},m(t,s){C(t,e,s)},d(t){t&&D(e)}}}function ka(l){let e,t=l[36]+"",s,n=l[35]&&kl(l);return{c(){n&&n.c(),e=L(),s=I(t)},m(i,r){n&&n.m(i,r),C(i,e,r),C(i,s,r)},p(i,r){i[35]?n?n.p(i,r):(n=kl(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),r[0]&32768&&t!==(t=i[36]+"")&&R(s,t)},d(i){i&&(D(e),D(s)),n&&n.d(i)}}}function va(l){let e,t=l[35]+"",s;return{c(){e=h("span"),s=I(t),u(e,"class","dimmed_text")},m(n,i){C(n,e,i),g(e,s)},p(n,i){i[0]&32768&&t!==(t=n[35]+"")&&R(s,t)},d(n){n&&D(e)}}}function kl(l){let e,t=l[35]+"",s,n;return{c(){e=h("span"),s=I(t),n=I(":"),u(e,"class","dimmed_text")},m(i,r){C(i,e,r),g(e,s),g(e,n)},p(i,r){r[0]&32768&&t!==(t=i[35]+"")&&R(s,t)},d(i){i&&D(e)}}}function vl(l){let e,t,s=l[38]>0&&ha();function n(o,a){return o[36]===!0?va:ka}let i=n(l),r=i(l);return{c(){s&&s.c(),e=L(),r.c(),t=be()},m(o,a){s&&s.m(o,a),C(o,e,a),r.m(o,a),C(o,t,a)},p(o,a){i===(i=n(o))&&r?r.p(o,a):(r.d(1),r=i(o),r&&(r.c(),r.m(t.parentNode,t)))},d(o){o&&(D(e),D(t)),s&&s.d(o),r.d(o)}}}function wl(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-times"),u(t,"aria-hidden","true"),u(e,"type","button"),u(e,"class","local-mail-search-box-icon btn px-0"),u(e,"title",s=l[7].strings.clearsearch)},m(r,o){C(r,e,o),g(e,t),n||(i=J(e,"click",Te(l[19])),n=!0)},p(r,o){o[0]&128&&s!==(s=r[7].strings.clearsearch)&&u(e,"title",s)},d(r){r&&D(e),n=!1,i()}}}function $l(l){let e,t,s,n,i,r,o;function a(b){l[28](b)}function f(b){l[29](b)}function d(b){l[30](b)}function m(b){l[31](b)}function c(b){l[32](b)}let _={store:l[0],submit:l[20],submitEnabled:l[13]};return l[2]!==void 0&&(_.sendername=l[2]),l[3]!==void 0&&(_.recipientname=l[3]),l[4]!==void 0&&(_.unread=l[4]),l[5]!==void 0&&(_.withfilesonly=l[5]),l[6]!==void 0&&(_.maxtime=l[6]),e=new aa({props:_}),l[27](e),Me.push(()=>Ve(e,"sendername",a)),Me.push(()=>Ve(e,"recipientname",f)),Me.push(()=>Ve(e,"unread",d)),Me.push(()=>Ve(e,"withfilesonly",m)),Me.push(()=>Ve(e,"maxtime",c)),{c(){K(e.$$.fragment)},m(b,p){W(e,b,p),o=!0},p(b,p){const v={};p[0]&1&&(v.store=b[0]),p[0]&8192&&(v.submitEnabled=b[13]),!t&&p[0]&4&&(t=!0,v.sendername=b[2],Ke(()=>t=!1)),!s&&p[0]&8&&(s=!0,v.recipientname=b[3],Ke(()=>s=!1)),!n&&p[0]&16&&(n=!0,v.unread=b[4],Ke(()=>n=!1)),!i&&p[0]&32&&(i=!0,v.withfilesonly=b[5],Ke(()=>i=!1)),!r&&p[0]&64&&(r=!0,v.maxtime=b[6],Ke(()=>r=!1)),e.$set(v)},i(b){o||(T(e.$$.fragment,b),o=!0)},o(b){z(e.$$.fragment,b),o=!1},d(b){l[27](null),X(e,b)}}}function yl(l){let e,t,s;function n(r){l[33](r)}let i={store:l[0],enabled:l[8]&&!l[9]&&!!l[1].trim(),content:l[1],onClick:l[22]};return l[12]!==void 0&&(i.loading=l[12]),e=new ga({props:i}),Me.push(()=>Ve(e,"loading",n)),{c(){K(e.$$.fragment)},m(r,o){W(e,r,o),s=!0},p(r,o){const a={};o[0]&1&&(a.store=r[0]),o[0]&770&&(a.enabled=r[8]&&!r[9]&&!!r[1].trim()),o[0]&2&&(a.content=r[1]),!t&&o[0]&4096&&(t=!0,a.loading=r[12],Ke(()=>t=!1)),e.$set(a)},i(r){s||(T(e.$$.fragment,r),s=!0)},o(r){z(e.$$.fragment,r),s=!1},d(r){X(e,r)}}}function wa(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w;function M(N,j){return N[8]?ba:pa}let $=M(l),k=$(l),y=(l[14]||l[13])&&wl(l),q=l[9]&&$l(l),S=l[7].settings.incrementalsearch&&yl(l);return{c(){e=h("form"),t=h("div"),s=h("i"),i=L(),k.c(),r=L(),o=h("div"),y&&y.c(),a=L(),f=h("button"),d=h("i"),_=L(),q&&q.c(),b=L(),S&&S.c(),u(s,"class",n="fa fa-fw "+(l[12]?"fa-spinner fa-pulse":"fa-search")),u(s,"aria-hidden","true"),u(t,"class","local-mail-search-box-icon position-absolute h-100 d-flex justify-content-center align-items-center px-0"),ge(t,"top","0"),ge(t,"left","0"),u(d,"class",m="fa fa-fw "+(l[9]?"fa-caret-up":"fa-sliders")),u(d,"aria-hidden","true"),u(f,"type","button"),u(f,"aria-expanded",l[9]),u(f,"class","local-mail-search-box-icon btn px-0"),u(f,"title",c=l[7].strings.searchoptions),u(o,"class","position-absolute h-100 d-flex align-items-center"),ge(o,"top","0"),ge(o,"right","0"),u(e,"class","local-mail-search-box position-relative")},m(N,j){C(N,e,j),g(e,t),g(t,s),g(e,i),k.m(e,null),g(e,r),g(e,o),y&&y.m(o,null),g(o,a),g(o,f),g(f,d),g(e,_),q&&q.m(e,null),g(e,b),S&&S.m(e,null),p=!0,v||(w=[J(f,"click",Te(l[18])),Se(Fe.call(null,e,l[17]))],v=!0)},p(N,j){(!p||j[0]&4096&&n!==(n="fa fa-fw "+(N[12]?"fa-spinner fa-pulse":"fa-search")))&&u(s,"class",n),$===($=M(N))&&k?k.p(N,j):(k.d(1),k=$(N),k&&(k.c(),k.m(e,r))),N[14]||N[13]?y?y.p(N,j):(y=wl(N),y.c(),y.m(o,a)):y&&(y.d(1),y=null),(!p||j[0]&512&&m!==(m="fa fa-fw "+(N[9]?"fa-caret-up":"fa-sliders")))&&u(d,"class",m),(!p||j[0]&512)&&u(f,"aria-expanded",N[9]),(!p||j[0]&128&&c!==(c=N[7].strings.searchoptions))&&u(f,"title",c),N[9]?q?(q.p(N,j),j[0]&512&&T(q,1)):(q=$l(N),q.c(),T(q,1),q.m(e,b)):q&&(ie(),z(q,1,1,()=>{q=null}),re()),N[7].settings.incrementalsearch?S?(S.p(N,j),j[0]&128&&T(S,1)):(S=yl(N),S.c(),T(S,1),S.m(e,null)):S&&(ie(),z(S,1,1,()=>{S=null}),re())},i(N){p||(T(q),T(S),p=!0)},o(N){z(q),z(S),p=!1},d(N){N&&D(e),k.d(),y&&y.d(),q&&q.d(),S&&S.d(),v=!1,we(w)}}}function $a(l,e,t){let s,n,i,r,o,a,f=F,d=()=>(f(),f=_e(m,U=>t(7,a=U)),m);l.$$.on_destroy.push(()=>f());let{store:m}=e;d();let c=!a.params.search,_=!1,b,p,v="",w="",M="",$=!1,k=!1,y=0,q=!1;const S=U=>{t(1,v=(U==null?void 0:U.content)||""),t(2,w=(U==null?void 0:U.sendername)||""),t(3,M=(U==null?void 0:U.recipientname)||""),t(4,$=(U==null?void 0:U.unread)||!1),t(5,k=(U==null?void 0:U.withfilesonly)||!1),t(6,y=(U==null?void 0:U.maxtime)||0)},N=async()=>{t(8,c=!0),n&&t(9,_=!0),await Qe(),b.focus()},j=async()=>{t(8,c=!i),t(9,_=!1),S(s)},B=async()=>{_?(t(9,_=!1),await Qe(),b.focus()):(t(9,_=!0),N(),await Qe(),p.focus())},H=async()=>{t(8,c=!0),t(9,_=!1),S(),await m.navigate({...a.params,offset:void 0,search:void 0}),await Qe(),b.focus()},P=async()=>{await m.navigate({...a.params,messageid:void 0,offset:void 0,search:_?{content:v.trim(),sendername:w.trim(),recipientname:M.trim(),unread:$,withfilesonly:k,maxtime:y}:{content:v.trim()}}),t(9,_=!1),t(8,c=!1)},O=U=>{U.key=="Enter"&&(U.preventDefault(),r?P():H())},x=async U=>{await m.navigate(U),t(9,_=!1),t(8,c=!1)};function V(){v=this.value,t(1,v)}function te(U){Me[U?"unshift":"push"](()=>{b=U,t(10,b)})}function ae(U){Me[U?"unshift":"push"](()=>{p=U,t(11,p)})}function Y(U){w=U,t(2,w)}function Q(U){M=U,t(3,M)}function A(U){$=U,t(4,$)}function E(U){k=U,t(5,k)}function se(U){y=U,t(6,y)}function le(U){q=U,t(12,q)}return l.$$set=U=>{"store"in U&&d(t(0,m=U.store))},l.$$.update=()=>{l.$$.dirty[0]&128&&t(23,s=a.params.search),l.$$.dirty[0]&8388608&&S(s),l.$$.dirty[0]&8388608&&t(24,n=!!(s!=null&&s.sendername||s!=null&&s.recipientname||s!=null&&s.unread||s!=null&&s.withfilesonly||s!=null&&s.maxtime)),l.$$.dirty[0]&25165824&&t(14,i=!!(s!=null&&s.content)||n),l.$$.dirty[0]&126&&t(13,r=!!(v.trim()||w.trim()||M.trim()||$||k||y)),l.$$.dirty[0]&254&&t(15,o=[{label:"",value:v},{label:a.strings.searchfrom,value:w},{label:a.strings.searchto,value:M},{label:a.strings.searchdate,value:y>0?new Date(y*1e3).toLocaleDateString():""},{label:a.strings.searchunreadonly,value:$},{label:a.strings.searchhasattachments,value:k}].filter(({value:U})=>!!U))},[m,v,w,M,$,k,y,a,c,_,b,p,q,r,i,o,N,j,B,H,P,O,x,s,n,V,te,ae,Y,Q,A,E,se,le]}class ya extends ce{constructor(e){super(),me(this,e,$a,wa,oe,{store:0},null,[-1,-1])}}function Ml(l,e,t){const s=l.slice();return s[4]=e[t],s}function Cl(l){let e,t=l[1].strings.undo+"",s,n,i;function r(){return l[2](l[4])}return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","local-mail-toast-undo btn font-weight-bold px-2 py-0 ml-3")},m(o,a){C(o,e,a),g(e,s),n||(i=J(e,"click",r),n=!0)},p(o,a){l=o,a&2&&t!==(t=l[1].strings.undo+"")&&R(s,t)},d(o){o&&D(e),n=!1,i()}}}function Dl(l,e){let t,s,n,i=e[4].text+"",r,o,a,f,d,m,c,_,b,p,v=F,w,M,$,k=e[4].undo&&Cl(e);function y(){return e[3](e[4])}return{key:l,first:null,c(){t=h("div"),s=h("div"),n=h("div"),r=I(i),o=L(),k&&k.c(),a=L(),f=h("button"),d=h("i"),c=L(),u(n,"class","px-1 mr-auto"),u(d,"class","fa fa-times"),u(f,"type","button"),u(f,"class","btn px-2 py-0 ml-2 text-white-50"),u(f,"title",m=e[1].strings.close),u(s,"class","toast-body d-flex align-items-center p-2"),u(t,"class","toast mt-2 mb-0"),u(t,"role","alert"),u(t,"aria-live","assertive"),u(t,"aria-atomic","true"),u(t,"data-autohide","false"),this.first=t},m(q,S){C(q,t,S),g(t,s),g(s,n),g(n,r),g(s,o),k&&k.m(s,null),g(s,a),g(s,f),g(f,d),g(t,c),w=!0,M||($=J(f,"click",y),M=!0)},p(q,S){e=q,(!w||S&2)&&i!==(i=e[4].text+"")&&R(r,i),e[4].undo?k?k.p(e,S):(k=Cl(e),k.c(),k.m(s,a)):k&&(k.d(1),k=null),(!w||S&2&&m!==(m=e[1].strings.close))&&u(f,"title",m)},r(){p=t.getBoundingClientRect()},f(){Ql(t),v(),dt(t,p)},a(){v(),v=Yl(t,p,an,{})},i(q){w||(je(()=>{w&&(b&&b.end(1),_=mt(t,at,{y:50,delay:200}),_.start())}),w=!0)},o(q){_&&_.invalidate(),b=Vl(t,at,{y:50,duration:400}),w=!1},d(q){q&&D(t),k&&k.d(),q&&b&&b.end(),M=!1,$()}}}function Ma(l){let e,t=[],s=new Map,n,i=ue(l[1].toasts);const r=o=>o[4];for(let o=0;o<i.length;o+=1){let a=Ml(l,i,o),f=r(a);s.set(f,t[o]=Dl(f,a))}return{c(){e=h("div");for(let o=0;o<t.length;o+=1)t[o].c();u(e,"aria-live","polite"),u(e,"aria-atomic","true"),u(e,"class","local-mail-toasts position-fixed d-flex flex-column-reverse p-3")},m(o,a){C(o,e,a);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(o,[a]){if(a&3){i=ue(o[1].toasts),ie();for(let f=0;f<t.length;f+=1)t[f].r();t=Le(t,a,r,1,o,i,s,e,Jl,Dl,null,Ml);for(let f=0;f<t.length;f+=1)t[f].a();re()}},i(o){if(!n){for(let a=0;a<i.length;a+=1)T(t[a]);n=!0}},o(o){for(let a=0;a<t.length;a+=1)z(t[a]);n=!1},d(o){o&&D(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function Ca(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=f=>r.undo(f),a=f=>r.hideToast(f);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,o,a]}class Da extends ce{constructor(e){super(),me(this,e,Ca,Ma,oe,{store:0})}}function Sa(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa fa-fw fa-arrow-left"),u(e,"type","button"),u(e,"class","local-mail-back-button btn btn-secondary"),u(e,"title",s=l[1].strings.messagelist)},m(r,o){C(r,e,o),g(e,t),n||(i=J(e,"click",l[2]),n=!0)},p(r,[o]){o&2&&s!==(s=r[1].strings.messagelist)&&u(e,"title",s)},i:F,o:F,d(r){r&&D(e),n=!1,i()}}}function Ta(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=()=>r.navigateToList();return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class La extends ce{constructor(e){super(),me(this,e,Ta,Sa,oe,{store:0})}}function Sl(l){let e,t,s=l[1].strings.all+"",n,i,r,o=l[1].strings.none+"",a,f,d,m=l[1].strings.read+"",c,_,b,p=l[1].strings.unread+"",v,w,M,$=l[1].strings.starred+"",k,y,q,S=l[1].strings.unstarred+"",N,j,B;return{c(){e=h("div"),t=h("button"),n=I(s),i=L(),r=h("button"),a=I(o),f=L(),d=h("button"),c=I(m),_=L(),b=h("button"),v=I(p),w=L(),M=h("button"),k=I($),y=L(),q=h("button"),N=I(S),u(t,"type","button"),u(t,"class","dropdown-item"),u(r,"type","button"),u(r,"class","dropdown-item"),u(d,"type","button"),u(d,"class","dropdown-item"),u(b,"type","button"),u(b,"class","dropdown-item"),u(M,"type","button"),u(M,"class","dropdown-item"),u(q,"type","button"),u(q,"class","dropdown-item"),u(e,"class","dropdown-menu show")},m(H,P){C(H,e,P),g(e,t),g(t,n),g(e,i),g(e,r),g(r,a),g(e,f),g(e,d),g(d,c),g(e,_),g(e,b),g(b,v),g(e,w),g(e,M),g(M,k),g(e,y),g(e,q),g(q,N),j||(B=[J(t,"click",l[7]),J(r,"click",l[8]),J(d,"click",l[9]),J(b,"click",l[10]),J(M,"click",l[11]),J(q,"click",l[12])],j=!0)},p(H,P){P&2&&s!==(s=H[1].strings.all+"")&&R(n,s),P&2&&o!==(o=H[1].strings.none+"")&&R(a,o),P&2&&m!==(m=H[1].strings.read+"")&&R(c,m),P&2&&p!==(p=H[1].strings.unread+"")&&R(v,p),P&2&&$!==($=H[1].strings.starred+"")&&R(k,$),P&2&&S!==(S=H[1].strings.unstarred+"")&&R(N,S)},d(H){H&&D(e),j=!1,we(B)}}}function za(l){let e,t,s,n,i,r,o,a,f=l[2]&&Sl(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=L(),f&&f.c(),u(s,"class",n="fa fa-fw "+l[3]),u(t,"class","btn btn-secondary dropdown-toggle"),u(t,"aria-expanded",l[2]),u(t,"title",i=l[1].strings.select),u(e,"class","btn-group"),u(e,"role","group")},m(d,m){C(d,e,m),g(e,t),g(t,s),g(e,r),f&&f.m(e,null),o||(a=[J(t,"click",l[5]),Se(Fe.call(null,e,l[4]))],o=!0)},p(d,[m]){m&8&&n!==(n="fa fa-fw "+d[3])&&u(s,"class",n),m&4&&u(t,"aria-expanded",d[2]),m&2&&i!==(i=d[1].strings.select)&&u(t,"title",i),d[2]?f?f.p(d,m):(f=Sl(d),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:F,o:F,d(d){d&&D(e),f&&f.d(),o=!1,we(a)}}}function ja(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(o,M=>t(1,n=M)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let a=!1;const f=()=>{t(2,a=!1)},d=()=>{t(2,a=!a)},m=M=>{f(),o.selectAll(M)},c=()=>m("all"),_=()=>m("none"),b=()=>m("read"),p=()=>m("unread"),v=()=>m("starred"),w=()=>m("unstarred");return l.$$set=M=>{"store"in M&&r(t(0,o=M.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=n.selectedMessages.size==0?"fa-square-o":n.selectedMessages.size<n.listMessages.length?"fa-minus-square-o":"fa-check-square-o")},[o,n,a,s,f,d,m,c,_,b,p,v,w]}class Na extends ce{constructor(e){super(),me(this,e,ja,za,oe,{store:0})}}function Aa(l){let e,t;return e=new Na({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function qa(l){let e,t;return e=new La({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Tl(l){let e,t,s,n,i,r;const o=[Ea,Ba],a=[];function f(d,m){return d[1].params.tray=="trash"?0:1}return t=f(l),s=a[t]=o[t](l),i=new ln({props:{store:l[0]}}),{c(){e=h("div"),s.c(),n=L(),K(i.$$.fragment),u(e,"class","btn-group"),u(e,"role","group")},m(d,m){C(d,e,m),a[t].m(e,null),g(e,n),W(i,e,null),r=!0},p(d,m){let c=t;t=f(d),t===c?a[t].p(d,m):(ie(),z(a[c],1,1,()=>{a[c]=null}),re(),s=a[t],s?s.p(d,m):(s=a[t]=o[t](d),s.c()),T(s,1),s.m(e,n));const _={};m&1&&(_.store=d[0]),i.$set(_)},i(d){r||(T(s),T(i.$$.fragment,d),r=!0)},o(d){z(s),z(i.$$.fragment,d),r=!1},d(d){d&&D(e),a[t].d(),X(i)}}}function Ba(l){let e,t,s,n;return e=new sn({props:{store:l[0]}}),s=new xl({props:{store:l[0]}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){W(e,i,r),C(i,t,r),W(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),X(e,i),X(s,i)}}}function Ea(l){let e,t,s,n;return e=new rn({props:{store:l[0]}}),s=new en({props:{store:l[0]}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){W(e,i,r),C(i,t,r),W(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),X(e,i),X(s,i)}}}function Ll(l){let e,t,s;return t=new Kl({props:{settings:l[1].settings,strings:l[1].strings,courses:l[1].courses,label:l[1].strings.allcourses,selected:l[1].params.courseid,readonly:l[1].params.tray=="course",onChange:l[2],primary:!0,style:l[1].viewportSize>=de.MD?"filter-left":"filter-right"}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","d-flex flex-grow-1 ml-auto mr-0 ml-md-0 mr-md-auto"),ge(e,"max-width","20rem"),ge(e,"min-width","0")},m(n,i){C(n,e,i),W(t,e,null),s=!0},p(n,i){const r={};i&2&&(r.settings=n[1].settings),i&2&&(r.strings=n[1].strings),i&2&&(r.courses=n[1].courses),i&2&&(r.label=n[1].strings.allcourses),i&2&&(r.selected=n[1].params.courseid),i&2&&(r.readonly=n[1].params.tray=="course"),i&1&&(r.onChange=n[2]),i&2&&(r.style=n[1].viewportSize>=de.MD?"filter-left":"filter-right"),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),X(t)}}}function Ia(l){let e,t;return e=new gn({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Pa(l){let e,t;return e=new nn({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Ra(l){var $;let e,t,s,n,i,r=!(($=l[1].message)!=null&&$.draft)&&["shortname","fullname"].includes(l[1].settings.filterbycourse)&&l[1].viewportSize<de.LG,o,a,f,d;const m=[qa,Aa],c=[];function _(k,y){return k[1].message?0:1}t=_(l),s=c[t]=m[t](l);let b=l[1].viewportSize>=de.MD&&Tl(l),p=r&&Ll(l);const v=[Pa,Ia],w=[];function M(k,y){var q;return k[1].viewportSize>=de.MD?0:(q=k[1].message)!=null&&q.draft?1:-1}return~(a=M(l))&&(f=w[a]=v[a](l)),{c(){e=h("div"),s.c(),n=L(),b&&b.c(),i=L(),p&&p.c(),o=L(),f&&f.c(),u(e,"role","toolbar"),u(e,"class","local-mail-toolbar d-flex w-100")},m(k,y){C(k,e,y),c[t].m(e,null),g(e,n),b&&b.m(e,null),g(e,i),p&&p.m(e,null),g(e,o),~a&&w[a].m(e,null),d=!0},p(k,[y]){var N;let q=t;t=_(k),t===q?c[t].p(k,y):(ie(),z(c[q],1,1,()=>{c[q]=null}),re(),s=c[t],s?s.p(k,y):(s=c[t]=m[t](k),s.c()),T(s,1),s.m(e,n)),k[1].viewportSize>=de.MD?b?(b.p(k,y),y&2&&T(b,1)):(b=Tl(k),b.c(),T(b,1),b.m(e,i)):b&&(ie(),z(b,1,1,()=>{b=null}),re()),y&2&&(r=!((N=k[1].message)!=null&&N.draft)&&["shortname","fullname"].includes(k[1].settings.filterbycourse)&&k[1].viewportSize<de.LG),r?p?(p.p(k,y),y&2&&T(p,1)):(p=Ll(k),p.c(),T(p,1),p.m(e,o)):p&&(ie(),z(p,1,1,()=>{p=null}),re());let S=a;a=M(k),a===S?~a&&w[a].p(k,y):(f&&(ie(),z(w[S],1,1,()=>{w[S]=null}),re()),~a?(f=w[a],f?f.p(k,y):(f=w[a]=v[a](k),f.c()),T(f,1),f.m(e,null)):f=null)},i(k){d||(T(s),T(b),T(p),T(f),d=!0)},o(k){z(s),z(b),z(p),z(f),d=!1},d(k){k&&D(e),c[t].d(),b&&b.d(),p&&p.d(),~a&&w[a].d()}}}function Fa(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=a=>r.selectCourse(a);return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class Ua extends ce{constructor(e){super(),me(this,e,Fa,Ra,oe,{store:0})}}const{window:lt}=et;function zl(l){let e,t;return e=new En({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Ga(l){let e,t=l[3].strings.pluginname+"",s,n,i=l[2]&&l[3].viewportSize<de.LG&&jl(l);return{c(){e=h("h1"),s=I(t),n=L(),i&&i.c(),u(e,"class","h2 local-mail-view-side-column text-truncate mb-4")},m(r,o){C(r,e,o),g(e,s),g(e,n),i&&i.m(e,null)},p(r,o){o&8&&t!==(t=r[3].strings.pluginname+"")&&R(s,t),r[2]&&r[3].viewportSize<de.LG?i?i.p(r,o):(i=jl(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(r){r&&D(e),i&&i.d()}}}function Ha(l){let e;return{c(){e=h("div"),u(e,"class","local-mail-view-side-column")},m(t,s){C(t,e,s)},p:F,d(t){t&&D(e)}}}function jl(l){let e,t,s;return{c(){e=h("i"),t=L(),s=I(l[2]),u(e,"class","fa fa-angle-right mx-1"),u(e,"aria-hidden","true")},m(n,i){C(n,e,i),C(n,t,i),C(n,s,i)},p(n,i){i&4&&R(s,n[2])},d(n){n&&(D(e),D(t),D(s))}}}function Nl(l){let e,t,s;return t=new ya({props:{store:l[0]}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","local-mail-view-search")},m(n,i){C(n,e,i),W(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),X(t)}}}function Al(l){let e,t,s,n;e=new Wl({props:{strings:l[3].strings,iconOnly:l[1]&&l[3].viewportSize<de.SM,onClick:l[14]}});let i=!l[1]&&ql(l);return{c(){K(e.$$.fragment),t=L(),i&&i.c(),s=be()},m(r,o){W(e,r,o),C(r,t,o),i&&i.m(r,o),C(r,s,o),n=!0},p(r,o){const a={};o&8&&(a.strings=r[3].strings),o&10&&(a.iconOnly=r[1]&&r[3].viewportSize<de.SM),o&1&&(a.onClick=r[14]),e.$set(a),r[1]?i&&(ie(),z(i,1,1,()=>{i=null}),re()):i?(i.p(r,o),o&2&&T(i,1)):(i=ql(r),i.c(),T(i,1),i.m(s.parentNode,s))},i(r){n||(T(e.$$.fragment,r),T(i),n=!0)},o(r){z(e.$$.fragment,r),z(i),n=!1},d(r){r&&(D(t),D(s)),X(e,r),i&&i.d(r)}}}function ql(l){let e,t,s;return t=new Tn({props:{strings:l[3].strings,onClick:l[15]}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","ml-auto")},m(n,i){C(n,e,i),W(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[15]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),X(t)}}}function Bl(l){let e,t,s,n=l[3].viewportSize>=de.LG&&El(l),i=l[1]&&Il(l);return{c(){e=h("div"),n&&n.c(),t=L(),i&&i.c(),u(e,"class","row mb-3")},m(r,o){C(r,e,o),n&&n.m(e,null),g(e,t),i&&i.m(e,null),s=!0},p(r,o){r[3].viewportSize>=de.LG?n?(n.p(r,o),o&8&&T(n,1)):(n=El(r),n.c(),T(n,1),n.m(e,t)):n&&(ie(),z(n,1,1,()=>{n=null}),re()),r[1]?i?(i.p(r,o),o&2&&T(i,1)):(i=Il(r),i.c(),T(i,1),i.m(e,null)):i&&(ie(),z(i,1,1,()=>{i=null}),re())},i(r){s||(T(n),T(i),s=!0)},o(r){z(n),z(i),s=!1},d(r){r&&D(e),n&&n.d(),i&&i.d()}}}function El(l){let e,t,s;return t=new Wl({props:{strings:l[3].strings,onClick:l[16]}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","local-mail-view-side-column")},m(n,i){C(n,e,i),W(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[16]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),X(t)}}}function Il(l){let e,t,s;return t=new Ua({props:{store:l[0]}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","local-mail-view-main-column d-flex")},m(n,i){C(n,e,i),W(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),X(t)}}}function Pl(l){let e,t,s;return t=new Ln({props:{settings:l[3].settings,strings:l[3].strings,courses:l[3].courses,labels:l[3].labels,params:l[3].params,onClick:l[0].navigate,onCourseChange:l[0].selectCourse}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","local-mail-view-side-column")},m(n,i){C(n,e,i),W(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.settings=n[3].settings),i&8&&(r.strings=n[3].strings),i&8&&(r.courses=n[3].courses),i&8&&(r.labels=n[3].labels),i&8&&(r.params=n[3].params),i&1&&(r.onClick=n[0].navigate),i&1&&(r.onCourseChange=n[0].selectCourse),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),X(t)}}}function Rl(l){let e,t,s,n;const i=[Va,Ja,Oa],r=[];function o(a,f){var d;return(d=a[3].message)!=null&&d.draft&&a[3].draftForm?0:a[3].message?1:2}return t=o(l),s=r[t]=i[t](l),{c(){e=h("div"),s.c(),u(e,"class","local-mail-view-main-column")},m(a,f){C(a,e,f),r[t].m(e,null),n=!0},p(a,f){let d=t;t=o(a),t===d?r[t].p(a,f):(ie(),z(r[d],1,1,()=>{r[d]=null}),re(),s=r[t],s?s.p(a,f):(s=r[t]=i[t](a),s.c()),T(s,1),s.m(e,null))},i(a){n||(T(s),n=!0)},o(a){z(s),n=!1},d(a){a&&D(e),r[t].d()}}}function Oa(l){let e,t,s,n;return e=new Zi({props:{store:l[0]}}),s=new Qr({props:{store:l[0]}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){W(e,i,r),C(i,t,r),W(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),X(e,i),X(s,i)}}}function Ja(l){let e,t;return e=new yr({props:{store:l[0],message:l[3].message}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Va(l){let e,t;return e=new Wr({props:{store:l[0],message:l[3].message,form:l[3].draftForm}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),n&8&&(i.form=s[3].draftForm),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Fl(l){let e,t;return e=new Di({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Ul(l){let e,t;return e=new ta({props:{store:l[0],onCancel:l[17]}}),{c(){K(e.$$.fragment)},m(s,n){W(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[17]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){X(e,s)}}}function Ka(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,M,$,k,y,q;document.title=t=l[5]+" - "+l[3].strings.pluginname;let S=!l[3].mobile&&zl(l);function N(Y,Q){return Y[3].mobile&&Y[3].viewportSize<de.LG?Ha:Ga}let j=N(l),B=j(l),H=l[1]&&Nl(l),P=l[3].viewportSize<de.LG&&Al(l),O=(l[1]||l[3].viewportSize>=de.LG)&&Bl(l),x=(!l[1]||l[3].viewportSize>=de.LG)&&Pl(l),V=l[1]&&Rl(l),te=l[1]&&l[3].viewportSize<de.MD&&Fl(l),ae=l[3].params.dialog=="preferences"&&Ul(l);return w=new Da({props:{store:l[0]}}),$=new Hn({props:{store:l[0]}}),{c(){e=L(),s=L(),n=h("div"),S&&S.c(),i=L(),r=h("div"),B.c(),o=L(),a=h("div"),H&&H.c(),f=L(),P&&P.c(),d=L(),O&&O.c(),m=L(),c=h("div"),x&&x.c(),_=L(),V&&V.c(),b=L(),te&&te.c(),p=L(),ae&&ae.c(),v=L(),K(w.$$.fragment),M=L(),K($.$$.fragment),u(a,"class","local-mail-view-main-column d-flex mb-3"),G(a,"mb-4",l[3].viewportSize>=de.LG),u(r,"class","row align-items-center"),u(c,"class","row mb-3"),u(n,"class","local-mail local-mail-view container-fluid pt-2"),G(n,"p-4",!l[3].mobile),G(n,"local-mail-loading",l[3].loading)},m(Y,Q){C(Y,e,Q),C(Y,s,Q),C(Y,n,Q),S&&S.m(n,null),g(n,i),g(n,r),B.m(r,null),g(r,o),g(r,a),H&&H.m(a,null),g(a,f),P&&P.m(a,null),g(n,d),O&&O.m(n,null),g(n,m),g(n,c),x&&x.m(c,null),g(c,_),V&&V.m(c,null),g(n,b),te&&te.m(n,null),g(n,p),ae&&ae.m(n,null),g(n,v),W(w,n,null),g(n,M),W($,n,null),l[18](n),k=!0,y||(q=[J(lt,"resize",l[12]),J(lt,"popstate",l[13]),J(lt,"beforeunload",l[6]),J(lt,"message",l[7]),J(document,"click",function(){Ce(l[3].mobile?l[8]:void 0)&&(l[3].mobile?l[8]:void 0).apply(this,arguments)})],y=!0)},p(Y,[Q]){l=Y,(!k||Q&40)&&t!==(t=l[5]+" - "+l[3].strings.pluginname)&&(document.title=t),l[3].mobile?S&&(ie(),z(S,1,1,()=>{S=null}),re()):S?(S.p(l,Q),Q&8&&T(S,1)):(S=zl(l),S.c(),T(S,1),S.m(n,i)),j===(j=N(l))&&B?B.p(l,Q):(B.d(1),B=j(l),B&&(B.c(),B.m(r,o))),l[1]?H?(H.p(l,Q),Q&2&&T(H,1)):(H=Nl(l),H.c(),T(H,1),H.m(a,f)):H&&(ie(),z(H,1,1,()=>{H=null}),re()),l[3].viewportSize<de.LG?P?(P.p(l,Q),Q&8&&T(P,1)):(P=Al(l),P.c(),T(P,1),P.m(a,null)):P&&(ie(),z(P,1,1,()=>{P=null}),re()),(!k||Q&8)&&G(a,"mb-4",l[3].viewportSize>=de.LG),l[1]||l[3].viewportSize>=de.LG?O?(O.p(l,Q),Q&10&&T(O,1)):(O=Bl(l),O.c(),T(O,1),O.m(n,m)):O&&(ie(),z(O,1,1,()=>{O=null}),re()),!l[1]||l[3].viewportSize>=de.LG?x?(x.p(l,Q),Q&10&&T(x,1)):(x=Pl(l),x.c(),T(x,1),x.m(c,_)):x&&(ie(),z(x,1,1,()=>{x=null}),re()),l[1]?V?(V.p(l,Q),Q&2&&T(V,1)):(V=Rl(l),V.c(),T(V,1),V.m(c,null)):V&&(ie(),z(V,1,1,()=>{V=null}),re()),l[1]&&l[3].viewportSize<de.MD?te?(te.p(l,Q),Q&10&&T(te,1)):(te=Fl(l),te.c(),T(te,1),te.m(n,p)):te&&(ie(),z(te,1,1,()=>{te=null}),re()),l[3].params.dialog=="preferences"?ae?(ae.p(l,Q),Q&8&&T(ae,1)):(ae=Ul(l),ae.c(),T(ae,1),ae.m(n,v)):ae&&(ie(),z(ae,1,1,()=>{ae=null}),re());const A={};Q&1&&(A.store=l[0]),w.$set(A);const E={};Q&1&&(E.store=l[0]),$.$set(E),(!k||Q&8)&&G(n,"p-4",!l[3].mobile),(!k||Q&8)&&G(n,"local-mail-loading",l[3].loading)},i(Y){k||(T(S),T(H),T(P),T(O),T(x),T(V),T(te),T(ae),T(w.$$.fragment,Y),T($.$$.fragment,Y),k=!0)},o(Y){z(S),z(H),z(P),z(O),z(x),z(V),z(te),z(ae),z(w.$$.fragment,Y),z($.$$.fragment,Y),k=!1},d(Y){Y&&(D(e),D(s),D(n)),S&&S.d(),B.d(),H&&H.d(),P&&P.d(),O&&O.d(),x&&x.d(),V&&V.d(),te&&te.d(),ae&&ae.d(),X(w),X($),l[18](null),y=!1,we(q)}}}function Wa(l,e,t){let s,n,i,r,o,a,f,d=F,m=()=>(d(),d=_e(c,j=>t(3,f=j)),c);l.$$.on_destroy.push(()=>d());let{store:c}=e;m();let _,b=0;Ze(()=>{c.setViewportSize(window.innerWidth)}),Sn(()=>{if(b!=f.navigationId){b=f.navigationId;let j=_.parentElement;for(;j;)j.scrollTop>0&&j.scrollTo({top:0}),j=j.parentElement}});const p=j=>{if(f.draftData)return j.preventDefault(),c.updateDraft(f.draftData,!0),""},v=j=>{f.mobile&&j.data.addon=="local_mail"&&j.data.backClicked&&c.navigateToMenu()},w=j=>{var B;if(f.mobile&&!j.defaultPrevented&&j.target instanceof HTMLElement){const H=j.target.closest("a");H&&((B=window.parent)==null||B.postMessage({addon:"local_mail",openUrl:H.href},"*")),j.defaultPrevented||j.preventDefault()}},M=()=>c.setViewportSize(window.innerWidth),$=()=>c.navigate(Xl()),k=()=>c.createMessage(),y=()=>c.showDialog("preferences"),q=()=>c.createMessage(),S=()=>c.hideDialog();function N(j){Me[j?"unshift":"push"](()=>{_=j,t(4,_)})}return l.$$set=j=>{"store"in j&&m(t(0,c=j.store))},l.$$.update=()=>{var j;l.$$.dirty&8&&t(1,s=f.params.tray),l.$$.dirty&8&&t(10,n=f.courses.find(B=>B.id==f.params.courseid)),l.$$.dirty&8&&t(11,i=f.labels.find(B=>B.id==f.params.labelid)),l.$$.dirty&3082&&t(2,r=s=="inbox"?f.strings.inbox:s=="starred"?f.strings.starredplural:s=="sent"?f.strings.sentplural:s=="drafts"?f.strings.drafts:s=="trash"?f.strings.trash:s=="label"?(i==null?void 0:i.name)||"":s=="course"?We(n,"fullname"):""),l.$$.dirty&12&&t(5,o=f.message?f.message.subject.trim()||f.strings.nosubject:r),l.$$.dirty&12&&t(9,a=f.viewportSize<de.LG?r||f.strings.pluginname:""),l.$$.dirty&514&&((j=window.parent)==null||j.postMessage({addon:"local_mail",setTitle:a,captureBack:s!=null},"*"))},[c,s,r,f,_,o,p,v,w,a,n,i,M,$,k,y,q,S,N]}class Xa extends ce{constructor(e){super(),me(this,e,Wa,Ka,oe,{store:0})}}const Je=[];function Ya(l,e=F){let t;const s=new Set;function n(o){if(zn(l,o)&&(l=o,t)){const a=!Je.length;for(const f of s)f[1](),Je.push(f,l);if(a){for(let f=0;f<Je.length;f+=2)Je[f][0](Je[f+1]);Je.length=0}}}function i(o){n(o(l))}function r(o,a=F){const f=[o,a];return s.add(f),s.size===1&&(t=e(n,i)||F),o(l),()=>{s.delete(f),s.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:r}}async function Qa(l){let e=0,t=0,s={userid:l.userid,settings:l.settings,preferences:l.preferences,strings:l.strings,mobile:l.mobile,params:{},unread:0,drafts:0,courses:[],labels:[],totalCount:0,listMessages:[],loading:!0,selectedMessages:new Map,toasts:[],navigationId:0,viewportSize:0};const{subscribe:n,set:i}=Ya(s),r=A=>i({...s,...A});n(A=>{s=A});const o=async(A,E,se=!1)=>{var vt,wt,$t,yt,Mt;const le=++e,U=(vt=s.message)==null?void 0:vt.id,fe=s.draftData,ee=E||s.params,he=!se&&(ee.tray!=s.params.tray||ee.messageid!=s.params.messageid||ee.courseid!=s.params.courseid||ee.labelid!=s.params.labelid||ee.search!=s.params.search)?{...s.params,dialog:void 0}:s.prevParams,Z=s.preferences.perpage;if(r({loading:!0,error:void 0}),ot(ee,se),U&&fe&&(window.clearTimeout(t),A.unshift({methodname:"update_message",messageid:U,data:fe})),A.push({methodname:"get_courses"}),A.push({methodname:"get_labels"}),ee.tray){const ve={courseid:ee.courseid,labelid:ee.tray=="label"?ee.labelid:void 0,draft:ee.tray=="drafts"?!0:ee.tray=="sent"?!1:void 0,roles:ee.tray=="inbox"?["to","cc","bcc"]:ee.tray=="sent"?["from"]:void 0,starred:ee.tray=="starred"?!0:void 0,deleted:ee.tray=="trash"};A.push({methodname:"count_messages",query:ve}),ee.messageid?(A.push({methodname:"get_message",messageid:ee.messageid}),A.push({methodname:"search_messages",query:{...ve,...ee.search,startid:ee.messageid,reverse:!1},limit:1}),A.push({methodname:"search_messages",query:{...ve,...ee.search,startid:ee.messageid,reverse:!0},limit:1}),ee.search||A.push({methodname:"count_messages",query:{...ve,startid:ee.messageid,reverse:!0}})):A.push({methodname:"search_messages",query:{...ve,...ee.search},offset:ee.search?void 0:ee.offset,limit:ee.search?Z+1:Z})}let ne;try{ne=await Xe(A)}catch(ve){return N(ve),null}let pe,De,ze,ye,ke=[],He=0;ee.tray&&(ee.messageid?(ee.search||(De=ne.pop()),ye=(wt=ne.pop()[0])==null?void 0:wt.id,ze=($t=ne.pop()[0])==null?void 0:$t.id,pe=ne.pop()):(ke=ne.pop(),ee.search&&(ee.search.reverse?(ye=(yt=ke[Z])==null?void 0:yt.id,ze=ee.search.startid,ke=ke.slice(0,Z).reverse()):(ye=ee.search.startid,ze=(Mt=ke[Z])==null?void 0:Mt.id,ke=ke.slice(0,Z)))),He=ne.pop());const ht=ne.pop(),st=ne.pop();if(U&&fe&&ne.shift(),ee.tray=="course"&&!st.find(ve=>ve.id==ee.courseid)||ee.tray=="label"&&!ht.find(ve=>ve.id==ee.labelid))return await p({tray:"inbox"},!0),ne;let kt;if(pe!=null&&pe.draft&&(pe==null?void 0:pe.id)!=U){const ve=[{methodname:"get_message_form",messageid:pe.id}];let Oe;try{Oe=await Xe(ve)}catch(pn){return N(pn),null}kt=Oe.pop()}return le!=e||(r({params:ee,prevParams:he,unread:st.reduce((ve,Oe)=>ve+Oe.unread,0),drafts:st.reduce((ve,Oe)=>ve+Oe.drafts,0),courses:st,labels:ht,messageOffset:De,totalCount:He,listMessages:ke,message:pe,nextMessageId:ze,prevMessageId:ye,draftForm:(pe==null?void 0:pe.id)!=U?kt:s.draftForm,draftData:void 0,draftSaved:(pe==null?void 0:pe.id)==U?fe==null:!1,selectedMessages:new Map(pe?[[pe.id,pe]]:s.message?[]:ke.filter(ve=>s.selectedMessages.has(ve.id)).map(ve=>[ve.id,ve])),loading:!1,navigationId:se||ee.tray!=s.params.tray||ee.courseid!=s.params.courseid||ee.labelid!=s.params.labelid||ee.messageid!=s.params.messageid||ee.offset!=s.params.offset?s.navigationId+1:s.navigationId}),U&&fe&&U!=(pe==null?void 0:pe.id)&&x({text:s.strings.draftsaved})),ne},a=async(A,E)=>{const le=await o([{methodname:"create_label",name:A,color:E}]);return le==null?void 0:le.pop()},f=async A=>{A=A||s.params.courseid||s.courses[0].id;const E={methodname:"create_message",courseid:A};let se;try{se=await Xe([E])}catch(le){N(le);return}await p({tray:"drafts",messageid:se.pop(),courseid:A})},d=async A=>{await o([{methodname:"delete_label",labelid:A}],{tray:"inbox"})},m=async A=>{await o([{methodname:"empty_trash",courseid:A}])},c=async A=>{const E=s.params,se={methodname:"forward_message",messageid:A.id},le=await o([se]);le!=null&&await p({tray:"drafts",messageid:le.pop(),courseid:E.courseid?A.course.id:void 0})},_=()=>{const A={...s.params,dialog:void 0};r({params:A}),ot(A,!0)},b=A=>{r({toasts:s.toasts.filter(E=>E!=A)})},p=async(A,E=!1,se=!0)=>{var fe;const le=[];se&&s.settings.incrementalsearch&&le.push({methodname:"search_messages",query:{deleted:!1},offset:s.settings.incrementalsearchlimit,limit:1}),A!=null&&A.messageid&&le.push({methodname:"view_message",messageid:A.messageid});const U=await o(le,A,E);if(U!=null&&se&&s.settings.incrementalsearch){const ee=U[0];r({incrementalSearchStopId:(fe=ee[0])==null?void 0:fe.id})}},v=async(A=!1)=>{const E={...s.params,messageid:void 0,offset:Math.floor((s.params.offset||0)/s.preferences.perpage)*s.preferences.perpage||void 0};await o([],E,A)},w=async()=>{await o([],{})},M=async(A,E)=>{const se=s.params,le={methodname:"reply_message",messageid:A.id,all:E},U=await o([le]);U!=null&&await p({tray:"drafts",messageid:U.pop(),courseid:se.courseid?A.course.id:void 0})},$=async A=>{r({preferences:{...s.preferences,...A}});let E=s.params;A.perpage&&(E={...E,offset:s.params.offset?Math.trunc(s.params.offset/A.perpage)*A.perpage:void 0}),await o([{methodname:"set_preferences",preferences:A}],E,!0)},k=A=>{r({selectedMessages:new Map(s.listMessages.filter(E=>A=="all"||A=="read"&&!E.unread||A=="unread"&&E.unread||A=="starred"&&E.starred||A=="unstarred"&&!E.starred).map(E=>[E.id,E]))})},y=async A=>{await p({...s.params,courseid:A,offset:0,messageid:void 0,search:s.params.search?{...s.params.search,startid:void 0,reverse:void 0}:void 0})},q=async()=>{var le;if(!((le=s.message)!=null&&le.draft))return;const A={methodname:"send_message",messageid:s.message.id},E=s.prevParams?{...s.prevParams,messageid:void 0,offset:Math.floor((s.prevParams.offset||0)/s.preferences.perpage)*s.preferences.perpage||void 0}:["shortname","fullname"].includes(s.settings.filterbycourse)?{tray:"inbox",courseid:s.message.course.id}:{tray:"course",courseid:s.message.course.id};await o([A],E)!=null&&x({text:s.strings.messagesent})},S=async(A,E,se)=>{const le=A.map(ee=>({methodname:"set_deleted",messageid:ee,deleted:E})),U={...s.params,messageid:void 0};if(await o(le,U,!0)!=null&&E!=Pe.DeletedForever){const ee=E?A.length>1?"messagesmovedtotrash":"messagemovedtotrash":A.length>1?"messagesrestored":"messagerestored",he=Ne(s.strings[ee],A.length);x({text:he,undo:se?()=>{S(A,E?Pe.NotDeleted:Pe.Deleted,!1)}:void 0})}},N=async A=>{r({loading:s.loading&&!A,error:A})},j=async(A,E)=>{Q(le=>s.selectedMessages.has(le.id)?{...le,labels:s.labels.filter(U=>A.includes(U.id)?!0:E.includes(U.id)?!1:le.labels.findIndex(fe=>fe.id==U.id)>=0)}:le);const se=[];s.selectedMessages.forEach(le=>{se.push({methodname:"set_labels",messageid:le.id,labelids:le.labels.map(U=>U.id)})}),await o(se)},B=async(A,E)=>{Q(le=>A.includes(le.id)?{...le,starred:E}:le);const se=A.map(le=>({methodname:"set_starred",messageid:le,starred:E}));await o(se)},H=async(A,E)=>{Q(U=>A.includes(U.id)?{...U,unread:E}:U);const se=A.map(U=>({methodname:"set_unread",messageid:U,unread:E})),le={...s.params,messageid:void 0};await o(se,le)},P=A=>{r({viewportSize:A,navigationId:s.navigationId+1}),!s.params.tray&&A>=de.LG&&!s.error&&p({tray:"inbox",dialog:s.params.dialog},!0)},O=async A=>{const E={...s.params,dialog:A};ot(E,s.params.dialog!=null),r({params:E})},x=async A=>{r({toasts:[A]}),A&&window.setTimeout(()=>b(A),1e4)},V=A=>{r({selectedMessages:new Map(s.listMessages.filter(E=>E.id==A?!s.selectedMessages.has(E.id):s.selectedMessages.has(E.id)).map(E=>[E.id,E]))})},te=async A=>{A.undo&&(b(A),A.undo())},ae=(A,E)=>{if(!s.message)return;const se=++e,le=s.message,U=s.draftData;r({draftData:A,draftSaved:!1});let fe=3e3;E?fe=0:U&&(fe=Math.max(0,le.time*1e3+fe-Date.now())),window.clearTimeout(t),t=window.setTimeout(async()=>{const ee=[{methodname:"update_message",messageid:le.id,data:A},{methodname:"get_message",messageid:le.id}];let he;try{he=await Xe(ee)}catch(ne){N(ne);return}const Z=he.pop();se==e&&r({message:Z,draftData:void 0,draftSaved:!0})},fe)},Y=async(A,E,se)=>{await o([{methodname:"update_label",labelid:A,name:E,color:se}])},Q=A=>{r({listMessages:s.listMessages.map(E=>A(E)),message:s.message?A(s.message):void 0,selectedMessages:new Map(Array.from(s.selectedMessages.entries()).map(([E,se])=>[E,A(se)]))})};return await p(Xl(),!0,!0),{createLabel:a,createMessage:f,deleteLabel:d,emptyTrash:m,forward:c,get:()=>s,hideDialog:_,hideToast:b,navigate:p,navigateToList:v,navigateToMenu:w,reply:M,savePreferences:$,selectAll:k,selectCourse:y,sendMessage:q,setDeleted:S,setError:N,setLabels:j,setStarred:B,setUnread:H,setViewportSize:P,showDialog:O,subscribe:n,toggleSelected:V,undo:te,updateDraft:ae,updateLabel:Y}}async function Za(){const l=document.getElementById("local-mail-view"),e=document.getElementById("local-mail-navbar"),t=window.local_mail_view_data;if(!t)return;const s=await Qa({userid:t.userid,settings:t.settings,preferences:t.preferences,strings:t.strings,mobile:!!t.mobile});if(l&&new Xa({target:l,props:{store:s}}),e){e.innerHTML="";const n=s.get(),i=new jn({target:e,props:{settings:n.settings,strings:n.strings,courses:n.courses,labels:n.labels,params:n.params,onClick:s.navigate,onComposeClick:s.createMessage,onCourseChange:s.selectCourse}});s.subscribe(r=>{i.$set({settings:r.settings,strings:r.strings,courses:r.courses,labels:r.labels,params:r.params})})}}Za();
//# sourceMappingURL=view-4IjSUE3Z.js.map
