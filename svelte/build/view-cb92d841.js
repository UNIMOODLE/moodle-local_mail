import{n as $,i as ps,a as Hs,l as Gs,c as Ks,d as Vs,s as Ys,g as Js,R as ze,b as Ke,e as Ws,f as bs,D as Ue,h as at,S as fe,j as ue,k as oe,m as Xs,o as D,p as v,t as R,q as d,r as C,u as _,v as I,w as ke,x as ve,y as Ee,z as E,A as Qs,B as Zs,C as xs,E as A,F as De,G as Be,H as N,I as T,J as pe,K as Ve,L as tt,M as we,N as de,O as ne,P as re,Q as J,T as W,U as X,V as me,W as O,X as ie,Y as be,Z as ye,_ as Me,$ as Ie,a0 as se,a1 as en,a2 as hs,a3 as Ae,a4 as Ye,a5 as lt,a6 as Re,a7 as vs,a8 as ks,a9 as qe,aa as je,ab as Oe,ac as tn,ad as He,ae as et,af as ln,ag as Fe,ah as Pe,ai as sn,aj as ws,ak as nn,al as rn}from"./global-add3171e.js";const Je=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ys(s,e,t,l){if(!e)return $;const n=s.getBoundingClientRect();if(e.left===n.left&&e.right===n.right&&e.top===n.top&&e.bottom===n.bottom)return $;const{delay:r=0,duration:i=300,easing:a=ps,start:o=Hs()+r,end:f=o+i,tick:c=$,css:m}=t(s,{from:e,to:n},l);let u=!0,g=!1,h;function p(){m&&(h=Ks(s,0,1,i,r,a,m)),r||(g=!0)}function b(){m&&Vs(s,h),u=!1}return Gs(S=>{if(!g&&S>=o&&(g=!0),g&&S>=f&&(c(1,0),b()),!u)return!1;if(g){const w=S-o,y=0+1*a(w/i);c(y,1-y)}return!0}),p(),c(0,1),b}function Ms(s){const e=getComputedStyle(s);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:l}=e,n=s.getBoundingClientRect();s.style.position="absolute",s.style.width=t,s.style.height=l,st(s,n)}}function st(s,e){const t=s.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const l=getComputedStyle(s),n=l.transform==="none"?"":l.transform;s.style.transform=`${n} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}const $e=[];function an(s,e=$){let t;const l=new Set;function n(a){if(Ys(s,a)&&(s=a,t)){const o=!$e.length;for(const f of l)f[1](),$e.push(f,s);if(o){for(let f=0;f<$e.length;f+=2)$e[f][0]($e[f+1]);$e.length=0}}}function r(a){n(a(s))}function i(a,o=$){const f=[a,o];return l.add(f),l.size===1&&(t=e(n,r)||$),a(s),()=>{l.delete(f),l.size===0&&t&&(t(),t=null)}}return{set:n,update:r,subscribe:i}}const We=["","blue","indigo","purple","pink","red","orange","yellow","green","teal","cyan"];function ot(s){if(s==0)return"";const e=new Date(s*1e3);return[String(e.getFullYear()),String(e.getMonth()+1).padStart(2,"0"),String(e.getDate()).padStart(2,"0")].join("-")}function ft(s){const e=[{bytes:1099511627776,name:"TB"},{bytes:1073741824,name:"GB"},{bytes:1048576,name:"MB"},{bytes:1024,name:"KB"}];for(const t of e)if(s>=t.bytes)return`${Intl.NumberFormat(void 0,{maximumFractionDigits:1}).format(s/t.bytes)} ${t.name}`;return`${s} B`}function ut(s){return s.trim().replaceAll(/\s+/gu," ")}function Le(s,e){if(s=s||"",typeof e=="string"||typeof e=="number")s=s.replace("{$a}",e.toString());else for(const t in e)s=s.replace(`{$a->${t}}`,e[t].toString());return s}async function on(s){return new Promise(e=>{setTimeout(e,s)})}function fn(s){return s?Math.floor(new Date(parseInt(s.slice(0,4)),parseInt(s.slice(5,7))-1,parseInt(s.slice(8,10)),23,59,59).getTime()/1e3):0}var _e=(s=>(s[s.SM=576]="SM",s[s.MD=768]="MD",s[s.LG=992]="LG",s[s.XL=1200]="XL",s))(_e||{});async function un(s){let e=0,t=0;const{subscribe:l,update:n}=an({userid:s.userid,settings:s.settings,preferences:s.preferences,strings:s.strings,params:{tray:"inbox"},unread:0,drafts:0,courses:[],labels:[],totalCount:0,listMessages:[],loading:!0,selectedMessages:new Map,toasts:[],navigationId:0,viewSize:0}),r={subscribe:l,get(){return Js(r)},async callServicesAndRefresh(i,a,o=!1){var Q,ee,te,B,x;const f=++e,c=(Q=r.get().message)==null?void 0:Q.id,m=r.get().draftData,u=a||r.get().params,g=r.get().preferences.perpage;n(Z=>({...Z,loading:!0})),c&&m&&(clearTimeout(t),i.unshift({methodname:"update_message",messageid:c,data:m})),i.push({methodname:"count_messages",query:{roles:Object.values(ze),unread:!0}}),i.push({methodname:"count_messages",query:{draft:!0}}),i.push({methodname:"get_courses"}),i.push({methodname:"get_labels"});const h={courseid:u.courseid,labelid:u.tray=="label"?u.labelid:void 0,draft:u.tray=="drafts"?!0:u.tray=="sent"?!1:void 0,roles:u.tray=="inbox"?["to","cc","bcc"]:u.tray=="sent"?["from"]:void 0,starred:u.tray=="starred"?!0:void 0,deleted:u.tray=="trash"};i.push({methodname:"count_messages",query:h}),u.messageid?(i.push({methodname:"get_message",messageid:u.messageid}),i.push({methodname:"search_messages",query:{...h,...u.search,startid:u.messageid,reverse:!1},limit:1}),i.push({methodname:"search_messages",query:{...h,...u.search,startid:u.messageid,reverse:!0},limit:1}),u.search||i.push({methodname:"count_messages",query:{...h,startid:u.messageid,reverse:!0}})):i.push({methodname:"search_messages",query:{...h,...u.search},offset:u.search?void 0:u.offset,limit:u.search?g+1:g});let p;try{p=await Ke(i)}catch(Z){return r.setError(Z),[]}let b,S,w,y,k=[];u.messageid?(u.search||(S=p.pop()),y=(ee=p.pop()[0])==null?void 0:ee.id,w=(te=p.pop()[0])==null?void 0:te.id,b=p.pop()):(k=p.pop(),u.search&&(u.search.reverse?(y=(B=k[g])==null?void 0:B.id,w=u.search.startid,k=k.slice(0,g).reverse()):(y=u.search.startid,w=(x=k[g])==null?void 0:x.id,k=k.slice(0,g))));const M=p.pop(),z=p.pop(),L=p.pop(),j=p.pop(),F=p.pop();if(c&&m&&p.shift(),u.tray=="course"&&!L.find(Z=>Z.id==u.courseid)||u.tray=="label"&&!z.find(Z=>Z.id==u.labelid))return await r.navigate({tray:"inbox"},!0),p;let V;if(b!=null&&b.draft&&(b==null?void 0:b.id)!=c){const Z=[{methodname:"get_message_form",messageid:b.id}];let le;try{le=await Ke(Z)}catch(q){return r.setError(q),p}V=le.pop()}return f!=e||(n(Z=>({...Z,params:u,unread:F,drafts:j,courses:L,labels:z,messageOffset:S,totalCount:M,listMessages:k,message:b,nextMessageId:w,prevMessageId:y,draftForm:(b==null?void 0:b.id)!=c?V:Z.draftForm,draftData:void 0,draftSaved:(b==null?void 0:b.id)==c?m!=null:!1,selectedMessages:new Map(b?[[b.id,b]]:Z.message?[]:k.filter(le=>Z.selectedMessages.has(le.id)).map(le=>[le.id,le])),loading:!1,navigationId:o||u.tray!=Z.params.tray||u.courseid!=Z.params.courseid||u.labelid!=Z.params.labelid||u.messageid!=Z.params.messageid||u.offset!=Z.params.offset?Z.navigationId+1:Z.navigationId})),c&&m&&c!=(b==null?void 0:b.id)&&r.showToast({text:r.get().strings.draftsaved}),Ws(u,o)),p},async createLabel(i,a){const o={methodname:"create_label",name:i,color:a};return(await r.callServicesAndRefresh([o])).pop()},async deleteLabel(i){const a={methodname:"delete_label",labelid:i};r.callServicesAndRefresh([a],{tray:"inbox"})},async emptyTrash(){const i={methodname:"empty_trash"};await r.callServicesAndRefresh([i])},async forward(i){const a=r.get().params,o={methodname:"forward_message",messageid:i.id},f=await r.callServicesAndRefresh([o]);await r.navigate({tray:"drafts",messageid:f.pop(),courseid:a.courseid?i.course.id:void 0})},hideToast(i){n(a=>({...a,toasts:a.toasts.filter(o=>o!=i)}))},async init(){const i=[];r.get().settings.incrementalsearch&&i.push({methodname:"search_messages",query:{deleted:!1},offset:r.get().settings.incrementalsearchlimit,limit:1});const a=await r.callServicesAndRefresh(i,bs());n(o=>{var f,c;return{...o,incrementalSearchStopId:(c=(f=a.pop())==null?void 0:f[0])==null?void 0:c.id}})},async navigate(i,a=!1){const o=[];i!=null&&i.messageid&&o.push({methodname:"set_unread",messageid:i.messageid,unread:!1}),await r.callServicesAndRefresh(o,i,a)},async navigateToList(i=!1){const a=r.get(),o={...a.params,messageid:void 0,offset:a.params.search?Math.floor((a.messageOffset||0)/a.preferences.perpage)*a.preferences.perpage:void 0};await r.callServicesAndRefresh([],o,i)},async reply(i,a){const o=r.get().params,f={methodname:"reply_message",messageid:i.id,all:a},c=await r.callServicesAndRefresh([f]);await r.navigate({tray:"drafts",messageid:c.pop(),courseid:o.courseid?i.course.id:void 0})},selectAll(i){n(a=>({...a,selectedMessages:new Map(a.listMessages.filter(o=>i=="all"||i=="read"&&!o.unread||i=="unread"&&o.unread||i=="starred"&&o.starred||i=="unstarred"&&!o.starred).map(o=>[o.id,o]))}))},async selectCourse(i){const a=r.get().params;await r.navigate({...a,courseid:i,offset:0,messageid:void 0,search:a.search?{...a.search,startid:void 0,reverse:void 0}:void 0})},async sendMessage(){const i=r.get().params,a=r.get().message;if(!(a!=null&&a.draft))return;const o={methodname:"send_message",messageid:a.id},f={tray:"inbox",courseid:i.courseid?a.course.id:void 0};await r.callServicesAndRefresh([o],f),r.showToast({text:r.get().strings.messagesent})},async setDeleted(i,a,o){const f=i.map(m=>({methodname:"set_deleted",messageid:m,deleted:a})),c={...r.get().params,messageid:void 0};if(await r.callServicesAndRefresh(f,c,!0),a!=Ue.DeletedForever){const m=a?i.length>1?"undodeletemany":"undodeleteone":i.length>1?"undorestoremany":"undorestoreone",u=Le(r.get().strings[m],i.length),g=()=>{r.setDeleted(i,a?Ue.NotDeleted:Ue.Deleted,!1)};r.showToast({text:u,undo:o?g:void 0})}},async setError(i){n(a=>({...a,loading:a.loading&&!i,error:i}))},async setLabels(i,a){r.updateStateMessages((f,c)=>c.selectedMessages.has(f.id)?{...f,labels:c.labels.filter(m=>i.includes(m.id)?!0:a.includes(m.id)?!1:f.labels.findIndex(u=>u.id==m.id)>=0)}:f);const o=[];r.get().selectedMessages.forEach(f=>{o.push({methodname:"set_labels",messageid:f.id,labelids:f.labels.map(c=>c.id)})}),await r.callServicesAndRefresh(o)},setViewportSize(i){n(a=>({...a,viewSize:i,navigationId:a.navigationId+1}))},async setPerPage(i){n(c=>({...c,preferences:{...c.preferences,perpage:i}}));const a=r.get().params,o={...a,offset:a.offset?Math.trunc(a.offset/i)*i:void 0},f={methodname:"set_preferences",preferences:{perpage:i}};await r.callServicesAndRefresh([f],o,!0)},async setStarred(i,a){r.updateStateMessages(f=>i.includes(f.id)?{...f,starred:a}:f);const o=i.map(f=>({methodname:"set_starred",messageid:f,starred:a}));await r.callServicesAndRefresh(o)},async setUnread(i,a){r.updateStateMessages(c=>i.includes(c.id)?{...c,unread:a}:c);const o=i.map(c=>({methodname:"set_unread",messageid:c,unread:a})),f={...r.get().params,messageid:void 0};await r.callServicesAndRefresh(o,f)},async showToast(i){n(a=>({...a,toasts:[i]})),i&&(await on(1e4),r.hideToast(i))},toggleSelected(i){n(a=>({...a,selectedMessages:new Map(a.listMessages.filter(o=>o.id==i?!a.selectedMessages.has(o.id):a.selectedMessages.has(o.id)).map(o=>[o.id,o]))}))},async undo(i){i.undo&&(await i.undo(),r.hideToast(i))},updateDraft(i,a){const o=r.get().message,f=r.get().draftData;if(!o)return;n(u=>({...u,draftData:i,draftSaved:!1}));const c=++e;let m=3e3;a?m=0:f&&(m=Math.max(0,o.time*1e3+m-Date.now())),clearTimeout(t),t=setTimeout(async()=>{const u=[{methodname:"update_message",messageid:o.id,data:i},{methodname:"get_message",messageid:o.id}];let g;try{g=await Ke(u)}catch(p){r.setError(p);return}const h=g.pop();c==e&&n(p=>({...p,message:h,draftData:void 0,draftSaved:!0}))},m)},async updateLabel(i,a,o){const f={methodname:"update_label",labelid:i,name:a,color:o};await r.callServicesAndRefresh([f])},updateStateMessages(i){n(a=>({...a,listMessages:a.listMessages.map(o=>i(o,a)),message:a.message?i(a.message,a):void 0,selectedMessages:new Map(Array.from(a.selectedMessages.entries()).map(([o,f])=>[o,i(f,a)]))}))}};return await r.init(),r}function Ss(s){const e=s-1;return e*e*e+1}function Ne(s,{delay:e=0,duration:t=400,easing:l=ps}={}){const n=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:l,css:r=>`opacity: ${r*n}`}}function Xe(s,{delay:e=0,duration:t=400,easing:l=Ss,x:n=0,y:r=0,opacity:i=0}={}){const a=getComputedStyle(s),o=+a.opacity,f=a.transform==="none"?"":a.transform,c=o*(1-i),[m,u]=at(n),[g,h]=at(r);return{delay:e,duration:t,easing:l,css:(p,b)=>`
			transform: ${f} translate(${(1-p)*m}${u}, ${(1-p)*g}${h});
			opacity: ${o-c*b}`}}const{document:cn}=Je;function ct(s){let e,t,l=s[1]&&mt(s),n=s[2]&&s[4]&&dt(s);return{c(){e=v("div"),l&&l.c(),t=D(),n&&n.c(),d(e,"class","modal-footer")},m(r,i){C(r,e,i),l&&l.m(e,null),_(e,t),n&&n.m(e,null)},p(r,i){r[1]?l?l.p(r,i):(l=mt(r),l.c(),l.m(e,t)):l&&(l.d(1),l=null),r[2]&&r[4]?n?n.p(r,i):(n=dt(r),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(r){r&&T(e),l&&l.d(),n&&n.d()}}}function mt(s){let e,t,l,n;return{c(){e=v("button"),t=R(s[1]),d(e,"type","button"),d(e,"class","btn btn-secondary")},m(r,i){C(r,e,i),_(e,t),l||(n=I(e,"click",function(){ke(s[3])&&s[3].apply(this,arguments)}),l=!0)},p(r,i){s=r,i&2&&E(t,s[1])},d(r){r&&T(e),l=!1,n()}}}function dt(s){let e,t,l,n,r;return{c(){e=v("button"),t=R(s[2]),d(e,"type","button"),d(e,"class",l="btn "+s[5]),e.disabled=s[6]},m(i,a){C(i,e,a),_(e,t),n||(r=I(e,"click",function(){ke(s[4])&&s[4].apply(this,arguments)}),n=!0)},p(i,a){s=i,a&4&&E(t,s[2]),a&32&&l!==(l="btn "+s[5])&&d(e,"class",l),a&64&&(e.disabled=s[6])},d(i){i&&T(e),n=!1,r()}}}function mn(s){let e,t,l,n,r,i,a,o,f,c,m,u,g,h,p,b,S,w,y,k,M;const z=s[10].default,L=Xs(z,s,s[9],null);let j=(s[1]||s[2]&&s[4])&&ct(s);return{c(){e=D(),t=v("div"),l=v("div"),n=v("div"),r=v("div"),i=v("h5"),a=R(s[0]),o=D(),f=v("button"),c=v("span"),c.textContent="×",m=D(),u=v("div"),L&&L.c(),g=D(),j&&j.c(),b=D(),S=v("div"),d(i,"class","modal-title"),d(c,"aria-hidden","true"),d(f,"type","button"),d(f,"class","close"),d(f,"aria-label",s[1]),d(r,"class","modal-header"),d(u,"class","modal-body"),d(n,"class","modal-content"),d(l,"class","modal-dialog"),d(t,"class","modal show"),d(t,"tabindex","-1"),d(t,"role","dialog"),d(t,"aria-label",s[0]),d(t,"aria-modal","true"),d(S,"class","modal-backdrop show")},m(F,V){C(F,e,V),C(F,t,V),_(t,l),_(l,n),_(n,r),_(r,i),_(i,a),_(r,o),_(r,f),_(f,c),_(n,m),_(n,u),L&&L.m(u,null),_(n,g),j&&j.m(n,null),s[11](t),C(F,b,V),C(F,S,V),y=!0,k||(M=[I(cn.body,"keyup",s[8]),I(f,"click",function(){ke(s[3])&&s[3].apply(this,arguments)}),ve(h=Ee.call(null,t,s[3]))],k=!0)},p(F,[V]){s=F,(!y||V&1)&&E(a,s[0]),(!y||V&2)&&d(f,"aria-label",s[1]),L&&L.p&&(!y||V&512)&&Qs(L,z,s,s[9],y?xs(z,s[9],V,null):Zs(s[9]),null),s[1]||s[2]&&s[4]?j?j.p(s,V):(j=ct(s),j.c(),j.m(n,null)):j&&(j.d(1),j=null),(!y||V&1)&&d(t,"aria-label",s[0]),h&&ke(h.update)&&V&8&&h.update.call(null,s[3])},i(F){y||(A(L,F),De(()=>{y&&(p||(p=Be(t,Xe,{y:-100},!0)),p.run(1))}),De(()=>{y&&(w||(w=Be(S,Ne,{},!0)),w.run(1))}),y=!0)},o(F){N(L,F),p||(p=Be(t,Xe,{y:-100},!1)),p.run(0),w||(w=Be(S,Ne,{},!1)),w.run(0),y=!1},d(F){F&&(T(e),T(t),T(b),T(S)),L&&L.d(F),j&&j.d(),s[11](null),F&&p&&p.end(),F&&w&&w.end(),k=!1,pe(M)}}}function dn(s,e,t){let{$$slots:l={},$$scope:n}=e,{title:r}=e,{cancelText:i=""}=e,{confirmText:a=""}=e,{handleCancel:o}=e,{handleConfirm:f=void 0}=e,{confirmClass:c="btn-primary"}=e,{confirmDisabled:m=!1}=e,u;Ve(()=>{document.body.classList.add("modal-open"),u.focus()}),tt(()=>{document.body.classList.remove("modal-open")});const g=p=>{p.key=="Escape"&&o()};function h(p){we[p?"unshift":"push"](()=>{u=p,t(7,u)})}return s.$$set=p=>{"title"in p&&t(0,r=p.title),"cancelText"in p&&t(1,i=p.cancelText),"confirmText"in p&&t(2,a=p.confirmText),"handleCancel"in p&&t(3,o=p.handleCancel),"handleConfirm"in p&&t(4,f=p.handleConfirm),"confirmClass"in p&&t(5,c=p.confirmClass),"confirmDisabled"in p&&t(6,m=p.confirmDisabled),"$$scope"in p&&t(9,n=p.$$scope)},[r,i,a,o,f,c,m,u,g,n,l,h]}class Ge extends fe{constructor(e){super(),ue(this,e,dn,mn,oe,{title:0,cancelText:1,confirmText:2,handleCancel:3,handleConfirm:4,confirmClass:5,confirmDisabled:6})}}function _t(s){let e,t;return e=new Ge({props:{title:s[1].strings.error,handleCancel:s[2],$$slots:{default:[_n]},$$scope:{ctx:s}}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&2&&(r.title=l[1].strings.error),n&1&&(r.handleCancel=l[2]),n&10&&(r.$$scope={dirty:n,ctx:l}),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function gt(s){var n;let e,t=((n=s[1].error)==null?void 0:n.debuginfo)+"",l;return{c(){e=v("p"),l=R(t)},m(r,i){C(r,e,i),_(e,l)},p(r,i){var a;i&2&&t!==(t=((a=r[1].error)==null?void 0:a.debuginfo)+"")&&E(l,t)},d(r){r&&T(e)}}}function pt(s){var n;let e,t=((n=s[1].error)==null?void 0:n.stacktrace)+"",l;return{c(){e=v("pre"),l=R(t)},m(r,i){C(r,e,i),_(e,l)},p(r,i){var a;i&2&&t!==(t=((a=r[1].error)==null?void 0:a.stacktrace)+"")&&E(l,t)},d(r){r&&T(e)}}}function _n(s){var f,c,m;let e,t=((f=s[1].error)==null?void 0:f.message)+"",l,n,r,i,a=((c=s[1].error)==null?void 0:c.debuginfo)&&gt(s),o=((m=s[1].error)==null?void 0:m.stacktrace)&&pt(s);return{c(){e=v("p"),l=R(t),n=D(),a&&a.c(),r=D(),o&&o.c(),i=de()},m(u,g){C(u,e,g),_(e,l),C(u,n,g),a&&a.m(u,g),C(u,r,g),o&&o.m(u,g),C(u,i,g)},p(u,g){var h,p,b;g&2&&t!==(t=((h=u[1].error)==null?void 0:h.message)+"")&&E(l,t),(p=u[1].error)!=null&&p.debuginfo?a?a.p(u,g):(a=gt(u),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null),(b=u[1].error)!=null&&b.stacktrace?o?o.p(u,g):(o=pt(u),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},d(u){u&&(T(e),T(n),T(r),T(i)),a&&a.d(u),o&&o.d(u)}}}function gn(s){let e,t,l=s[1].error&&_t(s);return{c(){l&&l.c(),e=de()},m(n,r){l&&l.m(n,r),C(n,e,r),t=!0},p(n,[r]){n[1].error?l?(l.p(n,r),r&2&&A(l,1)):(l=_t(n),l.c(),A(l,1),l.m(e.parentNode,e)):l&&(ne(),N(l,1,1,()=>{l=null}),re())},i(n){t||(A(l),t=!0)},o(n){N(l),t=!1},d(n){n&&T(e),l&&l.d(n)}}}function pn(s,e,t){let l,n=$,r=()=>(n(),n=me(i,o=>t(1,l=o)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();const a=()=>i.setError();return s.$$set=o=>{"store"in o&&r(t(0,i=o.store))},[i,l,a]}class bn extends fe{constructor(e){super(),ue(this,e,pn,gn,oe,{store:0})}}function hn(s){let e,t,l,n,r,i;return{c(){e=v("button"),t=v("i"),d(t,"class","fa fa-fw fa-trash"),d(e,"type","button"),d(e,"class","local-mail-action-delete btn"),e.disabled=l=!s[2].selectedMessages.size,d(e,"title",n=s[2].strings.delete),O(e,"btn-secondary",!s[1]),O(e,"disabled",!s[2].selectedMessages.size)},m(a,o){C(a,e,o),_(e,t),r||(i=I(e,"click",s[3]),r=!0)},p(a,[o]){o&4&&l!==(l=!a[2].selectedMessages.size)&&(e.disabled=l),o&4&&n!==(n=a[2].strings.delete)&&d(e,"title",n),o&2&&O(e,"btn-secondary",!a[1]),o&4&&O(e,"disabled",!a[2].selectedMessages.size)},i:$,o:$,d(a){a&&T(e),r=!1,i()}}}function vn(s,e,t){let l,n=$,r=()=>(n(),n=me(i,f=>t(2,l=f)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{transparent:a=!1}=e;const o=()=>i.setDeleted(Array.from(l.selectedMessages.keys()),Ue.Deleted,!0);return s.$$set=f=>{"store"in f&&r(t(0,i=f.store)),"transparent"in f&&t(1,a=f.transparent)},[i,a,l,o]}class Cs extends fe{constructor(e){super(),ue(this,e,vn,hn,oe,{store:0,transparent:1})}}function bt(s){let e,t;return e=new Ge({props:{title:s[3].strings.deleteforever,cancelText:s[3].strings.cancel,confirmText:s[3].strings.deleteforever,confirmClass:"btn-danger",handleCancel:s[5],handleConfirm:s[6],$$slots:{default:[kn]},$$scope:{ctx:s}}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&8&&(r.title=l[3].strings.deleteforever),n&8&&(r.cancelText=l[3].strings.cancel),n&8&&(r.confirmText=l[3].strings.deleteforever),n&136&&(r.$$scope={dirty:n,ctx:l}),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function kn(s){let e=s[3].strings.messagedeleteconfirm+"",t;return{c(){t=R(e)},m(l,n){C(l,t,n)},p(l,n){n&8&&e!==(e=l[3].strings.messagedeleteconfirm+"")&&E(t,e)},d(l){l&&T(t)}}}function wn(s){let e,t,l,n,r,i,a,o,f,c=s[2]&&bt(s);return{c(){e=v("button"),t=v("i"),r=D(),c&&c.c(),i=de(),d(t,"class","fa fa-fw fa-trash"),d(e,"type","button"),d(e,"class","local-mail-action-delete-forever btn"),e.disabled=l=!s[3].selectedMessages.size,d(e,"title",n=s[3].strings.deleteforever),O(e,"btn-secondary",!s[1]),O(e,"disabled",!s[3].selectedMessages.size)},m(m,u){C(m,e,u),_(e,t),C(m,r,u),c&&c.m(m,u),C(m,i,u),a=!0,o||(f=I(e,"click",s[4]),o=!0)},p(m,[u]){(!a||u&8&&l!==(l=!m[3].selectedMessages.size))&&(e.disabled=l),(!a||u&8&&n!==(n=m[3].strings.deleteforever))&&d(e,"title",n),(!a||u&2)&&O(e,"btn-secondary",!m[1]),(!a||u&8)&&O(e,"disabled",!m[3].selectedMessages.size),m[2]?c?(c.p(m,u),u&4&&A(c,1)):(c=bt(m),c.c(),A(c,1),c.m(i.parentNode,i)):c&&(ne(),N(c,1,1,()=>{c=null}),re())},i(m){a||(A(c),a=!0)},o(m){N(c),a=!1},d(m){m&&(T(e),T(r),T(i)),c&&c.d(m),o=!1,f()}}}function yn(s,e,t){let l,n=$,r=()=>(n(),n=me(i,u=>t(3,l=u)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{transparent:a=!1}=e,o=!1;const f=()=>{t(2,o=!0)},c=()=>{t(2,o=!1)},m=()=>{t(2,o=!1),i.setDeleted(Array.from(l.selectedMessages.keys()),Ue.DeletedForever,!0)};return s.$$set=u=>{"store"in u&&r(t(0,i=u.store)),"transparent"in u&&t(1,a=u.transparent)},[i,a,o,l,f,c,m]}class Ts extends fe{constructor(e){super(),ue(this,e,yn,wn,oe,{store:0,transparent:1})}}function ht(s,e,t){const l=s.slice();return l[16]=e[t],l}function Mn(s){let e;return{c(){e=v("span"),e.textContent="a",d(e,"aria-hidden","true")},m(t,l){C(t,e,l)},d(t){t&&T(e)}}}function Sn(s){let e;return{c(){e=v("i"),d(e,"class","fa fa-check local-mail-label-modal-color-option-check")},m(t,l){C(t,e,l)},d(t){t&&T(e)}}}function vt(s,e){let t,l,n,r,i,a;function o(u,g){return u[16]==u[7]?Sn:Mn}let f=o(e),c=f(e);function m(){return e[15](e[16])}return{key:s,first:null,c(){t=v("button"),c.c(),l=D(),d(t,"role","radio"),d(t,"aria-checked",n=e[16]==e[7]),d(t,"tabindex","0"),d(t,"title",r=e[5].strings[`color${e[16]}`]),d(t,"class","local-mail-label-modal-color-option btn svelte-cky3j8"),d(t,"style",`color: var(--local-mail-color-${e[16]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${e[16]}-bg, var(--local-mail-color-gray-bg))`),this.first=t},m(u,g){C(u,t,g),c.m(t,null),_(t,l),i||(a=I(t,"click",ye(m)),i=!0)},p(u,g){e=u,f!==(f=o(e))&&(c.d(1),c=f(e),c&&(c.c(),c.m(t,l))),g&128&&n!==(n=e[16]==e[7])&&d(t,"aria-checked",n),g&32&&r!==(r=e[5].strings[`color${e[16]}`])&&d(t,"title",r)},d(u){u&&T(t),c.d(),i=!1,a()}}}function Cn(s){let e,t,l,n=s[5].strings.labelname+"",r,i,a,o,f,c,m=s[5].strings[s[4]?"errorrepeatedlabelname":"erroremptylabelname"]+"",u,g,h,p,b,S,w=s[5].strings.labelcolor+"",y,k,M,z,L=[],j=new Map,F,V,Q,ee=ie(We);const te=B=>B[16];for(let B=0;B<ee.length;B+=1){let x=ht(s,ee,B),Z=te(x);j.set(Z,L[B]=vt(Z,x))}return{c(){e=v("form"),t=v("div"),l=v("label"),r=R(n),i=D(),a=v("input"),f=D(),c=v("div"),u=R(m),g=D(),h=v("div"),h.textContent=" ",p=D(),b=v("div"),S=v("label"),y=R(w),M=D(),z=v("div");for(let B=0;B<L.length;B+=1)L[B].c();d(l,"for","local-mail-label-modal-name"),d(a,"type","text"),a.required=!0,d(a,"class","form-control is-invalid"),d(a,"id",o=s[9]+"-name"),O(a,"is-valid",s[8]),O(a,"is-invalid",!s[8]),d(c,"class","invalid-feedback"),d(h,"class","valid-feedback"),d(t,"class","form-group"),d(S,"for",k=s[9]+"-color"),d(z,"role","radiogroup"),d(z,"class","local-mail-label-modal-color svelte-cky3j8"),d(z,"id",F=s[9]+"-color"),d(b,"class","form-group")},m(B,x){C(B,e,x),_(e,t),_(t,l),_(l,r),_(t,i),_(t,a),s[13](a),be(a,s[3]),_(t,f),_(t,c),_(c,u),_(t,g),_(t,h),_(e,p),_(e,b),_(b,S),_(S,y),_(b,M),_(b,z);for(let Z=0;Z<L.length;Z+=1)L[Z]&&L[Z].m(z,null);V||(Q=[I(a,"input",s[14]),I(e,"submit",ye(s[10]))],V=!0)},p(B,x){x&32&&n!==(n=B[5].strings.labelname+"")&&E(r,n),x&512&&o!==(o=B[9]+"-name")&&d(a,"id",o),x&8&&a.value!==B[3]&&be(a,B[3]),x&256&&O(a,"is-valid",B[8]),x&256&&O(a,"is-invalid",!B[8]),x&48&&m!==(m=B[5].strings[B[4]?"errorrepeatedlabelname":"erroremptylabelname"]+"")&&E(u,m),x&32&&w!==(w=B[5].strings.labelcolor+"")&&E(y,w),x&512&&k!==(k=B[9]+"-color")&&d(S,"for",k),x&160&&(ee=ie(We),L=Me(L,x,te,1,B,ee,j,z,Ie,vt,null,ht)),x&512&&F!==(F=B[9]+"-color")&&d(z,"id",F)},d(B){B&&T(e),s[13](null);for(let x=0;x<L.length;x+=1)L[x].d();V=!1,pe(Q)}}}function Tn(s){let e,t;return e=new Ge({props:{title:s[5].strings[s[1]?"editlabel":"newlabel"],cancelText:s[5].strings.cancel,handleCancel:s[2],confirmText:s[5].strings[s[1]?"save":"create"],confirmDisabled:!s[8],handleConfirm:s[10],$$slots:{default:[Cn]},$$scope:{ctx:s}}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,[n]){const r={};n&34&&(r.title=l[5].strings[l[1]?"editlabel":"newlabel"]),n&32&&(r.cancelText=l[5].strings.cancel),n&4&&(r.handleCancel=l[2]),n&34&&(r.confirmText=l[5].strings[l[1]?"save":"create"]),n&256&&(r.confirmDisabled=!l[8]),n&525304&&(r.$$scope={dirty:n,ctx:l}),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function Dn(s,e,t){let l,n,r,i,a,o,f,c=$,m=()=>(c(),c=me(u,M=>t(5,f=M)),u);s.$$.on_destroy.push(()=>c());let{store:u}=e;m();let{label:g=void 0}=e,{handleCancel:h}=e,{handleSubmit:p}=e,b;const S=async()=>{p(n,r)};Ve(()=>b.focus());function w(M){we[M?"unshift":"push"](()=>{b=M,t(6,b)})}function y(){n=this.value,t(3,n),t(1,g)}const k=M=>{t(7,r=M)};return s.$$set=M=>{"store"in M&&m(t(0,u=M.store)),"label"in M&&t(1,g=M.label),"handleCancel"in M&&t(2,h=M.handleCancel),"handleSubmit"in M&&t(11,p=M.handleSubmit)},s.$$.update=()=>{s.$$.dirty&2&&t(9,l=`local-mail-label-modal-${(g==null?void 0:g.id)||"new"}`),s.$$.dirty&2&&t(3,n=(g==null?void 0:g.name)||""),s.$$.dirty&2&&t(7,r=(g==null?void 0:g.color)||We[0]),s.$$.dirty&8&&t(12,i=ut(n)==""),s.$$.dirty&42&&t(4,a=f.labels.some(M=>M.id!=(g==null?void 0:g.id)&&M.name==ut(n))),s.$$.dirty&4112&&t(8,o=!i&&!a)},[u,g,h,n,a,f,b,r,o,l,S,p,i,w,y,k]}class Ds extends fe{constructor(e){super(),ue(this,e,Dn,Tn,oe,{store:0,label:1,handleCancel:2,handleSubmit:11})}}const{Map:Ln}=Je;function kt(s,e,t){const l=s.slice();return l[16]=e[t],l}function wt(s){let e,t=[],l=new Ln,n,r,i=ie(s[3].labels);const a=u=>u[16].id;for(let u=0;u<i.length;u+=1){let g=kt(s,i,u),h=a(g);l.set(h,t[u]=yt(h,g))}let o=s[3].labels.length>0&&Mt();function f(u,g){return u[7]?An:zn}let c=f(s),m=c(s);return{c(){e=v("div");for(let u=0;u<t.length;u+=1)t[u].c();n=D(),o&&o.c(),r=D(),m.c(),d(e,"class","dropdown-menu show")},m(u,g){C(u,e,g);for(let h=0;h<t.length;h+=1)t[h]&&t[h].m(e,null);_(e,n),o&&o.m(e,null),_(e,r),m.m(e,null)},p(u,g){g&1096&&(i=ie(u[3].labels),t=Me(t,g,a,1,u,i,l,e,Ie,yt,n,kt)),u[3].labels.length>0?o||(o=Mt(),o.c(),o.m(e,r)):o&&(o.d(1),o=null),c===(c=f(u))&&m?m.p(u,g):(m.d(1),m=c(u),m&&(m.c(),m.m(e,null)))},d(u){u&&T(e);for(let g=0;g<t.length;g+=1)t[g].d();o&&o.d(),m.d()}}}function yt(s,e){let t,l,n,r,i=e[16].name+"",a,o,f;function c(){return e[15](e[16])}return{key:s,first:null,c(){t=v("button"),l=v("i"),r=D(),a=R(i),d(l,"class",n="fa fa-fw "+e[6](e[16].id)+" svelte-ufjoxg"),d(t,"type","button"),d(t,"class","dropdown-item local-mail-action-label-button-item"),this.first=t},m(m,u){C(m,t,u),_(t,l),_(t,r),_(t,a),o||(f=I(t,"click",c),o=!0)},p(m,u){e=m,u&72&&n!==(n="fa fa-fw "+e[6](e[16].id)+" svelte-ufjoxg")&&d(l,"class",n),u&8&&i!==(i=e[16].name+"")&&E(a,i)},d(m){m&&T(t),o=!1,f()}}}function Mt(s){let e;return{c(){e=v("div"),d(e,"class","dropdown-divider")},m(t,l){C(t,e,l)},d(t){t&&T(e)}}}function zn(s){let e,t=s[3].strings.newlabel+"",l,n,r;return{c(){e=v("button"),l=R(t),d(e,"type","button"),d(e,"class","dropdown-item local-mail-action-label-button-item")},m(i,a){C(i,e,a),_(e,l),n||(r=I(e,"click",s[12]),n=!0)},p(i,a){a&8&&t!==(t=i[3].strings.newlabel+"")&&E(l,t)},d(i){i&&T(e),n=!1,r()}}}function An(s){let e,t=s[3].strings.applychanges+"",l,n,r;return{c(){e=v("button"),l=R(t),d(e,"type","button"),d(e,"class","dropdown-item local-mail-action-label-button-item")},m(i,a){C(i,e,a),_(e,l),n||(r=I(e,"click",s[11]),n=!0)},p(i,a){a&8&&t!==(t=i[3].strings.applychanges+"")&&E(l,t)},d(i){i&&T(e),n=!1,r()}}}function St(s){let e,t;return e=new Ds({props:{store:s[0],handleCancel:s[9],handleSubmit:s[13]}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.store=l[0]),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function jn(s){let e,t,l,n,r,i,a,o,f,c,m=s[4]&&wt(s),u=s[5]&&St(s);return{c(){e=v("div"),t=v("button"),l=v("i"),i=D(),m&&m.c(),a=D(),u&&u.c(),d(l,"class","fa fa-fw fa-tag"),d(t,"type","button"),d(t,"class","local-mail-action-label-button btn dropdown-toggle svelte-ufjoxg"),t.disabled=n=!s[3].selectedMessages.size,d(t,"aria-expanded",s[4]),d(t,"title",r=s[3].strings.labels),O(t,"btn-secondary",!s[1]),O(t,"disabled",!s[3].selectedMessages.size),d(e,"class","btn-group"),d(e,"role","group"),O(e,"dropup",s[2])},m(g,h){C(g,e,h),_(e,t),_(t,l),_(e,i),m&&m.m(e,null),_(e,a),u&&u.m(e,null),o=!0,f||(c=[I(t,"click",s[8]),ve(Ee.call(null,e,s[9]))],f=!0)},p(g,[h]){(!o||h&8&&n!==(n=!g[3].selectedMessages.size))&&(t.disabled=n),(!o||h&16)&&d(t,"aria-expanded",g[4]),(!o||h&8&&r!==(r=g[3].strings.labels))&&d(t,"title",r),(!o||h&2)&&O(t,"btn-secondary",!g[1]),(!o||h&8)&&O(t,"disabled",!g[3].selectedMessages.size),g[4]?m?m.p(g,h):(m=wt(g),m.c(),m.m(e,a)):m&&(m.d(1),m=null),g[5]?u?(u.p(g,h),h&32&&A(u,1)):(u=St(g),u.c(),A(u,1),u.m(e,null)):u&&(ne(),N(u,1,1,()=>{u=null}),re()),(!o||h&4)&&O(e,"dropup",g[2])},i(g){o||(A(u),o=!0)},o(g){N(u),o=!1},d(g){g&&T(e),m&&m.d(),u&&u.d(),f=!1,pe(c)}}}function Nn(s,e,t){let l,n,r,i=$,a=()=>(i(),i=me(o,M=>t(3,r=M)),o);s.$$.on_destroy.push(()=>i());let{store:o}=e;a();let{transparent:f=!1}=e,{dropup:c=!1}=e,m=!1,u=!1,g=new Map;const h=()=>{t(4,m=!m)},p=()=>{t(4,m=!1),t(5,u=!1)},b=M=>{t(14,g=new Map(Array.from(g.entries()).map(([z,L])=>[z,z==M?L=="true"?"false":"true":L])))},S=()=>{t(4,m=!1),o.setLabels(Array.from(g.keys()).filter(M=>g.get(M)=="true"),Array.from(g.keys()).filter(M=>g.get(M)=="false"))},w=()=>{t(4,m=!1),t(5,u=!0)},y=async(M,z)=>{t(5,u=!1);const L=await o.createLabel(M,z);L&&o.setLabels([L],[])},k=M=>b(M.id);return s.$$set=M=>{"store"in M&&a(t(0,o=M.store)),"transparent"in M&&t(1,f=M.transparent),"dropup"in M&&t(2,c=M.dropup)},s.$$.update=()=>{s.$$.dirty&8&&t(14,g=new Map(r.labels.map(M=>{const z=Array.from(r.selectedMessages.values()).filter(L=>L.labels.some(j=>j.id==M.id));return[M.id,z.length==0?"false":z.length<r.selectedMessages.size?"mixed":"true"]}))),s.$$.dirty&16392&&t(7,l=Array.from(g.entries()).some(([M,z])=>Array.from(r.selectedMessages.values()).some(L=>z=="true"&&L.labels.every(j=>j.id!=M)||z=="false"&&L.labels.some(j=>j.id==M)))),s.$$.dirty&16384&&t(6,n=M=>g.get(M)=="false"?"fa-square-o":g.get(M)=="mixed"?"fa-minus-square-o":"fa-check-square-o")},[o,f,c,r,m,u,n,l,h,p,b,S,w,y,g,k]}class Ls extends fe{constructor(e){super(),ue(this,e,Nn,jn,oe,{store:0,transparent:1,dropup:2})}}function Ct(s){let e;function t(r,i){return r[8].params.tray=="trash"?Rn:Bn}let l=t(s),n=l(s);return{c(){e=v("div"),n.c(),d(e,"class","dropdown-menu show")},m(r,i){C(r,e,i),n.m(e,null)},p(r,i){l===(l=t(r))&&n?n.p(r,i):(n.d(1),n=l(r),n&&(n.c(),n.m(e,null)))},d(r){r&&T(e),n.d()}}}function Bn(s){let e,t,l,n,r,i=s[6]&&Tt(s),a=s[7]&&Dt(s),o=s[4]&&Lt(s),f=s[5]&&zt(s),c=s[3]&&At(s);return{c(){i&&i.c(),e=D(),a&&a.c(),t=D(),o&&o.c(),l=D(),f&&f.c(),n=D(),c&&c.c(),r=de()},m(m,u){i&&i.m(m,u),C(m,e,u),a&&a.m(m,u),C(m,t,u),o&&o.m(m,u),C(m,l,u),f&&f.m(m,u),C(m,n,u),c&&c.m(m,u),C(m,r,u)},p(m,u){m[6]?i?i.p(m,u):(i=Tt(m),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),m[7]?a?a.p(m,u):(a=Dt(m),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),m[4]?o?o.p(m,u):(o=Lt(m),o.c(),o.m(l.parentNode,l)):o&&(o.d(1),o=null),m[5]?f?f.p(m,u):(f=zt(m),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null),m[3]?c?c.p(m,u):(c=At(m),c.c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null)},d(m){m&&(T(e),T(t),T(l),T(n),T(r)),i&&i.d(m),a&&a.d(m),o&&o.d(m),f&&f.d(m),c&&c.d(m)}}}function Rn(s){let e,t=s[8].strings.emptytrash+"",l,n,r;return{c(){e=v("button"),l=R(t),d(e,"type","button"),d(e,"class","dropdown-item")},m(i,a){C(i,e,a),_(e,l),n||(r=I(e,"click",s[24]),n=!0)},p(i,a){a[0]&256&&t!==(t=i[8].strings.emptytrash+"")&&E(l,t)},d(i){i&&T(e),n=!1,r()}}}function Tt(s){let e,t=s[8].strings.markasread+"",l,n,r;return{c(){e=v("button"),l=R(t),d(e,"type","button"),d(e,"class","dropdown-item")},m(i,a){C(i,e,a),_(e,l),n||(r=I(e,"click",s[28]),n=!0)},p(i,a){a[0]&256&&t!==(t=i[8].strings.markasread+"")&&E(l,t)},d(i){i&&T(e),n=!1,r()}}}function Dt(s){let e,t=s[8].strings.markasunread+"",l,n,r;return{c(){e=v("button"),l=R(t),d(e,"type","button"),d(e,"class","dropdown-item")},m(i,a){C(i,e,a),_(e,l),n||(r=I(e,"click",s[29]),n=!0)},p(i,a){a[0]&256&&t!==(t=i[8].strings.markasunread+"")&&E(l,t)},d(i){i&&T(e),n=!1,r()}}}function Lt(s){let e,t=s[8].strings.markasstarred+"",l,n,r;return{c(){e=v("button"),l=R(t),d(e,"type","button"),d(e,"class","dropdown-item")},m(i,a){C(i,e,a),_(e,l),n||(r=I(e,"click",s[30]),n=!0)},p(i,a){a[0]&256&&t!==(t=i[8].strings.markasstarred+"")&&E(l,t)},d(i){i&&T(e),n=!1,r()}}}function zt(s){let e,t=s[8].strings.markasunstarred+"",l,n,r;return{c(){e=v("button"),l=R(t),d(e,"type","button"),d(e,"class","dropdown-item")},m(i,a){C(i,e,a),_(e,l),n||(r=I(e,"click",s[31]),n=!0)},p(i,a){a[0]&256&&t!==(t=i[8].strings.markasunstarred+"")&&E(l,t)},d(i){i&&T(e),n=!1,r()}}}function At(s){let e,t,l=s[8].strings.editlabel+"",n,r,i,a=s[8].strings.deletelabel+"",o,f,c,m=(s[6]||s[7]||s[4]||s[5])&&jt();return{c(){m&&m.c(),e=D(),t=v("button"),n=R(l),r=D(),i=v("button"),o=R(a),d(t,"type","button"),d(t,"class","dropdown-item"),d(i,"type","button"),d(i,"class","dropdown-item")},m(u,g){m&&m.m(u,g),C(u,e,g),C(u,t,g),_(t,n),C(u,r,g),C(u,i,g),_(i,o),f||(c=[I(t,"click",s[18]),I(i,"click",s[21])],f=!0)},p(u,g){u[6]||u[7]||u[4]||u[5]?m||(m=jt(),m.c(),m.m(e.parentNode,e)):m&&(m.d(1),m=null),g[0]&256&&l!==(l=u[8].strings.editlabel+"")&&E(n,l),g[0]&256&&a!==(a=u[8].strings.deletelabel+"")&&E(o,a)},d(u){u&&(T(e),T(t),T(r),T(i)),m&&m.d(u),f=!1,pe(c)}}}function jt(s){let e;return{c(){e=v("div"),d(e,"class","dropdown-divider")},m(t,l){C(t,e,l)},d(t){t&&T(e)}}}function En(s){let e,t,l,n=s[10]&&Nt(s),r=s[11]&&Bt(s);return{c(){n&&n.c(),e=D(),r&&r.c(),t=de()},m(i,a){n&&n.m(i,a),C(i,e,a),r&&r.m(i,a),C(i,t,a),l=!0},p(i,a){i[10]?n?(n.p(i,a),a[0]&1024&&A(n,1)):(n=Nt(i),n.c(),A(n,1),n.m(e.parentNode,e)):n&&(ne(),N(n,1,1,()=>{n=null}),re()),i[11]?r?(r.p(i,a),a[0]&2048&&A(r,1)):(r=Bt(i),r.c(),A(r,1),r.m(t.parentNode,t)):r&&(ne(),N(r,1,1,()=>{r=null}),re())},i(i){l||(A(n),A(r),l=!0)},o(i){N(n),N(r),l=!1},d(i){i&&(T(e),T(t)),n&&n.d(i),r&&r.d(i)}}}function qn(s){let e,t,l=s[12]&&Rt(s);return{c(){l&&l.c(),e=de()},m(n,r){l&&l.m(n,r),C(n,e,r),t=!0},p(n,r){n[12]?l?(l.p(n,r),r[0]&4096&&A(l,1)):(l=Rt(n),l.c(),A(l,1),l.m(e.parentNode,e)):l&&(ne(),N(l,1,1,()=>{l=null}),re())},i(n){t||(A(l),t=!0)},o(n){N(l),t=!1},d(n){n&&T(e),l&&l.d(n)}}}function Nt(s){let e,t;return e=new Ds({props:{store:s[0],label:s[3],handleCancel:s[19],handleSubmit:s[20]}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n[0]&1&&(r.store=l[0]),n[0]&8&&(r.label=l[3]),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function Bt(s){let e,t;return e=new Ge({props:{title:s[8].strings.deletelabel,cancelText:s[8].strings.cancel,confirmText:s[8].strings.deletelabel,confirmClass:"btn-danger",handleCancel:s[22],handleConfirm:s[23],$$slots:{default:[In]},$$scope:{ctx:s}}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n[0]&256&&(r.title=l[8].strings.deletelabel),n[0]&256&&(r.cancelText=l[8].strings.cancel),n[0]&256&&(r.confirmText=l[8].strings.deletelabel),n[0]&264|n[1]&2&&(r.$$scope={dirty:n,ctx:l}),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function In(s){let e=Le(s[8].strings.labeldeleteconfirm,s[3].name)+"",t;return{c(){t=R(e)},m(l,n){C(l,t,n)},p(l,n){n[0]&264&&e!==(e=Le(l[8].strings.labeldeleteconfirm,l[3].name)+"")&&E(t,e)},d(l){l&&T(t)}}}function Rt(s){let e,t;return e=new Ge({props:{title:s[8].strings.emptytrash,cancelText:s[8].strings.cancel,confirmText:s[8].strings.emptytrash,confirmClass:"btn-danger",handleCancel:s[25],handleConfirm:s[26],$$slots:{default:[$n]},$$scope:{ctx:s}}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n[0]&256&&(r.title=l[8].strings.emptytrash),n[0]&256&&(r.cancelText=l[8].strings.cancel),n[0]&256&&(r.confirmText=l[8].strings.emptytrash),n[0]&256|n[1]&2&&(r.$$scope={dirty:n,ctx:l}),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function $n(s){let e=s[8].strings.emptytrashconfirm+"",t;return{c(){t=R(e)},m(l,n){C(l,t,n)},p(l,n){n[0]&256&&e!==(e=l[8].strings.emptytrashconfirm+"")&&E(t,e)},d(l){l&&T(t)}}}function Fn(s){let e,t,l,n,r,i,a,o,f,c,m,u=s[9]&&Ct(s);const g=[qn,En],h=[];function p(b,S){return b[8].params.tray=="trash"?0:b[3]?1:-1}return~(a=p(s))&&(o=h[a]=g[a](s)),{c(){e=v("div"),t=v("button"),l=v("i"),r=D(),u&&u.c(),i=D(),o&&o.c(),d(l,"class","fa fa-fw fa-ellipsis-v"),d(t,"type","button"),d(t,"class","local-mail-action-more-button btn dropdown-toggle svelte-kx0nzt"),t.disabled=s[13],d(t,"aria-expanded",s[9]),d(t,"title",n=s[8].strings.moreactions),O(t,"btn-secondary",!s[1]),O(t,"disabled",s[13]),d(e,"class","btn-group"),O(e,"dropup",s[2])},m(b,S){C(b,e,S),_(e,t),_(t,l),_(e,r),u&&u.m(e,null),_(e,i),~a&&h[a].m(e,null),f=!0,c||(m=[I(t,"click",s[15]),ve(Ee.call(null,e,s[14]))],c=!0)},p(b,S){(!f||S[0]&8192)&&(t.disabled=b[13]),(!f||S[0]&512)&&d(t,"aria-expanded",b[9]),(!f||S[0]&256&&n!==(n=b[8].strings.moreactions))&&d(t,"title",n),(!f||S[0]&2)&&O(t,"btn-secondary",!b[1]),(!f||S[0]&8192)&&O(t,"disabled",b[13]),b[9]?u?u.p(b,S):(u=Ct(b),u.c(),u.m(e,i)):u&&(u.d(1),u=null);let w=a;a=p(b),a===w?~a&&h[a].p(b,S):(o&&(ne(),N(h[w],1,1,()=>{h[w]=null}),re()),~a?(o=h[a],o?o.p(b,S):(o=h[a]=g[a](b),o.c()),A(o,1),o.m(e,null)):o=null),(!f||S[0]&4)&&O(e,"dropup",b[2])},i(b){f||(A(o),f=!0)},o(b){N(o),f=!1},d(b){b&&T(e),u&&u.d(),~a&&h[a].d(),c=!1,pe(m)}}}function Pn(s,e,t){let l,n,r,i,a,o,f,c,m=$,u=()=>(m(),m=me(g,Y=>t(8,c=Y)),g);s.$$.on_destroy.push(()=>m());let{store:g}=e;u();let{transparent:h=!1}=e,{dropup:p=!1}=e,b=!1,S=!1,w=!1,y=!1;const k=()=>{t(9,b=!1)},M=()=>{t(9,b=!b)},z=Y=>{t(9,b=!1),g.setUnread(n.filter(ce=>!ce.draft).map(ce=>ce.id),Y)},L=Y=>{t(9,b=!1),g.setStarred(n.map(ce=>ce.id),Y)},j=()=>{t(9,b=!1),t(10,S=!0)},F=()=>{t(10,S=!1)},V=async(Y,ce)=>{t(10,S=!1),l&&g.updateLabel(l.id,Y,ce)},Q=()=>{t(9,b=!1),t(11,w=!0)},ee=()=>{t(11,w=!1)},te=()=>{t(11,w=!1),g.deleteLabel(c.params.labelid||0)},B=()=>{t(9,b=!1),t(12,y=!0)},x=()=>{t(12,y=!1)},Z=()=>{t(12,y=!1),g.emptyTrash()},le=()=>z(!1),q=()=>z(!0),K=()=>L(!0),U=()=>L(!1);return s.$$set=Y=>{"store"in Y&&u(t(0,g=Y.store)),"transparent"in Y&&t(1,h=Y.transparent),"dropup"in Y&&t(2,p=Y.dropup)},s.$$.update=()=>{s.$$.dirty[0]&256&&t(3,l=c.params.tray=="label"&&c.message==null?c.labels.find(Y=>Y.id==c.params.labelid):null),s.$$.dirty[0]&256&&t(27,n=Array.from(c.selectedMessages.values())),s.$$.dirty[0]&134217728&&t(7,r=n.some(Y=>!Y.draft&&!Y.unread)),s.$$.dirty[0]&134217728&&t(6,i=n.some(Y=>!Y.draft&&Y.unread)),s.$$.dirty[0]&134217728&&t(5,a=n.some(Y=>Y.starred)),s.$$.dirty[0]&134217728&&t(4,o=n.some(Y=>!Y.starred)),s.$$.dirty[0]&504&&t(13,f=c.params.tray=="trash"?!c.totalCount:!l&&!r&&!i&&!a&&!o)},[g,h,p,l,o,a,i,r,c,b,S,w,y,f,k,M,z,L,j,F,V,Q,ee,te,B,x,Z,n,le,q,K,U]}class zs extends fe{constructor(e){super(),ue(this,e,Pn,Fn,oe,{store:0,transparent:1,dropup:2},null,[-1,-1])}}function Et(s){let e,t;return{c(){e=v("div"),t=R(s[4]),d(e,"class","align-self-center text-nowrap")},m(l,n){C(l,e,n),_(e,t)},p(l,n){n&16&&E(t,l[4])},d(l){l&&T(e)}}}function qt(s){let e,t;return{c(){e=v("div"),t=R(s[4]),d(e,"class","text-truncate align-self-center mx-2")},m(l,n){C(l,e,n),_(e,t)},p(l,n){n&16&&E(t,l[4])},d(l){l&&T(e)}}}function On(s){let e,t,l,n,r,i,a,o,f,c,m,u,g,h,p,b,S,w=!s[2]&&Et(s),y=s[2]&&qt(s);return{c(){e=v("div"),w&&w.c(),t=D(),l=v("div"),n=v("button"),r=v("i"),f=D(),y&&y.c(),c=D(),m=v("button"),u=v("i"),d(r,"class","fa fa-w fa-chevron-left"),d(r,"aria-label",i=s[3].strings.previouspage),d(n,"type","button"),d(n,"class","btn btn-secondary"),n.disabled=a=!s[5],d(n,"title",o=s[3].strings[s[3].message?"previousmessage":"previouspage"]),O(n,"btn-secondary",!s[1]),d(u,"class","fa fa-w fa-chevron-right"),d(u,"aria-label",g=s[3].strings.nextpage),d(m,"type","button"),d(m,"class","btn"),m.disabled=h=!s[6],d(m,"title",p=s[3].strings[s[3].message?"nextmessage":"nextpage"]),O(m,"btn-secondary",!s[1]),d(l,"class","btn-group d-flex"),d(l,"role","group"),O(l,"btn-group",!s[2]),d(e,"class","local-mail-paging-buttons d-flex svelte-nbwrye"),O(e,"ml-auto",!s[2])},m(k,M){C(k,e,M),w&&w.m(e,null),_(e,t),_(e,l),_(l,n),_(n,r),_(l,f),y&&y.m(l,null),_(l,c),_(l,m),_(m,u),b||(S=[I(n,"click",ye(s[9])),I(m,"click",ye(s[10]))],b=!0)},p(k,[M]){k[2]?w&&(w.d(1),w=null):w?w.p(k,M):(w=Et(k),w.c(),w.m(e,t)),M&8&&i!==(i=k[3].strings.previouspage)&&d(r,"aria-label",i),M&32&&a!==(a=!k[5])&&(n.disabled=a),M&8&&o!==(o=k[3].strings[k[3].message?"previousmessage":"previouspage"])&&d(n,"title",o),M&2&&O(n,"btn-secondary",!k[1]),k[2]?y?y.p(k,M):(y=qt(k),y.c(),y.m(l,c)):y&&(y.d(1),y=null),M&8&&g!==(g=k[3].strings.nextpage)&&d(u,"aria-label",g),M&64&&h!==(h=!k[6])&&(m.disabled=h),M&8&&p!==(p=k[3].strings[k[3].message?"nextmessage":"nextpage"])&&d(m,"title",p),M&2&&O(m,"btn-secondary",!k[1]),M&4&&O(l,"btn-group",!k[2]),M&4&&O(e,"ml-auto",!k[2])},i:$,o:$,d(k){k&&T(e),w&&w.d(),y&&y.d(),b=!1,pe(S)}}}function Un(s,e,t){let l,n,r,i,a,o,f=$,c=()=>(f(),f=me(m,b=>t(3,o=b)),m);s.$$.on_destroy.push(()=>f());let{store:m}=e;c();let{transparent:u=!1}=e,{compact:g=!1}=e;const h=()=>m.navigate(i),p=()=>m.navigate(r);return s.$$set=b=>{"store"in b&&c(t(0,m=b.store)),"transparent"in b&&t(1,u=b.transparent),"compact"in b&&t(2,g=b.compact)},s.$$.update=()=>{var b;s.$$.dirty&8&&t(8,l=o.nextMessageId||!o.params.search&&(o.params.offset||0)+o.preferences.perpage<o.totalCount),s.$$.dirty&8&&t(7,n=o.prevMessageId||!o.params.search&&(o.params.offset||0)),s.$$.dirty&264&&t(6,r=l?o.message?{...o.params,messageid:o.nextMessageId,offset:(o.params.offset||0)+1}:{...o.params,messageid:void 0,offset:(o.params.offset||0)+o.preferences.perpage,search:o.params.search?{...o.params.search,startid:(b=o.listMessages[o.listMessages.length-1])==null?void 0:b.id,reverse:!1}:void 0}:void 0),s.$$.dirty&136&&t(5,i=n?o.message?{...o.params,messageid:o.prevMessageId,offset:Math.max(0,(o.params.offset||0)-1)}:{...o.params,messageid:void 0,offset:Math.max(0,(o.params.offset||0)-o.preferences.perpage),search:o.params.search?{...o.params.search,startid:o.listMessages[0].id,reverse:!0}:void 0}:void 0),s.$$.dirty&8&&t(4,a=o.message?o.params.search?(o.params.offset||0)+1:Le(o.strings.pagingsingle,{index:(o.messageOffset||0)+1,total:o.totalCount}):o.listMessages.length==0?"":o.params.search?Le(o.strings.pagingsearch,{first:(o.params.offset||0)+1,last:(o.params.offset||0)+o.listMessages.length}):Le(o.strings.pagingmultiple,{first:(o.params.offset||0)+1,last:(o.params.offset||0)+o.listMessages.length,total:o.totalCount}))},[m,u,g,o,a,i,r,n,l,h,p]}class As extends fe{constructor(e){super(),ue(this,e,Un,On,oe,{store:0,transparent:1,compact:2})}}function It(s){let e,t;return e=new Ge({props:{title:s[3].strings.restore,cancelText:s[3].strings.cancel,confirmText:s[3].strings.restore,handleCancel:s[5],handleConfirm:s[6],$$slots:{default:[Hn]},$$scope:{ctx:s}}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&8&&(r.title=l[3].strings.restore),n&8&&(r.cancelText=l[3].strings.cancel),n&8&&(r.confirmText=l[3].strings.restore),n&136&&(r.$$scope={dirty:n,ctx:l}),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function Hn(s){let e=s[3].strings.messagerestoreconfirm+"",t;return{c(){t=R(e)},m(l,n){C(l,t,n)},p(l,n){n&8&&e!==(e=l[3].strings.messagerestoreconfirm+"")&&E(t,e)},d(l){l&&T(t)}}}function Gn(s){let e,t,l,n,r,i,a,o,f,c=s[2]&&It(s);return{c(){e=v("button"),t=v("i"),r=D(),c&&c.c(),i=de(),d(t,"class","fa fa-fw fa-undo"),d(e,"type","button"),d(e,"class","local-mail-action-delete btn"),e.disabled=l=!s[3].selectedMessages.size,d(e,"title",n=s[3].strings.restore),O(e,"btn-secondary",!s[1]),O(e,"disabled",!s[3].selectedMessages.size)},m(m,u){C(m,e,u),_(e,t),C(m,r,u),c&&c.m(m,u),C(m,i,u),a=!0,o||(f=I(e,"click",s[4]),o=!0)},p(m,[u]){(!a||u&8&&l!==(l=!m[3].selectedMessages.size))&&(e.disabled=l),(!a||u&8&&n!==(n=m[3].strings.restore))&&d(e,"title",n),(!a||u&2)&&O(e,"btn-secondary",!m[1]),(!a||u&8)&&O(e,"disabled",!m[3].selectedMessages.size),m[2]?c?(c.p(m,u),u&4&&A(c,1)):(c=It(m),c.c(),A(c,1),c.m(i.parentNode,i)):c&&(ne(),N(c,1,1,()=>{c=null}),re())},i(m){a||(A(c),a=!0)},o(m){N(c),a=!1},d(m){m&&(T(e),T(r),T(i)),c&&c.d(m),o=!1,f()}}}function Kn(s,e,t){let l,n=$,r=()=>(n(),n=me(i,u=>t(3,l=u)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{transparent:a=!1}=e,o=!1;const f=()=>{t(2,o=!0)},c=()=>{t(2,o=!1)},m=()=>{t(2,o=!1),i.setDeleted(Array.from(l.selectedMessages.keys()),Ue.NotDeleted,!0)};return s.$$set=u=>{"store"in u&&r(t(0,i=u.store)),"transparent"in u&&t(1,a=u.transparent)},[i,a,o,l,f,c,m]}class js extends fe{constructor(e){super(),ue(this,e,Kn,Gn,oe,{store:0,transparent:1})}}function Vn(s){let e,t,l,n;return e=new Ls({props:{store:s[0],transparent:!0,dropup:!0}}),l=new Cs({props:{store:s[0],transparent:!0}}),{c(){J(e.$$.fragment),t=D(),J(l.$$.fragment)},m(r,i){W(e,r,i),C(r,t,i),W(l,r,i),n=!0},p(r,i){const a={};i&1&&(a.store=r[0]),e.$set(a);const o={};i&1&&(o.store=r[0]),l.$set(o)},i(r){n||(A(e.$$.fragment,r),A(l.$$.fragment,r),n=!0)},o(r){N(e.$$.fragment,r),N(l.$$.fragment,r),n=!1},d(r){r&&T(t),X(e,r),X(l,r)}}}function Yn(s){let e,t,l,n;return e=new js({props:{store:s[0],transparent:!0}}),l=new Ts({props:{store:s[0],transparent:!0}}),{c(){J(e.$$.fragment),t=D(),J(l.$$.fragment)},m(r,i){W(e,r,i),C(r,t,i),W(l,r,i),n=!0},p(r,i){const a={};i&1&&(a.store=r[0]),e.$set(a);const o={};i&1&&(o.store=r[0]),l.$set(o)},i(r){n||(A(e.$$.fragment,r),A(l.$$.fragment,r),n=!0)},o(r){N(e.$$.fragment,r),N(l.$$.fragment,r),n=!1},d(r){r&&T(t),X(e,r),X(l,r)}}}function Jn(s){let e,t,l,n,r,i,a,o,f,c,m;const u=[Yn,Vn],g=[];function h(p,b){return p[4].params.tray=="trash"?0:1}return n=h(s),r=g[n]=u[n](s),a=new zs({props:{store:s[0],transparent:!0,dropup:!0}}),f=new As({props:{store:s[0],transparent:!0,compact:!0}}),{c(){e=v("div"),t=v("div"),l=v("div"),r.c(),i=D(),J(a.$$.fragment),o=D(),J(f.$$.fragment),d(l,"class","w-100 d-flex justify-content-around"),d(l,"role","group"),d(t,"role","toolbar"),d(t,"class","local-mail-toolbar d-flex w-100 py-3 border-top"),De(()=>s[5].call(t)),O(t,"position-fixed",s[3]),O(t,"position-absolute",!s[3]),O(t,"fixed-bottom",s[3]),O(t,"border-bottom",!s[3]),O(t,"bg-white",!s[3]),O(t,"bg-light",s[3]),d(e,"class","row position-relative"),se(e,"height",s[1]+"px")},m(p,b){C(p,e,b),_(e,t),_(t,l),g[n].m(l,null),_(l,i),W(a,l,null),_(l,o),W(f,l,null),c=en(t,s[5].bind(t)),s[6](e),m=!0},p(p,[b]){let S=n;n=h(p),n===S?g[n].p(p,b):(ne(),N(g[S],1,1,()=>{g[S]=null}),re(),r=g[n],r?r.p(p,b):(r=g[n]=u[n](p),r.c()),A(r,1),r.m(l,i));const w={};b&1&&(w.store=p[0]),a.$set(w);const y={};b&1&&(y.store=p[0]),f.$set(y),(!m||b&8)&&O(t,"position-fixed",p[3]),(!m||b&8)&&O(t,"position-absolute",!p[3]),(!m||b&8)&&O(t,"fixed-bottom",p[3]),(!m||b&8)&&O(t,"border-bottom",!p[3]),(!m||b&8)&&O(t,"bg-white",!p[3]),(!m||b&8)&&O(t,"bg-light",p[3]),(!m||b&2)&&se(e,"height",p[1]+"px")},i(p){m||(A(r),A(a.$$.fragment,p),A(f.$$.fragment,p),m=!0)},o(p){N(r),N(a.$$.fragment,p),N(f.$$.fragment,p),m=!1},d(p){p&&T(e),g[n].d(),X(a),X(f),c(),s[6](null)}}}function Wn(s,e,t){let l,n=$,r=()=>(n(),n=me(i,u=>t(4,l=u)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let a,o,f=!1;Ve(()=>{const u=new IntersectionObserver(g=>{for(const h of g)t(3,f=h.intersectionRatio<1&&h.boundingClientRect.top>=h.boundingClientRect.height)},{threshold:1});return u.observe(o),()=>u.disconnect()});function c(){a=this.offsetHeight,t(1,a)}function m(u){we[u?"unshift":"push"](()=>{o=u,t(2,o)})}return s.$$set=u=>{"store"in u&&r(t(0,i=u.store))},[i,a,o,f,l,c,m]}class Xn extends fe{constructor(e){super(),ue(this,e,Wn,Jn,oe,{store:0})}}function Ns(s,{from:e,to:t},l={}){const n=getComputedStyle(s),r=n.transform==="none"?"":n.transform,[i,a]=n.transformOrigin.split(" ").map(parseFloat),o=e.left+e.width*i/t.width-(t.left+i),f=e.top+e.height*a/t.height-(t.top+a),{delay:c=0,duration:m=g=>Math.sqrt(g)*120,easing:u=Ss}=l;return{delay:c,duration:ke(m)?m(Math.sqrt(o*o+f*f)):m,easing:u,css:(g,h)=>{const p=h*o,b=h*f,S=g+h*e.width/t.width,w=g+h*e.height/t.height;return`transform: ${r} translate(${p}px, ${b}px) scale(${S}, ${w});`}}}function Qn(s){let e,t,l,n,r,i,a;return{c(){e=v("button"),t=v("i"),d(t,"class",l="fa align-middle "+s[3]),d(e,"type","button"),d(e,"class","btn px-2"),d(e,"role","checkbox"),d(e,"aria-checked",n=!!s[2].selectedMessages.has(s[1].id)),d(e,"title",r=s[2].strings.select)},m(o,f){C(o,e,f),_(e,t),i||(a=I(e,"click",hs(ye(s[4]))),i=!0)},p(o,[f]){f&8&&l!==(l="fa align-middle "+o[3])&&d(t,"class",l),f&6&&n!==(n=!!o[2].selectedMessages.has(o[1].id))&&d(e,"aria-checked",n),f&4&&r!==(r=o[2].strings.select)&&d(e,"title",r)},i:$,o:$,d(o){o&&T(e),i=!1,a()}}}function Zn(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,c=>t(2,n=c)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();let{message:o}=e;const f=()=>a.toggleSelected(o.id);return s.$$set=c=>{"store"in c&&i(t(0,a=c.store)),"message"in c&&t(1,o=c.message)},s.$$.update=()=>{s.$$.dirty&6&&t(3,l=n.selectedMessages.has(o.id)?"fa-check-square-o":"fa-square-o")},[a,o,n,l,f]}class Bs extends fe{constructor(e){super(),ue(this,e,Zn,Qn,oe,{store:0,message:1})}}function xn(s){let e,t,l,n,r,i,a,o;return{c(){e=v("button"),t=v("i"),d(t,"class",l="fa "+s[2]),d(e,"type","button"),d(e,"class","btn px-2"),d(e,"role","checkbox"),d(e,"aria-checked",n=s[1].starred),e.disabled=r=s[1].deleted,d(e,"title",i=s[1].deleted?s[3].strings[s[1].starred?"starred":"unstarred"]:s[3].strings[s[1].starred?"markasunstarred":"markasstarred"])},m(f,c){C(f,e,c),_(e,t),a||(o=I(e,"click",hs(ye(s[4]))),a=!0)},p(f,[c]){c&4&&l!==(l="fa "+f[2])&&d(t,"class",l),c&2&&n!==(n=f[1].starred)&&d(e,"aria-checked",n),c&2&&r!==(r=f[1].deleted)&&(e.disabled=r),c&10&&i!==(i=f[1].deleted?f[3].strings[f[1].starred?"starred":"unstarred"]:f[3].strings[f[1].starred?"markasunstarred":"markasstarred"])&&d(e,"title",i)},i:$,o:$,d(f){f&&T(e),a=!1,o()}}}function er(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,c=>t(3,n=c)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();let{message:o}=e;const f=()=>a.setStarred([o.id],!o.starred);return s.$$set=c=>{"store"in c&&i(t(0,a=c.store)),"message"in c&&t(1,o=c.message)},s.$$.update=()=>{s.$$.dirty&2&&t(2,l=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,l,n,f]}class Rs extends fe{constructor(e){super(),ue(this,e,er,xn,oe,{store:0,message:1})}}function tr(s){let e,t=s[1].join(", ")+"",l,n,r,i;return{c(){e=v("div"),l=R(t)},m(a,o){C(a,e,o),_(e,l),r||(i=ve(n=Ae.call(null,e,s[1].join(`
`))),r=!0)},p(a,[o]){o&2&&t!==(t=a[1].join(", ")+"")&&E(l,t),n&&ke(n.update)&&o&2&&n.update.call(null,a[1].join(`
`))},i:$,o:$,d(a){a&&T(e),r=!1,i()}}}function lr(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,f=>t(3,n=f)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();let{message:o}=e;return s.$$set=f=>{"store"in f&&i(t(0,a=f.store)),"message"in f&&t(2,o=f.message)},s.$$.update=()=>{s.$$.dirty&12&&t(1,l=n.params.tray=="sent"||n.params.tray=="drafts"?o.recipients.length>0?o.recipients.map(f=>f.fullname):[n.strings.norecipient]:[o.sender.fullname])},[a,l,o,n]}class nt extends fe{constructor(e){super(),ue(this,e,lr,tr,oe,{store:0,message:2})}}function $t(s){let e,t=s[2].strings.draft+"",l;return{c(){e=v("span"),l=R(t),d(e,"class","mr-2 text-danger")},m(n,r){C(n,e,r),_(e,l)},p(n,r){r&4&&t!==(t=n[2].strings.draft+"")&&E(l,t)},d(n){n&&T(e)}}}function sr(s){let e,t,l=(s[1].subject||s[2].strings.nosubject)+"",n,r,i,a,o=s[1].draft&&$t(s);return{c(){e=v("div"),o&&o.c(),t=D(),n=R(l)},m(f,c){C(f,e,c),o&&o.m(e,null),_(e,t),_(e,n),i||(a=ve(r=Ae.call(null,e,s[1].subject||s[2].strings.nosubject)),i=!0)},p(f,[c]){f[1].draft?o?o.p(f,c):(o=$t(f),o.c(),o.m(e,t)):o&&(o.d(1),o=null),c&6&&l!==(l=(f[1].subject||f[2].strings.nosubject)+"")&&E(n,l),r&&ke(r.update)&&c&6&&r.update.call(null,f[1].subject||f[2].strings.nosubject)},i:$,o:$,d(f){f&&T(e),o&&o.d(),i=!1,a()}}}function nr(s,e,t){let l,n=$,r=()=>(n(),n=me(i,o=>t(2,l=o)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{message:a}=e;return s.$$set=o=>{"store"in o&&r(t(0,i=o.store)),"message"in o&&t(1,a=o.message)},[i,a,l]}class rt extends fe{constructor(e){super(),ue(this,e,nr,sr,oe,{store:0,message:1})}}function Ft(s){let e,t,l,n,r;return{c(){e=v("span"),t=R(s[2]),d(e,"class","local-mail-course-badge badge px-2 mr-2 mb-2 svelte-zl9zhm"),se(e,"min-width","3rem"),se(e,"max-width","calc("+s[1]+"ch + 1.5rem)")},m(i,a){C(i,e,a),_(e,t),n||(r=ve(l=Ae.call(null,e,s[2])),n=!0)},p(i,a){a&4&&E(t,i[2]),a&2&&se(e,"max-width","calc("+i[1]+"ch + 1.5rem)"),l&&ke(l.update)&&a&4&&l.update.call(null,i[2])},d(i){i&&T(e),n=!1,r()}}}function rr(s){let e=["shortname","fullname"].includes(s[0].coursebadges),t,l=e&&Ft(s);return{c(){l&&l.c(),t=de()},m(n,r){l&&l.m(n,r),C(n,t,r)},p(n,[r]){r&1&&(e=["shortname","fullname"].includes(n[0].coursebadges)),e?l?l.p(n,r):(l=Ft(n),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},i:$,o:$,d(n){n&&T(t),l&&l.d(n)}}}function ir(s,e,t){let l,n,{course:r}=e,{settings:i}=e;return s.$$set=a=>{"course"in a&&t(3,r=a.course),"settings"in a&&t(0,i=a.settings)},s.$$.update=()=>{s.$$.dirty&9&&t(2,l=i.coursebadges=="shortname"?r.shortname:r.fullname),s.$$.dirty&1&&t(1,n=i.coursebadgeslength||20)},[i,n,l,r]}class it extends fe{constructor(e){super(),ue(this,e,ir,rr,oe,{course:3,settings:0})}}function ar(s){let e,t=s[0].name+"",l,n;return{c(){e=v("span"),l=R(t),d(e,"class","local-mail-label-badge badge flex-shrink-0 px-2 mr-2 mb-2 svelte-1xmrn49"),d(e,"style",n=`color: var(--local-mail-color-${s[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${s[1]}-bg, var(--local-mail-color-gray-bg))`)},m(r,i){C(r,e,i),_(e,l)},p(r,[i]){i&1&&t!==(t=r[0].name+"")&&E(l,t),i&2&&n!==(n=`color: var(--local-mail-color-${r[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${r[1]}-bg, var(--local-mail-color-gray-bg))`)&&d(e,"style",n)},i:$,o:$,d(r){r&&T(e)}}}function or(s,e,t){let l,{label:n}=e;return s.$$set=r=>{"label"in r&&t(0,n=r.label)},s.$$.update=()=>{s.$$.dirty&1&&t(1,l=We.includes(n.color)?n.color:"gray")},[n,l]}class Es extends fe{constructor(e){super(),ue(this,e,or,ar,oe,{label:0})}}function Pt(s,e,t){const l=s.slice();return l[3]=e[t],l}function Ot(s){let e,t,l=s[2].params.courseid!=s[1].course.id&&Ut(s);return{c(){l&&l.c(),e=de()},m(n,r){l&&l.m(n,r),C(n,e,r),t=!0},p(n,r){n[2].params.courseid!=n[1].course.id?l?(l.p(n,r),r&6&&A(l,1)):(l=Ut(n),l.c(),A(l,1),l.m(e.parentNode,e)):l&&(ne(),N(l,1,1,()=>{l=null}),re())},i(n){t||(A(l),t=!0)},o(n){N(l),t=!1},d(n){n&&T(e),l&&l.d(n)}}}function Ut(s){let e,t;return e=new it({props:{course:s[1].course,settings:s[2].settings}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&2&&(r.course=l[1].course),n&4&&(r.settings=l[2].settings),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function Ht(s){let e,t;return e=new Es({props:{label:s[3]}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&2&&(r.label=l[3]),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function Gt(s,e){let t,l,n,r=(e[2].params.tray!="label"||e[2].params.labelid!=e[3].id)&&Ht(e);return{key:s,first:null,c(){t=de(),r&&r.c(),l=de(),this.first=t},m(i,a){C(i,t,a),r&&r.m(i,a),C(i,l,a),n=!0},p(i,a){e=i,e[2].params.tray!="label"||e[2].params.labelid!=e[3].id?r?(r.p(e,a),a&6&&A(r,1)):(r=Ht(e),r.c(),A(r,1),r.m(l.parentNode,l)):r&&(ne(),N(r,1,1,()=>{r=null}),re())},i(i){n||(A(r),n=!0)},o(i){N(r),n=!1},d(i){i&&(T(t),T(l)),r&&r.d(i)}}}function Kt(s){let e,t,l=s[2].params.courseid!=s[1].course.id&&Vt(s);return{c(){l&&l.c(),e=de()},m(n,r){l&&l.m(n,r),C(n,e,r),t=!0},p(n,r){n[2].params.courseid!=n[1].course.id?l?(l.p(n,r),r&6&&A(l,1)):(l=Vt(n),l.c(),A(l,1),l.m(e.parentNode,e)):l&&(ne(),N(l,1,1,()=>{l=null}),re())},i(n){t||(A(l),t=!0)},o(n){N(l),t=!1},d(n){n&&T(e),l&&l.d(n)}}}function Vt(s){let e,t;return e=new it({props:{course:s[1].course,settings:s[2].settings}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&2&&(r.course=l[1].course),n&4&&(r.settings=l[2].settings),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function fr(s){let e,t=[],l=new Map,n,r,i,a=s[2].viewSize<_e.MD&&Ot(s),o=ie(s[1].labels);const f=m=>m[3].id;for(let m=0;m<o.length;m+=1){let u=Pt(s,o,m),g=f(u);l.set(g,t[m]=Gt(g,u))}let c=s[2].viewSize>=_e.MD&&Kt(s);return{c(){a&&a.c(),e=D();for(let m=0;m<t.length;m+=1)t[m].c();n=D(),c&&c.c(),r=de()},m(m,u){a&&a.m(m,u),C(m,e,u);for(let g=0;g<t.length;g+=1)t[g]&&t[g].m(m,u);C(m,n,u),c&&c.m(m,u),C(m,r,u),i=!0},p(m,[u]){m[2].viewSize<_e.MD?a?(a.p(m,u),u&4&&A(a,1)):(a=Ot(m),a.c(),A(a,1),a.m(e.parentNode,e)):a&&(ne(),N(a,1,1,()=>{a=null}),re()),u&6&&(o=ie(m[1].labels),ne(),t=Me(t,u,f,1,m,o,l,n.parentNode,Ye,Gt,n,Pt),re()),m[2].viewSize>=_e.MD?c?(c.p(m,u),u&4&&A(c,1)):(c=Kt(m),c.c(),A(c,1),c.m(r.parentNode,r)):c&&(ne(),N(c,1,1,()=>{c=null}),re())},i(m){if(!i){A(a);for(let u=0;u<o.length;u+=1)A(t[u]);A(c),i=!0}},o(m){N(a);for(let u=0;u<t.length;u+=1)N(t[u]);N(c),i=!1},d(m){m&&(T(e),T(n),T(r)),a&&a.d(m);for(let u=0;u<t.length;u+=1)t[u].d(m);c&&c.d(m)}}}function ur(s,e,t){let l,n=$,r=()=>(n(),n=me(i,o=>t(2,l=o)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{message:a}=e;return s.$$set=o=>{"store"in o&&r(t(0,i=o.store)),"message"in o&&t(1,a=o.message)},[i,a,l]}class qs extends fe{constructor(e){super(),ue(this,e,ur,fr,oe,{store:0,message:1})}}function Yt(s){let e,t,l,n,r;return{c(){e=v("span"),t=v("i"),d(t,"class",l="fa fa-fw "+(s[1].numattachments>0?"fa-paperclip":"")),d(t,"aria-hidden",!0),d(e,"class","-shrink-0 mr-2"),d(e,"title",n=s[1].numattachments>0?Le(s[2].strings.attachnumber,s[1].numattachments):""),d(e,"aria-hidden",r=s[1].numattachments==0)},m(i,a){C(i,e,a),_(e,t)},p(i,a){a&2&&l!==(l="fa fa-fw "+(i[1].numattachments>0?"fa-paperclip":""))&&d(t,"class",l),a&6&&n!==(n=i[1].numattachments>0?Le(i[2].strings.attachnumber,i[1].numattachments):"")&&d(e,"title",n),a&2&&r!==(r=i[1].numattachments==0)&&d(e,"aria-hidden",r)},d(i){i&&T(e)}}}function cr(s){let e,t=(s[1].numattachments>0||s[2].viewSize>=_e.MD)&&Yt(s);return{c(){t&&t.c(),e=de()},m(l,n){t&&t.m(l,n),C(l,e,n)},p(l,[n]){l[1].numattachments>0||l[2].viewSize>=_e.MD?t?t.p(l,n):(t=Yt(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:$,o:$,d(l){l&&T(e),t&&t.d(l)}}}function mr(s,e,t){let l,n=$,r=()=>(n(),n=me(i,o=>t(2,l=o)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{message:a}=e;return s.$$set=o=>{"store"in o&&r(t(0,i=o.store)),"message"in o&&t(1,a=o.message)},[i,a,l]}class Is extends fe{constructor(e){super(),ue(this,e,mr,cr,oe,{store:0,message:1})}}function dr(s){let e,t=s[0].shorttime+"",l,n;return{c(){e=v("span"),l=R(t),d(e,"class","local-mail-list-message-time d-shrink-0 text-nowrap text-right svelte-phmq8k"),d(e,"title",n=s[0].fulltime),O(e,"local-mail-list-message-time-md",s[2].viewSize>=_e.MD)},m(r,i){C(r,e,i),_(e,l)},p(r,[i]){i&1&&t!==(t=r[0].shorttime+"")&&E(l,t),i&1&&n!==(n=r[0].fulltime)&&d(e,"title",n),i&4&&O(e,"local-mail-list-message-time-md",r[2].viewSize>=_e.MD)},i:$,o:$,d(r){r&&T(e)}}}function _r(s,e,t){let l,n=$,r=()=>(n(),n=me(a,o=>t(2,l=o)),a);s.$$.on_destroy.push(()=>n());let{message:i}=e,{store:a}=e;return r(),s.$$set=o=>{"message"in o&&t(0,i=o.message),"store"in o&&r(t(1,a=o.store))},[i,a,l]}class $s extends fe{constructor(e){super(),ue(this,e,_r,dr,oe,{message:0,store:1})}}function Jt(s){let e,t,l=s[1].strings.nomessagesfound+"",n,r,i,a=s[1].totalCount>0&&Wt(s);return{c(){e=v("div"),t=v("div"),n=R(l),r=D(),a&&a.c(),d(e,"class","alert alert-info")},m(o,f){C(o,e,f),_(e,t),_(t,n),_(e,r),a&&a.m(e,null)},p(o,f){f&2&&l!==(l=o[1].strings.nomessagesfound+"")&&E(n,l),o[1].totalCount>0?a?a.p(o,f):(a=Wt(o),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i(o){o&&(i||De(()=>{i=lt(e,Ne,{delay:400}),i.start()}))},o:$,d(o){o&&T(e),a&&a.d()}}}function Wt(s){let e,t=s[1].strings.showrecentmessages+"",l,n,r,i;return{c(){e=v("a"),l=R(t),d(e,"class","btn btn-info text-white mt-3"),d(e,"href",n=Re(s[2]))},m(a,o){C(a,e,o),_(e,l),r||(i=I(e,"click",ye(s[3])),r=!0)},p(a,o){o&2&&t!==(t=a[1].strings.showrecentmessages+"")&&E(l,t),o&4&&n!==(n=Re(a[2]))&&d(e,"href",n)},d(a){a&&T(e),r=!1,i()}}}function gr(s){let e,t=!s[1].listMessages.length&&Jt(s);return{c(){t&&t.c(),e=de()},m(l,n){t&&t.m(l,n),C(l,e,n)},p(l,[n]){l[1].listMessages.length?t&&(t.d(1),t=null):t?(t.p(l,n),n&2&&A(t,1)):(t=Jt(l),t.c(),A(t,1),t.m(e.parentNode,e))},i(l){A(t)},o:$,d(l){l&&T(e),t&&t.d(l)}}}function pr(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,f=>t(1,n=f)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();const o=()=>a.navigate(l);return s.$$set=f=>{"store"in f&&i(t(0,a=f.store))},s.$$.update=()=>{s.$$.dirty&2&&t(2,l={tray:n.params.tray,courseid:n.params.courseid,labelid:n.params.labelid})},[a,n,l,o]}class br extends fe{constructor(e){super(),ue(this,e,pr,gr,oe,{store:0})}}function Xt(s,e,t){const l=s.slice();return l[4]=e[t],l[6]=t,l}function hr(s){let e,t,l,n,r,i,a,o,f,c,m,u,g,h,p,b,S,w,y,k,M;return t=new Bs({props:{store:s[0],message:s[4]}}),i=new nt({props:{store:s[0],message:s[4]}}),o=new Is({props:{store:s[0],message:s[4]}}),m=new $s({props:{store:s[0],message:s[4]}}),p=new rt({props:{store:s[0],message:s[4]}}),S=new Rs({props:{store:s[0],message:s[4]}}),k=new qs({props:{store:s[0],message:s[4]}}),{c(){e=v("div"),J(t.$$.fragment),l=D(),n=v("div"),r=v("div"),J(i.$$.fragment),a=D(),J(o.$$.fragment),f=D(),c=v("div"),J(m.$$.fragment),u=D(),g=v("div"),h=v("div"),J(p.$$.fragment),b=D(),J(S.$$.fragment),w=D(),y=v("div"),J(k.$$.fragment),d(c,"class","ml-auto mr-2"),d(r,"class","d-flex mt-2"),d(h,"class","d-flex w-100 my-2 mr-2"),se(h,"min-width","0"),d(g,"class","d-flex"),d(y,"class","d-flex flex-wrap ml-n2 mr-2"),d(n,"class","w-100 ml-1"),se(n,"min-width","0"),d(e,"class","d-flex align-items-start pt-1 pb-2 pl-1 pr-2")},m(z,L){C(z,e,L),W(t,e,null),_(e,l),_(e,n),_(n,r),W(i,r,null),_(r,a),W(o,r,null),_(r,f),_(r,c),W(m,c,null),_(n,u),_(n,g),_(g,h),W(p,h,null),_(g,b),W(S,g,null),_(n,w),_(n,y),W(k,y,null),M=!0},p(z,L){const j={};L&1&&(j.store=z[0]),L&2&&(j.message=z[4]),t.$set(j);const F={};L&1&&(F.store=z[0]),L&2&&(F.message=z[4]),i.$set(F);const V={};L&1&&(V.store=z[0]),L&2&&(V.message=z[4]),o.$set(V);const Q={};L&1&&(Q.store=z[0]),L&2&&(Q.message=z[4]),m.$set(Q);const ee={};L&1&&(ee.store=z[0]),L&2&&(ee.message=z[4]),p.$set(ee);const te={};L&1&&(te.store=z[0]),L&2&&(te.message=z[4]),S.$set(te);const B={};L&1&&(B.store=z[0]),L&2&&(B.message=z[4]),k.$set(B)},i(z){M||(A(t.$$.fragment,z),A(i.$$.fragment,z),A(o.$$.fragment,z),A(m.$$.fragment,z),A(p.$$.fragment,z),A(S.$$.fragment,z),A(k.$$.fragment,z),M=!0)},o(z){N(t.$$.fragment,z),N(i.$$.fragment,z),N(o.$$.fragment,z),N(m.$$.fragment,z),N(p.$$.fragment,z),N(S.$$.fragment,z),N(k.$$.fragment,z),M=!1},d(z){z&&T(e),X(t),X(i),X(o),X(m),X(p),X(S),X(k)}}}function vr(s){let e,t,l,n,r,i,a,o,f,c,m,u,g,h,p,b,S,w,y;return t=new Bs({props:{store:s[0],message:s[4]}}),n=new Rs({props:{store:s[0],message:s[4]}}),o=new nt({props:{store:s[0],message:s[4]}}),m=new rt({props:{store:s[0],message:s[4]}}),h=new qs({props:{store:s[0],message:s[4]}}),b=new Is({props:{store:s[0],message:s[4]}}),w=new $s({props:{store:s[0],message:s[4]}}),{c(){e=v("div"),J(t.$$.fragment),l=D(),J(n.$$.fragment),r=D(),i=v("div"),a=v("div"),J(o.$$.fragment),f=D(),c=v("div"),J(m.$$.fragment),u=D(),g=v("div"),J(h.$$.fragment),p=D(),J(b.$$.fragment),S=D(),J(w.$$.fragment),d(a,"class","flex-grow-1 mx-2"),se(a,"width","25%"),se(a,"min-width","0"),d(g,"class","d-flex text-truncate flex-shrink-0 justify-content-end mb-n2 ml-auto"),se(g,"max-width","80%"),d(c,"class","flex-grow-1 d-flex my-2 mx-2"),se(c,"width","75%"),se(c,"min-width","0"),d(i,"class","d-flex w-100 flex-grow-1 align-items-center"),se(i,"min-width","0"),d(e,"class","d-flex align-items-center pl-1 pr-3")},m(k,M){C(k,e,M),W(t,e,null),_(e,l),W(n,e,null),_(e,r),_(e,i),_(i,a),W(o,a,null),_(i,f),_(i,c),W(m,c,null),_(c,u),_(c,g),W(h,g,null),_(e,p),W(b,e,null),_(e,S),W(w,e,null),y=!0},p(k,M){const z={};M&1&&(z.store=k[0]),M&2&&(z.message=k[4]),t.$set(z);const L={};M&1&&(L.store=k[0]),M&2&&(L.message=k[4]),n.$set(L);const j={};M&1&&(j.store=k[0]),M&2&&(j.message=k[4]),o.$set(j);const F={};M&1&&(F.store=k[0]),M&2&&(F.message=k[4]),m.$set(F);const V={};M&1&&(V.store=k[0]),M&2&&(V.message=k[4]),h.$set(V);const Q={};M&1&&(Q.store=k[0]),M&2&&(Q.message=k[4]),b.$set(Q);const ee={};M&1&&(ee.store=k[0]),M&2&&(ee.message=k[4]),w.$set(ee)},i(k){y||(A(t.$$.fragment,k),A(n.$$.fragment,k),A(o.$$.fragment,k),A(m.$$.fragment,k),A(h.$$.fragment,k),A(b.$$.fragment,k),A(w.$$.fragment,k),y=!0)},o(k){N(t.$$.fragment,k),N(n.$$.fragment,k),N(o.$$.fragment,k),N(m.$$.fragment,k),N(h.$$.fragment,k),N(b.$$.fragment,k),N(w.$$.fragment,k),y=!1},d(k){k&&T(e),X(t),X(n),X(o),X(m),X(h),X(b),X(w)}}}function Qt(s,e){let t,l,n,r,i,a,o,f=$,c,m,u;const g=[vr,hr],h=[];function p(S,w){return S[1].viewSize>=_e.MD?0:1}l=p(e),n=h[l]=g[l](e);function b(){return e[3](e[4],e[6])}return{key:s,first:null,c(){t=v("a"),n.c(),d(t,"class","local-mail-list-message list-group-item list-group-item-action p-0 svelte-unh3d4"),d(t,"href",r=Re(e[2](e[4],e[6]))),O(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),O(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),O(t,"font-weight-bold",e[4].unread),this.first=t},m(S,w){C(S,t,w),h[l].m(t,null),c=!0,m||(u=I(t,"click",ye(b)),m=!0)},p(S,w){e=S;let y=l;l=p(e),l===y?h[l].p(e,w):(ne(),N(h[y],1,1,()=>{h[y]=null}),re(),n=h[l],n?n.p(e,w):(n=h[l]=g[l](e),n.c()),A(n,1),n.m(t,null)),(!c||w&2&&r!==(r=Re(e[2](e[4],e[6]))))&&d(t,"href",r),(!c||w&2)&&O(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),(!c||w&2)&&O(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),(!c||w&2)&&O(t,"font-weight-bold",e[4].unread)},r(){o=t.getBoundingClientRect()},f(){Ms(t),f(),st(t,o)},a(){f(),f=ys(t,o,Ns,{delay:400,duration:400})},i(S){c||(A(n),S&&De(()=>{c&&(a&&a.end(1),i=lt(t,Ne,{delay:400}),i.start())}),c=!0)},o(S){N(n),i&&i.invalidate(),S&&(a=ks(t,Ne,{duration:400})),c=!1},d(S){S&&T(t),h[l].d(),S&&a&&a.end(),m=!1,u()}}}function Zt(s){let e,t=[],l=new Map,n,r,i,a=ie(s[1].listMessages);const o=f=>f[4].id;for(let f=0;f<a.length;f+=1){let c=Xt(s,a,f),m=o(c);l.set(m,t[f]=Qt(m,c))}return r=new br({props:{store:s[0]}}),{c(){e=v("div");for(let f=0;f<t.length;f+=1)t[f].c();n=D(),J(r.$$.fragment),d(e,"class","list-group")},m(f,c){C(f,e,c);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(e,null);_(e,n),W(r,e,null),i=!0},p(f,c){if(c&7){a=ie(f[1].listMessages),ne();for(let u=0;u<t.length;u+=1)t[u].r();t=Me(t,c,o,1,f,a,l,e,vs,Qt,n,Xt);for(let u=0;u<t.length;u+=1)t[u].a();re()}const m={};c&1&&(m.store=f[0]),r.$set(m)},i(f){if(!i){for(let c=0;c<a.length;c+=1)A(t[c]);A(r.$$.fragment,f),i=!0}},o(f){for(let c=0;c<t.length;c+=1)N(t[c]);N(r.$$.fragment,f),i=!1},d(f){f&&T(e);for(let c=0;c<t.length;c+=1)t[c].d();X(r)}}}function kr(s){let e=s[1].navigationId,t,l,n=Zt(s);return{c(){n.c(),t=de()},m(r,i){n.m(r,i),C(r,t,i),l=!0},p(r,[i]){i&2&&oe(e,e=r[1].navigationId)?(ne(),N(n,1,1,$),re(),n=Zt(r),n.c(),A(n,1),n.m(t.parentNode,t)):n.p(r,i)},i(r){l||(A(n),l=!0)},o(r){N(n),l=!1},d(r){r&&T(t),n.d(r)}}}function wr(s,e,t){let l,n=$,r=()=>(n(),n=me(i,f=>t(1,l=f)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();const a=(f,c)=>({...l.params,messageid:f.id,offset:(l.params.offset||0)+c}),o=(f,c)=>i.navigate(a(f,c));return s.$$set=f=>{"store"in f&&r(t(0,i=f.store))},[i,l,a,o]}class yr extends fe{constructor(e){super(),ue(this,e,wr,kr,oe,{store:0})}}function xt(s){let e,t,l,n,r,i,a,o=s[3]&&el(s);return{c(){e=v("div"),t=v("button"),l=v("i"),r=D(),o&&o.c(),d(l,"class","fa fa-fw fa-ellipsis-v align-middle"),d(t,"type","button"),d(t,"class","btn"),d(t,"aria-expanded",s[3]),d(t,"title",n=s[5].strings.moreactions),d(e,"class","dropdown")},m(f,c){C(f,e,c),_(e,t),_(t,l),_(e,r),o&&o.m(e,null),i||(a=[I(t,"click",s[6]),ve(Ee.call(null,e,s[7]))],i=!0)},p(f,c){c&8&&d(t,"aria-expanded",f[3]),c&32&&n!==(n=f[5].strings.moreactions)&&d(t,"title",n),f[3]?o?o.p(f,c):(o=el(f),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(f){f&&T(e),o&&o.d(),i=!1,pe(a)}}}function el(s){let e,t,l,n,r=s[5].strings.reply+"",i,a,o,f,c,m=s[5].strings.replyall+"",u,g,h,p,b,S,w=s[5].strings.forward+"",y,k,M;return{c(){e=v("div"),t=v("button"),l=v("i"),n=D(),i=R(r),a=D(),o=v("button"),f=v("i"),c=D(),u=R(m),h=D(),p=v("button"),b=v("i"),S=D(),y=R(w),d(l,"class","fa fa-fw fa-reply"),d(l,"aria-hidden","true"),d(t,"type","button"),d(t,"class","dropdown-item"),d(f,"class","fa fa-fw fa-reply-all"),d(f,"aria-hidden","true"),d(o,"type","button"),o.disabled=g=!s[2],d(o,"class","dropdown-item"),O(o,"disabled",!s[2]),d(b,"class","fa fa-fw fa-share"),d(b,"aria-hidden","true"),d(p,"type","button"),d(p,"class","dropdown-item"),d(e,"class","dropdown-menu dropdown-menu-right show")},m(z,L){C(z,e,L),_(e,t),_(t,l),_(t,n),_(t,i),_(e,a),_(e,o),_(o,f),_(o,c),_(o,u),_(e,h),_(e,p),_(p,b),_(p,S),_(p,y),k||(M=[I(t,"click",s[9]),I(o,"click",s[10]),I(p,"click",s[11])],k=!0)},p(z,L){L&32&&r!==(r=z[5].strings.reply+"")&&E(i,r),L&32&&m!==(m=z[5].strings.replyall+"")&&E(u,m),L&4&&g!==(g=!z[2])&&(o.disabled=g),L&4&&O(o,"disabled",!z[2]),L&32&&w!==(w=z[5].strings.forward+"")&&E(y,w)},d(z){z&&T(e),k=!1,pe(M)}}}function tl(s){let e,t,l,n,r,i,a,o,f,c,m,u,g,h;return{c(){e=v("button"),t=v("i"),n=D(),r=v("button"),i=v("i"),f=D(),c=v("button"),m=v("i"),d(t,"class","fa fa-fw fa-reply"),d(t,"aria-hidden","true"),d(e,"type","button"),d(e,"title",l=s[5].strings.reply),d(e,"class","btn py-2 border-0"),d(i,"class","fa fa-fw fa-reply-all"),d(i,"aria-hidden","true"),d(r,"type","button"),r.disabled=a=!s[2],d(r,"title",o=s[5].strings.replyall),d(r,"class","btn py-2 border-0"),O(r,"disabled",!s[2]),d(m,"class","fa fa-fw fa-share"),d(m,"aria-hidden","true"),d(c,"type","button"),d(c,"title",u=s[5].strings.forward),d(c,"class","btn py-2 border-0")},m(p,b){C(p,e,b),_(e,t),C(p,n,b),C(p,r,b),_(r,i),C(p,f,b),C(p,c,b),_(c,m),g||(h=[I(e,"click",s[12]),I(r,"click",s[13]),I(c,"click",s[14])],g=!0)},p(p,b){b&32&&l!==(l=p[5].strings.reply)&&d(e,"title",l),b&4&&a!==(a=!p[2])&&(r.disabled=a),b&32&&o!==(o=p[5].strings.replyall)&&d(r,"title",o),b&4&&O(r,"disabled",!p[2]),b&32&&u!==(u=p[5].strings.forward)&&d(c,"title",u)},d(p){p&&(T(e),T(n),T(r),T(f),T(c)),g=!1,pe(h)}}}function Mr(s){let e,t,l,n,r,i,a,o,f,c,m,u=s[5].viewSize<_e.SM&&xt(s),g=s[5].viewSize>=_e.SM&&tl(s);return{c(){e=v("button"),t=v("i"),a=D(),u&&u.c(),o=D(),g&&g.c(),f=de(),d(t,"class",l="fa "+s[4]),d(e,"type","button"),d(e,"class","btn py-2 border-0"),d(e,"role","checkbox"),d(e,"aria-checked",n=s[1].starred),e.disabled=r=s[1].deleted,d(e,"title",i=s[1].starred?s[5].strings.markasunstarred:s[5].strings.markasstarred)},m(h,p){C(h,e,p),_(e,t),C(h,a,p),u&&u.m(h,p),C(h,o,p),g&&g.m(h,p),C(h,f,p),c||(m=I(e,"click",s[8]),c=!0)},p(h,[p]){p&16&&l!==(l="fa "+h[4])&&d(t,"class",l),p&2&&n!==(n=h[1].starred)&&d(e,"aria-checked",n),p&2&&r!==(r=h[1].deleted)&&(e.disabled=r),p&34&&i!==(i=h[1].starred?h[5].strings.markasunstarred:h[5].strings.markasstarred)&&d(e,"title",i),h[5].viewSize<_e.SM?u?u.p(h,p):(u=xt(h),u.c(),u.m(o.parentNode,o)):u&&(u.d(1),u=null),h[5].viewSize>=_e.SM?g?g.p(h,p):(g=tl(h),g.c(),g.m(f.parentNode,f)):g&&(g.d(1),g=null)},i:$,o:$,d(h){h&&(T(e),T(a),T(o),T(f)),u&&u.d(h),g&&g.d(h),c=!1,m()}}}function Sr(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,k=>t(5,n=k)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();let{message:o}=e,{canReplyAll:f}=e,c=!1;const m=()=>{t(3,c=!c)},u=()=>{t(3,c=!1)},g=()=>a.setStarred([o.id],!o.starred),h=()=>a.reply(o,!1),p=()=>a.reply(o,!0),b=()=>a.forward(o),S=()=>a.reply(o,!1),w=()=>a.reply(o,!0),y=()=>a.forward(o);return s.$$set=k=>{"store"in k&&i(t(0,a=k.store)),"message"in k&&t(1,o=k.message),"canReplyAll"in k&&t(2,f=k.canReplyAll)},s.$$.update=()=>{s.$$.dirty&2&&t(4,l=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,f,c,l,n,m,u,g,h,p,b,S,w,y]}class Cr extends fe{constructor(e){super(),ue(this,e,Sr,Mr,oe,{store:0,message:1,canReplyAll:2})}}function ll(s,e,t){const l=s.slice();return l[1]=e[t],l}function sl(s){let e,t,l,n,r,i,a=(s[1].filepath+s[1].filename).replace(/^\//,"")+"",o,f,c,m,u=ft(s[1].filesize)+"",g,h;return{c(){e=v("div"),t=v("img"),r=D(),i=v("a"),o=R(a),c=D(),m=v("span"),g=R(u),h=D(),d(t,"aria-hidden","true"),d(t,"alt",l=s[1].filename),je(t.src,n=s[1].iconurl)||d(t,"src",n),d(t,"width","24"),d(t,"height","24"),d(t,"class","mr-2"),d(i,"href",f=s[1].fileurl),d(i,"class","mr-2"),d(m,"class","text-muted"),d(e,"class","mr-5 mb-3")},m(p,b){C(p,e,b),_(e,t),_(e,r),_(e,i),_(i,o),_(e,c),_(e,m),_(m,g),_(e,h)},p(p,b){b&1&&l!==(l=p[1].filename)&&d(t,"alt",l),b&1&&!je(t.src,n=p[1].iconurl)&&d(t,"src",n),b&1&&a!==(a=(p[1].filepath+p[1].filename).replace(/^\//,"")+"")&&E(o,a),b&1&&f!==(f=p[1].fileurl)&&d(i,"href",f),b&1&&u!==(u=ft(p[1].filesize)+"")&&E(g,u)},d(p){p&&T(e)}}}function Tr(s){let e,t=ie(s[0].attachments),l=[];for(let n=0;n<t.length;n+=1)l[n]=sl(ll(s,t,n));return{c(){e=v("div");for(let n=0;n<l.length;n+=1)l[n].c();d(e,"class","d-sm-flex flex-sm-wrap mr-n5 mt-3 mb-n3")},m(n,r){C(n,e,r);for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(e,null)},p(n,[r]){if(r&1){t=ie(n[0].attachments);let i;for(i=0;i<t.length;i+=1){const a=ll(n,t,i);l[i]?l[i].p(a,r):(l[i]=sl(a),l[i].c(),l[i].m(e,null))}for(;i<l.length;i+=1)l[i].d(1);l.length=t.length}},i:$,o:$,d(n){n&&T(e),qe(l,n)}}}function Dr(s,e,t){let{message:l}=e;return s.$$set=n=>{"message"in n&&t(0,l=n.message)},[l]}class Fs extends fe{constructor(e){super(),ue(this,e,Dr,Tr,oe,{message:0})}}function Lr(s){let e,t,l,n=s[3].strings.reply+"",r,i,a,o,f,c=s[3].strings.replyall+"",m,u,g,h,p,b,S=s[3].strings.forward+"",w,y,k;return{c(){e=v("button"),t=v("i"),l=D(),r=R(n),i=D(),a=v("button"),o=v("i"),f=D(),m=R(c),g=D(),h=v("button"),p=v("i"),b=D(),w=R(S),d(t,"class","fa fa-fw fa-reply mr-2"),d(e,"type","button"),d(e,"class","btn btn-primary mr-3 mb-3"),d(o,"class","fa fa-fw fa-reply-all mr-2"),d(a,"type","button"),a.disabled=u=!s[2],d(a,"class","btn mr-3 mb-3"),O(a,"disabled",!s[2]),O(a,"btn-primary",s[2]),O(a,"btn-secondary",!s[2]),d(p,"class","fa fa-fw fa-share mr-2"),d(h,"type","button"),d(h,"class","btn btn-primary mr-3 mb-3")},m(M,z){C(M,e,z),_(e,t),_(e,l),_(e,r),C(M,i,z),C(M,a,z),_(a,o),_(a,f),_(a,m),C(M,g,z),C(M,h,z),_(h,p),_(h,b),_(h,w),y||(k=[I(e,"click",s[4]),I(a,"click",s[5]),I(h,"click",s[6])],y=!0)},p(M,[z]){z&8&&n!==(n=M[3].strings.reply+"")&&E(r,n),z&8&&c!==(c=M[3].strings.replyall+"")&&E(m,c),z&4&&u!==(u=!M[2])&&(a.disabled=u),z&4&&O(a,"disabled",!M[2]),z&4&&O(a,"btn-primary",M[2]),z&4&&O(a,"btn-secondary",!M[2]),z&8&&S!==(S=M[3].strings.forward+"")&&E(w,S)},i:$,o:$,d(M){M&&(T(e),T(i),T(a),T(g),T(h)),y=!1,pe(k)}}}function zr(s,e,t){let l,n=$,r=()=>(n(),n=me(i,u=>t(3,l=u)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{message:a}=e,{canReplyAll:o}=e;const f=()=>i.reply(a,!1),c=()=>i.reply(a,!0),m=()=>i.forward(a);return s.$$set=u=>{"store"in u&&r(t(0,i=u.store)),"message"in u&&t(1,a=u.message),"canReplyAll"in u&&t(2,o=u.canReplyAll)},[i,a,o,l,f,c,m]}class Ar extends fe{constructor(e){super(),ue(this,e,zr,Lr,oe,{store:0,message:1,canReplyAll:2})}}function nl(s,e,t){const l=s.slice();return l[3]=e[t],l}function rl(s){let e,t;return e=new it({props:{course:s[1].course,settings:s[2].settings}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&2&&(r.course=l[1].course),n&4&&(r.settings=l[2].settings),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function il(s,e){let t,l,n;return l=new Es({props:{label:e[3]}}),{key:s,first:null,c(){t=de(),J(l.$$.fragment),this.first=t},m(r,i){C(r,t,i),W(l,r,i),n=!0},p(r,i){e=r;const a={};i&2&&(a.label=e[3]),l.$set(a)},i(r){n||(A(l.$$.fragment,r),n=!0)},o(r){N(l.$$.fragment,r),n=!1},d(r){r&&T(t),X(l,r)}}}function jr(s){let e,t=[],l=new Map,n,r,i=s[1].course.id!=s[2].params.courseid&&rl(s),a=ie(s[1].labels);const o=f=>f[3].id;for(let f=0;f<a.length;f+=1){let c=nl(s,a,f),m=o(c);l.set(m,t[f]=il(m,c))}return{c(){i&&i.c(),e=D();for(let f=0;f<t.length;f+=1)t[f].c();n=de()},m(f,c){i&&i.m(f,c),C(f,e,c);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(f,c);C(f,n,c),r=!0},p(f,[c]){f[1].course.id!=f[2].params.courseid?i?(i.p(f,c),c&6&&A(i,1)):(i=rl(f),i.c(),A(i,1),i.m(e.parentNode,e)):i&&(ne(),N(i,1,1,()=>{i=null}),re()),c&2&&(a=ie(f[1].labels),ne(),t=Me(t,c,o,1,f,a,l,n.parentNode,Ye,il,n,nl),re())},i(f){if(!r){A(i);for(let c=0;c<a.length;c+=1)A(t[c]);r=!0}},o(f){N(i);for(let c=0;c<t.length;c+=1)N(t[c]);r=!1},d(f){f&&(T(e),T(n)),i&&i.d(f);for(let c=0;c<t.length;c+=1)t[c].d(f)}}}function Nr(s,e,t){let l,n=$,r=()=>(n(),n=me(i,o=>t(2,l=o)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{message:a}=e;return s.$$set=o=>{"store"in o&&r(t(0,i=o.store)),"message"in o&&t(1,a=o.message)},[i,a,l]}class Br extends fe{constructor(e){super(),ue(this,e,Nr,jr,oe,{store:0,message:1})}}function al(s){let e,t,l,n;return l=new Fs({props:{message:s[0]}}),{c(){e=v("hr"),t=D(),J(l.$$.fragment)},m(r,i){C(r,e,i),C(r,t,i),W(l,r,i),n=!0},p(r,i){const a={};i&1&&(a.message=r[0]),l.$set(a)},i(r){n||(A(l.$$.fragment,r),n=!0)},o(r){N(l.$$.fragment,r),n=!1},d(r){r&&(T(e),T(t)),X(l,r)}}}function Rr(s){let e,t,l,n=s[0].subject+"",r,i,a,o,f,c,m,u,g,h,p,b=s[0].sender.fullname+"",S,w,y,k,M=s[0].fulltime+"",z,L,j,F,V,Q=s[0].content+"",ee,te,B=s[0].attachments.length>0&&al(s);return{c(){e=v("div"),t=v("div"),l=v("h5"),r=R(n),i=D(),a=v("div"),o=v("div"),f=v("div"),c=v("img"),g=D(),h=v("div"),p=v("a"),S=R(b),y=D(),k=v("div"),z=R(M),L=D(),j=v("hr"),F=D(),V=v("div"),ee=D(),B&&B.c(),d(l,"class","h5 card-title mb-3"),d(c,"aria-hidden","true"),d(c,"alt",m=s[0].sender.fullname),je(c.src,u=s[0].sender.pictureurl)||d(c,"src",u),d(c,"width","35"),d(c,"height","35"),d(c,"class","rounded-circle"),d(f,"class","mr-3"),d(p,"href",w=s[0].sender.profileurl),d(h,"class","mt-1"),d(o,"class","d-flex mb-3 mb-sm-0"),d(k,"class","mt-1 ml-auto"),d(a,"class","d-sm-flex mb-n1"),d(V,"class","local-mail-message-reference-content svelte-nahnfm"),d(t,"class","card-body p-3 px-xl-4"),d(e,"class","card mb-4")},m(x,Z){C(x,e,Z),_(e,t),_(t,l),_(l,r),_(t,i),_(t,a),_(a,o),_(o,f),_(f,c),_(o,g),_(o,h),_(h,p),_(p,S),_(a,y),_(a,k),_(k,z),_(t,L),_(t,j),_(t,F),_(t,V),V.innerHTML=Q,_(t,ee),B&&B.m(t,null),te=!0},p(x,[Z]){(!te||Z&1)&&n!==(n=x[0].subject+"")&&E(r,n),(!te||Z&1&&m!==(m=x[0].sender.fullname))&&d(c,"alt",m),(!te||Z&1&&!je(c.src,u=x[0].sender.pictureurl))&&d(c,"src",u),(!te||Z&1)&&b!==(b=x[0].sender.fullname+"")&&E(S,b),(!te||Z&1&&w!==(w=x[0].sender.profileurl))&&d(p,"href",w),(!te||Z&1)&&M!==(M=x[0].fulltime+"")&&E(z,M),(!te||Z&1)&&Q!==(Q=x[0].content+"")&&(V.innerHTML=Q),x[0].attachments.length>0?B?(B.p(x,Z),Z&1&&A(B,1)):(B=al(x),B.c(),A(B,1),B.m(t,null)):B&&(ne(),N(B,1,1,()=>{B=null}),re())},i(x){te||(A(B),te=!0)},o(x){N(B),te=!1},d(x){x&&T(e),B&&B.d()}}}function Er(s,e,t){let{reference:l}=e;return s.$$set=n=>{"reference"in n&&t(0,l=n.reference)},[l]}class Ps extends fe{constructor(e){super(),ue(this,e,Er,Rr,oe,{reference:0})}}function ol(s,e,t){const l=s.slice();return l[4]=e[t],l}function fl(s,e,t){const l=s.slice();return l[7]=e[t],l[9]=t,l}function ul(s){let e,t,l=s[3].strings[s[4]]+"",n,r,i,a=[],o=new Map,f,c=ie(s[2](s[4]));const m=u=>u[7].id;for(let u=0;u<c.length;u+=1){let g=fl(s,c,u),h=m(g);o.set(h,a[u]=ml(h,g))}return{c(){e=v("div"),t=v("span"),n=R(l),r=R(":"),i=D();for(let u=0;u<a.length;u+=1)a[u].c();f=D(),d(e,"class","mb-2")},m(u,g){C(u,e,g),_(e,t),_(t,n),_(t,r),_(e,i);for(let h=0;h<a.length;h+=1)a[h]&&a[h].m(e,null);_(e,f)},p(u,g){g&8&&l!==(l=u[3].strings[u[4]]+"")&&E(n,l),g&4&&(c=ie(u[2](u[4])),a=Me(a,g,m,1,u,c,o,e,Ie,ml,f,fl))},d(u){u&&T(e);for(let g=0;g<a.length;g+=1)a[g].d()}}}function cl(s){let e;return{c(){e=R(",")},m(t,l){C(t,e,l)},d(t){t&&T(e)}}}function ml(s,e){let t,l,n,r=e[7].fullname+"",i,a,o=e[9]>0&&cl();return{key:s,first:null,c(){t=de(),o&&o.c(),l=D(),n=v("a"),i=R(r),d(n,"href",a=e[7].profileurl),this.first=t},m(f,c){C(f,t,c),o&&o.m(f,c),C(f,l,c),C(f,n,c),_(n,i)},p(f,c){e=f,e[9]>0?o||(o=cl(),o.c(),o.m(l.parentNode,l)):o&&(o.d(1),o=null),c&4&&r!==(r=e[7].fullname+"")&&E(i,r),c&4&&a!==(a=e[7].profileurl)&&d(n,"href",a)},d(f){f&&(T(t),T(l),T(n)),o&&o.d(f)}}}function dl(s){let e=s[2](s[4]).length>0,t,l=e&&ul(s);return{c(){l&&l.c(),t=de()},m(n,r){l&&l.m(n,r),C(n,t,r)},p(n,r){r&4&&(e=n[2](n[4]).length>0),e?l?l.p(n,r):(l=ul(n),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},d(n){n&&T(t),l&&l.d(n)}}}function qr(s){let e,t,l,n,r,i,a,o,f,c=s[1].sender.fullname+"",m,u,g,h=ie(Object.values(ze)),p=[];for(let b=0;b<h.length;b+=1)p[b]=dl(ol(s,h,b));return{c(){e=v("div"),t=v("div"),l=v("img"),i=D(),a=v("div"),o=v("div"),f=v("a"),m=R(c),g=D();for(let b=0;b<p.length;b+=1)p[b].c();d(l,"aria-hidden","true"),d(l,"alt",n=s[1].sender.fullname),je(l.src,r=s[1].sender.pictureurl)||d(l,"src",r),d(l,"width","35"),d(l,"height","35"),d(l,"class","rounded-circle"),d(t,"class","mr-3"),d(f,"href",u=s[1].sender.profileurl),d(o,"class","mt-1 mb-2"),d(a,"class","d-flex flex-column"),d(e,"class","local-mail-message-users d-flex mb-n2")},m(b,S){C(b,e,S),_(e,t),_(t,l),_(e,i),_(e,a),_(a,o),_(o,f),_(f,m),_(a,g);for(let w=0;w<p.length;w+=1)p[w]&&p[w].m(a,null)},p(b,[S]){if(S&2&&n!==(n=b[1].sender.fullname)&&d(l,"alt",n),S&2&&!je(l.src,r=b[1].sender.pictureurl)&&d(l,"src",r),S&2&&c!==(c=b[1].sender.fullname+"")&&E(m,c),S&2&&u!==(u=b[1].sender.profileurl)&&d(f,"href",u),S&12){h=ie(Object.values(ze));let w;for(w=0;w<h.length;w+=1){const y=ol(b,h,w);p[w]?p[w].p(y,S):(p[w]=dl(y),p[w].c(),p[w].m(a,null))}for(;w<p.length;w+=1)p[w].d(1);p.length=h.length}},i:$,o:$,d(b){b&&T(e),qe(p,b)}}}function Ir(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,f=>t(3,n=f)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();let{message:o}=e;return s.$$set=f=>{"store"in f&&i(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},s.$$.update=()=>{s.$$.dirty&2&&t(2,l=f=>o.recipients.filter(c=>c.type==f))},[a,o,l,n]}class $r extends fe{constructor(e){super(),ue(this,e,Ir,qr,oe,{store:0,message:1})}}function _l(s,e,t){const l=s.slice();return l[4]=e[t],l}function gl(s){let e,t,l,n;return l=new Fs({props:{message:s[1]}}),{c(){e=v("hr"),t=D(),J(l.$$.fragment)},m(r,i){C(r,e,i),C(r,t,i),W(l,r,i),n=!0},p(r,i){const a={};i&2&&(a.message=r[1]),l.$set(a)},i(r){n||(A(l.$$.fragment,r),n=!0)},o(r){N(l.$$.fragment,r),n=!1},d(r){r&&(T(e),T(t)),X(l,r)}}}function pl(s){let e,t=s[2].strings.references+"",l,n,r=[],i=new Map,a,o,f=ie(s[1].references);const c=m=>m[4].id;for(let m=0;m<f.length;m+=1){let u=_l(s,f,m),g=c(u);i.set(g,r[m]=bl(g,u))}return{c(){e=v("div"),l=R(t),n=D();for(let m=0;m<r.length;m+=1)r[m].c();a=de(),d(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(m,u){C(m,e,u),_(e,l),C(m,n,u);for(let g=0;g<r.length;g+=1)r[g]&&r[g].m(m,u);C(m,a,u),o=!0},p(m,u){(!o||u&4)&&t!==(t=m[2].strings.references+"")&&E(l,t),u&2&&(f=ie(m[1].references),ne(),r=Me(r,u,c,1,m,f,i,a.parentNode,Ye,bl,a,_l),re())},i(m){if(!o){for(let u=0;u<f.length;u+=1)A(r[u]);o=!0}},o(m){for(let u=0;u<r.length;u+=1)N(r[u]);o=!1},d(m){m&&(T(e),T(n),T(a));for(let u=0;u<r.length;u+=1)r[u].d(m)}}}function bl(s,e){let t,l,n;return l=new Ps({props:{reference:e[4]}}),{key:s,first:null,c(){t=de(),J(l.$$.fragment),this.first=t},m(r,i){C(r,t,i),W(l,r,i),n=!0},p(r,i){e=r;const a={};i&2&&(a.reference=e[4]),l.$set(a)},i(r){n||(A(l.$$.fragment,r),n=!0)},o(r){N(l.$$.fragment,r),n=!1},d(r){r&&T(t),X(l,r)}}}function Fr(s){let e,t,l,n=s[1].subject+"",r,i,a,o,f,c,m,u,g=s[1].fulltime+"",h,p,b,S,w,y,k,M,z,L,j=s[1].content+"",F,V,Q,ee,te,B,x,Z,le;f=new Br({props:{store:s[0],message:s[1]}}),S=new Cr({props:{store:s[0],message:s[1],canReplyAll:s[3]}}),y=new $r({props:{store:s[0],message:s[1]}});let q=s[1].attachments.length>0&&gl(s);B=new Ar({props:{store:s[0],message:s[1],canReplyAll:s[3]}});let K=s[1].references.length>0&&pl(s);return{c(){e=v("div"),t=v("div"),l=v("h3"),r=R(n),i=D(),a=v("div"),o=v("div"),J(f.$$.fragment),c=D(),m=v("div"),u=v("div"),h=R(g),p=D(),b=v("div"),J(S.$$.fragment),w=D(),J(y.$$.fragment),k=D(),M=v("hr"),z=D(),L=v("div"),F=D(),q&&q.c(),V=D(),Q=v("hr"),ee=D(),te=v("div"),J(B.$$.fragment),x=D(),K&&K.c(),Z=de(),d(l,"class","h4 card-title mb-3 mb-md-2"),d(o,"class","d-flex flex-wrap mx-n2 mt-2"),se(o,"min-width","0"),d(u,"class","my-2 text-truncate"),d(b,"class","d-flex flex-shrink-0 ml-3 mr-n2"),d(m,"class","d-flex justify-content-between flex-shrink-0 ml-auto"),d(a,"class","d-md-flex align-items-start mb-2"),d(L,"class","local-mail-message-content svelte-18ecame"),d(te,"class","mt-3 d-flex mr-n3 mb-n3 flex-column flex-sm-row justify-content-end"),d(t,"class","card-body p-3 px-xl-4"),d(e,"class","card")},m(U,Y){C(U,e,Y),_(e,t),_(t,l),_(l,r),_(t,i),_(t,a),_(a,o),W(f,o,null),_(a,c),_(a,m),_(m,u),_(u,h),_(m,p),_(m,b),W(S,b,null),_(t,w),W(y,t,null),_(t,k),_(t,M),_(t,z),_(t,L),L.innerHTML=j,_(t,F),q&&q.m(t,null),_(t,V),_(t,Q),_(t,ee),_(t,te),W(B,te,null),C(U,x,Y),K&&K.m(U,Y),C(U,Z,Y),le=!0},p(U,[Y]){(!le||Y&2)&&n!==(n=U[1].subject+"")&&E(r,n);const ce={};Y&1&&(ce.store=U[0]),Y&2&&(ce.message=U[1]),f.$set(ce),(!le||Y&2)&&g!==(g=U[1].fulltime+"")&&E(h,g);const ge={};Y&1&&(ge.store=U[0]),Y&2&&(ge.message=U[1]),Y&8&&(ge.canReplyAll=U[3]),S.$set(ge);const P={};Y&1&&(P.store=U[0]),Y&2&&(P.message=U[1]),y.$set(P),(!le||Y&2)&&j!==(j=U[1].content+"")&&(L.innerHTML=j),U[1].attachments.length>0?q?(q.p(U,Y),Y&2&&A(q,1)):(q=gl(U),q.c(),A(q,1),q.m(t,V)):q&&(ne(),N(q,1,1,()=>{q=null}),re());const G={};Y&1&&(G.store=U[0]),Y&2&&(G.message=U[1]),Y&8&&(G.canReplyAll=U[3]),B.$set(G),U[1].references.length>0?K?(K.p(U,Y),Y&2&&A(K,1)):(K=pl(U),K.c(),A(K,1),K.m(Z.parentNode,Z)):K&&(ne(),N(K,1,1,()=>{K=null}),re())},i(U){le||(A(f.$$.fragment,U),A(S.$$.fragment,U),A(y.$$.fragment,U),A(q),A(B.$$.fragment,U),A(K),le=!0)},o(U){N(f.$$.fragment,U),N(S.$$.fragment,U),N(y.$$.fragment,U),N(q),N(B.$$.fragment,U),N(K),le=!1},d(U){U&&(T(e),T(x),T(Z)),X(f),X(S),X(y),q&&q.d(),X(B),K&&K.d(U)}}}function Pr(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,f=>t(2,n=f)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();let{message:o}=e;return s.$$set=f=>{"store"in f&&i(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},s.$$.update=()=>{s.$$.dirty&6&&t(3,l=o.sender.id==n.userid?o.recipients.filter(f=>f.type=="cc").length>0:o.recipients.filter(f=>["to","cc"].includes(f.type)&&f.id!=n.userid).length>0)},[a,o,n,l]}class Or extends fe{constructor(e){super(),ue(this,e,Pr,Fr,oe,{store:0,message:1})}}function hl(s,e,t){const l=s.slice();return l[29]=e[t],l}function Ur(s){var a;let e,t=((a=s[11])==null?void 0:a[s[8]])+"",l,n,r,i;return{c(){e=v("button"),l=R(t),d(e,"type","button"),d(e,"class","form-control px-5 text-left"),O(e,"alert-primary",s[4])},m(o,f){var c;C(o,e,f),_(e,l),r||(i=[ve(n=Ae.call(null,e,((c=s[11])==null?void 0:c[s[8]])||"")),I(e,"click",s[17])],r=!0)},p(o,f){var c,m;f[0]&2304&&t!==(t=((c=o[11])==null?void 0:c[o[8]])+"")&&E(l,t),n&&ke(n.update)&&f[0]&2304&&n.update.call(null,((m=o[11])==null?void 0:m[o[8]])||""),f[0]&16&&O(e,"alert-primary",o[4])},d(o){o&&T(e),r=!1,pe(i)}}}function Hr(s){let e,t,l;return{c(){e=v("input"),d(e,"type","text"),d(e,"class","form-control px-5 text-truncate"),d(e,"placeholder",s[1]),d(e,"aria-label",s[1])},m(n,r){C(n,e,r),be(e,s[6]),s[25](e),t||(l=[I(e,"input",s[24]),I(e,"focus",s[15]),I(e,"keyup",s[20])],t=!0)},p(n,r){r[0]&2&&d(e,"placeholder",n[1]),r[0]&2&&d(e,"aria-label",n[1]),r[0]&64&&e.value!==n[6]&&be(e,n[6])},d(n){n&&T(e),s[25](null),t=!1,pe(l)}}}function Gr(s){var a;let e,t=((a=s[11])==null?void 0:a[s[8]])+"",l,n,r,i;return{c(){e=v("div"),l=R(t),d(e,"class","alert-secondary form-control pl-5 pr-2 text-left")},m(o,f){var c;C(o,e,f),_(e,l),r||(i=ve(n=Ae.call(null,e,((c=s[11])==null?void 0:c[s[8]])||"")),r=!0)},p(o,f){var c,m;f[0]&2304&&t!==(t=((c=o[11])==null?void 0:c[o[8]])+"")&&E(l,t),n&&ke(n.update)&&f[0]&2304&&n.update.call(null,((m=o[11])==null?void 0:m[o[8]])||"")},d(o){o&&T(e),r=!1,i()}}}function vl(s){let e,t,l,n,r,i=s[9].strings.togglefilterresults+"",a,o,f,c;return{c(){e=v("button"),t=v("i"),n=D(),r=v("span"),a=R(i),o=R("n"),d(t,"class",l="fa fa-fw "+s[13]+" svelte-ept5ag"),d(t,"aria-hidden","true"),d(r,"class","sr-only"),d(e,"type","button"),d(e,"aria-expanded",s[7]),d(e,"class","btn position-absolute h-100 d-flex align-items-center px-2"),se(e,"top","0"),se(e,"right","0")},m(m,u){C(m,e,u),_(e,t),_(e,n),_(e,r),_(r,a),_(r,o),f||(c=I(e,"click",s[17]),f=!0)},p(m,u){u[0]&8192&&l!==(l="fa fa-fw "+m[13]+" svelte-ept5ag")&&d(t,"class",l),u[0]&512&&i!==(i=m[9].strings.togglefilterresults+"")&&E(a,i),u[0]&128&&d(e,"aria-expanded",m[7])},d(m){m&&T(e),f=!1,c()}}}function kl(s){let e,t,l=[],n=new Map,r,i=!s[2]&&wl(s),a=ie(s[14]);const o=c=>c[29].id;for(let c=0;c<a.length;c+=1){let m=hl(s,a,c),u=o(m);n.set(u,l[c]=Ml(u,m))}let f=null;return a.length||(f=yl(s)),{c(){e=v("div"),i&&i.c(),t=D();for(let c=0;c<l.length;c+=1)l[c].c();f&&f.c(),d(e,"class",r="dropdown-menu dropdown-menu-"+s[5]+" show svelte-ept5ag")},m(c,m){C(c,e,m),i&&i.m(e,null),_(e,t);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);f&&f.m(e,null)},p(c,m){c[2]?i&&(i.d(1),i=null):i?i.p(c,m):(i=wl(c),i.c(),i.m(e,t)),m[0]&545280&&(a=ie(c[14]),l=Me(l,m,o,1,c,a,n,e,Ie,Ml,null,hl),!a.length&&f?f.p(c,m):a.length?f&&(f.d(1),f=null):(f=yl(c),f.c(),f.m(e,null))),m[0]&32&&r!==(r="dropdown-menu dropdown-menu-"+c[5]+" show svelte-ept5ag")&&d(e,"class",r)},d(c){c&&T(e),i&&i.d();for(let m=0;m<l.length;m+=1)l[m].d();f&&f.d()}}}function wl(s){let e,t=s[9].strings.allcourses+"",l,n,r,i,a;return{c(){e=v("button"),l=R(t),n=D(),r=v("div"),d(e,"type","button"),d(e,"class","dropdown-item text-truncate svelte-ept5ag"),d(r,"class","dropdown-divider")},m(o,f){C(o,e,f),_(e,l),C(o,n,f),C(o,r,f),i||(a=I(e,"click",s[26]),i=!0)},p(o,f){f[0]&512&&t!==(t=o[9].strings.allcourses+"")&&E(l,t)},d(o){o&&(T(e),T(n),T(r)),i=!1,a()}}}function yl(s){let e,t=s[9].strings.emptycoursefilterresults+"",l,n;return{c(){e=v("div"),l=R(t),n=D(),d(e,"class","px-4 text-danger")},m(r,i){C(r,e,i),_(e,l),_(e,n)},p(r,i){i[0]&512&&t!==(t=r[9].strings.emptycoursefilterresults+"")&&E(l,t)},d(r){r&&T(e)}}}function Ml(s,e){let t,l,n=e[12](e[29])+"",r,i,a;function o(){return e[27](e[29])}return{key:s,first:null,c(){t=v("button"),l=new tn(!1),r=D(),l.a=r,d(t,"type","button"),d(t,"class","dropdown-item text-truncate svelte-ept5ag"),this.first=t},m(f,c){C(f,t,c),l.m(n,t),_(t,r),i||(a=I(t,"click",o),i=!0)},p(f,c){e=f,c[0]&20480&&n!==(n=e[12](e[29])+"")&&l.p(n)},d(f){f&&T(t),i=!1,a()}}}function Kr(s){let e,t,l,n,r,i,a;function o(g,h){return g[3]?Gr:g[7]||!g[11]?Hr:Ur}let f=o(s),c=f(s),m=!s[3]&&vl(s),u=s[7]&&kl(s);return{c(){e=v("div"),t=v("div"),t.innerHTML='<i class="fa fa-fw fa-filter" aria-hidden="true"></i>',l=D(),c.c(),n=D(),m&&m.c(),r=D(),u&&u.c(),d(t,"class","position-absolute h-100 d-flex align-items-center px-2"),se(t,"top","0"),se(t,"left","0"),d(e,"class","local-mail-course-select position-relative d-flex svelte-ept5ag")},m(g,h){C(g,e,h),_(e,t),_(e,l),c.m(e,null),_(e,n),m&&m.m(e,null),_(e,r),u&&u.m(e,null),i||(a=ve(Ee.call(null,e,s[16])),i=!0)},p(g,h){f===(f=o(g))&&c?c.p(g,h):(c.d(1),c=f(g),c&&(c.c(),c.m(e,n))),g[3]?m&&(m.d(1),m=null):m?m.p(g,h):(m=vl(g),m.c(),m.m(e,r)),g[7]?u?u.p(g,h):(u=kl(g),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i:$,o:$,d(g){g&&T(e),c.d(),m&&m.d(),u&&u.d(),i=!1,a()}}}function Vr(s,e,t){let l,n,r,i,a,o=$,f=()=>(o(),o=me(c,q=>t(9,a=q)),c);s.$$.on_destroy.push(()=>o());let{store:c}=e;f();let{label:m}=e,{selected:u}=e,{required:g=!1}=e,{readonly:h=!1}=e,{primary:p=!1}=e,{align:b="left"}=e,{onChange:S}=e,w,y="",k=!1,M,z;const L=q=>q.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&"),j=async()=>{t(7,k=!0),t(6,y=""),await Oe(),w.focus()},F=()=>{t(7,k=!1),t(6,y="")},V=async()=>{k?F():j()},Q=async()=>{await S(),t(21,u=void 0),t(7,k=!1),t(6,y="")},ee=async q=>{await S(q.id),t(21,u=q.id),t(7,k=!1),t(6,y="")},te=q=>{q.key=="Escape"&&(t(7,k=!1),t(6,y=""),w.blur())};function B(){y=this.value,t(6,y)}function x(q){we[q?"unshift":"push"](()=>{w=q,t(10,w)})}const Z=()=>Q(),le=q=>ee(q);return s.$$set=q=>{"store"in q&&f(t(0,c=q.store)),"label"in q&&t(1,m=q.label),"selected"in q&&t(21,u=q.selected),"required"in q&&t(2,g=q.required),"readonly"in q&&t(3,h=q.readonly),"primary"in q&&t(4,p=q.primary),"align"in q&&t(5,b=q.align),"onChange"in q&&t(22,S=q.onChange)},s.$$.update=()=>{s.$$.dirty[0]&512&&t(8,z=a.settings.filterbycourse=="shortname"?"shortname":"fullname"),s.$$.dirty[0]&2097664&&t(11,M=a.courses.find(q=>q.id==u)),s.$$.dirty[0]&64&&t(23,l=new RegExp(L(y.trim()).replaceAll(/\s+/gu,"\\s+"),"giu")),s.$$.dirty[0]&8389376&&t(14,n=a.courses.filter(q=>q[z].match(l))),s.$$.dirty[0]&192&&t(13,r=k?y?"fa-times":"fa-caret-up":"fa-caret-down"),s.$$.dirty[0]&8388864&&t(12,i=q=>q[z].replaceAll(l,K=>K.trim()?"<mark>"+K+"</mark>":K))},[c,m,g,h,p,b,y,k,z,a,w,M,i,r,n,j,F,V,Q,ee,te,u,S,l,B,x,Z,le]}class Os extends fe{constructor(e){super(),ue(this,e,Vr,Kr,oe,{store:0,label:1,selected:21,required:2,readonly:3,primary:4,align:5,onChange:22},null,[-1,-1])}}function Sl(s,e,t){const l=s.slice();l[6]=e[t];const n=Array.from(l[1].values()).filter(function(...i){return s[5](l[6],...i)});return l[7]=n,l}function Cl(s,e,t){const l=s.slice();return l[10]=e[t],l}function Tl(s){let e,t,l=s[3].strings[s[6]]+"",n,r,i,a,o=[],f=new Map,c,m,u,g=ie(s[7]);const h=p=>p[10].id;for(let p=0;p<g.length;p+=1){let b=Cl(s,g,p),S=h(b);f.set(S,o[p]=Dl(S,b))}return{c(){e=v("div"),t=v("div"),n=R(l),r=R(":"),i=D(),a=v("div");for(let p=0;p<o.length;p+=1)o[p].c();c=D(),d(t,"class","local-mail-message-form-recipients-type flex-grow-0 flex-shrink-0 py-2 mr-2 svelte-1uaipzj"),d(a,"class","d-flex flex-wrap"),se(a,"min-width","0"),d(e,"class","d-flex mb-2")},m(p,b){C(p,e,b),_(e,t),_(t,n),_(t,r),_(e,i),_(e,a);for(let S=0;S<o.length;S+=1)o[S]&&o[S].m(a,null);_(e,c),u=!0},p(p,b){(!u||b&8)&&l!==(l=p[3].strings[p[6]]+"")&&E(n,l),b&14&&(g=ie(p[7]),ne(),o=Me(o,b,h,1,p,g,f,a,Ye,Dl,null,Cl),re())},i(p){if(!u){for(let b=0;b<g.length;b+=1)A(o[b]);p&&De(()=>{u&&(m||(m=Be(e,Ne,{},!0)),m.run(1))}),u=!0}},o(p){for(let b=0;b<o.length;b+=1)N(o[b]);p&&(m||(m=Be(e,Ne,{},!1)),m.run(0)),u=!1},d(p){p&&T(e);for(let b=0;b<o.length;b+=1)o[b].d();p&&m&&m.end()}}}function Yr(s){let e,t,l;return{c(){e=v("div"),t=v("i"),d(t,"class","fa fa-exclamation-circle"),d(e,"class","m-0 d-flex justify-content-center align-items-center"),se(e,"width","35px"),se(e,"height","35px"),d(e,"title",l=s[3].strings.cannotsendmailtouser)},m(n,r){C(n,e,r),_(e,t)},p(n,r){r&8&&l!==(l=n[3].strings.cannotsendmailtouser)&&d(e,"title",l)},d(n){n&&T(e)}}}function Jr(s){let e,t,l;return{c(){e=v("img"),d(e,"aria-hidden","true"),d(e,"alt",t=s[10].fullname),je(e.src,l=s[10].pictureurl)||d(e,"src",l),d(e,"width","35"),d(e,"height","35"),d(e,"class","rounded-circle")},m(n,r){C(n,e,r)},p(n,r){r&2&&t!==(t=n[10].fullname)&&d(e,"alt",t),r&2&&!je(e.src,l=n[10].pictureurl)&&d(e,"src",l)},d(n){n&&T(e)}}}function Dl(s,e){let t,l,n,r,i=e[10].fullname+"",a,o,f,c,m,u,g,h,p,b,S,w;function y(L,j){return L[10].isvalid?Jr:Yr}let k=y(e),M=k(e);function z(){return e[4](e[10])}return{key:s,first:null,c(){t=v("div"),l=v("div"),M.c(),n=D(),r=v("div"),a=R(i),f=D(),c=v("button"),m=v("i"),g=D(),d(l,"class","d-flex m-1 mr-2"),d(r,"class","py-2"),d(m,"class","fa fa-fw fa-times"),d(c,"type","button"),d(c,"class","btn align-self-middle p-2 align-bottom svelte-1uaipzj"),d(c,"title",u=e[3].strings.delete),d(t,"class","local-mail-message-form-recipients-user d-flex flex-shrink align-items-center mr-2 mb-2 svelte-1uaipzj"),O(t,"alert-danger",!e[10].isvalid),this.first=t},m(L,j){C(L,t,j),_(t,l),M.m(l,null),_(t,n),_(t,r),_(r,a),_(t,f),_(t,c),_(c,m),_(t,g),b=!0,S||(w=[ve(o=Ae.call(null,r,e[10].fullname)),I(c,"click",z),ve(h=Ae.call(null,t,e[10].fullname))],S=!0)},p(L,j){e=L,k===(k=y(e))&&M?M.p(e,j):(M.d(1),M=k(e),M&&(M.c(),M.m(l,null))),(!b||j&2)&&i!==(i=e[10].fullname+"")&&E(a,i),o&&ke(o.update)&&j&2&&o.update.call(null,e[10].fullname),(!b||j&8&&u!==(u=e[3].strings.delete))&&d(c,"title",u),h&&ke(h.update)&&j&2&&h.update.call(null,e[10].fullname),(!b||j&2)&&O(t,"alert-danger",!e[10].isvalid)},i(L){b||(L&&De(()=>{b&&(p||(p=Be(t,Ne,{},!0)),p.run(1))}),b=!0)},o(L){L&&(p||(p=Be(t,Ne,{},!1)),p.run(0)),b=!1},d(L){L&&T(t),M.d(),L&&p&&p.end(),S=!1,pe(w)}}}function Ll(s){let e,t,l=s[7].length&&Tl(s);return{c(){l&&l.c(),e=de()},m(n,r){l&&l.m(n,r),C(n,e,r),t=!0},p(n,r){n[7].length?l?(l.p(n,r),r&2&&A(l,1)):(l=Tl(n),l.c(),A(l,1),l.m(e.parentNode,e)):l&&(ne(),N(l,1,1,()=>{l=null}),re())},i(n){t||(A(l),t=!0)},o(n){N(l),t=!1},d(n){n&&T(e),l&&l.d(n)}}}function Wr(s){let e,t,l=ie(Object.values(ze)),n=[];for(let i=0;i<l.length;i+=1)n[i]=Ll(Sl(s,l,i));const r=i=>N(n[i],1,1,()=>{n[i]=null});return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=de()},m(i,a){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(i,a);C(i,e,a),t=!0},p(i,[a]){if(a&14){l=ie(Object.values(ze));let o;for(o=0;o<l.length;o+=1){const f=Sl(i,l,o);n[o]?(n[o].p(f,a),A(n[o],1)):(n[o]=Ll(f),n[o].c(),A(n[o],1),n[o].m(e.parentNode,e))}for(ne(),o=l.length;o<n.length;o+=1)r(o);re()}},i(i){if(!t){for(let a=0;a<l.length;a+=1)A(n[a]);t=!0}},o(i){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)N(n[a]);t=!1},d(i){i&&T(e),qe(n,i)}}}function Xr(s,e,t){let l,n=$,r=()=>(n(),n=me(i,m=>t(3,l=m)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{recipients:a}=e,{onDelete:o}=e;const f=m=>o(m),c=(m,u)=>u.type==m;return s.$$set=m=>{"store"in m&&r(t(0,i=m.store)),"recipients"in m&&t(1,a=m.recipients),"onDelete"in m&&t(2,o=m.onDelete)},[i,a,o,l,f,c]}class Qr extends fe{constructor(e){super(),ue(this,e,Xr,Wr,oe,{store:0,recipients:1,onDelete:2})}}function zl(s,e,t){var r;const l=s.slice();l[30]=e[t];const n=(r=l[1].get(l[30].id))==null?void 0:r.type;return l[31]=n,l}function Al(s,e,t){const l=s.slice();return l[34]=e[t],l}function jl(s,e,t){const l=s.slice();l[34]=e[t];const n=l[9].every(function(...i){return s[27](l[34],...i)});return l[37]=n,l}function Nl(s,e,t){const l=s.slice();return l[40]=e[t],l}function Bl(s,e,t){const l=s.slice();return l[43]=e[t],l}function Rl(s){let e,t,l,n,r,i=s[13].strings.allroles+"",a,o=[],f=new Map,c,m,u,g,h=ie(s[7]);const p=k=>k[43].id;for(let k=0;k<h.length;k+=1){let M=Bl(s,h,k),z=p(M);f.set(z,o[k]=El(z,M))}let b=s[8].length&&ql(s);function S(k,M){return k[9].length?k[10]?xr:Zr:ei}let w=S(s),y=w(s);return{c(){e=v("div"),t=v("div"),l=v("div"),n=v("select"),r=v("option"),a=R(i);for(let k=0;k<o.length;k+=1)o[k].c();c=D(),b&&b.c(),m=D(),y.c(),r.__value=0,be(r,r.__value),d(n,"class","form-control text-truncate"),s[11]===void 0&&De(()=>s[22].call(n)),d(l,"class","flex-grow-1 mx-2 mb-2 mb-sm-0"),d(t,"class","list-group-item d-sm-flex px-2 py-2"),d(e,"class","local-mail-message-form-search-users-dropdown dropdown-menu dropdown-menu-left list-group show p-0 w-100 svelte-vi3u1k"),se(e,"min-width","18rem")},m(k,M){C(k,e,M),_(e,t),_(t,l),_(l,n),_(n,r),_(r,a);for(let z=0;z<o.length;z+=1)o[z]&&o[z].m(n,null);He(n,s[11],!0),_(t,c),b&&b.m(t,null),_(e,m),y.m(e,null),u||(g=[I(n,"change",s[22]),I(n,"change",s[23])],u=!0)},p(k,M){M[0]&8192&&i!==(i=k[13].strings.allroles+"")&&E(a,i),M[0]&128&&(h=ie(k[7]),o=Me(o,M,p,1,k,h,f,n,Ie,El,null,Bl)),M[0]&2176&&He(n,k[11]),k[8].length?b?b.p(k,M):(b=ql(k),b.c(),b.m(t,null)):b&&(b.d(1),b=null),w===(w=S(k))&&y?y.p(k,M):(y.d(1),y=w(k),y&&(y.c(),y.m(e,null)))},d(k){k&&T(e);for(let M=0;M<o.length;M+=1)o[M].d();b&&b.d(),y.d(),u=!1,pe(g)}}}function El(s,e){let t,l=e[43].name+"",n,r,i;return{key:s,first:null,c(){t=v("option"),n=R(l),r=D(),t.__value=i=e[43].id,be(t,t.__value),this.first=t},m(a,o){C(a,t,o),_(t,n),_(t,r)},p(a,o){e=a,o[0]&128&&l!==(l=e[43].name+"")&&E(n,l),o[0]&128&&i!==(i=e[43].id)&&(t.__value=i,be(t,t.__value))},d(a){a&&T(t)}}}function ql(s){let e,t,l,n=s[13].strings.allgroups+"",r,i=[],a=new Map,o,f,c=ie(s[8]);const m=u=>u[40].id;for(let u=0;u<c.length;u+=1){let g=Nl(s,c,u),h=m(g);a.set(h,i[u]=Il(h,g))}return{c(){e=v("div"),t=v("select"),l=v("option"),r=R(n);for(let u=0;u<i.length;u+=1)i[u].c();l.__value=0,be(l,l.__value),d(t,"class","form-control text-truncate"),se(t,"min-width","0"),s[12]===void 0&&De(()=>s[24].call(t)),d(e,"class","flex-grow-1 mx-2")},m(u,g){C(u,e,g),_(e,t),_(t,l),_(l,r);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(t,null);He(t,s[12],!0),o||(f=[I(t,"change",s[24]),I(t,"change",s[25])],o=!0)},p(u,g){g[0]&8192&&n!==(n=u[13].strings.allgroups+"")&&E(r,n),g[0]&256&&(c=ie(u[8]),i=Me(i,g,m,1,u,c,a,t,Ie,Il,null,Nl)),g[0]&4352&&He(t,u[12])},d(u){u&&T(e);for(let g=0;g<i.length;g+=1)i[g].d();o=!1,pe(f)}}}function Il(s,e){let t,l=e[40].name+"",n,r,i;return{key:s,first:null,c(){t=v("option"),n=R(l),r=D(),t.__value=i=e[40].id,be(t,t.__value),d(t,"class","text-truncate"),this.first=t},m(a,o){C(a,t,o),_(t,n),_(t,r)},p(a,o){e=a,o[0]&256&&l!==(l=e[40].name+"")&&E(n,l),o[0]&256&&i!==(i=e[40].id)&&(t.__value=i,be(t,t.__value))},d(a){a&&T(t)}}}function Zr(s){let e,t,l=s[13].strings.allusers+"",n,r,i,a,o,f=[],c=new Map,m,u,g,h=ie(Object.values(ze)),p=[];for(let w=0;w<h.length;w+=1)p[w]=$l(jl(s,h,w));let b=ie(s[9]);const S=w=>w[30].id;for(let w=0;w<b.length;w+=1){let y=zl(s,b,w),k=S(y);c.set(k,f[w]=Pl(k,y))}return{c(){e=v("div"),t=v("div"),n=R(l),i=D(),a=v("div");for(let w=0;w<p.length;w+=1)p[w].c();o=D();for(let w=0;w<f.length;w+=1)f[w].c();m=de(),d(a,"class","d-flex ml-auto"),d(e,"class","list-group-item d-flex align-items-center px-3 py-2")},m(w,y){C(w,e,y),_(e,t),_(t,n),_(e,i),_(e,a);for(let k=0;k<p.length;k+=1)p[k]&&p[k].m(a,null);C(w,o,y);for(let k=0;k<f.length;k+=1)f[k]&&f[k].m(w,y);C(w,m,y),u||(g=ve(r=Ae.call(null,t,s[13].strings.allusers)),u=!0)},p(w,y){if(y[0]&8192&&l!==(l=w[13].strings.allusers+"")&&E(n,l),r&&ke(r.update)&&y[0]&8192&&r.update.call(null,w[13].strings.allusers),y[0]&8710){h=ie(Object.values(ze));let k;for(k=0;k<h.length;k+=1){const M=jl(w,h,k);p[k]?p[k].p(M,y):(p[k]=$l(M),p[k].c(),p[k].m(a,null))}for(;k<p.length;k+=1)p[k].d(1);p.length=h.length}y[0]&8710&&(b=ie(w[9]),f=Me(f,y,S,1,w,b,c,m.parentNode,Ie,Pl,m,zl))},d(w){w&&(T(e),T(o),T(m)),qe(p,w);for(let y=0;y<f.length;y+=1)f[y].d(w);u=!1,g()}}}function xr(s){let e,t=s[13].strings.toomanyusersfound+"",l;return{c(){e=v("div"),l=R(t),d(e,"class","list-group-item text-danger")},m(n,r){C(n,e,r),_(e,l)},p(n,r){r[0]&8192&&t!==(t=n[13].strings.toomanyusersfound+"")&&E(l,t)},d(n){n&&T(e)}}}function ei(s){let e,t=s[13].strings.nousersfound+"",l;return{c(){e=v("div"),l=R(t),d(e,"class","list-group-item text-danger")},m(n,r){C(n,e,r),_(e,l)},p(n,r){r[0]&8192&&t!==(t=n[13].strings.nousersfound+"")&&E(l,t)},d(n){n&&T(e)}}}function $l(s){let e,t=s[13].strings[s[34]]+"",l,n,r,i,a;function o(){return s[26](s[37],s[34])}return{c(){e=v("button"),l=R(t),n=D(),d(e,"type","button"),d(e,"class","btn text-nowrap ml-2"),d(e,"aria-pressed",r=s[37]),O(e,"btn-primary",s[37]),O(e,"btn-secondary",!s[37])},m(f,c){C(f,e,c),_(e,l),_(e,n),i||(a=I(e,"click",o),i=!0)},p(f,c){s=f,c[0]&8192&&t!==(t=s[13].strings[s[34]]+"")&&E(l,t),c[0]&514&&r!==(r=s[37])&&d(e,"aria-pressed",r),c[0]&514&&O(e,"btn-primary",s[37]),c[0]&514&&O(e,"btn-secondary",!s[37])},d(f){f&&T(e),i=!1,a()}}}function Fl(s){let e,t=s[13].strings[s[34]]+"",l,n,r,i,a;function o(){return s[28](s[30],s[31],s[34])}return{c(){e=v("button"),l=R(t),n=D(),d(e,"type","button"),d(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),d(e,"aria-pressed",r=s[31]==s[34]),O(e,"btn-primary",s[31]==s[34]),O(e,"btn-secondary",s[31]!=s[34])},m(f,c){C(f,e,c),_(e,l),_(e,n),i||(a=I(e,"click",o),i=!0)},p(f,c){s=f,c[0]&8192&&t!==(t=s[13].strings[s[34]]+"")&&E(l,t),c[0]&514&&r!==(r=s[31]==s[34])&&d(e,"aria-pressed",r),c[0]&514&&O(e,"btn-primary",s[31]==s[34]),c[0]&514&&O(e,"btn-secondary",s[31]!=s[34])},d(f){f&&T(e),i=!1,a()}}}function Pl(s,e){let t,l,n,r,i,a,o,f=e[30].fullname+"",c,m,u,g,h,p,b,S=ie(Object.values(ze)),w=[];for(let y=0;y<S.length;y+=1)w[y]=Fl(Al(e,S,y));return{key:s,first:null,c(){t=v("div"),l=v("img"),i=D(),a=v("div"),o=v("div"),c=R(f),u=D(),g=v("div");for(let y=0;y<w.length;y+=1)w[y].c();h=D(),d(l,"aria-hidden","true"),d(l,"alt",n=e[30].fullname),je(l.src,r=e[30].pictureurl)||d(l,"src",r),d(l,"width","35"),d(l,"height","35"),d(l,"class","rounded-circle mx-3 my-2"),d(o,"class","py-2 mr-3"),d(g,"class","d-flex ml-auto mr-2"),d(a,"class","d-sm-flex align-items-center flex-grow-1"),d(t,"class","list-group-item d-flex align-items-sm-center p-0"),this.first=t},m(y,k){C(y,t,k),_(t,l),_(t,i),_(t,a),_(a,o),_(o,c),_(a,u),_(a,g);for(let M=0;M<w.length;M+=1)w[M]&&w[M].m(g,null);_(t,h),p||(b=ve(m=Ae.call(null,o,e[30].fullname)),p=!0)},p(y,k){if(e=y,k[0]&512&&n!==(n=e[30].fullname)&&d(l,"alt",n),k[0]&512&&!je(l.src,r=e[30].pictureurl)&&d(l,"src",r),k[0]&512&&f!==(f=e[30].fullname+"")&&E(c,f),m&&ke(m.update)&&k[0]&512&&m.update.call(null,e[30].fullname),k[0]&8710){S=ie(Object.values(ze));let M;for(M=0;M<S.length;M+=1){const z=Al(e,S,M);w[M]?w[M].p(z,k):(w[M]=Fl(z),w[M].c(),w[M].m(g,null))}for(;M<w.length;M+=1)w[M].d(1);w.length=S.length}},d(y){y&&T(t),qe(w,y),p=!1,b()}}}function ti(s){let e,t,l,n,r,i,a,o,f,c,m,u,g,h,p,b,S,w=s[3]&&Rl(s);return{c(){e=v("div"),t=v("div"),l=v("i"),r=D(),i=v("input"),f=D(),c=v("div"),m=v("button"),u=v("i"),p=D(),w&&w.c(),d(l,"class",n="fa fa-fw "+(s[6]?"fa-spinner fa-pulse":"fa-user")),d(l,"aria-hidden","true"),d(t,"class","position-absolute h-100 d-flex justify-content-center align-items-center px-0"),se(t,"top","0"),se(t,"left","0"),se(t,"width","2.5rem"),d(i,"type","text"),d(i,"class","form-control svelte-vi3u1k"),se(i,"padding-left","2.5rem"),se(i,"padding-right","2.5"),d(i,"placeholder",a=s[13].strings.addrecipients),d(i,"aria-label",o=s[13].strings.addrecipients),d(i,"autocomplete","off"),O(i,"is-invalid",!s[1].size),d(u,"class",g="fa fa-fw "+(s[4]?"fa-times":s[3]?"fa-caret-up":"fa-caret-down")),d(u,"aria-hidden","true"),d(m,"type","button"),d(m,"aria-expanded",s[3]),d(m,"class","btn px-0"),d(m,"title",h=s[13].strings.cancel),se(m,"width","2.5rem"),d(c,"class","position-absolute h-100 d-flex align-items-center"),se(c,"top","0"),se(c,"right","0"),d(e,"class","local-mail-message-form-search-users-input form-group position-relative svelte-vi3u1k")},m(y,k){C(y,e,k),_(e,t),_(t,l),_(e,r),_(e,i),be(i,s[4]),s[20](i),_(e,f),_(e,c),_(c,m),_(m,u),_(e,p),w&&w.m(e,null),b||(S=[I(i,"input",s[19]),I(i,"input",s[21]),I(i,"focus",s[17]),I(m,"click",ye(s[14])),ve(Ee.call(null,e,s[16]))],b=!0)},p(y,k){k[0]&64&&n!==(n="fa fa-fw "+(y[6]?"fa-spinner fa-pulse":"fa-user"))&&d(l,"class",n),k[0]&8192&&a!==(a=y[13].strings.addrecipients)&&d(i,"placeholder",a),k[0]&8192&&o!==(o=y[13].strings.addrecipients)&&d(i,"aria-label",o),k[0]&16&&i.value!==y[4]&&be(i,y[4]),k[0]&2&&O(i,"is-invalid",!y[1].size),k[0]&24&&g!==(g="fa fa-fw "+(y[4]?"fa-times":y[3]?"fa-caret-up":"fa-caret-down"))&&d(u,"class",g),k[0]&8&&d(m,"aria-expanded",y[3]),k[0]&8192&&h!==(h=y[13].strings.cancel)&&d(m,"title",h),y[3]?w?w.p(y,k):(w=Rl(y),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i:$,o:$,d(y){y&&T(e),s[20](null),w&&w.d(),b=!1,pe(S)}}}const Qe=100,li=500;function si(s,e,t){let l,n=$,r=()=>(n(),n=me(i,K=>t(13,l=K)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();let{courseid:a}=e,{recipients:o}=e,{onChange:f}=e,c=!1,m="",u,g=!1,h,p=[],b=[],S=[],w=!1,y=0,k=0;const M=async()=>{c?(t(4,m=""),t(11,y=0),t(12,k=0),t(3,c=!1),window.clearTimeout(h)):(z(!1),u.focus())},z=async K=>{t(6,g=!0),window.clearTimeout(h),h=window.setTimeout(async()=>{const U=[{methodname:"get_roles",courseid:a},{methodname:"get_groups",courseid:a},{methodname:"search_users",query:{courseid:a,fullname:m,roleid:y,groupid:k},limit:Qe+1}];let Y;try{Y=await Ke(U)}catch(ce){i.setError(ce),t(6,g=!1),t(3,c=!1),t(10,w=!1),t(9,S=[]);return}t(9,S=Y.pop()),t(10,w=S.length>Qe),t(9,S=S.slice(0,Qe)),t(8,b=Y.pop()),t(12,k=b.find(ce=>ce.id==k)?k:0),t(7,p=Y.pop()),t(11,y=p.find(ce=>ce.id==y)?y:0),t(6,g=!1),t(3,c=!0)},K?li:0)},L=()=>{t(4,m=""),t(3,c=!1)},j=()=>{c||z(!1)};function F(){m=this.value,t(4,m)}function V(K){we[K?"unshift":"push"](()=>{u=K,t(5,u)})}const Q=()=>z(!0);function ee(){y=et(this),t(11,y),t(7,p)}const te=()=>z(!1);function B(){k=et(this),t(12,k),t(8,b)}const x=()=>z(!1),Z=(K,U)=>f(S,K?null:U),le=(K,U)=>{var Y;return((Y=o.get(U.id))==null?void 0:Y.type)==K},q=(K,U,Y)=>f([K],U==Y?null:Y);return s.$$set=K=>{"store"in K&&r(t(0,i=K.store)),"courseid"in K&&t(18,a=K.courseid),"recipients"in K&&t(1,o=K.recipients),"onChange"in K&&t(2,f=K.onChange)},[i,o,f,c,m,u,g,p,b,S,w,y,k,l,M,z,L,j,a,F,V,Q,ee,te,B,x,Z,le,q]}class ni extends fe{constructor(e){super(),ue(this,e,si,ti,oe,{store:0,courseid:18,recipients:1,onChange:2},null,[-1,-1])}}function ri(s){let e,t,l,n=s[1].strings.send+"",r,i,a,o;return{c(){e=v("button"),t=v("i"),l=D(),r=R(n),d(t,"class","fa fa-send mr-2"),d(e,"type","button"),d(e,"class","local-mail-action-send btn btn-primary flex-shrink-0 text-nowrap px-3 text-truncate ml-auto"),d(e,"title",i=s[1].strings.send)},m(f,c){C(f,e,c),_(e,t),_(e,l),_(e,r),a||(o=I(e,"click",s[2]),a=!0)},p(f,[c]){c&2&&n!==(n=f[1].strings.send+"")&&E(r,n),c&2&&i!==(i=f[1].strings.send)&&d(e,"title",i)},i:$,o:$,d(f){f&&T(e),a=!1,o()}}}function ii(s,e,t){let l,n=$,r=()=>(n(),n=me(i,o=>t(1,l=o)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();const a=()=>i.sendMessage();return s.$$set=o=>{"store"in o&&r(t(0,i=o.store))},[i,l,a]}class Us extends fe{constructor(e){super(),ue(this,e,ii,ri,oe,{store:0})}}const{Map:ai}=Je;function Ol(s,e,t){const l=s.slice();return l[19]=e[t],l}function Ul(s){let e,t,l,n=s[7].strings.errorinvalidrecipients+"",r;return{c(){e=v("div"),t=v("i"),l=D(),r=R(n),d(t,"class","fa fa-exclamation-circle mr-2"),d(e,"class","alert alert-danger")},m(i,a){C(i,e,a),_(e,t),_(e,l),_(e,r)},p(i,a){a&128&&n!==(n=i[7].strings.errorinvalidrecipients+"")&&E(r,n)},d(i){i&&T(e)}}}function oi(s){let e,t,l,n=Le(s[7].strings.errortoomanyrecipients,s[7].settings.maxrecipients)+"",r;return{c(){e=v("div"),t=v("i"),l=D(),r=R(n),d(t,"class","fa fa-exclamation-circle mr-2"),d(e,"class","alert alert-danger")},m(i,a){C(i,e,a),_(e,t),_(e,l),_(e,r)},p(i,a){a&128&&n!==(n=Le(i[7].strings.errortoomanyrecipients,i[7].settings.maxrecipients)+"")&&E(r,n)},d(i){i&&T(e)}}}function fi(s){let e,t,l,n=s[7].strings.erroremptyrecipients+"",r;return{c(){e=v("div"),t=v("i"),l=D(),r=R(n),d(t,"class","fa fa-exclamation-circle mr-2"),d(e,"class","alert alert-danger")},m(i,a){C(i,e,a),_(e,t),_(e,l),_(e,r)},p(i,a){a&128&&n!==(n=i[7].strings.erroremptyrecipients+"")&&E(r,n)},d(i){i&&T(e)}}}function Hl(s){let e,t,l,n=s[7].strings.erroremptysubject+"",r;return{c(){e=v("div"),t=v("i"),l=D(),r=R(n),d(t,"class","fa fa-exclamation-circle mr-2"),d(e,"class","alert alert-danger")},m(i,a){C(i,e,a),_(e,t),_(e,l),_(e,r)},p(i,a){a&128&&n!==(n=i[7].strings.erroremptysubject+"")&&E(r,n)},d(i){i&&T(e)}}}function Gl(s){let e,t=s[7].strings.references+"",l,n,r=[],i=new ai,a,o,f=ie(s[1].references);const c=m=>m[19].id;for(let m=0;m<f.length;m+=1){let u=Ol(s,f,m),g=c(u);i.set(g,r[m]=Kl(g,u))}return{c(){e=v("div"),l=R(t),n=D();for(let m=0;m<r.length;m+=1)r[m].c();a=de(),d(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(m,u){C(m,e,u),_(e,l),C(m,n,u);for(let g=0;g<r.length;g+=1)r[g]&&r[g].m(m,u);C(m,a,u),o=!0},p(m,u){(!o||u&128)&&t!==(t=m[7].strings.references+"")&&E(l,t),u&2&&(f=ie(m[1].references),ne(),r=Me(r,u,c,1,m,f,i,a.parentNode,Ye,Kl,a,Ol),re())},i(m){if(!o){for(let u=0;u<f.length;u+=1)A(r[u]);o=!0}},o(m){for(let u=0;u<r.length;u+=1)N(r[u]);o=!1},d(m){m&&(T(e),T(n),T(a));for(let u=0;u<r.length;u+=1)r[u].d(m)}}}function Kl(s,e){let t,l,n;return l=new Ps({props:{reference:e[19]}}),{key:s,first:null,c(){t=de(),J(l.$$.fragment),this.first=t},m(r,i){C(r,t,i),W(l,r,i),n=!0},p(r,i){e=r;const a={};i&2&&(a.reference=e[19]),l.$set(a)},i(r){n||(A(l.$$.fragment,r),n=!0)},o(r){N(l.$$.fragment,r),n=!1},d(r){r&&T(t),X(l,r)}}}function ui(s){let e,t,l,n,r,i,a,o,f,c,m,u,g,h,p,b,S,w,y=s[2].editorhtml+"",k,M,z=s[2].filemanagerhtml+"",L,j=Array.from(s[5].values()).some(Vl),F,V,Q=!s[4].trim(),ee,te,B,x,Z,le,q,K;i=new Os({props:{store:s[0],label:s[7].strings.course,selected:s[6],required:!0,readonly:s[1].references.length>0,onChange:s[8]}}),f=new ni({props:{store:s[0],courseid:s[6],recipients:s[5],onChange:s[9]}}),m=new Qr({props:{store:s[0],recipients:s[5],onDelete:s[10]}});let U=j&&Ul(s);function Y(H,ae){if(H[5].size==0)return fi;if(H[5].size>H[7].settings.maxrecipients)return oi}let ce=Y(s),ge=ce&&ce(s),P=Q&&Hl(s);B=new Us({props:{store:s[0]}});let G=s[1].references.length>0&&Gl(s);return{c(){e=v("hr"),t=D(),l=v("form"),n=v("div"),r=v("div"),J(i.$$.fragment),a=D(),o=v("div"),J(f.$$.fragment),c=D(),J(m.$$.fragment),u=D(),g=v("div"),h=v("input"),S=D(),w=v("div"),k=D(),M=v("div"),L=D(),U&&U.c(),F=D(),ge&&ge.c(),V=D(),P&&P.c(),ee=D(),te=v("div"),J(B.$$.fragment),x=D(),G&&G.c(),Z=de(),d(e,"class","d-lg-none my-2"),d(r,"class","form-group col-12 col-xl-5"),d(o,"class","col-12 col-xl-7"),d(n,"class","row"),d(h,"type","text"),d(h,"id","local-mail-message-form-subject"),d(h,"class","form-control"),d(h,"placeholder",p=s[7].strings.subject),d(h,"aria-label",b=s[7].strings.subject),d(h,"autocomplete","off"),d(h,"maxlength","100"),O(h,"is-invalid",!s[4].trim()),d(g,"class","form-group"),d(w,"class","form-group"),d(M,"class","form-group"),d(te,"class","d-flex justify-content-end align-items-center"),d(l,"class","py-2 py-3 px-lg-4"),O(l,"card",s[7].viewSize>=_e.LG)},m(H,ae){C(H,e,ae),C(H,t,ae),C(H,l,ae),_(l,n),_(n,r),W(i,r,null),_(n,a),_(n,o),W(f,o,null),_(l,c),W(m,l,null),_(l,u),_(l,g),_(g,h),be(h,s[4]),_(l,S),_(l,w),w.innerHTML=y,_(l,k),_(l,M),M.innerHTML=z,_(l,L),U&&U.m(l,null),_(l,F),ge&&ge.m(l,null),_(l,V),P&&P.m(l,null),_(l,ee),_(l,te),W(B,te,null),s[15](l),C(H,x,ae),G&&G.m(H,ae),C(H,Z,ae),le=!0,q||(K=[I(h,"input",s[12]),I(h,"input",s[13]),I(w,"change",s[14]),I(l,"submit",ye(s[16]))],q=!0)},p(H,[ae]){const Se={};ae&1&&(Se.store=H[0]),ae&128&&(Se.label=H[7].strings.course),ae&64&&(Se.selected=H[6]),ae&2&&(Se.readonly=H[1].references.length>0),i.$set(Se);const Te={};ae&1&&(Te.store=H[0]),ae&64&&(Te.courseid=H[6]),ae&32&&(Te.recipients=H[5]),f.$set(Te);const Ce={};ae&1&&(Ce.store=H[0]),ae&32&&(Ce.recipients=H[5]),m.$set(Ce),(!le||ae&128&&p!==(p=H[7].strings.subject))&&d(h,"placeholder",p),(!le||ae&128&&b!==(b=H[7].strings.subject))&&d(h,"aria-label",b),ae&16&&h.value!==H[4]&&be(h,H[4]),(!le||ae&16)&&O(h,"is-invalid",!H[4].trim()),(!le||ae&4)&&y!==(y=H[2].editorhtml+"")&&(w.innerHTML=y),(!le||ae&4)&&z!==(z=H[2].filemanagerhtml+"")&&(M.innerHTML=z),ae&32&&(j=Array.from(H[5].values()).some(Vl)),j?U?U.p(H,ae):(U=Ul(H),U.c(),U.m(l,F)):U&&(U.d(1),U=null),ce===(ce=Y(H))&&ge?ge.p(H,ae):(ge&&ge.d(1),ge=ce&&ce(H),ge&&(ge.c(),ge.m(l,V))),ae&16&&(Q=!H[4].trim()),Q?P?P.p(H,ae):(P=Hl(H),P.c(),P.m(l,ee)):P&&(P.d(1),P=null);const he={};ae&1&&(he.store=H[0]),B.$set(he),(!le||ae&128)&&O(l,"card",H[7].viewSize>=_e.LG),H[1].references.length>0?G?(G.p(H,ae),ae&2&&A(G,1)):(G=Gl(H),G.c(),A(G,1),G.m(Z.parentNode,Z)):G&&(ne(),N(G,1,1,()=>{G=null}),re())},i(H){le||(A(i.$$.fragment,H),A(f.$$.fragment,H),A(m.$$.fragment,H),A(B.$$.fragment,H),A(G),le=!0)},o(H){N(i.$$.fragment,H),N(f.$$.fragment,H),N(m.$$.fragment,H),N(B.$$.fragment,H),N(G),le=!1},d(H){H&&(T(e),T(t),T(l),T(x),T(Z)),X(i),X(f),X(m),U&&U.d(),ge&&ge.d(),P&&P.d(),X(B),s[15](null),G&&G.d(H),q=!1,pe(K)}}}const Vl=s=>!s.isvalid;function ci(s,e,t){let l,n,r,i,a=$,o=()=>(a(),a=me(f,j=>t(7,i=j)),f);s.$$.on_destroy.push(()=>a());let{store:f}=e;o();let{message:c}=e,{form:m}=e,u,g;Ve(()=>{g==null||g.addEventListener("core_form/uploadChanged",()=>w(!1))}),tt(()=>{u==null||u.remove()});const h=async j=>{const F=await ln("core/fragment");u==null||u.remove(),await Oe(),u=document.createElement("script"),u.setAttribute("type","text/javascript"),u.innerHTML=F.processCollectedJavascript(j),document.head.append(u)},p=j=>{t(6,l=j||i.courses[0].id),w(!0)},b=(j,F)=>{const V=new Map(r);for(const Q of j)F?V.set(Q.id,{...Q,type:F,isvalid:!0}):V.delete(Q.id);t(5,r=V),w(!1)},S=j=>{b([j],null)},w=async j=>{var Q,ee,te;if(!g)return;const F=new FormData(g),V={courseid:l,to:Array.from(r.values()).filter(B=>B.type=="to").map(B=>B.id),cc:Array.from(r.values()).filter(B=>B.type=="cc").map(B=>B.id),bcc:Array.from(r.values()).filter(B=>B.type=="bcc").map(B=>B.id),subject:n,content:((Q=F.get("content[text]"))==null?void 0:Q.toString())||"",format:parseInt(((ee=F.get("content[format]"))==null?void 0:ee.toString())||"")||1,draftitemid:parseInt(((te=F.get("content[itemid]"))==null?void 0:te.toString())||"")||0};await f.updateDraft(V,j)};function y(){n=this.value,t(4,n),t(1,c)}const k=()=>w(!1),M=()=>w(!1);function z(j){we[j?"unshift":"push"](()=>{g=j,t(3,g)})}const L=()=>w(!0);return s.$$set=j=>{"store"in j&&o(t(0,f=j.store)),"message"in j&&t(1,c=j.message),"form"in j&&t(2,m=j.form)},s.$$.update=()=>{s.$$.dirty&2&&t(6,l=c.course.id),s.$$.dirty&2&&t(4,n=c.subject),s.$$.dirty&2&&t(5,r=new Map(c.recipients.map(j=>[j.id,j]))),s.$$.dirty&4&&h(m.javascript)},[f,c,m,g,n,r,l,i,p,b,S,w,y,k,M,z,L]}class mi extends fe{constructor(e){super(),ue(this,e,ci,ui,oe,{store:0,message:1,form:2})}}function Yl(s,e,t){const l=s.slice();return l[7]=e[t],l}function Jl(s){let e,t=s[7]+"",l,n;return{c(){e=v("option"),l=R(t),e.__value=n=s[7],be(e,e.__value)},m(r,i){C(r,e,i),_(e,l)},p(r,i){i&8&&t!==(t=r[7]+"")&&E(l,t),i&8&&n!==(n=r[7])&&(e.__value=n,be(e,e.__value))},d(r){r&&T(e)}}}function di(s){let e,t,l,n=s[1].strings.messagesperpage+"",r,i,a,o,f,c,m=ie(s[3]),u=[];for(let g=0;g<m.length;g+=1)u[g]=Jl(Yl(s,m,g));return{c(){e=v("dov"),t=v("div"),l=v("label"),r=R(n),i=R(":"),a=D(),o=v("select");for(let g=0;g<u.length;g+=1)u[g].c();d(l,"for","local-mail-perpage-select"),d(o,"id","local-mail-perpage-select"),d(o,"class","custom-select"),s[2]===void 0&&De(()=>s[4].call(o)),d(t,"class","form-group"),d(e,"class","form-inline justify-content-end mt-3")},m(g,h){C(g,e,h),_(e,t),_(t,l),_(l,r),_(l,i),_(t,a),_(t,o);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(o,null);He(o,s[2],!0),f||(c=[I(o,"change",s[4]),I(o,"change",s[5])],f=!0)},p(g,[h]){if(h&2&&n!==(n=g[1].strings.messagesperpage+"")&&E(r,n),h&8){m=ie(g[3]);let p;for(p=0;p<m.length;p+=1){const b=Yl(g,m,p);u[p]?u[p].p(b,h):(u[p]=Jl(b),u[p].c(),u[p].m(o,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=m.length}h&12&&He(o,g[2])},i:$,o:$,d(g){g&&T(e),qe(u,g),f=!1,pe(c)}}}function _i(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,u=>t(1,n=u)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();const o=[5,10,20,50,100];let f=n.preferences.perpage;function c(){f=et(this),t(2,f),t(3,l),t(1,n)}const m=()=>a.setPerPage(f);return s.$$set=u=>{"store"in u&&i(t(0,a=u.store))},s.$$.update=()=>{s.$$.dirty&2&&t(3,l=o.includes(n.preferences.perpage)?o:o.concat([n.preferences.perpage]).sort((u,g)=>u-g))},[a,n,f,l,c,m]}class gi extends fe{constructor(e){super(),ue(this,e,_i,di,oe,{store:0})}}function pi(s){let e,t,l,n=s[9].strings.from+"",r,i,a,o,f,c,m,u=s[9].strings.to+"",g,h,p,b,S,w,y,k=s[9].strings.filterbydate+"",M,z,L,j,F,V,Q,ee,te,B,x=s[9].strings.searchbyunread+"",Z,le,q,K,U,Y,ce=s[9].strings.searchbyattach+"",ge,P,G,H,ae,Se,Te;return{c(){e=v("div"),t=v("div"),l=v("label"),r=R(n),i=D(),a=v("div"),o=v("input"),f=D(),c=v("div"),m=v("label"),g=R(u),h=D(),p=v("div"),b=v("input"),S=D(),w=v("div"),y=v("label"),M=R(k),z=D(),L=v("div"),j=v("input"),F=D(),V=v("div"),Q=v("div"),ee=v("input"),te=D(),B=v("label"),Z=R(x),le=D(),q=v("div"),K=v("input"),U=D(),Y=v("label"),ge=R(ce),P=D(),G=v("input"),d(l,"for","local-mail-search-input-sendername"),d(l,"class","col-3 col-form-label"),d(o,"type","text"),d(o,"class","form-control"),d(o,"id","local-mail-search-input-sendername"),d(a,"class","col-9"),d(t,"class","form-group row"),d(m,"for","local-mail-search-input-recipientname"),d(m,"class","col-3 col-form-label"),d(b,"type","text"),d(b,"class","form-control"),d(b,"id","local-mail-search-input-recipientname"),d(p,"class","col-9"),d(c,"class","form-group row"),d(y,"for","local-mail-search-input-maxdate"),d(y,"class","col-3 col-form-label"),d(j,"type","date"),d(j,"class","form-control"),d(j,"id","local-mail-search-input-maxdate"),d(j,"max",s[10]),j.value=s[8],d(L,"class","col-9"),d(w,"class","form-group row"),d(ee,"class","form-check-input"),d(ee,"type","checkbox"),d(ee,"id","local-mail-search-input-unread"),d(B,"class","form-check-label"),d(B,"for","local-mail-search-input-unread"),d(Q,"class","form-check"),d(K,"class","form-check-input"),d(K,"type","checkbox"),d(K,"id","local-mail-search-input-withfilesonly"),d(Y,"class","form-check-label"),d(Y,"for","local-mail-search-input-withfilesonly"),d(q,"class","form-check"),d(G,"type","submit"),G.disabled=H=!s[6],d(G,"class","btn btn-primary px-3 ml-auto"),G.value=ae=s[9].strings.search,d(V,"class","d-flex flex-wrap align-items-center"),se(V,"column-gap","2rem"),se(V,"row-gap","1rem"),d(e,"class","dropdown-menu dropdown-menu-left show p-3 w-100"),se(e,"min-width","18rem")},m(Ce,he){C(Ce,e,he),_(e,t),_(t,l),_(l,r),_(t,i),_(t,a),_(a,o),be(o,s[0]),s[15](o),_(e,f),_(e,c),_(c,m),_(m,g),_(c,h),_(c,p),_(p,b),be(b,s[1]),_(e,S),_(e,w),_(w,y),_(y,M),_(w,z),_(w,L),_(L,j),_(e,F),_(e,V),_(V,Q),_(Q,ee),ee.checked=s[2],_(Q,te),_(Q,B),_(B,Z),_(V,le),_(V,q),_(q,K),K.checked=s[3],_(q,U),_(q,Y),_(Y,ge),_(V,P),_(V,G),Se||(Te=[I(o,"input",s[14]),I(b,"input",s[16]),I(j,"input",s[11]),I(ee,"change",s[17]),I(K,"change",s[18]),I(G,"click",ye(function(){ke(s[5])&&s[5].apply(this,arguments)}))],Se=!0)},p(Ce,[he]){s=Ce,he&512&&n!==(n=s[9].strings.from+"")&&E(r,n),he&1&&o.value!==s[0]&&be(o,s[0]),he&512&&u!==(u=s[9].strings.to+"")&&E(g,u),he&2&&b.value!==s[1]&&be(b,s[1]),he&512&&k!==(k=s[9].strings.filterbydate+"")&&E(M,k),he&256&&(j.value=s[8]),he&4&&(ee.checked=s[2]),he&512&&x!==(x=s[9].strings.searchbyunread+"")&&E(Z,x),he&8&&(K.checked=s[3]),he&512&&ce!==(ce=s[9].strings.searchbyattach+"")&&E(ge,ce),he&64&&H!==(H=!s[6])&&(G.disabled=H),he&512&&ae!==(ae=s[9].strings.search)&&(G.value=ae)},i:$,o:$,d(Ce){Ce&&T(e),s[15](null),Se=!1,pe(Te)}}}function bi(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,j=>t(9,n=j)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();let{sendername:o=""}=e,{recipientname:f=""}=e,{unread:c=!1}=e,{withfilesonly:m=!1}=e,{maxtime:u=0}=e,{submit:g}=e,{submitEnabled:h}=e;function p(){b.focus()}let b,S=ot(Math.floor(new Date().getTime()/1e3));const w=j=>{t(12,u=fn(j.target.value))};function y(){o=this.value,t(0,o)}function k(j){we[j?"unshift":"push"](()=>{b=j,t(7,b)})}function M(){f=this.value,t(1,f)}function z(){c=this.checked,t(2,c)}function L(){m=this.checked,t(3,m)}return s.$$set=j=>{"store"in j&&i(t(4,a=j.store)),"sendername"in j&&t(0,o=j.sendername),"recipientname"in j&&t(1,f=j.recipientname),"unread"in j&&t(2,c=j.unread),"withfilesonly"in j&&t(3,m=j.withfilesonly),"maxtime"in j&&t(12,u=j.maxtime),"submit"in j&&t(5,g=j.submit),"submitEnabled"in j&&t(6,h=j.submitEnabled)},s.$$.update=()=>{s.$$.dirty&4096&&t(8,l=ot(u))},[o,f,c,m,a,g,h,b,l,n,S,w,u,p,y,k,M,z,L]}class hi extends fe{constructor(e){super(),ue(this,e,bi,pi,oe,{store:4,sendername:0,recipientname:1,unread:2,withfilesonly:3,maxtime:12,submit:5,submitEnabled:6,focus:13})}get focus(){return this.$$.ctx[13]}}const{Boolean:vi}=Je;function Wl(s,e,t){const l=s.slice();return l[14]=e[t],l[16]=t,l}function Xl(s){let e,t,l,n=ie(s[4]),r=[];for(let c=0;c<n.length;c+=1)r[c]=Ql(Wl(s,n,c));const i=c=>N(r[c],1,1,()=>{r[c]=null});function a(c,m){if(c[5])return yi;if(!c[4].length)return wi}let o=a(s),f=o&&o(s);return{c(){e=v("div");for(let c=0;c<r.length;c+=1)r[c].c();t=D(),f&&f.c(),d(e,"class","dropdown-menu dropdown-menu-left overflow-hidden show p-0 w-100"),se(e,"min-width","18rem")},m(c,m){C(c,e,m);for(let u=0;u<r.length;u+=1)r[u]&&r[u].m(e,null);_(e,t),f&&f.m(e,null),l=!0},p(c,m){if(m&401){n=ie(c[4]);let u;for(u=0;u<n.length;u+=1){const g=Wl(c,n,u);r[u]?(r[u].p(g,m),A(r[u],1)):(r[u]=Ql(g),r[u].c(),A(r[u],1),r[u].m(e,t))}for(ne(),u=n.length;u<r.length;u+=1)i(u);re()}o===(o=a(c))&&f?f.p(c,m):(f&&f.d(1),f=o&&o(c),f&&(f.c(),f.m(e,null)))},i(c){if(!l){for(let m=0;m<n.length;m+=1)A(r[m]);l=!0}},o(c){r=r.filter(vi);for(let m=0;m<r.length;m+=1)N(r[m]);l=!1},d(c){c&&T(e),qe(r,c),f&&f.d()}}}function ki(s){let e;return{c(){e=v("div"),d(e,"class","dropdown-divider my-0")},m(t,l){C(t,e,l)},d(t){t&&T(e)}}}function Ql(s){let e,t,l,n,r,i,a,o,f=s[14].shorttime+"",c,m,u,g,h,p,b=s[16]>0&&ki();return l=new rt({props:{store:s[0],message:s[14]}}),i=new nt({props:{store:s[0],message:s[14]}}),{c(){b&&b.c(),e=D(),t=v("a"),J(l.$$.fragment),n=D(),r=v("div"),J(i.$$.fragment),a=D(),o=v("div"),c=R(f),d(o,"title",m=s[14].fulltime),d(o,"class","ml-auto"),d(r,"class","local-mail-incremental-search-muted d-flex svelte-sdeam0"),d(t,"class","dropdown-item local-mail-incremental-search-item"),d(t,"href",u=Re(s[7](s[14],s[16]))),O(t,"font-weight-bold",s[14].unread)},m(S,w){b&&b.m(S,w),C(S,e,w),C(S,t,w),W(l,t,null),_(t,n),_(t,r),W(i,r,null),_(r,a),_(r,o),_(o,c),g=!0,h||(p=I(t,"click",function(){ke(s[8](s[14],s[16]))&&s[8](s[14],s[16]).apply(this,arguments)}),h=!0)},p(S,w){s=S;const y={};w&1&&(y.store=s[0]),w&16&&(y.message=s[14]),l.$set(y);const k={};w&1&&(k.store=s[0]),w&16&&(k.message=s[14]),i.$set(k),(!g||w&16)&&f!==(f=s[14].shorttime+"")&&E(c,f),(!g||w&16&&m!==(m=s[14].fulltime))&&d(o,"title",m),(!g||w&144&&u!==(u=Re(s[7](s[14],s[16]))))&&d(t,"href",u),(!g||w&16)&&O(t,"font-weight-bold",s[14].unread)},i(S){g||(A(l.$$.fragment,S),A(i.$$.fragment,S),g=!0)},o(S){N(l.$$.fragment,S),N(i.$$.fragment,S),g=!1},d(S){S&&(T(e),T(t)),b&&b.d(S),X(l),X(i),h=!1,p()}}}function wi(s){let e,t=s[3].strings.nomessagesfound+"",l;return{c(){e=v("div"),l=R(t),d(e,"class","px-4 py-2 text-danger")},m(n,r){C(n,e,r),_(e,l)},p(n,r){r&8&&t!==(t=n[3].strings.nomessagesfound+"")&&E(l,t)},d(n){n&&T(e)}}}function yi(s){let e,t,l,n=s[3].strings.searchallmessages+"",r,i,a,o;return{c(){e=v("div"),t=D(),l=v("a"),r=R(n),d(e,"class","dropdown-divider my-0"),d(l,"class","dropdown-item py-2"),d(l,"href",i=Re(s[6]))},m(f,c){C(f,e,c),C(f,t,c),C(f,l,c),_(l,r),a||(o=I(l,"click",ye(s[12])),a=!0)},p(f,c){c&8&&n!==(n=f[3].strings.searchallmessages+"")&&E(r,n),c&64&&i!==(i=Re(f[6]))&&d(l,"href",i)},d(f){f&&(T(e),T(t),T(l)),a=!1,o()}}}function Mi(s){let e,t,l=s[1]&&s[4]!=null&&Xl(s);return{c(){l&&l.c(),e=de()},m(n,r){l&&l.m(n,r),C(n,e,r),t=!0},p(n,[r]){n[1]&&n[4]!=null?l?(l.p(n,r),r&18&&A(l,1)):(l=Xl(n),l.c(),A(l,1),l.m(e.parentNode,e)):l&&(ne(),N(l,1,1,()=>{l=null}),re())},i(n){t||(A(l),t=!0)},o(n){N(l),t=!1},d(n){n&&T(e),l&&l.d(n)}}}const Ze=10,Si=500;function Ci(s,e,t){let l,n,r,i=$,a=()=>(i(),i=me(o,y=>t(3,r=y)),o);s.$$.on_destroy.push(()=>i());let{store:o}=e;a();let{enabled:f}=e,{content:c}=e,{loading:m=!1}=e,{handleClick:u}=e,g,h,p=!1;const b=async y=>{t(9,m=!0),window.clearTimeout(g),t(11,g=window.setTimeout(async()=>{const k=r.params,z={methodname:"search_messages",query:{courseid:k.courseid,labelid:k.tray=="label"?k.labelid:void 0,draft:k.tray=="drafts"?!0:k.tray=="sent"?!1:void 0,roles:k.tray=="inbox"?Object.values(ze):k.tray=="sent"?["from"]:void 0,starred:k.tray=="starred"?!0:void 0,deleted:k.tray=="trash",content:y.trim(),stopid:r.incrementalSearchStopId},limit:Ze+1};let L;try{L=await Ke([z])}catch(j){o.setError(j),t(9,m=!1),t(4,h=void 0);return}t(9,m=!1),t(4,h=L[0]),t(5,p=h.length>Ze||!!r.incrementalSearchStopId),t(4,h=h.slice(0,Ze))},Si))},S=(y,k)=>M=>{y.draft||(M.preventDefault(),u(l(y,k)))};tt(()=>{window.clearTimeout(g)});const w=()=>u(n);return s.$$set=y=>{"store"in y&&a(t(0,o=y.store)),"enabled"in y&&t(1,f=y.enabled),"content"in y&&t(10,c=y.content),"loading"in y&&t(9,m=y.loading),"handleClick"in y&&t(2,u=y.handleClick)},s.$$.update=()=>{s.$$.dirty&3074&&(f?b(c):(t(4,h=void 0),t(9,m=!1),window.clearTimeout(g))),s.$$.dirty&1032&&t(7,l=(y,k)=>({...r.params,messageid:y.id,offset:k,search:{content:c.trim()}})),s.$$.dirty&1032&&t(6,n={...r.params,messageid:void 0,offset:0,search:{content:c.trim()}})},[o,f,u,r,h,p,n,l,S,m,c,g,w]}class Ti extends fe{constructor(e){super(),ue(this,e,Ci,Mi,oe,{store:0,enabled:1,content:10,loading:9,handleClick:2})}}function Zl(s,e,t){const l=s.slice();return l[35]=e[t].label,l[36]=e[t].value,l[38]=t,l}function Di(s){let e,t,l,n=ie(s[15]),r=[];for(let i=0;i<n.length;i+=1)r[i]=es(Zl(s,n,i));return{c(){e=v("button");for(let i=0;i<r.length;i+=1)r[i].c();d(e,"type","button"),d(e,"class","alert-primary form-control text-left text-truncate"),se(e,"padding-left","2.5rem"),se(e,"padding-right","5rem")},m(i,a){C(i,e,a);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null);t||(l=I(e,"click",s[16]),t=!0)},p(i,a){if(a[0]&32768){n=ie(i[15]);let o;for(o=0;o<n.length;o+=1){const f=Zl(i,n,o);r[o]?r[o].p(f,a):(r[o]=es(f),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(i){i&&T(e),qe(r,i),t=!1,l()}}}function Li(s){let e,t,l,n,r;return{c(){e=v("input"),d(e,"type","text"),d(e,"class","form-control"),se(e,"padding-left","2.5rem"),se(e,"padding-right","5rem"),d(e,"placeholder",t=s[7].strings.search),d(e,"aria-label",l=s[7].strings.search),d(e,"autocomplete","off")},m(i,a){C(i,e,a),be(e,s[1]),s[26](e),n||(r=[I(e,"input",s[25]),I(e,"keypress",s[21])],n=!0)},p(i,a){a[0]&128&&t!==(t=i[7].strings.search)&&d(e,"placeholder",t),a[0]&128&&l!==(l=i[7].strings.search)&&d(e,"aria-label",l),a[0]&2&&e.value!==i[1]&&be(e,i[1])},d(i){i&&T(e),s[26](null),n=!1,pe(r)}}}function zi(s){let e;return{c(){e=v("span"),e.textContent=", ",d(e,"class","dimmed_text")},m(t,l){C(t,e,l)},d(t){t&&T(e)}}}function Ai(s){let e,t=s[36]+"",l,n=s[35]&&xl(s);return{c(){n&&n.c(),e=D(),l=R(t)},m(r,i){n&&n.m(r,i),C(r,e,i),C(r,l,i)},p(r,i){r[35]?n?n.p(r,i):(n=xl(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),i[0]&32768&&t!==(t=r[36]+"")&&E(l,t)},d(r){r&&(T(e),T(l)),n&&n.d(r)}}}function ji(s){let e,t=s[35]+"",l;return{c(){e=v("span"),l=R(t),d(e,"class","dimmed_text")},m(n,r){C(n,e,r),_(e,l)},p(n,r){r[0]&32768&&t!==(t=n[35]+"")&&E(l,t)},d(n){n&&T(e)}}}function xl(s){let e,t=s[35]+"",l,n;return{c(){e=v("span"),l=R(t),n=R(":"),d(e,"class","dimmed_text")},m(r,i){C(r,e,i),_(e,l),_(e,n)},p(r,i){i[0]&32768&&t!==(t=r[35]+"")&&E(l,t)},d(r){r&&T(e)}}}function es(s){let e,t,l=s[38]>0&&zi();function n(a,o){return a[36]===!0?ji:Ai}let r=n(s),i=r(s);return{c(){l&&l.c(),e=D(),i.c(),t=de()},m(a,o){l&&l.m(a,o),C(a,e,o),i.m(a,o),C(a,t,o)},p(a,o){r===(r=n(a))&&i?i.p(a,o):(i.d(1),i=r(a),i&&(i.c(),i.m(t.parentNode,t)))},d(a){a&&(T(e),T(t)),l&&l.d(a),i.d(a)}}}function ts(s){let e,t,l,n,r;return{c(){e=v("button"),t=v("i"),d(t,"class","fa fa-fw fa-times"),d(t,"aria-hidden","true"),d(e,"type","button"),d(e,"class","btn px-0"),d(e,"title",l=s[7].strings.cancel),se(e,"width","2.5rem")},m(i,a){C(i,e,a),_(e,t),n||(r=I(e,"click",ye(s[19])),n=!0)},p(i,a){a[0]&128&&l!==(l=i[7].strings.cancel)&&d(e,"title",l)},d(i){i&&T(e),n=!1,r()}}}function ls(s){let e,t,l,n,r,i,a;function o(h){s[28](h)}function f(h){s[29](h)}function c(h){s[30](h)}function m(h){s[31](h)}function u(h){s[32](h)}let g={store:s[0],submit:s[20],submitEnabled:s[13]};return s[2]!==void 0&&(g.sendername=s[2]),s[3]!==void 0&&(g.recipientname=s[3]),s[4]!==void 0&&(g.unread=s[4]),s[5]!==void 0&&(g.withfilesonly=s[5]),s[6]!==void 0&&(g.maxtime=s[6]),e=new hi({props:g}),s[27](e),we.push(()=>Fe(e,"sendername",o)),we.push(()=>Fe(e,"recipientname",f)),we.push(()=>Fe(e,"unread",c)),we.push(()=>Fe(e,"withfilesonly",m)),we.push(()=>Fe(e,"maxtime",u)),{c(){J(e.$$.fragment)},m(h,p){W(e,h,p),a=!0},p(h,p){const b={};p[0]&1&&(b.store=h[0]),p[0]&8192&&(b.submitEnabled=h[13]),!t&&p[0]&4&&(t=!0,b.sendername=h[2],Pe(()=>t=!1)),!l&&p[0]&8&&(l=!0,b.recipientname=h[3],Pe(()=>l=!1)),!n&&p[0]&16&&(n=!0,b.unread=h[4],Pe(()=>n=!1)),!r&&p[0]&32&&(r=!0,b.withfilesonly=h[5],Pe(()=>r=!1)),!i&&p[0]&64&&(i=!0,b.maxtime=h[6],Pe(()=>i=!1)),e.$set(b)},i(h){a||(A(e.$$.fragment,h),a=!0)},o(h){N(e.$$.fragment,h),a=!1},d(h){s[27](null),X(e,h)}}}function ss(s){let e,t,l;function n(i){s[33](i)}let r={store:s[0],enabled:s[8]&&!s[9]&&!!s[1].trim(),content:s[1],handleClick:s[22]};return s[12]!==void 0&&(r.loading=s[12]),e=new Ti({props:r}),we.push(()=>Fe(e,"loading",n)),{c(){J(e.$$.fragment)},m(i,a){W(e,i,a),l=!0},p(i,a){const o={};a[0]&1&&(o.store=i[0]),a[0]&770&&(o.enabled=i[8]&&!i[9]&&!!i[1].trim()),a[0]&2&&(o.content=i[1]),!t&&a[0]&4096&&(t=!0,o.loading=i[12],Pe(()=>t=!1)),e.$set(o)},i(i){l||(A(e.$$.fragment,i),l=!0)},o(i){N(e.$$.fragment,i),l=!1},d(i){X(e,i)}}}function Ni(s){let e,t,l,n,r,i,a,o,f,c,m,u,g,h,p,b,S;function w(j,F){return j[8]?Li:Di}let y=w(s),k=y(s),M=(s[14]||s[13])&&ts(s),z=s[9]&&ls(s),L=s[7].settings.incrementalsearch&&ss(s);return{c(){e=v("form"),t=v("div"),l=v("i"),r=D(),k.c(),i=D(),a=v("div"),M&&M.c(),o=D(),f=v("button"),c=v("i"),g=D(),z&&z.c(),h=D(),L&&L.c(),d(l,"class",n="fa fa-fw "+(s[12]?"fa-spinner fa-pulse":"fa-search")),d(l,"aria-hidden","true"),d(t,"class","position-absolute h-100 d-flex justify-content-center align-items-center px-0"),se(t,"top","0"),se(t,"left","0"),se(t,"width","2.5rem"),d(c,"class",m="fa fa-fw "+(s[9]?"fa-caret-up":"fa-sliders")),d(c,"aria-hidden","true"),d(f,"type","button"),d(f,"aria-expanded",s[9]),d(f,"class","btn px-0"),se(f,"width","2.5rem"),d(f,"title",u=s[7].strings.advsearch),d(a,"class","position-absolute h-100 d-flex align-items-center"),se(a,"top","0"),se(a,"right","0"),d(e,"class","local-mail-search-input position-relative svelte-5mr94p")},m(j,F){C(j,e,F),_(e,t),_(t,l),_(e,r),k.m(e,null),_(e,i),_(e,a),M&&M.m(a,null),_(a,o),_(a,f),_(f,c),_(e,g),z&&z.m(e,null),_(e,h),L&&L.m(e,null),p=!0,b||(S=[I(f,"click",ye(s[18])),ve(Ee.call(null,e,s[17]))],b=!0)},p(j,F){(!p||F[0]&4096&&n!==(n="fa fa-fw "+(j[12]?"fa-spinner fa-pulse":"fa-search")))&&d(l,"class",n),y===(y=w(j))&&k?k.p(j,F):(k.d(1),k=y(j),k&&(k.c(),k.m(e,i))),j[14]||j[13]?M?M.p(j,F):(M=ts(j),M.c(),M.m(a,o)):M&&(M.d(1),M=null),(!p||F[0]&512&&m!==(m="fa fa-fw "+(j[9]?"fa-caret-up":"fa-sliders")))&&d(c,"class",m),(!p||F[0]&512)&&d(f,"aria-expanded",j[9]),(!p||F[0]&128&&u!==(u=j[7].strings.advsearch))&&d(f,"title",u),j[9]?z?(z.p(j,F),F[0]&512&&A(z,1)):(z=ls(j),z.c(),A(z,1),z.m(e,h)):z&&(ne(),N(z,1,1,()=>{z=null}),re()),j[7].settings.incrementalsearch?L?(L.p(j,F),F[0]&128&&A(L,1)):(L=ss(j),L.c(),A(L,1),L.m(e,null)):L&&(ne(),N(L,1,1,()=>{L=null}),re())},i(j){p||(A(z),A(L),p=!0)},o(j){N(z),N(L),p=!1},d(j){j&&T(e),k.d(),M&&M.d(),z&&z.d(),L&&L.d(),b=!1,pe(S)}}}function Bi(s,e,t){let l,n,r,i,a,o,f=$,c=()=>(f(),f=me(m,P=>t(7,o=P)),m);s.$$.on_destroy.push(()=>f());let{store:m}=e;c();let u=!o.params.search,g=!1,h,p,b="",S="",w="",y=!1,k=!1,M=0,z=!1;const L=P=>{t(1,b=(P==null?void 0:P.content)||""),t(2,S=(P==null?void 0:P.sendername)||""),t(3,w=(P==null?void 0:P.recipientname)||""),t(4,y=(P==null?void 0:P.unread)||!1),t(5,k=(P==null?void 0:P.withfilesonly)||!1),t(6,M=(P==null?void 0:P.maxtime)||0)},j=async()=>{t(8,u=!0),n&&t(9,g=!0),await Oe(),h.focus()},F=async()=>{t(8,u=!r),t(9,g=!1),L(l)},V=async()=>{g?(t(9,g=!1),await Oe(),h.focus()):(t(9,g=!0),j(),await Oe(),p.focus())},Q=async()=>{t(8,u=!0),t(9,g=!1),L(),await m.navigate({...o.params,offset:void 0,search:void 0}),await Oe(),h.focus()},ee=async()=>{await m.navigate({...o.params,messageid:void 0,offset:void 0,search:g?{content:b.trim(),sendername:S.trim(),recipientname:w.trim(),unread:y,withfilesonly:k,maxtime:M}:{content:b.trim()}}),t(9,g=!1),t(8,u=!1)},te=P=>{P.key=="Enter"&&(P.preventDefault(),i?ee():Q())},B=async P=>{await m.navigate(P),t(9,g=!1),t(8,u=!1)};function x(){b=this.value,t(1,b)}function Z(P){we[P?"unshift":"push"](()=>{h=P,t(10,h)})}function le(P){we[P?"unshift":"push"](()=>{p=P,t(11,p)})}function q(P){S=P,t(2,S)}function K(P){w=P,t(3,w)}function U(P){y=P,t(4,y)}function Y(P){k=P,t(5,k)}function ce(P){M=P,t(6,M)}function ge(P){z=P,t(12,z)}return s.$$set=P=>{"store"in P&&c(t(0,m=P.store))},s.$$.update=()=>{s.$$.dirty[0]&128&&t(23,l=o.params.search),s.$$.dirty[0]&8388608&&L(l),s.$$.dirty[0]&8388608&&t(24,n=!!(l!=null&&l.sendername||l!=null&&l.recipientname||l!=null&&l.unread||l!=null&&l.withfilesonly||l!=null&&l.maxtime)),s.$$.dirty[0]&25165824&&t(14,r=(l==null?void 0:l.content)||n),s.$$.dirty[0]&126&&t(13,i=!!(b.trim()||S.trim()||w.trim()||y||k||M)),s.$$.dirty[0]&254&&t(15,a=[{label:"",value:b},{label:o.strings.from,value:S},{label:o.strings.to,value:w},{label:o.strings.filterbydate,value:M>0?new Date(M*1e3).toLocaleDateString():""},{label:o.strings.searchbyunread,value:y},{label:o.strings.searchbyattach,value:k}].filter(({value:P})=>!!P))},[m,b,S,w,y,k,M,o,u,g,h,p,z,i,r,a,j,F,V,Q,ee,te,B,l,n,x,Z,le,q,K,U,Y,ce,ge]}class Ri extends fe{constructor(e){super(),ue(this,e,Bi,Ni,oe,{store:0},null,[-1,-1])}}function ns(s,e,t){const l=s.slice();return l[4]=e[t],l}function rs(s){let e,t=s[1].strings.undo+"",l,n,r;function i(){return s[2](s[4])}return{c(){e=v("button"),l=R(t),d(e,"type","button"),d(e,"class","local-mail-toast-undo btn font-weight-bold px-2 py-0 ml-3 svelte-kxpqnp")},m(a,o){C(a,e,o),_(e,l),n||(r=I(e,"click",i),n=!0)},p(a,o){s=a,o&2&&t!==(t=s[1].strings.undo+"")&&E(l,t)},d(a){a&&T(e),n=!1,r()}}}function is(s,e){let t,l,n,r=e[4].text+"",i,a,o,f,c,m,u,g,h,p,b=$,S,w,y,k=e[4].undo&&rs(e);function M(){return e[3](e[4])}return{key:s,first:null,c(){t=v("div"),l=v("div"),n=v("div"),i=R(r),a=D(),k&&k.c(),o=D(),f=v("button"),c=v("i"),u=D(),d(n,"class","px-1 mr-auto"),d(c,"class","fa fa-times"),d(f,"type","button"),d(f,"class","btn px-2 py-0 ml-2 text-white-50"),d(f,"title",m=e[1].strings.close),d(l,"class","toast-body d-flex align-items-center p-2"),d(t,"class","toast mt-2 mb-0"),d(t,"role","alert"),d(t,"aria-live","assertive"),d(t,"aria-atomic","true"),d(t,"data-autohide","false"),this.first=t},m(z,L){C(z,t,L),_(t,l),_(l,n),_(n,i),_(l,a),k&&k.m(l,null),_(l,o),_(l,f),_(f,c),_(t,u),S=!0,w||(y=I(f,"click",M),w=!0)},p(z,L){e=z,(!S||L&2)&&r!==(r=e[4].text+"")&&E(i,r),e[4].undo?k?k.p(e,L):(k=rs(e),k.c(),k.m(l,o)):k&&(k.d(1),k=null),(!S||L&2&&m!==(m=e[1].strings.close))&&d(f,"title",m)},r(){p=t.getBoundingClientRect()},f(){Ms(t),b(),st(t,p)},a(){b(),b=ys(t,p,Ns,{})},i(z){S||(De(()=>{S&&(h&&h.end(1),g=lt(t,Xe,{y:50,delay:200}),g.start())}),S=!0)},o(z){g&&g.invalidate(),h=ks(t,Xe,{y:50,duration:400}),S=!1},d(z){z&&T(t),k&&k.d(),z&&h&&h.end(),w=!1,y()}}}function Ei(s){let e,t=[],l=new Map,n,r=ie(s[1].toasts);const i=a=>a[4];for(let a=0;a<r.length;a+=1){let o=ns(s,r,a),f=i(o);l.set(f,t[a]=is(f,o))}return{c(){e=v("div");for(let a=0;a<t.length;a+=1)t[a].c();d(e,"aria-live","polite"),d(e,"aria-atomic","true"),d(e,"class","local-mail-toasts position-fixed d-flex flex-column-reverse p-3 svelte-kxpqnp")},m(a,o){C(a,e,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,[o]){if(o&3){r=ie(a[1].toasts),ne();for(let f=0;f<t.length;f+=1)t[f].r();t=Me(t,o,i,1,a,r,l,e,vs,is,null,ns);for(let f=0;f<t.length;f+=1)t[f].a();re()}},i(a){if(!n){for(let o=0;o<r.length;o+=1)A(t[o]);n=!0}},o(a){for(let o=0;o<t.length;o+=1)N(t[o]);n=!1},d(a){a&&T(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function qi(s,e,t){let l,n=$,r=()=>(n(),n=me(i,f=>t(1,l=f)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();const a=f=>i.undo(f),o=f=>i.hideToast(f);return s.$$set=f=>{"store"in f&&r(t(0,i=f.store))},[i,l,a,o]}class Ii extends fe{constructor(e){super(),ue(this,e,qi,Ei,oe,{store:0})}}function $i(s){let e,t,l,n,r;return{c(){e=v("button"),t=v("i"),d(t,"class","fa fa fa-fw fa-arrow-left"),d(e,"type","button"),d(e,"class","local-mail-back-button btn btn-secondary svelte-h5ths1"),d(e,"title",l=s[1].strings.messagelist)},m(i,a){C(i,e,a),_(e,t),n||(r=I(e,"click",s[2]),n=!0)},p(i,[a]){a&2&&l!==(l=i[1].strings.messagelist)&&d(e,"title",l)},i:$,o:$,d(i){i&&T(e),n=!1,r()}}}function Fi(s,e,t){let l,n=$,r=()=>(n(),n=me(i,o=>t(1,l=o)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();const a=()=>i.navigateToList();return s.$$set=o=>{"store"in o&&r(t(0,i=o.store))},[i,l,a]}class Pi extends fe{constructor(e){super(),ue(this,e,Fi,$i,oe,{store:0})}}function as(s){let e,t,l=s[1].strings.all+"",n,r,i,a=s[1].strings.none+"",o,f,c,m=s[1].strings.read+"",u,g,h,p=s[1].strings.unread+"",b,S,w,y=s[1].strings.starred+"",k,M,z,L=s[1].strings.unstarred+"",j,F,V;return{c(){e=v("div"),t=v("button"),n=R(l),r=D(),i=v("button"),o=R(a),f=D(),c=v("button"),u=R(m),g=D(),h=v("button"),b=R(p),S=D(),w=v("button"),k=R(y),M=D(),z=v("button"),j=R(L),d(t,"type","button"),d(t,"class","dropdown-item"),d(i,"type","button"),d(i,"class","dropdown-item"),d(c,"type","button"),d(c,"class","dropdown-item"),d(h,"type","button"),d(h,"class","dropdown-item"),d(w,"type","button"),d(w,"class","dropdown-item"),d(z,"type","button"),d(z,"class","dropdown-item"),d(e,"class","dropdown-menu show")},m(Q,ee){C(Q,e,ee),_(e,t),_(t,n),_(e,r),_(e,i),_(i,o),_(e,f),_(e,c),_(c,u),_(e,g),_(e,h),_(h,b),_(e,S),_(e,w),_(w,k),_(e,M),_(e,z),_(z,j),F||(V=[I(t,"click",s[7]),I(i,"click",s[8]),I(c,"click",s[9]),I(h,"click",s[10]),I(w,"click",s[11]),I(z,"click",s[12])],F=!0)},p(Q,ee){ee&2&&l!==(l=Q[1].strings.all+"")&&E(n,l),ee&2&&a!==(a=Q[1].strings.none+"")&&E(o,a),ee&2&&m!==(m=Q[1].strings.read+"")&&E(u,m),ee&2&&p!==(p=Q[1].strings.unread+"")&&E(b,p),ee&2&&y!==(y=Q[1].strings.starred+"")&&E(k,y),ee&2&&L!==(L=Q[1].strings.unstarred+"")&&E(j,L)},d(Q){Q&&T(e),F=!1,pe(V)}}}function Oi(s){let e,t,l,n,r,i,a,o,f=s[2]&&as(s);return{c(){e=v("div"),t=v("button"),l=v("i"),i=D(),f&&f.c(),d(l,"class",n="fa fa-fw "+s[3]),d(t,"class","btn btn-secondary dropdown-toggle"),d(t,"aria-expanded",s[2]),d(t,"title",r=s[1].strings.select),d(e,"class","btn-group"),d(e,"role","group")},m(c,m){C(c,e,m),_(e,t),_(t,l),_(e,i),f&&f.m(e,null),a||(o=[I(t,"click",s[5]),ve(Ee.call(null,e,s[4]))],a=!0)},p(c,[m]){m&8&&n!==(n="fa fa-fw "+c[3])&&d(l,"class",n),m&4&&d(t,"aria-expanded",c[2]),m&2&&r!==(r=c[1].strings.select)&&d(t,"title",r),c[2]?f?f.p(c,m):(f=as(c),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:$,o:$,d(c){c&&T(e),f&&f.d(),a=!1,pe(o)}}}function Ui(s,e,t){let l,n,r=$,i=()=>(r(),r=me(a,w=>t(1,n=w)),a);s.$$.on_destroy.push(()=>r());let{store:a}=e;i();let o=!1;const f=()=>{t(2,o=!1)},c=()=>{t(2,o=!o)},m=w=>{f(),a.selectAll(w)},u=()=>m("all"),g=()=>m("none"),h=()=>m("read"),p=()=>m("unread"),b=()=>m("starred"),S=()=>m("unstarred");return s.$$set=w=>{"store"in w&&i(t(0,a=w.store))},s.$$.update=()=>{s.$$.dirty&2&&t(3,l=n.selectedMessages.size==0?"fa-square-o":n.selectedMessages.size<n.listMessages.length?"fa-minus-square-o":"fa-check-square-o")},[a,n,o,l,f,c,m,u,g,h,p,b,S]}class Hi extends fe{constructor(e){super(),ue(this,e,Ui,Oi,oe,{store:0})}}function Gi(s){let e,t;return e=new Hi({props:{store:s[0]}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.store=l[0]),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function Ki(s){let e,t;return e=new Pi({props:{store:s[0]}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.store=l[0]),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function os(s){let e,t,l,n,r,i;const a=[Yi,Vi],o=[];function f(c,m){return c[1].params.tray=="trash"?0:1}return t=f(s),l=o[t]=a[t](s),r=new zs({props:{store:s[0]}}),{c(){e=v("div"),l.c(),n=D(),J(r.$$.fragment),d(e,"class","btn-group"),d(e,"role","group")},m(c,m){C(c,e,m),o[t].m(e,null),_(e,n),W(r,e,null),i=!0},p(c,m){let u=t;t=f(c),t===u?o[t].p(c,m):(ne(),N(o[u],1,1,()=>{o[u]=null}),re(),l=o[t],l?l.p(c,m):(l=o[t]=a[t](c),l.c()),A(l,1),l.m(e,n));const g={};m&1&&(g.store=c[0]),r.$set(g)},i(c){i||(A(l),A(r.$$.fragment,c),i=!0)},o(c){N(l),N(r.$$.fragment,c),i=!1},d(c){c&&T(e),o[t].d(),X(r)}}}function Vi(s){let e,t,l,n;return e=new Ls({props:{store:s[0]}}),l=new Cs({props:{store:s[0]}}),{c(){J(e.$$.fragment),t=D(),J(l.$$.fragment)},m(r,i){W(e,r,i),C(r,t,i),W(l,r,i),n=!0},p(r,i){const a={};i&1&&(a.store=r[0]),e.$set(a);const o={};i&1&&(o.store=r[0]),l.$set(o)},i(r){n||(A(e.$$.fragment,r),A(l.$$.fragment,r),n=!0)},o(r){N(e.$$.fragment,r),N(l.$$.fragment,r),n=!1},d(r){r&&T(t),X(e,r),X(l,r)}}}function Yi(s){let e,t,l,n;return e=new js({props:{store:s[0]}}),l=new Ts({props:{store:s[0]}}),{c(){J(e.$$.fragment),t=D(),J(l.$$.fragment)},m(r,i){W(e,r,i),C(r,t,i),W(l,r,i),n=!0},p(r,i){const a={};i&1&&(a.store=r[0]),e.$set(a);const o={};i&1&&(o.store=r[0]),l.$set(o)},i(r){n||(A(e.$$.fragment,r),A(l.$$.fragment,r),n=!0)},o(r){N(e.$$.fragment,r),N(l.$$.fragment,r),n=!1},d(r){r&&T(t),X(e,r),X(l,r)}}}function fs(s){let e,t,l;return t=new Os({props:{store:s[0],label:s[1].strings.filterbycourse,selected:s[1].params.courseid,readonly:s[1].params.tray=="course",onChange:s[2],primary:!0,align:s[1].viewSize>=_e.MD?"left":"right"}}),{c(){e=v("div"),J(t.$$.fragment),d(e,"class","d-flex flex-grow-1 ml-auto mr-0 ml-md-0 mr-md-auto"),se(e,"max-width","20rem"),se(e,"min-width","0")},m(n,r){C(n,e,r),W(t,e,null),l=!0},p(n,r){const i={};r&1&&(i.store=n[0]),r&2&&(i.label=n[1].strings.filterbycourse),r&2&&(i.selected=n[1].params.courseid),r&2&&(i.readonly=n[1].params.tray=="course"),r&1&&(i.onChange=n[2]),r&2&&(i.align=n[1].viewSize>=_e.MD?"left":"right"),t.$set(i)},i(n){l||(A(t.$$.fragment,n),l=!0)},o(n){N(t.$$.fragment,n),l=!1},d(n){n&&T(e),X(t)}}}function us(s){let e,t=s[1].strings.draftsaved+"",l,n,r,i;return{c(){e=v("div"),l=R(t),d(e,"class","align-self-center")},m(a,o){C(a,e,o),_(e,l),r||(i=ve(n=Ae.call(null,e,s[1].strings.draftsaved)),r=!0)},p(a,o){o&2&&t!==(t=a[1].strings.draftsaved+"")&&E(l,t),n&&ke(n.update)&&o&2&&n.update.call(null,a[1].strings.draftsaved)},d(a){a&&T(e),r=!1,i()}}}function Ji(s){let e,t;return e=new Us({props:{store:s[0]}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.store=l[0]),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function Wi(s){let e,t;return e=new As({props:{store:s[0]}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.store=l[0]),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function Xi(s){var M,z;let e,t,l,n,r,i=!((M=s[1].message)!=null&&M.draft)&&["shortname","fullname"].includes(s[1].settings.filterbycourse),a,o,f,c,m;const u=[Ki,Gi],g=[];function h(L,j){return L[1].message?0:1}t=h(s),l=g[t]=u[t](s);let p=s[1].viewSize>=_e.MD&&os(s),b=i&&fs(s),S=((z=s[1].message)==null?void 0:z.draft)&&s[1].draftSaved&&us(s);const w=[Wi,Ji],y=[];function k(L,j){var F;return L[1].viewSize>=_e.MD?0:(F=L[1].message)!=null&&F.draft?1:-1}return~(f=k(s))&&(c=y[f]=w[f](s)),{c(){e=v("div"),l.c(),n=D(),p&&p.c(),r=D(),b&&b.c(),a=D(),S&&S.c(),o=D(),c&&c.c(),d(e,"role","toolbar"),d(e,"class","local-mail-toolbar d-flex w-100 svelte-kqp7rd")},m(L,j){C(L,e,j),g[t].m(e,null),_(e,n),p&&p.m(e,null),_(e,r),b&&b.m(e,null),_(e,a),S&&S.m(e,null),_(e,o),~f&&y[f].m(e,null),m=!0},p(L,[j]){var Q,ee;let F=t;t=h(L),t===F?g[t].p(L,j):(ne(),N(g[F],1,1,()=>{g[F]=null}),re(),l=g[t],l?l.p(L,j):(l=g[t]=u[t](L),l.c()),A(l,1),l.m(e,n)),L[1].viewSize>=_e.MD?p?(p.p(L,j),j&2&&A(p,1)):(p=os(L),p.c(),A(p,1),p.m(e,r)):p&&(ne(),N(p,1,1,()=>{p=null}),re()),j&2&&(i=!((Q=L[1].message)!=null&&Q.draft)&&["shortname","fullname"].includes(L[1].settings.filterbycourse)),i?b?(b.p(L,j),j&2&&A(b,1)):(b=fs(L),b.c(),A(b,1),b.m(e,a)):b&&(ne(),N(b,1,1,()=>{b=null}),re()),(ee=L[1].message)!=null&&ee.draft&&L[1].draftSaved?S?S.p(L,j):(S=us(L),S.c(),S.m(e,o)):S&&(S.d(1),S=null);let V=f;f=k(L),f===V?~f&&y[f].p(L,j):(c&&(ne(),N(y[V],1,1,()=>{y[V]=null}),re()),~f?(c=y[f],c?c.p(L,j):(c=y[f]=w[f](L),c.c()),A(c,1),c.m(e,null)):c=null)},i(L){m||(A(l),A(p),A(b),A(c),m=!0)},o(L){N(l),N(p),N(b),N(c),m=!1},d(L){L&&T(e),g[t].d(),p&&p.d(),b&&b.d(),S&&S.d(),~f&&y[f].d()}}}function Qi(s,e,t){let l,n=$,r=()=>(n(),n=me(i,o=>t(1,l=o)),i);s.$$.on_destroy.push(()=>n());let{store:i}=e;r();const a=o=>i.selectCourse(o);return s.$$set=o=>{"store"in o&&r(t(0,i=o.store))},[i,l,a]}class Zi extends fe{constructor(e){super(),ue(this,e,Qi,Xi,oe,{store:0})}}const{window:xe}=Je;function cs(s){let e,t,l;return{c(){e=v("i"),t=D(),l=R(s[1]),d(e,"class","fa fa-angle-right mx-1"),d(e,"aria-hidden","true")},m(n,r){C(n,e,r),C(n,t,r),C(n,l,r)},p(n,r){r&2&&E(l,n[1])},d(n){n&&(T(e),T(t),T(l))}}}function ms(s){let e,t,l;return t=new ws({props:{strings:s[2].strings,courseid:s[2].params.courseid,courses:s[2].courses,onClick:s[0].navigate,onError:s[0].setError}}),{c(){e=v("div"),J(t.$$.fragment),d(e,"class","text-truncate d-flex")},m(n,r){C(n,e,r),W(t,e,null),l=!0},p(n,r){const i={};r&4&&(i.strings=n[2].strings),r&4&&(i.courseid=n[2].params.courseid),r&4&&(i.courses=n[2].courses),r&1&&(i.onClick=n[0].navigate),r&1&&(i.onError=n[0].setError),t.$set(i)},i(n){l||(A(t.$$.fragment,n),l=!0)},o(n){N(t.$$.fragment,n),l=!1},d(n){n&&T(e),X(t)}}}function ds(s){let e,t,l;return t=new ws({props:{strings:s[2].strings,courseid:s[2].params.courseid,courses:s[2].courses,onClick:s[0].navigate,onError:s[0].setError}}),{c(){e=v("div"),J(t.$$.fragment),d(e,"class","local-mail-view-side-column svelte-4ptkgt")},m(n,r){C(n,e,r),W(t,e,null),l=!0},p(n,r){const i={};r&4&&(i.strings=n[2].strings),r&4&&(i.courseid=n[2].params.courseid),r&4&&(i.courses=n[2].courses),r&1&&(i.onClick=n[0].navigate),r&1&&(i.onError=n[0].setError),t.$set(i)},i(n){l||(A(t.$$.fragment,n),l=!0)},o(n){N(t.$$.fragment,n),l=!1},d(n){n&&T(e),X(t)}}}function _s(s){let e,t,l;return t=new nn({props:{settings:s[2].settings,strings:s[2].strings,unread:s[2].unread,drafts:s[2].drafts,courses:s[2].courses,labels:s[2].labels,params:s[2].params,onClick:s[8]}}),{c(){e=v("div"),J(t.$$.fragment),d(e,"class","local-mail-view-side-column svelte-4ptkgt")},m(n,r){C(n,e,r),W(t,e,null),l=!0},p(n,r){const i={};r&4&&(i.settings=n[2].settings),r&4&&(i.strings=n[2].strings),r&4&&(i.unread=n[2].unread),r&4&&(i.drafts=n[2].drafts),r&4&&(i.courses=n[2].courses),r&4&&(i.labels=n[2].labels),r&4&&(i.params=n[2].params),r&1&&(i.onClick=n[8]),t.$set(i)},i(n){l||(A(t.$$.fragment,n),l=!0)},o(n){N(t.$$.fragment,n),l=!1},d(n){n&&T(e),X(t)}}}function xi(s){let e,t,l,n;return e=new yr({props:{store:s[0]}}),l=new gi({props:{store:s[0]}}),{c(){J(e.$$.fragment),t=D(),J(l.$$.fragment)},m(r,i){W(e,r,i),C(r,t,i),W(l,r,i),n=!0},p(r,i){const a={};i&1&&(a.store=r[0]),e.$set(a);const o={};i&1&&(o.store=r[0]),l.$set(o)},i(r){n||(A(e.$$.fragment,r),A(l.$$.fragment,r),n=!0)},o(r){N(e.$$.fragment,r),N(l.$$.fragment,r),n=!1},d(r){r&&T(t),X(e,r),X(l,r)}}}function ea(s){let e,t;return e=new Or({props:{store:s[0],message:s[2].message}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.store=l[0]),n&4&&(r.message=l[2].message),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function ta(s){let e,t;return e=new mi({props:{store:s[0],message:s[2].message,form:s[2].draftForm}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.store=l[0]),n&4&&(r.message=l[2].message),n&4&&(r.form=l[2].draftForm),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function gs(s){let e,t;return e=new Xn({props:{store:s[0]}}),{c(){J(e.$$.fragment)},m(l,n){W(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.store=l[0]),e.$set(r)},i(l){t||(A(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function la(s){let e,t,l,n,r,i=s[2].strings.pluginname+"",a,o,f,c,m,u,g,h,p,b,S,w,y,k,M,z,L,j,F,V,Q,ee,te,B,x,Z;document.title=e=s[4]+" - "+s[2].strings.pluginname;let le=s[2].viewSize<_e.LG&&cs(s);u=new Ri({props:{store:s[0]}});let q=s[2].viewSize<_e.LG&&ms(s),K=s[2].viewSize>=_e.LG&&ds(s);w=new Zi({props:{store:s[0]}});let U=s[2].viewSize>=_e.LG&&_s(s);const Y=[ta,ea,xi],ce=[];function ge(G,H){var ae;return(ae=G[2].message)!=null&&ae.draft&&G[2].draftForm?0:G[2].message?1:2}L=ge(s),j=ce[L]=Y[L](s);let P=s[2].viewSize<_e.MD&&gs(s);return Q=new Ii({props:{store:s[0]}}),te=new bn({props:{store:s[0]}}),{c(){t=D(),l=v("div"),n=v("div"),r=v("h1"),a=R(i),o=D(),le&&le.c(),f=D(),c=v("div"),m=v("div"),J(u.$$.fragment),g=D(),q&&q.c(),h=D(),p=v("div"),K&&K.c(),b=D(),S=v("div"),J(w.$$.fragment),y=D(),k=v("div"),U&&U.c(),M=D(),z=v("div"),j.c(),F=D(),P&&P.c(),V=D(),J(Q.$$.fragment),ee=D(),J(te.$$.fragment),d(r,"class","h2 local-mail-view-side-column text-truncate mb-4 svelte-4ptkgt"),d(m,"class","local-mail-view-search svelte-4ptkgt"),d(c,"class","local-mail-view-main-column d-flex mb-4 svelte-4ptkgt"),d(n,"class","row align-items-center"),d(S,"class","local-mail-view-main-column d-flex svelte-4ptkgt"),d(p,"class","row mb-3"),d(z,"class","local-mail-view-main-column svelte-4ptkgt"),d(k,"class","row mb-3"),d(l,"class","local-mail-view container-fluid py-4 svelte-4ptkgt"),O(l,"local-mail-loading",s[2].loading)},m(G,H){C(G,t,H),C(G,l,H),_(l,n),_(n,r),_(r,a),_(r,o),le&&le.m(r,null),_(n,f),_(n,c),_(c,m),W(u,m,null),_(c,g),q&&q.m(c,null),_(l,h),_(l,p),K&&K.m(p,null),_(p,b),_(p,S),W(w,S,null),_(l,y),_(l,k),U&&U.m(k,null),_(k,M),_(k,z),ce[L].m(z,null),_(l,F),P&&P.m(l,null),_(l,V),W(Q,l,null),_(l,ee),W(te,l,null),s[9](l),B=!0,x||(Z=[I(xe,"resize",s[6]),I(xe,"popstate",s[7]),I(xe,"beforeunload",s[5])],x=!0)},p(G,[H]){(!B||H&20)&&e!==(e=G[4]+" - "+G[2].strings.pluginname)&&(document.title=e),(!B||H&4)&&i!==(i=G[2].strings.pluginname+"")&&E(a,i),G[2].viewSize<_e.LG?le?le.p(G,H):(le=cs(G),le.c(),le.m(r,null)):le&&(le.d(1),le=null);const ae={};H&1&&(ae.store=G[0]),u.$set(ae),G[2].viewSize<_e.LG?q?(q.p(G,H),H&4&&A(q,1)):(q=ms(G),q.c(),A(q,1),q.m(c,null)):q&&(ne(),N(q,1,1,()=>{q=null}),re()),G[2].viewSize>=_e.LG?K?(K.p(G,H),H&4&&A(K,1)):(K=ds(G),K.c(),A(K,1),K.m(p,b)):K&&(ne(),N(K,1,1,()=>{K=null}),re());const Se={};H&1&&(Se.store=G[0]),w.$set(Se),G[2].viewSize>=_e.LG?U?(U.p(G,H),H&4&&A(U,1)):(U=_s(G),U.c(),A(U,1),U.m(k,M)):U&&(ne(),N(U,1,1,()=>{U=null}),re());let Te=L;L=ge(G),L===Te?ce[L].p(G,H):(ne(),N(ce[Te],1,1,()=>{ce[Te]=null}),re(),j=ce[L],j?j.p(G,H):(j=ce[L]=Y[L](G),j.c()),A(j,1),j.m(z,null)),G[2].viewSize<_e.MD?P?(P.p(G,H),H&4&&A(P,1)):(P=gs(G),P.c(),A(P,1),P.m(l,V)):P&&(ne(),N(P,1,1,()=>{P=null}),re());const Ce={};H&1&&(Ce.store=G[0]),Q.$set(Ce);const he={};H&1&&(he.store=G[0]),te.$set(he),(!B||H&4)&&O(l,"local-mail-loading",G[2].loading)},i(G){B||(A(u.$$.fragment,G),A(q),A(K),A(w.$$.fragment,G),A(U),A(j),A(P),A(Q.$$.fragment,G),A(te.$$.fragment,G),B=!0)},o(G){N(u.$$.fragment,G),N(q),N(K),N(w.$$.fragment,G),N(U),N(j),N(P),N(Q.$$.fragment,G),N(te.$$.fragment,G),B=!1},d(G){G&&(T(t),T(l)),le&&le.d(),X(u),q&&q.d(),K&&K.d(),X(w),U&&U.d(),ce[L].d(),P&&P.d(),X(Q),X(te),s[9](null),x=!1,pe(Z)}}}function sa(s,e,t){let l,n,r,i=$,a=()=>(i(),i=me(o,b=>t(2,r=b)),o);s.$$.on_destroy.push(()=>i());let{store:o}=e;a();let f,c=0;Ve(()=>{o.setViewportSize(window.innerWidth)}),sn(()=>{c!=r.navigationId&&(c=r.navigationId,f.scrollIntoView())});const m=b=>{if(r.draftData)return b.preventDefault(),o.updateDraft(r.draftData,!0),""},u=()=>o.setViewportSize(window.innerWidth),g=()=>o.navigate(bs()),h=b=>o.navigate(b);function p(b){we[b?"unshift":"push"](()=>{f=b,t(3,f)})}return s.$$set=b=>{"store"in b&&a(t(0,o=b.store))},s.$$.update=()=>{var b,S;s.$$.dirty&4&&t(1,l=r.params.tray=="inbox"?r.strings.inbox:r.params.tray=="starred"?r.strings.starredmail:r.params.tray=="sent"?r.strings.sentmail:r.params.tray=="drafts"?r.strings.drafts:r.params.tray=="trash"?r.strings.trash:r.params.tray=="label"?((b=r.labels.find(w=>w.id==r.params.labelid))==null?void 0:b.name)||"":r.params.tray=="course"&&((S=r.courses.find(w=>w.id==r.params.courseid))==null?void 0:S.fullname)||""),s.$$.dirty&6&&t(4,n=r.message?r.message.subject.trim()||r.strings.nosubject:l)},[o,l,r,f,n,m,u,g,h,p]}class na extends fe{constructor(e){super(),ue(this,e,sa,la,oe,{store:0})}}async function ra(){const s=document.getElementById("local-mail-view"),e=document.getElementById("local-mail-navbar"),t=window.local_mail_view_data;if(!t)return;const l=await un({userid:t.userid,settings:t.settings,preferences:t.preferences,strings:t.strings});if(s&&new na({target:s,props:{store:l}}),e){e.innerHTML="";const n=new rn({target:e,props:{settings:l.get().settings,strings:l.get().strings,unread:l.get().unread,drafts:l.get().drafts,courses:l.get().courses,labels:l.get().labels,onClick:l.navigate,onError:l.setError}});l.subscribe(r=>{n.$set({settings:r.settings,strings:r.strings,unread:r.unread,drafts:r.drafts,courses:r.courses,labels:r.labels,params:r.params})})}}ra();
