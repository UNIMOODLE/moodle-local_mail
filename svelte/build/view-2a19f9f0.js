import{n as U,i as Rl,a as _n,l as gn,c as pn,d as bn,s as Mt,S as ce,b as me,e as ue,f as hn,g as L,h,t as I,j as u,k as S,m as g,o as H,p as $e,q as Ce,r as Fe,u as R,v as kn,w as vn,x as wn,y as T,z as Le,A as qe,B as N,C as D,D as we,E as Xe,F as Fl,G as Me,H as pe,I as ie,J as re,K as Y,L as J,M as W,N as ge,O,P as fe,Q as ye,R as Se,T as De,U as Qe,V as _e,W as yn,X as Ul,Y as Ee,Z as Ue,_ as ut,$ as Pe,a0 as Gl,a1 as Ol,a2 as Be,a3 as st,a4 as Ct,a5 as ot,a6 as Je,a7 as ft,a8 as Hl,a9 as We,aa as Ve,ab as Ke,ac as $n,ad as Vl,ae as Mn,af as Cn,ag as Kl,ah as Sn,ai as rt,aj as Dn}from"./global-bac9d3e2.js";const Ze=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Yl(l,e,t,s){if(!e)return U;const n=l.getBoundingClientRect();if(e.left===n.left&&e.right===n.right&&e.top===n.top&&e.bottom===n.bottom)return U;const{delay:i=0,duration:r=300,easing:a=Rl,start:o=_n()+i,end:f=o+r,tick:d=U,css:c}=t(l,{from:e,to:n},s);let m=!0,_=!1,b;function p(){c&&(b=pn(l,0,1,r,i,a,c)),i||(_=!0)}function v(){c&&bn(l,b),m=!1}return gn(y=>{if(!_&&y>=o&&(_=!0),_&&y>=f&&(d(1,0),v()),!m)return!1;if(_){const $=y-o,w=0+1*a($/r);d(w,1-w)}return!0}),p(),d(0,1),v}function Jl(l){const e=getComputedStyle(l);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:s}=e,n=l.getBoundingClientRect();l.style.position="absolute",l.style.width=t,l.style.height=s,ct(l,n)}}function ct(l,e){const t=l.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const s=getComputedStyle(l),n=s.transform==="none"?"":s.transform;l.style.transform=`${n} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}var Re=(l=>(l[l.NotDeleted=0]="NotDeleted",l[l.Deleted=1]="Deleted",l[l.DeletedForever=2]="DeletedForever",l))(Re||{}),lt=(l=>(l[l.No=0]="No",l[l.Separate=1]="Separate",l[l.Visible=2]="Visible",l))(lt||{}),ze=(l=>(l.TO="to",l.CC="cc",l.BCC="bcc",l))(ze||{}),de=(l=>(l[l.SM=576]="SM",l[l.MD=768]="MD",l[l.LG=992]="LG",l[l.XL=1200]="XL",l))(de||{});function Wl(l){const e=l-1;return e*e*e+1}function Ne(l,{delay:e=0,duration:t=400,easing:s=Rl}={}){const n=+getComputedStyle(l).opacity;return{delay:e,duration:t,easing:s,css:i=>`opacity: ${i*n}`}}function nt(l,{delay:e=0,duration:t=400,easing:s=Wl,x:n=0,y:i=0,opacity:r=0}={}){const a=getComputedStyle(l),o=+a.opacity,f=a.transform==="none"?"":a.transform,d=o*(1-r),[c,m]=Mt(n),[_,b]=Mt(i);return{delay:e,duration:t,easing:s,css:(p,v)=>`
			transform: ${f} translate(${(1-p)*c}${m}, ${(1-p)*_}${b});
			opacity: ${o-d*v}`}}const{document:Tn}=Ze;function St(l){let e,t,s=l[1]&&Dt(l),n=l[2]&&l[4]&&Tt(l);return{c(){e=h("div"),s&&s.c(),t=L(),n&&n.c(),u(e,"class","modal-footer")},m(i,r){S(i,e,r),s&&s.m(e,null),g(e,t),n&&n.m(e,null)},p(i,r){i[1]?s?s.p(i,r):(s=Dt(i),s.c(),s.m(e,t)):s&&(s.d(1),s=null),i[2]&&i[4]?n?n.p(i,r):(n=Tt(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(i){i&&D(e),s&&s.d(),n&&n.d()}}}function Dt(l){let e,t,s,n;return{c(){e=h("button"),t=I(l[1]),u(e,"type","button"),u(e,"class","btn btn-secondary")},m(i,r){S(i,e,r),g(e,t),s||(n=H(e,"click",function(){$e(l[3])&&l[3].apply(this,arguments)}),s=!0)},p(i,r){l=i,r&2&&R(t,l[1])},d(i){i&&D(e),s=!1,n()}}}function Tt(l){let e,t,s,n,i;return{c(){e=h("button"),t=I(l[2]),u(e,"type","button"),u(e,"class",s="btn "+l[5]),e.disabled=l[6]},m(r,a){S(r,e,a),g(e,t),n||(i=H(e,"click",function(){$e(l[4])&&l[4].apply(this,arguments)}),n=!0)},p(r,a){l=r,a&4&&R(t,l[2]),a&32&&s!==(s="btn "+l[5])&&u(e,"class",s),a&64&&(e.disabled=l[6])},d(r){r&&D(e),n=!1,i()}}}function Ln(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,y,$,w,k,M;const j=l[10].default,C=hn(j,l,l[9],null);let z=(l[1]||l[2]&&l[4])&&St(l);return{c(){e=L(),t=h("div"),s=h("div"),n=h("div"),i=h("div"),r=h("h5"),a=I(l[0]),o=L(),f=h("button"),d=h("span"),d.textContent="Ã—",c=L(),m=h("div"),C&&C.c(),_=L(),z&&z.c(),v=L(),y=h("div"),u(r,"class","modal-title"),u(d,"aria-hidden","true"),u(f,"type","button"),u(f,"class","close"),u(f,"aria-label",l[1]),u(i,"class","modal-header"),u(m,"class","modal-body"),u(n,"class","modal-content"),u(s,"class","modal-dialog"),u(t,"class","modal show"),u(t,"tabindex","-1"),u(t,"role","dialog"),u(t,"aria-label",l[0]),u(t,"aria-modal","true"),u(y,"class","modal-backdrop show")},m(B,q){S(B,e,q),S(B,t,q),g(t,s),g(s,n),g(n,i),g(i,r),g(r,a),g(i,o),g(i,f),g(f,d),g(n,c),g(n,m),C&&C.m(m,null),g(n,_),z&&z.m(n,null),l[11](t),S(B,v,q),S(B,y,q),w=!0,k||(M=[H(Tn.body,"keyup",l[8]),H(f,"click",function(){$e(l[3])&&l[3].apply(this,arguments)}),Ce(b=Fe.call(null,t,l[3]))],k=!0)},p(B,[q]){l=B,(!w||q&1)&&R(a,l[0]),(!w||q&2)&&u(f,"aria-label",l[1]),C&&C.p&&(!w||q&512)&&kn(C,j,l,l[9],w?wn(j,l[9],q,null):vn(l[9]),null),l[1]||l[2]&&l[4]?z?z.p(l,q):(z=St(l),z.c(),z.m(n,null)):z&&(z.d(1),z=null),(!w||q&1)&&u(t,"aria-label",l[0]),b&&$e(b.update)&&q&8&&b.update.call(null,l[3])},i(B){w||(T(C,B),Le(()=>{w&&(p||(p=qe(t,nt,{y:-100},!0)),p.run(1))}),Le(()=>{w&&($||($=qe(y,Ne,{},!0)),$.run(1))}),w=!0)},o(B){N(C,B),p||(p=qe(t,nt,{y:-100},!1)),p.run(0),$||($=qe(y,Ne,{},!1)),$.run(0),w=!1},d(B){B&&(D(e),D(t),D(v),D(y)),C&&C.d(B),z&&z.d(),l[11](null),B&&p&&p.end(),B&&$&&$.end(),k=!1,we(M)}}}function zn(l,e,t){let{$$slots:s={},$$scope:n}=e,{title:i}=e,{cancelText:r=""}=e,{confirmText:a=""}=e,{onCancel:o}=e,{onConfirm:f=void 0}=e,{confirmClass:d="btn-primary"}=e,{confirmDisabled:c=!1}=e,m;Xe(()=>{document.body.classList.add("modal-open"),m.focus()}),Fl(()=>{document.body.classList.remove("modal-open")});const _=p=>{p.key=="Escape"&&o()};function b(p){Me[p?"unshift":"push"](()=>{m=p,t(7,m)})}return l.$$set=p=>{"title"in p&&t(0,i=p.title),"cancelText"in p&&t(1,r=p.cancelText),"confirmText"in p&&t(2,a=p.confirmText),"onCancel"in p&&t(3,o=p.onCancel),"onConfirm"in p&&t(4,f=p.onConfirm),"confirmClass"in p&&t(5,d=p.confirmClass),"confirmDisabled"in p&&t(6,c=p.confirmDisabled),"$$scope"in p&&t(9,n=p.$$scope)},[i,r,a,o,f,d,c,m,_,n,s,b]}class Ge extends ce{constructor(e){super(),me(this,e,zn,Ln,ue,{title:0,cancelText:1,confirmText:2,onCancel:3,onConfirm:4,confirmClass:5,confirmDisabled:6})}}function Lt(l){let e,t;return e=new Ge({props:{title:l[1].strings.error,onCancel:l[2],$$slots:{default:[jn]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.title=s[1].strings.error),n&1&&(i.onCancel=s[2]),n&10&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function zt(l){var n;let e,t=((n=l[1].error)==null?void 0:n.debuginfo)+"",s;return{c(){e=h("p"),s=I(t)},m(i,r){S(i,e,r),g(e,s)},p(i,r){var a;r&2&&t!==(t=((a=i[1].error)==null?void 0:a.debuginfo)+"")&&R(s,t)},d(i){i&&D(e)}}}function jt(l){var n;let e,t=((n=l[1].error)==null?void 0:n.stacktrace)+"",s;return{c(){e=h("pre"),s=I(t)},m(i,r){S(i,e,r),g(e,s)},p(i,r){var a;r&2&&t!==(t=((a=i[1].error)==null?void 0:a.stacktrace)+"")&&R(s,t)},d(i){i&&D(e)}}}function jn(l){var f,d,c;let e,t=((f=l[1].error)==null?void 0:f.message)+"",s,n,i,r,a=((d=l[1].error)==null?void 0:d.debuginfo)&&zt(l),o=((c=l[1].error)==null?void 0:c.stacktrace)&&jt(l);return{c(){e=h("p"),s=I(t),n=L(),a&&a.c(),i=L(),o&&o.c(),r=pe()},m(m,_){S(m,e,_),g(e,s),S(m,n,_),a&&a.m(m,_),S(m,i,_),o&&o.m(m,_),S(m,r,_)},p(m,_){var b,p,v;_&2&&t!==(t=((b=m[1].error)==null?void 0:b.message)+"")&&R(s,t),(p=m[1].error)!=null&&p.debuginfo?a?a.p(m,_):(a=zt(m),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null),(v=m[1].error)!=null&&v.stacktrace?o?o.p(m,_):(o=jt(m),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},d(m){m&&(D(e),D(n),D(i),D(r)),a&&a.d(m),o&&o.d(m)}}}function Nn(l){let e,t,s=l[1].error&&Lt(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,[i]){n[1].error?s?(s.p(n,i),i&2&&T(s,1)):(s=Lt(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),N(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){N(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function Bn(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.setError();return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class An extends ce{constructor(e){super(),me(this,e,Bn,Nn,ue,{store:0})}}function qn(l){let e,t,s,n,i,r;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-trash"),u(e,"type","button"),u(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.movetotrash),O(e,"btn-secondary",!l[1]),O(e,"disabled",!l[2].selectedMessages.size)},m(a,o){S(a,e,o),g(e,t),i||(r=H(e,"click",l[3]),i=!0)},p(a,[o]){o&4&&s!==(s=!a[2].selectedMessages.size)&&(e.disabled=s),o&4&&n!==(n=a[2].strings.movetotrash)&&u(e,"title",n),o&2&&O(e,"btn-secondary",!a[1]),o&4&&O(e,"disabled",!a[2].selectedMessages.size)},i:U,o:U,d(a){a&&D(e),i=!1,r()}}}function In(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:a=!1}=e;const o=()=>r.setDeleted(Array.from(s.selectedMessages.keys()),Re.Deleted,!0);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"transparent"in f&&t(1,a=f.transparent)},[r,a,s,o]}class Xl extends ce{constructor(e){super(),me(this,e,In,qn,ue,{store:0,transparent:1})}}function Nt(l){let e,t;return e=new Ge({props:{title:l[2].strings.deleteforever,cancelText:l[2].strings.cancel,confirmText:l[2].strings.deleteforever,confirmClass:"btn-danger",onCancel:l[5],onConfirm:l[3],$$slots:{default:[En]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.deleteforever),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.deleteforever),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function En(l){let e=l[2].strings[l[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"",t;return{c(){t=I(e)},m(s,n){S(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings[s[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"")&&R(t,e)},d(s){s&&D(t)}}}function Pn(l){let e,t,s,n,i,r,a,o,f,d=l[2].params.dialog=="deleteforever"&&Nt(l);return{c(){e=h("button"),t=h("i"),i=L(),d&&d.c(),r=pe(),u(t,"class","fa fa-fw fa-trash"),u(e,"type","button"),u(e,"class","local-mail-action-delete-forever btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.deleteforever),O(e,"btn-secondary",!l[1]),O(e,"disabled",!l[2].selectedMessages.size)},m(c,m){S(c,e,m),g(e,t),S(c,i,m),d&&d.m(c,m),S(c,r,m),a=!0,o||(f=H(e,"click",l[4]),o=!0)},p(c,[m]){(!a||m&4&&s!==(s=!c[2].selectedMessages.size))&&(e.disabled=s),(!a||m&4&&n!==(n=c[2].strings.deleteforever))&&u(e,"title",n),(!a||m&2)&&O(e,"btn-secondary",!c[1]),(!a||m&4)&&O(e,"disabled",!c[2].selectedMessages.size),c[2].params.dialog=="deleteforever"?d?(d.p(c,m),m&4&&T(d,1)):(d=Nt(c),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(ie(),N(d,1,1,()=>{d=null}),re())},i(c){a||(T(d),a=!0)},o(c){N(d),a=!1},d(c){c&&(D(e),D(i),D(r)),d&&d.d(c),o=!1,f()}}}function Rn(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,c=>t(2,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:a=!1}=e;const o=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Re.DeletedForever,!0)},f=()=>r.showDialog("deleteforever"),d=()=>r.hideDialog();return l.$$set=c=>{"store"in c&&i(t(0,r=c.store)),"transparent"in c&&t(1,a=c.transparent)},[r,a,s,o,f,d]}class Ql extends ce{constructor(e){super(),me(this,e,Rn,Pn,ue,{store:0,transparent:1})}}const it=["","blue","indigo","purple","pink","red","orange","yellow","green","teal","cyan"];function Bt(l){if(l==0)return"";const e=new Date(l*1e3);return[String(e.getFullYear()),String(e.getMonth()+1).padStart(2,"0"),String(e.getDate()).padStart(2,"0")].join("-")}function At(l){const e=[{bytes:1099511627776,name:"TB"},{bytes:1073741824,name:"GB"},{bytes:1048576,name:"MB"},{bytes:1024,name:"KB"}];for(const t of e)if(l>=t.bytes)return`${Intl.NumberFormat(void 0,{maximumFractionDigits:1}).format(l/t.bytes)} ${t.name}`;return`${l} B`}function qt(l){return l.trim().replaceAll(/\s+/gu," ")}function Ie(l,e){if(l=l||"",typeof e=="string"||typeof e=="number")l=l.replace("{$a}",e.toString());else for(const t in e)l=l.replace(`{$a->${t}}`,e[t].toString());return l}function Fn(l){return l?Math.floor(new Date(parseInt(l.slice(0,4)),parseInt(l.slice(5,7))-1,parseInt(l.slice(8,10)),23,59,59).getTime()/1e3):0}function It(l,e,t){const s=l.slice();return s[16]=e[t],s}function Un(l){let e;return{c(){e=I("Â ")},m(t,s){S(t,e,s)},p:U,d(t){t&&D(e)}}}function Gn(l){let e=l[5].strings.errorrepeatedlabelname+"",t;return{c(){t=I(e)},m(s,n){S(s,t,n)},p(s,n){n&32&&e!==(e=s[5].strings.errorrepeatedlabelname+"")&&R(t,e)},d(s){s&&D(t)}}}function On(l){let e;return{c(){e=h("span"),e.textContent="a",u(e,"aria-hidden","true")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function Hn(l){let e;return{c(){e=h("i"),u(e,"class","fa fa-check local-mail-label-modal-color-option-check")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function Et(l,e){let t,s,n,i,r,a;function o(m,_){return m[16]==m[7]?Hn:On}let f=o(e),d=f(e);function c(){return e[15](e[16])}return{key:l,first:null,c(){t=h("button"),d.c(),s=L(),u(t,"role","radio"),u(t,"aria-checked",n=e[16]==e[7]),u(t,"tabindex","0"),u(t,"title",i=e[5].strings[`color${e[16]}`]),u(t,"class","local-mail-label-modal-color-option btn"),u(t,"style",`color: var(--local-mail-color-${e[16]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${e[16]}-bg, var(--local-mail-color-gray-bg))`),this.first=t},m(m,_){S(m,t,_),d.m(t,null),g(t,s),r||(a=H(t,"click",Se(c)),r=!0)},p(m,_){e=m,f!==(f=o(e))&&(d.d(1),d=f(e),d&&(d.c(),d.m(t,s))),_&128&&n!==(n=e[16]==e[7])&&u(t,"aria-checked",n),_&32&&i!==(i=e[5].strings[`color${e[16]}`])&&u(t,"title",i)},d(m){m&&D(t),d.d(),r=!1,a()}}}function Vn(l){let e,t,s,n=l[5].strings.name+"",i,r,a,o,f,d,c,m,_,b,p,v=l[5].strings.color+"",y,$,w,k,M=[],j=new Map,C,z,B;function q(V,te){return V[4]?Gn:Un}let G=q(l),P=G(l),K=fe(it);const x=V=>V[16];for(let V=0;V<K.length;V+=1){let te=It(l,K,V),le=x(te);j.set(le,M[V]=Et(le,te))}return{c(){e=h("form"),t=h("div"),s=h("label"),i=I(n),r=L(),a=h("input"),f=L(),d=h("div"),P.c(),c=L(),m=h("div"),m.textContent="Â ",_=L(),b=h("div"),p=h("label"),y=I(v),w=L(),k=h("div");for(let V=0;V<M.length;V+=1)M[V].c();u(s,"for","local-mail-label-modal-name"),u(a,"type","text"),a.required=!0,u(a,"class","form-control is-invalid"),u(a,"id",o=l[9]+"-name"),O(a,"is-valid",l[8]),O(a,"is-invalid",!l[8]),u(d,"class","invalid-feedback"),u(m,"class","valid-feedback"),u(t,"class","form-group mb-0"),u(p,"for",$=l[9]+"-color"),u(k,"role","radiogroup"),u(k,"class","local-mail-label-modal-color"),u(k,"id",C=l[9]+"-color"),u(b,"class","form-group")},m(V,te){S(V,e,te),g(e,t),g(t,s),g(s,i),g(t,r),g(t,a),l[13](a),ye(a,l[3]),g(t,f),g(t,d),P.m(d,null),g(t,c),g(t,m),g(e,_),g(e,b),g(b,p),g(p,y),g(b,w),g(b,k);for(let le=0;le<M.length;le+=1)M[le]&&M[le].m(k,null);z||(B=[H(a,"input",l[14]),H(e,"submit",Se(l[10]))],z=!0)},p(V,te){te&32&&n!==(n=V[5].strings.name+"")&&R(i,n),te&512&&o!==(o=V[9]+"-name")&&u(a,"id",o),te&8&&a.value!==V[3]&&ye(a,V[3]),te&256&&O(a,"is-valid",V[8]),te&256&&O(a,"is-invalid",!V[8]),G===(G=q(V))&&P?P.p(V,te):(P.d(1),P=G(V),P&&(P.c(),P.m(d,null))),te&32&&v!==(v=V[5].strings.color+"")&&R(y,v),te&512&&$!==($=V[9]+"-color")&&u(p,"for",$),te&160&&(K=fe(it),M=De(M,te,x,1,V,K,j,k,Qe,Et,null,It)),te&512&&C!==(C=V[9]+"-color")&&u(k,"id",C)},d(V){V&&D(e),l[13](null),P.d();for(let te=0;te<M.length;te+=1)M[te].d();z=!1,we(B)}}}function Kn(l){let e,t;return e=new Ge({props:{title:l[5].strings[l[1]?"editlabel":"newlabel"],cancelText:l[5].strings.cancel,onCancel:l[2],confirmText:l[5].strings[l[1]?"save":"create"],confirmDisabled:!l[8],onConfirm:l[10],$$slots:{default:[Vn]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,[n]){const i={};n&34&&(i.title=s[5].strings[s[1]?"editlabel":"newlabel"]),n&32&&(i.cancelText=s[5].strings.cancel),n&4&&(i.onCancel=s[2]),n&34&&(i.confirmText=s[5].strings[s[1]?"save":"create"]),n&256&&(i.confirmDisabled=!s[8]),n&525304&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Yn(l,e,t){let s,n,i,r,a,o,f,d=U,c=()=>(d(),d=ge(m,M=>t(5,f=M)),m);l.$$.on_destroy.push(()=>d());let{store:m}=e;c();let{label:_=void 0}=e,{onCancel:b}=e,{onSubmit:p}=e,v;const y=async()=>{p(n,i)};Xe(()=>v.focus());function $(M){Me[M?"unshift":"push"](()=>{v=M,t(6,v)})}function w(){n=this.value,t(3,n),t(1,_)}const k=M=>{t(7,i=M)};return l.$$set=M=>{"store"in M&&c(t(0,m=M.store)),"label"in M&&t(1,_=M.label),"onCancel"in M&&t(2,b=M.onCancel),"onSubmit"in M&&t(11,p=M.onSubmit)},l.$$.update=()=>{l.$$.dirty&2&&t(9,s=`local-mail-label-modal-${(_==null?void 0:_.id)||"new"}`),l.$$.dirty&2&&t(3,n=(_==null?void 0:_.name)||""),l.$$.dirty&2&&t(7,i=(_==null?void 0:_.color)||it[0]),l.$$.dirty&8&&t(12,r=qt(n)==""),l.$$.dirty&42&&t(4,a=f.labels.some(M=>M.id!=(_==null?void 0:_.id)&&M.name==qt(n))),l.$$.dirty&4112&&t(8,o=!r&&!a)},[m,_,b,n,a,f,v,i,o,s,y,p,r,$,w,k]}class Zl extends ce{constructor(e){super(),me(this,e,Yn,Kn,ue,{store:0,label:1,onCancel:2,onSubmit:11})}}const{Map:Jn}=Ze;function Pt(l,e,t){const s=l.slice();return s[16]=e[t],s}function Rt(l){let e,t=[],s=new Jn,n,i,r=fe(l[3].labels);const a=m=>m[16].id;for(let m=0;m<r.length;m+=1){let _=Pt(l,r,m),b=a(_);s.set(b,t[m]=Ft(b,_))}let o=l[3].labels.length>0&&Ut();function f(m,_){return m[6]?Xn:Wn}let d=f(l),c=d(l);return{c(){e=h("div");for(let m=0;m<t.length;m+=1)t[m].c();n=L(),o&&o.c(),i=L(),c.c(),u(e,"class","dropdown-menu show")},m(m,_){S(m,e,_);for(let b=0;b<t.length;b+=1)t[b]&&t[b].m(e,null);g(e,n),o&&o.m(e,null),g(e,i),c.m(e,null)},p(m,_){_&552&&(r=fe(m[3].labels),t=De(t,_,a,1,m,r,s,e,Qe,Ft,n,Pt)),m[3].labels.length>0?o||(o=Ut(),o.c(),o.m(e,i)):o&&(o.d(1),o=null),d===(d=f(m))&&c?c.p(m,_):(c.d(1),c=d(m),c&&(c.c(),c.m(e,null)))},d(m){m&&D(e);for(let _=0;_<t.length;_+=1)t[_].d();o&&o.d(),c.d()}}}function Ft(l,e){let t,s,n,i,r=e[16].name+"",a,o,f;function d(){return e[14](e[16])}return{key:l,first:null,c(){t=h("button"),s=h("i"),i=L(),a=I(r),u(s,"class",n="fa fa-fw "+e[5](e[16].id)),u(t,"type","button"),u(t,"class","dropdown-item local-mail-action-label-button-item"),this.first=t},m(c,m){S(c,t,m),g(t,s),g(t,i),g(t,a),o||(f=H(t,"click",d),o=!0)},p(c,m){e=c,m&40&&n!==(n="fa fa-fw "+e[5](e[16].id))&&u(s,"class",n),m&8&&r!==(r=e[16].name+"")&&R(a,r)},d(c){c&&D(t),o=!1,f()}}}function Ut(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function Wn(l){let e,t=l[3].strings.newlabel+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,a){S(r,e,a),g(e,s),n||(i=H(e,"click",l[11]),n=!0)},p(r,a){a&8&&t!==(t=r[3].strings.newlabel+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Xn(l){let e,t=l[3].strings.apply+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,a){S(r,e,a),g(e,s),n||(i=H(e,"click",l[10]),n=!0)},p(r,a){a&8&&t!==(t=r[3].strings.apply+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Gt(l){let e,t;return e=new Zl({props:{store:l[0],onCancel:l[15],onSubmit:l[12]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[15]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Qn(l){let e,t,s,n,i,r,a,o,f,d,c=l[4]&&Rt(l),m=l[3].params.dialog=="createlabel"&&Gt(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=L(),c&&c.c(),a=L(),m&&m.c(),u(s,"class","fa fa-fw fa-tag"),u(t,"type","button"),u(t,"class","local-mail-action-label-button btn dropdown-toggle"),t.disabled=n=!l[3].selectedMessages.size,u(t,"aria-expanded",l[4]),u(t,"title",i=l[3].strings.labels),O(t,"btn-secondary",!l[1]),O(t,"disabled",!l[3].selectedMessages.size),u(e,"class","btn-group"),u(e,"role","group"),O(e,"dropup",l[2])},m(_,b){S(_,e,b),g(e,t),g(t,s),g(e,r),c&&c.m(e,null),g(e,a),m&&m.m(e,null),o=!0,f||(d=[H(t,"click",l[8]),Ce(Fe.call(null,e,l[7]))],f=!0)},p(_,[b]){(!o||b&8&&n!==(n=!_[3].selectedMessages.size))&&(t.disabled=n),(!o||b&16)&&u(t,"aria-expanded",_[4]),(!o||b&8&&i!==(i=_[3].strings.labels))&&u(t,"title",i),(!o||b&2)&&O(t,"btn-secondary",!_[1]),(!o||b&8)&&O(t,"disabled",!_[3].selectedMessages.size),_[4]?c?c.p(_,b):(c=Rt(_),c.c(),c.m(e,a)):c&&(c.d(1),c=null),_[3].params.dialog=="createlabel"?m?(m.p(_,b),b&8&&T(m,1)):(m=Gt(_),m.c(),T(m,1),m.m(e,null)):m&&(ie(),N(m,1,1,()=>{m=null}),re()),(!o||b&4)&&O(e,"dropup",_[2])},i(_){o||(T(m),o=!0)},o(_){N(m),o=!1},d(_){_&&D(e),c&&c.d(),m&&m.d(),f=!1,we(d)}}}function Zn(l,e,t){let s,n,i,r=U,a=()=>(r(),r=ge(o,M=>t(3,i=M)),o);l.$$.on_destroy.push(()=>r());let{store:o}=e;a();let{transparent:f=!1}=e,{dropup:d=!1}=e,c=!1,m=new Map;const _=()=>{t(4,c=!1)},b=()=>{t(4,c=!c)},p=M=>{t(13,m=new Map(Array.from(m.entries()).map(([j,C])=>[j,j==M?C=="true"?"false":"true":C])))},v=()=>{t(4,c=!1),o.setLabels(Array.from(m.keys()).filter(M=>m.get(M)=="true"),Array.from(m.keys()).filter(M=>m.get(M)=="false"))},y=()=>{_(),o.showDialog("createlabel")},$=async(M,j)=>{o.hideDialog();const C=await o.createLabel(M,j);C&&o.setLabels([C],[])},w=M=>p(M.id),k=()=>o.hideDialog();return l.$$set=M=>{"store"in M&&a(t(0,o=M.store)),"transparent"in M&&t(1,f=M.transparent),"dropup"in M&&t(2,d=M.dropup)},l.$$.update=()=>{l.$$.dirty&8&&t(13,m=new Map(i.labels.map(M=>{const j=Array.from(i.selectedMessages.values()).filter(C=>C.labels.some(z=>z.id==M.id));return[M.id,j.length==0?"false":j.length<i.selectedMessages.size?"mixed":"true"]}))),l.$$.dirty&8200&&t(6,s=Array.from(m.entries()).some(([M,j])=>Array.from(i.selectedMessages.values()).some(C=>j=="true"&&C.labels.every(z=>z.id!=M)||j=="false"&&C.labels.some(z=>z.id==M)))),l.$$.dirty&8192&&t(5,n=M=>m.get(M)=="false"?"fa-square-o":m.get(M)=="mixed"?"fa-minus-square-o":"fa-check-square-o")},[o,f,d,i,c,n,s,_,b,p,v,y,$,m,w,k]}class xl extends ce{constructor(e){super(),me(this,e,Zn,Qn,ue,{store:0,transparent:1,dropup:2})}}function Ot(l){let e;function t(i,r){return i[8].params.tray=="trash"?ei:xn}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),u(e,"class","dropdown-menu show")},m(i,r){S(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&D(e),n.d()}}}function xn(l){let e,t,s,n,i,r=l[6]&&Ht(l),a=l[7]&&Vt(l),o=l[4]&&Kt(l),f=l[5]&&Yt(l),d=l[3]&&Jt(l);return{c(){r&&r.c(),e=L(),a&&a.c(),t=L(),o&&o.c(),s=L(),f&&f.c(),n=L(),d&&d.c(),i=pe()},m(c,m){r&&r.m(c,m),S(c,e,m),a&&a.m(c,m),S(c,t,m),o&&o.m(c,m),S(c,s,m),f&&f.m(c,m),S(c,n,m),d&&d.m(c,m),S(c,i,m)},p(c,m){c[6]?r?r.p(c,m):(r=Ht(c),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),c[7]?a?a.p(c,m):(a=Vt(c),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),c[4]?o?o.p(c,m):(o=Kt(c),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),c[5]?f?f.p(c,m):(f=Yt(c),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null),c[3]?d?d.p(c,m):(d=Jt(c),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null)},d(c){c&&(D(e),D(t),D(s),D(n),D(i)),r&&r.d(c),a&&a.d(c),o&&o.d(c),f&&f.d(c),d&&d.d(c)}}}function ei(l){let e,t=l[8].strings.emptytrash+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=H(e,"click",l[19]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.emptytrash+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Ht(l){let e,t=l[8].strings.markasread+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=H(e,"click",l[22]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasread+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Vt(l){let e,t=l[8].strings.markasunread+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=H(e,"click",l[23]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasunread+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Kt(l){let e,t=l[8].strings.markasstarred+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=H(e,"click",l[24]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasstarred+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Yt(l){let e,t=l[8].strings.markasunstarred+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=H(e,"click",l[25]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasunstarred+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Jt(l){let e,t,s=l[8].strings.editlabel+"",n,i,r,a=l[8].strings.deletelabel+"",o,f,d,c=(l[6]||l[7]||l[4]||l[5])&&Wt();return{c(){c&&c.c(),e=L(),t=h("button"),n=I(s),i=L(),r=h("button"),o=I(a),u(t,"type","button"),u(t,"class","dropdown-item"),u(r,"type","button"),u(r,"class","dropdown-item")},m(m,_){c&&c.m(m,_),S(m,e,_),S(m,t,_),g(t,n),S(m,i,_),S(m,r,_),g(r,o),f||(d=[H(t,"click",l[15]),H(r,"click",l[17])],f=!0)},p(m,_){m[6]||m[7]||m[4]||m[5]?c||(c=Wt(),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null),_&256&&s!==(s=m[8].strings.editlabel+"")&&R(n,s),_&256&&a!==(a=m[8].strings.deletelabel+"")&&R(o,a)},d(m){m&&(D(e),D(t),D(i),D(r)),c&&c.d(m),f=!1,we(d)}}}function Wt(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function ti(l){let e,t,s,n;const i=[ni,li],r=[];function a(o,f){return o[8].params.dialog=="editlabel"?0:o[8].params.dialog=="deletelabel"?1:-1}return~(e=a(l))&&(t=r[e]=i[e](l)),{c(){t&&t.c(),s=pe()},m(o,f){~e&&r[e].m(o,f),S(o,s,f),n=!0},p(o,f){let d=e;e=a(o),e===d?~e&&r[e].p(o,f):(t&&(ie(),N(r[d],1,1,()=>{r[d]=null}),re()),~e?(t=r[e],t?t.p(o,f):(t=r[e]=i[e](o),t.c()),T(t,1),t.m(s.parentNode,s)):t=null)},i(o){n||(T(t),n=!0)},o(o){N(t),n=!1},d(o){o&&D(s),~e&&r[e].d(o)}}}function si(l){let e,t,s=l[8].params.dialog=="emptytrash"&&Xt(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,i){n[8].params.dialog=="emptytrash"?s?(s.p(n,i),i&256&&T(s,1)):(s=Xt(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),N(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){N(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function li(l){let e,t;return e=new Ge({props:{title:l[8].strings.deletelabel,cancelText:l[8].strings.cancel,confirmText:l[8].strings.deletelabel,confirmClass:"btn-danger",onCancel:l[28],onConfirm:l[18],$$slots:{default:[ii]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&256&&(i.title=s[8].strings.deletelabel),n&256&&(i.cancelText=s[8].strings.cancel),n&256&&(i.confirmText=s[8].strings.deletelabel),n&1&&(i.onCancel=s[28]),n&536871176&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function ni(l){let e,t;return e=new Zl({props:{store:l[0],label:l[3],onCancel:l[27],onSubmit:l[16]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.label=s[3]),n&1&&(i.onCancel=s[27]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function ii(l){let e=Ie(l[8].strings.deletelabelconfirm,l[3].name)+"",t;return{c(){t=I(e)},m(s,n){S(s,t,n)},p(s,n){n&264&&e!==(e=Ie(s[8].strings.deletelabelconfirm,s[3].name)+"")&&R(t,e)},d(s){s&&D(t)}}}function Xt(l){let e,t;return e=new Ge({props:{title:l[8].strings.emptytrash,cancelText:l[8].strings.cancel,confirmText:l[8].strings.emptytrash,confirmClass:"btn-danger",onCancel:l[26],onConfirm:l[20],$$slots:{default:[ri]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&256&&(i.title=s[8].strings.emptytrash),n&256&&(i.cancelText=s[8].strings.cancel),n&256&&(i.confirmText=s[8].strings.emptytrash),n&1&&(i.onCancel=s[26]),n&536871168&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function ri(l){let e=l[8].strings.emptytrashconfirm+"",t;return{c(){t=I(e)},m(s,n){S(s,t,n)},p(s,n){n&256&&e!==(e=s[8].strings.emptytrashconfirm+"")&&R(t,e)},d(s){s&&D(t)}}}function ai(l){let e,t,s,n,i,r,a,o,f,d,c,m,_=l[9]&&Ot(l);const b=[si,ti],p=[];function v(y,$){return y[8].params.tray=="trash"?0:y[3]?1:-1}return~(a=v(l))&&(o=p[a]=b[a](l)),{c(){e=h("div"),t=h("button"),s=h("i"),i=L(),_&&_.c(),r=L(),o&&o.c(),f=pe(),u(s,"class","fa fa-fw fa-ellipsis-v"),u(t,"type","button"),u(t,"class","local-mail-action-more-button btn dropdown-toggle"),t.disabled=l[10],u(t,"aria-expanded",l[9]),u(t,"title",n=l[8].strings.more),O(t,"btn-secondary",!l[1]),O(t,"disabled",l[10]),u(e,"class","btn-group"),O(e,"dropup",l[2])},m(y,$){S(y,e,$),g(e,t),g(t,s),g(e,i),_&&_.m(e,null),S(y,r,$),~a&&p[a].m(y,$),S(y,f,$),d=!0,c||(m=[H(t,"click",l[12]),Ce(Fe.call(null,e,l[11]))],c=!0)},p(y,[$]){(!d||$&1024)&&(t.disabled=y[10]),(!d||$&512)&&u(t,"aria-expanded",y[9]),(!d||$&256&&n!==(n=y[8].strings.more))&&u(t,"title",n),(!d||$&2)&&O(t,"btn-secondary",!y[1]),(!d||$&1024)&&O(t,"disabled",y[10]),y[9]?_?_.p(y,$):(_=Ot(y),_.c(),_.m(e,null)):_&&(_.d(1),_=null),(!d||$&4)&&O(e,"dropup",y[2]);let w=a;a=v(y),a===w?~a&&p[a].p(y,$):(o&&(ie(),N(p[w],1,1,()=>{p[w]=null}),re()),~a?(o=p[a],o?o.p(y,$):(o=p[a]=b[a](y),o.c()),T(o,1),o.m(f.parentNode,f)):o=null)},i(y){d||(T(o),d=!0)},o(y){N(o),d=!1},d(y){y&&(D(e),D(r),D(f)),_&&_.d(),~a&&p[a].d(y),c=!1,we(m)}}}function oi(l,e,t){let s,n,i,r,a,o,f,d,c=U,m=()=>(c(),c=ge(_,ee=>t(8,d=ee)),_);l.$$.on_destroy.push(()=>c());let{store:_}=e;m();let{transparent:b=!1}=e,{dropup:p=!1}=e,v=!1;const y=()=>{t(9,v=!1)},$=()=>{t(9,v=!v)},w=ee=>{y(),_.setUnread(n.filter(X=>!X.draft).map(X=>X.id),ee)},k=ee=>{y(),_.setStarred(n.map(X=>X.id),ee)},M=()=>{y(),_.showDialog("editlabel")},j=(ee,X)=>{_.hideDialog(),s&&_.updateLabel(s.id,ee,X)},C=()=>{y(),_.showDialog("deletelabel")},z=()=>{_.hideDialog(),_.deleteLabel(d.params.labelid||0)},B=()=>{y(),_.showDialog("emptytrash")},q=()=>{_.hideDialog(),_.emptyTrash(d.params.courseid)},G=()=>w(!1),P=()=>w(!0),K=()=>k(!0),x=()=>k(!1),V=()=>_.hideDialog(),te=()=>_.hideDialog(),le=()=>_.hideDialog();return l.$$set=ee=>{"store"in ee&&m(t(0,_=ee.store)),"transparent"in ee&&t(1,b=ee.transparent),"dropup"in ee&&t(2,p=ee.dropup)},l.$$.update=()=>{l.$$.dirty&256&&t(3,s=d.params.tray=="label"&&d.message==null?d.labels.find(ee=>ee.id==d.params.labelid):null),l.$$.dirty&256&&t(21,n=Array.from(d.selectedMessages.values())),l.$$.dirty&2097152&&t(7,i=n.some(ee=>!ee.draft&&!ee.unread)),l.$$.dirty&2097152&&t(6,r=n.some(ee=>!ee.draft&&ee.unread)),l.$$.dirty&2097152&&t(5,a=n.some(ee=>ee.starred)),l.$$.dirty&2097152&&t(4,o=n.some(ee=>!ee.starred)),l.$$.dirty&504&&t(10,f=d.params.tray=="trash"?!d.totalCount:!s&&!i&&!r&&!a&&!o)},[_,b,p,s,o,a,r,i,d,v,f,y,$,w,k,M,j,C,z,B,q,n,G,P,K,x,V,te,le]}class en extends ce{constructor(e){super(),me(this,e,oi,ai,ue,{store:0,transparent:1,dropup:2})}}function Qt(l){let e,t;return{c(){e=h("div"),t=I(l[4]),u(e,"class","align-self-center text-nowrap")},m(s,n){S(s,e,n),g(e,t)},p(s,n){n&16&&R(t,s[4])},d(s){s&&D(e)}}}function Zt(l){let e,t;return{c(){e=h("div"),t=I(l[4]),u(e,"class","text-truncate align-self-center mx-2")},m(s,n){S(s,e,n),g(e,t)},p(s,n){n&16&&R(t,s[4])},d(s){s&&D(e)}}}function fi(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,y,$=!l[2]&&Qt(l),w=l[2]&&Zt(l);return{c(){e=h("div"),$&&$.c(),t=L(),s=h("div"),n=h("button"),i=h("i"),f=L(),w&&w.c(),d=L(),c=h("button"),m=h("i"),u(i,"class","fa fa-w fa-chevron-left"),u(i,"aria-label",r=l[3].strings.previouspage),u(n,"type","button"),u(n,"class","btn btn-secondary"),n.disabled=a=!l[5],u(n,"title",o=l[3].strings[l[3].message?"previousmessage":"previouspage"]),O(n,"btn-secondary",!l[1]),u(m,"class","fa fa-w fa-chevron-right"),u(m,"aria-label",_=l[3].strings.nextpage),u(c,"type","button"),u(c,"class","btn"),c.disabled=b=!l[6],u(c,"title",p=l[3].strings[l[3].message?"nextmessage":"nextpage"]),O(c,"btn-secondary",!l[1]),u(s,"class","btn-group d-flex"),u(s,"role","group"),O(s,"btn-group",!l[2]),u(e,"class","local-mail-paging-buttons d-flex"),O(e,"ml-auto",!l[2])},m(k,M){S(k,e,M),$&&$.m(e,null),g(e,t),g(e,s),g(s,n),g(n,i),g(s,f),w&&w.m(s,null),g(s,d),g(s,c),g(c,m),v||(y=[H(n,"click",Se(l[9])),H(c,"click",Se(l[10]))],v=!0)},p(k,[M]){k[2]?$&&($.d(1),$=null):$?$.p(k,M):($=Qt(k),$.c(),$.m(e,t)),M&8&&r!==(r=k[3].strings.previouspage)&&u(i,"aria-label",r),M&32&&a!==(a=!k[5])&&(n.disabled=a),M&8&&o!==(o=k[3].strings[k[3].message?"previousmessage":"previouspage"])&&u(n,"title",o),M&2&&O(n,"btn-secondary",!k[1]),k[2]?w?w.p(k,M):(w=Zt(k),w.c(),w.m(s,d)):w&&(w.d(1),w=null),M&8&&_!==(_=k[3].strings.nextpage)&&u(m,"aria-label",_),M&64&&b!==(b=!k[6])&&(c.disabled=b),M&8&&p!==(p=k[3].strings[k[3].message?"nextmessage":"nextpage"])&&u(c,"title",p),M&2&&O(c,"btn-secondary",!k[1]),M&4&&O(s,"btn-group",!k[2]),M&4&&O(e,"ml-auto",!k[2])},i:U,o:U,d(k){k&&D(e),$&&$.d(),w&&w.d(),v=!1,we(y)}}}function ui(l,e,t){let s,n,i,r,a,o,f=U,d=()=>(f(),f=ge(c,v=>t(3,o=v)),c);l.$$.on_destroy.push(()=>f());let{store:c}=e;d();let{transparent:m=!1}=e,{compact:_=!1}=e;const b=()=>c.navigate(r),p=()=>c.navigate(i);return l.$$set=v=>{"store"in v&&d(t(0,c=v.store)),"transparent"in v&&t(1,m=v.transparent),"compact"in v&&t(2,_=v.compact)},l.$$.update=()=>{var v;l.$$.dirty&8&&t(8,s=o.nextMessageId||!o.params.search&&(o.params.offset||0)+o.preferences.perpage<o.totalCount),l.$$.dirty&8&&t(7,n=o.prevMessageId||!o.params.search&&(o.params.offset||0)),l.$$.dirty&264&&t(6,i=s?o.message?{...o.params,messageid:o.nextMessageId,offset:(o.params.offset||0)+1}:{...o.params,messageid:void 0,offset:(o.params.offset||0)+o.preferences.perpage,search:o.params.search?{...o.params.search,startid:(v=o.listMessages[o.listMessages.length-1])==null?void 0:v.id,reverse:!1}:void 0}:void 0),l.$$.dirty&136&&t(5,r=n?o.message?{...o.params,messageid:o.prevMessageId,offset:Math.max(0,(o.params.offset||0)-1)}:{...o.params,messageid:void 0,offset:Math.max(0,(o.params.offset||0)-o.preferences.perpage),search:o.params.search?{...o.params.search,startid:o.listMessages[0].id,reverse:!0}:void 0}:void 0),l.$$.dirty&8&&t(4,a=o.message?o.params.search?(o.params.offset||0)+1:Ie(o.strings.pagingsingle,{index:(o.messageOffset||0)+1,total:o.totalCount}):o.listMessages.length==0?"":o.params.search?Ie(o.strings.pagingrange,{first:(o.params.offset||0)+1,last:(o.params.offset||0)+o.listMessages.length}):Ie(o.strings.pagingrangetotal,{first:(o.params.offset||0)+1,last:(o.params.offset||0)+o.listMessages.length,total:o.totalCount}))},[c,m,_,o,a,r,i,n,s,b,p]}class tn extends ce{constructor(e){super(),me(this,e,ui,fi,ue,{store:0,transparent:1,compact:2})}}function xt(l){let e,t;return e=new Ge({props:{title:l[2].strings.restore,cancelText:l[2].strings.cancel,confirmText:l[2].strings.restore,onCancel:l[5],onConfirm:l[3],$$slots:{default:[ci]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.restore),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.restore),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function ci(l){let e=l[2].strings.restoremessageconfirm+"",t;return{c(){t=I(e)},m(s,n){S(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings.restoremessageconfirm+"")&&R(t,e)},d(s){s&&D(t)}}}function mi(l){let e,t,s,n,i,r,a,o,f,d=l[2].params.dialog=="restore"&&xt(l);return{c(){e=h("button"),t=h("i"),i=L(),d&&d.c(),r=pe(),u(t,"class","fa fa-fw fa-undo"),u(e,"type","button"),u(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.restore),O(e,"btn-secondary",!l[1]),O(e,"disabled",!l[2].selectedMessages.size)},m(c,m){S(c,e,m),g(e,t),S(c,i,m),d&&d.m(c,m),S(c,r,m),a=!0,o||(f=H(e,"click",l[4]),o=!0)},p(c,[m]){(!a||m&4&&s!==(s=!c[2].selectedMessages.size))&&(e.disabled=s),(!a||m&4&&n!==(n=c[2].strings.restore))&&u(e,"title",n),(!a||m&2)&&O(e,"btn-secondary",!c[1]),(!a||m&4)&&O(e,"disabled",!c[2].selectedMessages.size),c[2].params.dialog=="restore"?d?(d.p(c,m),m&4&&T(d,1)):(d=xt(c),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(ie(),N(d,1,1,()=>{d=null}),re())},i(c){a||(T(d),a=!0)},o(c){N(d),a=!1},d(c){c&&(D(e),D(i),D(r)),d&&d.d(c),o=!1,f()}}}function di(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,c=>t(2,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:a=!1}=e;const o=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Re.NotDeleted,!0)},f=()=>r.showDialog("restore"),d=()=>r.hideDialog();return l.$$set=c=>{"store"in c&&i(t(0,r=c.store)),"transparent"in c&&t(1,a=c.transparent)},[r,a,s,o,f,d]}class sn extends ce{constructor(e){super(),me(this,e,di,mi,ue,{store:0,transparent:1})}}function _i(l){let e,t,s,n;return e=new xl({props:{store:l[0],transparent:!0,dropup:!0}}),s=new Xl({props:{store:l[0],transparent:!0}}),{c(){Y(e.$$.fragment),t=L(),Y(s.$$.fragment)},m(i,r){J(e,i,r),S(i,t,r),J(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){N(e.$$.fragment,i),N(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function gi(l){let e,t,s,n;return e=new sn({props:{store:l[0],transparent:!0}}),s=new Ql({props:{store:l[0],transparent:!0}}),{c(){Y(e.$$.fragment),t=L(),Y(s.$$.fragment)},m(i,r){J(e,i,r),S(i,t,r),J(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){N(e.$$.fragment,i),N(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function pi(l){let e,t,s,n,i,r,a,o,f,d,c;const m=[gi,_i],_=[];function b(p,v){return p[4].params.tray=="trash"?0:1}return n=b(l),i=_[n]=m[n](l),a=new en({props:{store:l[0],transparent:!0,dropup:!0}}),f=new tn({props:{store:l[0],transparent:!0,compact:!0}}),{c(){e=h("div"),t=h("div"),s=h("div"),i.c(),r=L(),Y(a.$$.fragment),o=L(),Y(f.$$.fragment),u(s,"class","w-100 d-flex justify-content-around"),u(s,"role","group"),u(t,"role","toolbar"),u(t,"class","local-mail-toolbar d-flex w-100 py-3 border-top svelte-hn1exj"),Le(()=>l[5].call(t)),O(t,"position-fixed",l[3]),O(t,"position-absolute",!l[3]),O(t,"fixed-bottom",l[3]),O(t,"border-bottom",!l[3]),O(t,"bg-white",!l[3]),O(t,"bg-light",l[3]),u(e,"class","row position-relative"),_e(e,"height",l[1]+"px")},m(p,v){S(p,e,v),g(e,t),g(t,s),_[n].m(s,null),g(s,r),J(a,s,null),g(s,o),J(f,s,null),d=yn(t,l[5].bind(t)),l[6](e),c=!0},p(p,[v]){let y=n;n=b(p),n===y?_[n].p(p,v):(ie(),N(_[y],1,1,()=>{_[y]=null}),re(),i=_[n],i?i.p(p,v):(i=_[n]=m[n](p),i.c()),T(i,1),i.m(s,r));const $={};v&1&&($.store=p[0]),a.$set($);const w={};v&1&&(w.store=p[0]),f.$set(w),(!c||v&8)&&O(t,"position-fixed",p[3]),(!c||v&8)&&O(t,"position-absolute",!p[3]),(!c||v&8)&&O(t,"fixed-bottom",p[3]),(!c||v&8)&&O(t,"border-bottom",!p[3]),(!c||v&8)&&O(t,"bg-white",!p[3]),(!c||v&8)&&O(t,"bg-light",p[3]),(!c||v&2)&&_e(e,"height",p[1]+"px")},i(p){c||(T(i),T(a.$$.fragment,p),T(f.$$.fragment,p),c=!0)},o(p){N(i),N(a.$$.fragment,p),N(f.$$.fragment,p),c=!1},d(p){p&&D(e),_[n].d(),W(a),W(f),d(),l[6](null)}}}function bi(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,m=>t(4,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let a,o,f=!1;Xe(()=>{const m=new IntersectionObserver(_=>{for(const b of _)t(3,f=b.intersectionRatio<1&&b.boundingClientRect.top>=b.boundingClientRect.height)},{threshold:1});return m.observe(o),()=>m.disconnect()});function d(){a=this.offsetHeight,t(1,a)}function c(m){Me[m?"unshift":"push"](()=>{o=m,t(2,o)})}return l.$$set=m=>{"store"in m&&i(t(0,r=m.store))},[r,a,o,f,s,d,c]}class hi extends ce{constructor(e){super(),me(this,e,bi,pi,ue,{store:0})}}function ln(l,{from:e,to:t},s={}){const n=getComputedStyle(l),i=n.transform==="none"?"":n.transform,[r,a]=n.transformOrigin.split(" ").map(parseFloat),o=e.left+e.width*r/t.width-(t.left+r),f=e.top+e.height*a/t.height-(t.top+a),{delay:d=0,duration:c=_=>Math.sqrt(_)*120,easing:m=Wl}=s;return{delay:d,duration:$e(c)?c(Math.sqrt(o*o+f*f)):c,easing:m,css:(_,b)=>{const p=b*o,v=b*f,y=_+b*e.width/t.width,$=_+b*e.height/t.height;return`transform: ${i} translate(${p}px, ${v}px) scale(${y}, ${$});`}}}function ki(l){let e,t,s,n,i,r,a;return{c(){e=h("button"),t=h("i"),u(t,"class",s="fa align-middle "+l[3]),u(e,"type","button"),u(e,"class","btn px-2"),u(e,"role","checkbox"),u(e,"aria-checked",n=!!l[2].selectedMessages.has(l[1].id)),u(e,"title",i=l[2].strings.select)},m(o,f){S(o,e,f),g(e,t),r||(a=H(e,"click",Ul(Se(l[4]))),r=!0)},p(o,[f]){f&8&&s!==(s="fa align-middle "+o[3])&&u(t,"class",s),f&6&&n!==(n=!!o[2].selectedMessages.has(o[1].id))&&u(e,"aria-checked",n),f&4&&i!==(i=o[2].strings.select)&&u(e,"title",i)},i:U,o:U,d(o){o&&D(e),r=!1,a()}}}function vi(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,d=>t(2,n=d)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;const f=()=>a.toggleSelected(o.id);return l.$$set=d=>{"store"in d&&r(t(0,a=d.store)),"message"in d&&t(1,o=d.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=n.selectedMessages.has(o.id)?"fa-check-square-o":"fa-square-o")},[a,o,n,s,f]}class nn extends ce{constructor(e){super(),me(this,e,vi,ki,ue,{store:0,message:1})}}function wi(l){let e,t,s,n,i,r,a,o;return{c(){e=h("button"),t=h("i"),u(t,"class",s="fa "+l[2]),u(e,"type","button"),u(e,"class","btn px-2"),u(e,"role","checkbox"),u(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,u(e,"title",r=l[1].deleted?l[3].strings[l[1].starred?"starred":"unstarred"]:l[3].strings[l[1].starred?"markasunstarred":"markasstarred"])},m(f,d){S(f,e,d),g(e,t),a||(o=H(e,"click",Ul(Se(l[4]))),a=!0)},p(f,[d]){d&4&&s!==(s="fa "+f[2])&&u(t,"class",s),d&2&&n!==(n=f[1].starred)&&u(e,"aria-checked",n),d&2&&i!==(i=f[1].deleted)&&(e.disabled=i),d&10&&r!==(r=f[1].deleted?f[3].strings[f[1].starred?"starred":"unstarred"]:f[3].strings[f[1].starred?"markasunstarred":"markasstarred"])&&u(e,"title",r)},i:U,o:U,d(f){f&&D(e),a=!1,o()}}}function yi(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,d=>t(3,n=d)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;const f=()=>a.setStarred([o.id],!o.starred);return l.$$set=d=>{"store"in d&&r(t(0,a=d.store)),"message"in d&&t(1,o=d.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,s,n,f]}class rn extends ce{constructor(e){super(),me(this,e,yi,wi,ue,{store:0,message:1})}}function $i(l){let e,t=l[1].join(", ")+"",s,n,i,r;return{c(){e=h("div"),s=I(t)},m(a,o){S(a,e,o),g(e,s),i||(r=Ce(n=Ee.call(null,e,l[1].join(`
`))),i=!0)},p(a,[o]){o&2&&t!==(t=a[1].join(", ")+"")&&R(s,t),n&&$e(n.update)&&o&2&&n.update.call(null,a[1].join(`
`))},i:U,o:U,d(a){a&&D(e),i=!1,r()}}}function Mi(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,f=>t(3,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return l.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(2,o=f.message)},l.$$.update=()=>{l.$$.dirty&12&&t(1,s=n.params.tray=="sent"||n.params.tray=="drafts"?o.recipients.length>0?o.recipients.map(f=>f.fullname):[n.strings.norecipient]:[o.sender.fullname])},[a,s,o,n]}class mt extends ce{constructor(e){super(),me(this,e,Mi,$i,ue,{store:0,message:2})}}function es(l){let e,t=l[2].strings.draft+"",s;return{c(){e=h("span"),s=I(t),u(e,"class","mr-2 text-danger")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i&4&&t!==(t=n[2].strings.draft+"")&&R(s,t)},d(n){n&&D(e)}}}function Ci(l){let e,t,s=(l[1].subject||l[2].strings.nosubject)+"",n,i,r,a,o=l[1].draft&&es(l);return{c(){e=h("div"),o&&o.c(),t=L(),n=I(s)},m(f,d){S(f,e,d),o&&o.m(e,null),g(e,t),g(e,n),r||(a=Ce(i=Ee.call(null,e,l[1].subject||l[2].strings.nosubject)),r=!0)},p(f,[d]){f[1].draft?o?o.p(f,d):(o=es(f),o.c(),o.m(e,t)):o&&(o.d(1),o=null),d&6&&s!==(s=(f[1].subject||f[2].strings.nosubject)+"")&&R(n,s),i&&$e(i.update)&&d&6&&i.update.call(null,f[1].subject||f[2].strings.nosubject)},i:U,o:U,d(f){f&&D(e),o&&o.d(),r=!1,a()}}}function Si(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class dt extends ce{constructor(e){super(),me(this,e,Si,Ci,ue,{store:0,message:1})}}function ts(l){let e,t,s,n,i;return{c(){e=h("span"),t=I(l[2]),u(e,"class","local-mail-course-badge badge px-2 mr-2 mb-2"),_e(e,"min-width","3rem"),_e(e,"max-width","calc("+l[1]+"ch + 1.5rem)")},m(r,a){S(r,e,a),g(e,t),n||(i=Ce(s=Ee.call(null,e,l[2])),n=!0)},p(r,a){a&4&&R(t,r[2]),a&2&&_e(e,"max-width","calc("+r[1]+"ch + 1.5rem)"),s&&$e(s.update)&&a&4&&s.update.call(null,r[2])},d(r){r&&D(e),n=!1,i()}}}function Di(l){let e=["shortname","fullname"].includes(l[0].coursebadges),t,s=e&&ts(l);return{c(){s&&s.c(),t=pe()},m(n,i){s&&s.m(n,i),S(n,t,i)},p(n,[i]){i&1&&(e=["shortname","fullname"].includes(n[0].coursebadges)),e?s?s.p(n,i):(s=ts(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:U,o:U,d(n){n&&D(t),s&&s.d(n)}}}function Ti(l,e,t){let s,n,{course:i}=e,{settings:r}=e;return l.$$set=a=>{"course"in a&&t(3,i=a.course),"settings"in a&&t(0,r=a.settings)},l.$$.update=()=>{l.$$.dirty&9&&t(2,s=r.coursebadges=="shortname"?i.shortname:i.fullname),l.$$.dirty&1&&t(1,n=r.coursebadgeslength||20)},[r,n,s,i]}class _t extends ce{constructor(e){super(),me(this,e,Ti,Di,ue,{course:3,settings:0})}}function Li(l){let e,t=l[0].name+"",s,n;return{c(){e=h("span"),s=I(t),u(e,"class","local-mail-label-badge badge flex-shrink-0 px-2 mr-2 mb-2"),u(e,"style",n=`color: var(--local-mail-color-${l[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${l[1]}-bg, var(--local-mail-color-gray-bg))`)},m(i,r){S(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].name+"")&&R(s,t),r&2&&n!==(n=`color: var(--local-mail-color-${i[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${i[1]}-bg, var(--local-mail-color-gray-bg))`)&&u(e,"style",n)},i:U,o:U,d(i){i&&D(e)}}}function zi(l,e,t){let s,{label:n}=e;return l.$$set=i=>{"label"in i&&t(0,n=i.label)},l.$$.update=()=>{l.$$.dirty&1&&t(1,s=it.includes(n.color)?n.color:"gray")},[n,s]}class gt extends ce{constructor(e){super(),me(this,e,zi,Li,ue,{label:0})}}function ss(l,e,t){const s=l.slice();return s[3]=e[t],s}function ls(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&ns(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&T(s,1)):(s=ns(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),N(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){N(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function ns(l){let e,t;return e=new _t({props:{course:l[1].course,settings:l[2].settings}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function is(l){let e,t;return e=new gt({props:{label:l[3]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.label=s[3]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function rs(l,e){let t,s,n,i=(e[2].params.tray!="label"||e[2].params.labelid!=e[3].id)&&is(e);return{key:l,first:null,c(){t=pe(),i&&i.c(),s=pe(),this.first=t},m(r,a){S(r,t,a),i&&i.m(r,a),S(r,s,a),n=!0},p(r,a){e=r,e[2].params.tray!="label"||e[2].params.labelid!=e[3].id?i?(i.p(e,a),a&6&&T(i,1)):(i=is(e),i.c(),T(i,1),i.m(s.parentNode,s)):i&&(ie(),N(i,1,1,()=>{i=null}),re())},i(r){n||(T(i),n=!0)},o(r){N(i),n=!1},d(r){r&&(D(t),D(s)),i&&i.d(r)}}}function as(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&os(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&T(s,1)):(s=os(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),N(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){N(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function os(l){let e,t;return e=new _t({props:{course:l[1].course,settings:l[2].settings}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function ji(l){let e,t=[],s=new Map,n,i,r,a=l[2].viewportSize<de.MD&&ls(l),o=fe(l[1].labels);const f=c=>c[3].id;for(let c=0;c<o.length;c+=1){let m=ss(l,o,c),_=f(m);s.set(_,t[c]=rs(_,m))}let d=l[2].viewportSize>=de.MD&&as(l);return{c(){a&&a.c(),e=L();for(let c=0;c<t.length;c+=1)t[c].c();n=L(),d&&d.c(),i=pe()},m(c,m){a&&a.m(c,m),S(c,e,m);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(c,m);S(c,n,m),d&&d.m(c,m),S(c,i,m),r=!0},p(c,[m]){c[2].viewportSize<de.MD?a?(a.p(c,m),m&4&&T(a,1)):(a=ls(c),a.c(),T(a,1),a.m(e.parentNode,e)):a&&(ie(),N(a,1,1,()=>{a=null}),re()),m&6&&(o=fe(c[1].labels),ie(),t=De(t,m,f,1,c,o,s,n.parentNode,Ue,rs,n,ss),re()),c[2].viewportSize>=de.MD?d?(d.p(c,m),m&4&&T(d,1)):(d=as(c),d.c(),T(d,1),d.m(i.parentNode,i)):d&&(ie(),N(d,1,1,()=>{d=null}),re())},i(c){if(!r){T(a);for(let m=0;m<o.length;m+=1)T(t[m]);T(d),r=!0}},o(c){N(a);for(let m=0;m<t.length;m+=1)N(t[m]);N(d),r=!1},d(c){c&&(D(e),D(n),D(i)),a&&a.d(c);for(let m=0;m<t.length;m+=1)t[m].d(c);d&&d.d(c)}}}function Ni(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class an extends ce{constructor(e){super(),me(this,e,Ni,ji,ue,{store:0,message:1})}}function fs(l){let e,t,s,n,i;return{c(){e=h("span"),t=h("i"),u(t,"class",s="fa fa-fw "+(l[1].numattachments>0?"fa-paperclip":"")),u(t,"aria-hidden",!0),u(e,"class","-shrink-0 mr-2"),u(e,"aria-hidden",n=l[1].numattachments==0),u(e,"title",i=l[1].numattachments>0?l[2].strings.hasattachments:void 0)},m(r,a){S(r,e,a),g(e,t)},p(r,a){a&2&&s!==(s="fa fa-fw "+(r[1].numattachments>0?"fa-paperclip":""))&&u(t,"class",s),a&2&&n!==(n=r[1].numattachments==0)&&u(e,"aria-hidden",n),a&6&&i!==(i=r[1].numattachments>0?r[2].strings.hasattachments:void 0)&&u(e,"title",i)},d(r){r&&D(e)}}}function Bi(l){let e,t=(l[1].numattachments>0||l[2].viewportSize>=de.MD)&&fs(l);return{c(){t&&t.c(),e=pe()},m(s,n){t&&t.m(s,n),S(s,e,n)},p(s,[n]){s[1].numattachments>0||s[2].viewportSize>=de.MD?t?t.p(s,n):(t=fs(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(s){s&&D(e),t&&t.d(s)}}}function Ai(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class on extends ce{constructor(e){super(),me(this,e,Ai,Bi,ue,{store:0,message:1})}}function qi(l){let e,t=l[0].shorttime+"",s,n;return{c(){e=h("span"),s=I(t),u(e,"class","local-mail-list-message-time d-shrink-0 text-nowrap text-right"),u(e,"title",n=l[0].fulltime),O(e,"local-mail-list-message-time-md",l[2].viewportSize>=de.MD)},m(i,r){S(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].shorttime+"")&&R(s,t),r&1&&n!==(n=i[0].fulltime)&&u(e,"title",n),r&4&&O(e,"local-mail-list-message-time-md",i[2].viewportSize>=de.MD)},i:U,o:U,d(i){i&&D(e)}}}function Ii(l,e,t){let s,n=U,i=()=>(n(),n=ge(a,o=>t(2,s=o)),a);l.$$.on_destroy.push(()=>n());let{message:r}=e,{store:a}=e;return i(),l.$$set=o=>{"message"in o&&t(0,r=o.message),"store"in o&&i(t(1,a=o.store))},[r,a,s]}class fn extends ce{constructor(e){super(),me(this,e,Ii,qi,ue,{message:0,store:1})}}function us(l){let e,t,s=l[1].strings.nomessagesfound+"",n,i,r,a=l[1].totalCount>0&&cs(l);return{c(){e=h("div"),t=h("div"),n=I(s),i=L(),a&&a.c(),u(e,"class","alert alert-info")},m(o,f){S(o,e,f),g(e,t),g(t,n),g(e,i),a&&a.m(e,null)},p(o,f){f&2&&s!==(s=o[1].strings.nomessagesfound+"")&&R(n,s),o[1].totalCount>0?a?a.p(o,f):(a=cs(o),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i(o){o&&(r||Le(()=>{r=ut(e,Ne,{delay:400}),r.start()}))},o:U,d(o){o&&D(e),a&&a.d()}}}function cs(l){let e,t=l[1].strings.showrecentmessages+"",s,n,i,r;return{c(){e=h("a"),s=I(t),u(e,"class","btn btn-info text-white mt-3"),u(e,"href",n=Pe(l[2]))},m(a,o){S(a,e,o),g(e,s),i||(r=H(e,"click",Se(l[3])),i=!0)},p(a,o){o&2&&t!==(t=a[1].strings.showrecentmessages+"")&&R(s,t),o&4&&n!==(n=Pe(a[2]))&&u(e,"href",n)},d(a){a&&D(e),i=!1,r()}}}function Ei(l){let e,t=!l[1].listMessages.length&&us(l);return{c(){t&&t.c(),e=pe()},m(s,n){t&&t.m(s,n),S(s,e,n)},p(s,[n]){s[1].listMessages.length?t&&(t.d(1),t=null):t?(t.p(s,n),n&2&&T(t,1)):(t=us(s),t.c(),T(t,1),t.m(e.parentNode,e))},i(s){T(t)},o:U,d(s){s&&D(e),t&&t.d(s)}}}function Pi(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,f=>t(1,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();const o=()=>a.navigate(s);return l.$$set=f=>{"store"in f&&r(t(0,a=f.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s={tray:n.params.tray,courseid:n.params.courseid,labelid:n.params.labelid})},[a,n,s,o]}class Ri extends ce{constructor(e){super(),me(this,e,Pi,Ei,ue,{store:0})}}function ms(l,e,t){const s=l.slice();return s[4]=e[t],s[6]=t,s}function Fi(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,y,$,w,k,M;return t=new nn({props:{store:l[0],message:l[4]}}),r=new mt({props:{store:l[0],message:l[4]}}),o=new on({props:{store:l[0],message:l[4]}}),c=new fn({props:{store:l[0],message:l[4]}}),p=new dt({props:{store:l[0],message:l[4]}}),y=new rn({props:{store:l[0],message:l[4]}}),k=new an({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),Y(t.$$.fragment),s=L(),n=h("div"),i=h("div"),Y(r.$$.fragment),a=L(),Y(o.$$.fragment),f=L(),d=h("div"),Y(c.$$.fragment),m=L(),_=h("div"),b=h("div"),Y(p.$$.fragment),v=L(),Y(y.$$.fragment),$=L(),w=h("div"),Y(k.$$.fragment),u(d,"class","ml-auto mr-2"),u(i,"class","d-flex mt-2"),u(b,"class","d-flex w-100 my-2 mr-2"),_e(b,"min-width","0"),u(_,"class","d-flex"),u(w,"class","d-flex flex-wrap ml-n2 mr-2"),u(n,"class","w-100 ml-1"),_e(n,"min-width","0"),u(e,"class","d-flex align-items-start pt-1 pb-2 pl-1 pr-2")},m(j,C){S(j,e,C),J(t,e,null),g(e,s),g(e,n),g(n,i),J(r,i,null),g(i,a),J(o,i,null),g(i,f),g(i,d),J(c,d,null),g(n,m),g(n,_),g(_,b),J(p,b,null),g(_,v),J(y,_,null),g(n,$),g(n,w),J(k,w,null),M=!0},p(j,C){const z={};C&1&&(z.store=j[0]),C&2&&(z.message=j[4]),t.$set(z);const B={};C&1&&(B.store=j[0]),C&2&&(B.message=j[4]),r.$set(B);const q={};C&1&&(q.store=j[0]),C&2&&(q.message=j[4]),o.$set(q);const G={};C&1&&(G.store=j[0]),C&2&&(G.message=j[4]),c.$set(G);const P={};C&1&&(P.store=j[0]),C&2&&(P.message=j[4]),p.$set(P);const K={};C&1&&(K.store=j[0]),C&2&&(K.message=j[4]),y.$set(K);const x={};C&1&&(x.store=j[0]),C&2&&(x.message=j[4]),k.$set(x)},i(j){M||(T(t.$$.fragment,j),T(r.$$.fragment,j),T(o.$$.fragment,j),T(c.$$.fragment,j),T(p.$$.fragment,j),T(y.$$.fragment,j),T(k.$$.fragment,j),M=!0)},o(j){N(t.$$.fragment,j),N(r.$$.fragment,j),N(o.$$.fragment,j),N(c.$$.fragment,j),N(p.$$.fragment,j),N(y.$$.fragment,j),N(k.$$.fragment,j),M=!1},d(j){j&&D(e),W(t),W(r),W(o),W(c),W(p),W(y),W(k)}}}function Ui(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,y,$,w;return t=new nn({props:{store:l[0],message:l[4]}}),n=new rn({props:{store:l[0],message:l[4]}}),o=new mt({props:{store:l[0],message:l[4]}}),c=new dt({props:{store:l[0],message:l[4]}}),b=new an({props:{store:l[0],message:l[4]}}),v=new on({props:{store:l[0],message:l[4]}}),$=new fn({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),Y(t.$$.fragment),s=L(),Y(n.$$.fragment),i=L(),r=h("div"),a=h("div"),Y(o.$$.fragment),f=L(),d=h("div"),Y(c.$$.fragment),m=L(),_=h("div"),Y(b.$$.fragment),p=L(),Y(v.$$.fragment),y=L(),Y($.$$.fragment),u(a,"class","flex-grow-1 mx-2"),_e(a,"width","25%"),_e(a,"min-width","0"),u(_,"class","d-flex text-truncate flex-shrink-0 justify-content-end mb-n2 ml-auto"),_e(_,"max-width","80%"),u(d,"class","flex-grow-1 d-flex my-2 mx-2"),_e(d,"width","75%"),_e(d,"min-width","0"),u(r,"class","d-flex w-100 flex-grow-1 align-items-center"),_e(r,"min-width","0"),u(e,"class","d-flex align-items-center pl-1 pr-3")},m(k,M){S(k,e,M),J(t,e,null),g(e,s),J(n,e,null),g(e,i),g(e,r),g(r,a),J(o,a,null),g(r,f),g(r,d),J(c,d,null),g(d,m),g(d,_),J(b,_,null),g(e,p),J(v,e,null),g(e,y),J($,e,null),w=!0},p(k,M){const j={};M&1&&(j.store=k[0]),M&2&&(j.message=k[4]),t.$set(j);const C={};M&1&&(C.store=k[0]),M&2&&(C.message=k[4]),n.$set(C);const z={};M&1&&(z.store=k[0]),M&2&&(z.message=k[4]),o.$set(z);const B={};M&1&&(B.store=k[0]),M&2&&(B.message=k[4]),c.$set(B);const q={};M&1&&(q.store=k[0]),M&2&&(q.message=k[4]),b.$set(q);const G={};M&1&&(G.store=k[0]),M&2&&(G.message=k[4]),v.$set(G);const P={};M&1&&(P.store=k[0]),M&2&&(P.message=k[4]),$.$set(P)},i(k){w||(T(t.$$.fragment,k),T(n.$$.fragment,k),T(o.$$.fragment,k),T(c.$$.fragment,k),T(b.$$.fragment,k),T(v.$$.fragment,k),T($.$$.fragment,k),w=!0)},o(k){N(t.$$.fragment,k),N(n.$$.fragment,k),N(o.$$.fragment,k),N(c.$$.fragment,k),N(b.$$.fragment,k),N(v.$$.fragment,k),N($.$$.fragment,k),w=!1},d(k){k&&D(e),W(t),W(n),W(o),W(c),W(b),W(v),W($)}}}function ds(l,e){let t,s,n,i,r,a,o,f=U,d,c,m;const _=[Ui,Fi],b=[];function p(y,$){return y[1].viewportSize>=de.MD?0:1}s=p(e),n=b[s]=_[s](e);function v(){return e[3](e[4],e[6])}return{key:l,first:null,c(){t=h("a"),n.c(),u(t,"class","local-mail-list-message list-group-item list-group-item-action p-0"),u(t,"href",i=Pe(e[2](e[4],e[6]))),O(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),O(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),O(t,"font-weight-bold",e[4].unread),this.first=t},m(y,$){S(y,t,$),b[s].m(t,null),d=!0,c||(m=H(t,"click",Se(v)),c=!0)},p(y,$){e=y;let w=s;s=p(e),s===w?b[s].p(e,$):(ie(),N(b[w],1,1,()=>{b[w]=null}),re(),n=b[s],n?n.p(e,$):(n=b[s]=_[s](e),n.c()),T(n,1),n.m(t,null)),(!d||$&2&&i!==(i=Pe(e[2](e[4],e[6]))))&&u(t,"href",i),(!d||$&2)&&O(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),(!d||$&2)&&O(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),(!d||$&2)&&O(t,"font-weight-bold",e[4].unread)},r(){o=t.getBoundingClientRect()},f(){Jl(t),f(),ct(t,o)},a(){f(),f=Yl(t,o,ln,{delay:400,duration:400})},i(y){d||(T(n),y&&Le(()=>{d&&(a&&a.end(1),r=ut(t,Ne,{delay:400}),r.start())}),d=!0)},o(y){N(n),r&&r.invalidate(),y&&(a=Ol(t,Ne,{duration:400})),d=!1},d(y){y&&D(t),b[s].d(),y&&a&&a.end(),c=!1,m()}}}function _s(l){let e,t=[],s=new Map,n,i,r,a=fe(l[1].listMessages);const o=f=>f[4].id;for(let f=0;f<a.length;f+=1){let d=ms(l,a,f),c=o(d);s.set(c,t[f]=ds(c,d))}return i=new Ri({props:{store:l[0]}}),{c(){e=h("div");for(let f=0;f<t.length;f+=1)t[f].c();n=L(),Y(i.$$.fragment),u(e,"class","list-group")},m(f,d){S(f,e,d);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);g(e,n),J(i,e,null),r=!0},p(f,d){if(d&7){a=fe(f[1].listMessages),ie();for(let m=0;m<t.length;m+=1)t[m].r();t=De(t,d,o,1,f,a,s,e,Gl,ds,n,ms);for(let m=0;m<t.length;m+=1)t[m].a();re()}const c={};d&1&&(c.store=f[0]),i.$set(c)},i(f){if(!r){for(let d=0;d<a.length;d+=1)T(t[d]);T(i.$$.fragment,f),r=!0}},o(f){for(let d=0;d<t.length;d+=1)N(t[d]);N(i.$$.fragment,f),r=!1},d(f){f&&D(e);for(let d=0;d<t.length;d+=1)t[d].d();W(i)}}}function Gi(l){let e=l[1].navigationId,t,s,n=_s(l);return{c(){n.c(),t=pe()},m(i,r){n.m(i,r),S(i,t,r),s=!0},p(i,[r]){r&2&&ue(e,e=i[1].navigationId)?(ie(),N(n,1,1,U),re(),n=_s(i),n.c(),T(n,1),n.m(t.parentNode,t)):n.p(i,r)},i(i){s||(T(n),s=!0)},o(i){N(n),s=!1},d(i){i&&D(t),n.d(i)}}}function Oi(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=(f,d)=>({...s.params,messageid:f.id,offset:(s.params.offset||0)+d}),o=(f,d)=>r.navigate(a(f,d));return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,a,o]}class Hi extends ce{constructor(e){super(),me(this,e,Oi,Gi,ue,{store:0})}}function gs(l){let e,t,s,n,i,r,a,o=l[3]&&ps(l);return{c(){e=h("div"),t=h("button"),s=h("i"),i=L(),o&&o.c(),u(s,"class","fa fa-fw fa-ellipsis-v align-middle"),u(t,"type","button"),u(t,"class","btn"),u(t,"aria-expanded",l[3]),u(t,"title",n=l[5].strings.more),u(e,"class","dropdown")},m(f,d){S(f,e,d),g(e,t),g(t,s),g(e,i),o&&o.m(e,null),r||(a=[H(t,"click",l[6]),Ce(Fe.call(null,e,l[7]))],r=!0)},p(f,d){d&8&&u(t,"aria-expanded",f[3]),d&32&&n!==(n=f[5].strings.more)&&u(t,"title",n),f[3]?o?o.p(f,d):(o=ps(f),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(f){f&&D(e),o&&o.d(),r=!1,we(a)}}}function ps(l){let e,t,s,n,i=l[5].strings.reply+"",r,a,o,f,d,c=l[5].strings.replyall+"",m,_,b,p,v,y,$=l[5].strings.forward+"",w,k,M;return{c(){e=h("div"),t=h("button"),s=h("i"),n=L(),r=I(i),a=L(),o=h("button"),f=h("i"),d=L(),m=I(c),b=L(),p=h("button"),v=h("i"),y=L(),w=I($),u(s,"class","fa fa-fw fa-reply"),u(s,"aria-hidden","true"),u(t,"type","button"),u(t,"class","dropdown-item"),u(f,"class","fa fa-fw fa-reply-all"),u(f,"aria-hidden","true"),u(o,"type","button"),o.disabled=_=!l[2],u(o,"class","dropdown-item"),O(o,"disabled",!l[2]),u(v,"class","fa fa-fw fa-share"),u(v,"aria-hidden","true"),u(p,"type","button"),u(p,"class","dropdown-item"),u(e,"class","dropdown-menu dropdown-menu-right show")},m(j,C){S(j,e,C),g(e,t),g(t,s),g(t,n),g(t,r),g(e,a),g(e,o),g(o,f),g(o,d),g(o,m),g(e,b),g(e,p),g(p,v),g(p,y),g(p,w),k||(M=[H(t,"click",l[9]),H(o,"click",l[10]),H(p,"click",l[11])],k=!0)},p(j,C){C&32&&i!==(i=j[5].strings.reply+"")&&R(r,i),C&32&&c!==(c=j[5].strings.replyall+"")&&R(m,c),C&4&&_!==(_=!j[2])&&(o.disabled=_),C&4&&O(o,"disabled",!j[2]),C&32&&$!==($=j[5].strings.forward+"")&&R(w,$)},d(j){j&&D(e),k=!1,we(M)}}}function bs(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b;return{c(){e=h("button"),t=h("i"),n=L(),i=h("button"),r=h("i"),f=L(),d=h("button"),c=h("i"),u(t,"class","fa fa-fw fa-reply"),u(t,"aria-hidden","true"),u(e,"type","button"),u(e,"title",s=l[5].strings.reply),u(e,"class","btn py-2 border-0"),u(r,"class","fa fa-fw fa-reply-all"),u(r,"aria-hidden","true"),u(i,"type","button"),i.disabled=a=!l[2],u(i,"title",o=l[5].strings.replyall),u(i,"class","btn py-2 border-0"),O(i,"disabled",!l[2]),u(c,"class","fa fa-fw fa-share"),u(c,"aria-hidden","true"),u(d,"type","button"),u(d,"title",m=l[5].strings.forward),u(d,"class","btn py-2 border-0")},m(p,v){S(p,e,v),g(e,t),S(p,n,v),S(p,i,v),g(i,r),S(p,f,v),S(p,d,v),g(d,c),_||(b=[H(e,"click",l[12]),H(i,"click",l[13]),H(d,"click",l[14])],_=!0)},p(p,v){v&32&&s!==(s=p[5].strings.reply)&&u(e,"title",s),v&4&&a!==(a=!p[2])&&(i.disabled=a),v&32&&o!==(o=p[5].strings.replyall)&&u(i,"title",o),v&4&&O(i,"disabled",!p[2]),v&32&&m!==(m=p[5].strings.forward)&&u(d,"title",m)},d(p){p&&(D(e),D(n),D(i),D(f),D(d)),_=!1,we(b)}}}function Vi(l){let e,t,s,n,i,r,a,o,f,d,c,m=l[5].viewportSize<de.SM&&gs(l),_=l[5].viewportSize>=de.SM&&bs(l);return{c(){e=h("button"),t=h("i"),a=L(),m&&m.c(),o=L(),_&&_.c(),f=pe(),u(t,"class",s="fa "+l[4]),u(e,"type","button"),u(e,"class","btn py-2 border-0"),u(e,"role","checkbox"),u(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,u(e,"title",r=l[1].starred?l[5].strings.markasunstarred:l[5].strings.markasstarred)},m(b,p){S(b,e,p),g(e,t),S(b,a,p),m&&m.m(b,p),S(b,o,p),_&&_.m(b,p),S(b,f,p),d||(c=H(e,"click",l[8]),d=!0)},p(b,[p]){p&16&&s!==(s="fa "+b[4])&&u(t,"class",s),p&2&&n!==(n=b[1].starred)&&u(e,"aria-checked",n),p&2&&i!==(i=b[1].deleted)&&(e.disabled=i),p&34&&r!==(r=b[1].starred?b[5].strings.markasunstarred:b[5].strings.markasstarred)&&u(e,"title",r),b[5].viewportSize<de.SM?m?m.p(b,p):(m=gs(b),m.c(),m.m(o.parentNode,o)):m&&(m.d(1),m=null),b[5].viewportSize>=de.SM?_?_.p(b,p):(_=bs(b),_.c(),_.m(f.parentNode,f)):_&&(_.d(1),_=null)},i:U,o:U,d(b){b&&(D(e),D(a),D(o),D(f)),m&&m.d(b),_&&_.d(b),d=!1,c()}}}function Ki(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,k=>t(5,n=k)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e,{canReplyAll:f}=e,d=!1;const c=()=>{t(3,d=!d)},m=()=>{t(3,d=!1)},_=()=>a.setStarred([o.id],!o.starred),b=()=>a.reply(o,!1),p=()=>a.reply(o,!0),v=()=>a.forward(o),y=()=>a.reply(o,!1),$=()=>a.reply(o,!0),w=()=>a.forward(o);return l.$$set=k=>{"store"in k&&r(t(0,a=k.store)),"message"in k&&t(1,o=k.message),"canReplyAll"in k&&t(2,f=k.canReplyAll)},l.$$.update=()=>{l.$$.dirty&2&&t(4,s=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,f,d,s,n,c,m,_,b,p,v,y,$,w]}class Yi extends ce{constructor(e){super(),me(this,e,Ki,Vi,ue,{store:0,message:1,canReplyAll:2})}}function hs(l,e,t){const s=l.slice();return s[3]=e[t],s}function ks(l){let e,t,s,n,i,r,a,o,f,d=l[2](l[3])+"",c,m,_,b,p=At(l[3].filesize)+"",v,y,$,w;return{c(){e=h("a"),t=h("img"),i=L(),r=h("i"),a=L(),o=h("div"),f=h("div"),c=I(d),_=L(),b=h("div"),v=I(p),u(t,"aria-hidden","true"),u(t,"alt",s=l[3].filename),st(t.src,n=l[3].iconurl)||u(t,"src",n),u(t,"width","24"),u(t,"height","24"),u(t,"class","flex-shrink-0"),u(r,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),u(r,"aria-hidden","true"),_e(r,"width","24px"),_e(r,"height","24px"),u(b,"class","text-left text-muted"),u(o,"class","ml-2 mr-1"),_e(o,"min-width","0"),u(e,"href",y=l[3].fileurl),u(e,"class","local-mail-message-attachments-file btn btn-light d-flex align-items-center px-2 py-1 mr-3 mb-3")},m(k,M){S(k,e,M),g(e,t),g(e,i),g(e,r),g(e,a),g(e,o),g(o,f),g(f,c),g(o,_),g(o,b),g(b,v),$||(w=Ce(m=Ee.call(null,f,l[2](l[3]))),$=!0)},p(k,M){l=k,M&2&&s!==(s=l[3].filename)&&u(t,"alt",s),M&2&&!st(t.src,n=l[3].iconurl)&&u(t,"src",n),M&2&&d!==(d=l[2](l[3])+"")&&R(c,d),m&&$e(m.update)&&M&2&&m.update.call(null,l[2](l[3])),M&2&&p!==(p=At(l[3].filesize)+"")&&R(v,p),M&2&&y!==(y=l[3].fileurl)&&u(e,"href",y)},d(k){k&&D(e),$=!1,w()}}}function vs(l){let e,t,s,n,i=l[0].downloadall+"",r,a;return{c(){e=h("a"),t=h("i"),s=L(),n=h("div"),r=I(i),u(t,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),u(t,"aria-hidden","true"),_e(t,"width","24px"),_e(t,"height","24px"),u(n,"class","text-truncate ml-2"),u(e,"href",a=Ct(l[1].id)),u(e,"class","btn btn-light d-flex align-items-center p-2 mr-3 mb-3")},m(o,f){S(o,e,f),g(e,t),g(e,s),g(e,n),g(n,r)},p(o,f){f&1&&i!==(i=o[0].downloadall+"")&&R(r,i),f&2&&a!==(a=Ct(o[1].id))&&u(e,"href",a)},d(o){o&&D(e)}}}function Ji(l){let e,t,s=fe(l[1].attachments),n=[];for(let r=0;r<s.length;r+=1)n[r]=ks(hs(l,s,r));let i=l[1].attachments.length>1&&vs(l);return{c(){e=h("div");for(let r=0;r<n.length;r+=1)n[r].c();t=L(),i&&i.c(),u(e,"class","local-mail-message-attachments d-sm-flex flex-wrap mr-n3 mt-3 mb-sm-n3")},m(r,a){S(r,e,a);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(e,null);g(e,t),i&&i.m(e,null)},p(r,[a]){if(a&6){s=fe(r[1].attachments);let o;for(o=0;o<s.length;o+=1){const f=hs(r,s,o);n[o]?n[o].p(f,a):(n[o]=ks(f),n[o].c(),n[o].m(e,t))}for(;o<n.length;o+=1)n[o].d(1);n.length=s.length}r[1].attachments.length>1?i?i.p(r,a):(i=vs(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i:U,o:U,d(r){r&&D(e),Be(n,r),i&&i.d()}}}function Wi(l,e,t){let{strings:s}=e,{message:n}=e;const i=r=>(r.filepath+r.filename).replace(/^\//,"");return l.$$set=r=>{"strings"in r&&t(0,s=r.strings),"message"in r&&t(1,n=r.message)},[s,n,i]}class un extends ce{constructor(e){super(),me(this,e,Wi,Ji,ue,{strings:0,message:1})}}function Xi(l){let e,t,s,n=l[3].strings.reply+"",i,r,a,o,f,d=l[3].strings.replyall+"",c,m,_,b,p,v,y=l[3].strings.forward+"",$,w,k;return{c(){e=h("button"),t=h("i"),s=L(),i=I(n),r=L(),a=h("button"),o=h("i"),f=L(),c=I(d),_=L(),b=h("button"),p=h("i"),v=L(),$=I(y),u(t,"class","fa fa-fw fa-reply mr-2"),u(e,"type","button"),u(e,"class","btn btn-primary mr-3 mb-3"),u(o,"class","fa fa-fw fa-reply-all mr-2"),u(a,"type","button"),a.disabled=m=!l[2],u(a,"class","btn mr-3 mb-3"),O(a,"disabled",!l[2]),O(a,"btn-primary",l[2]),O(a,"btn-secondary",!l[2]),u(p,"class","fa fa-fw fa-share mr-2"),u(b,"type","button"),u(b,"class","btn btn-primary mr-3 mb-3")},m(M,j){S(M,e,j),g(e,t),g(e,s),g(e,i),S(M,r,j),S(M,a,j),g(a,o),g(a,f),g(a,c),S(M,_,j),S(M,b,j),g(b,p),g(b,v),g(b,$),w||(k=[H(e,"click",l[4]),H(a,"click",l[5]),H(b,"click",l[6])],w=!0)},p(M,[j]){j&8&&n!==(n=M[3].strings.reply+"")&&R(i,n),j&8&&d!==(d=M[3].strings.replyall+"")&&R(c,d),j&4&&m!==(m=!M[2])&&(a.disabled=m),j&4&&O(a,"disabled",!M[2]),j&4&&O(a,"btn-primary",M[2]),j&4&&O(a,"btn-secondary",!M[2]),j&8&&y!==(y=M[3].strings.forward+"")&&R($,y)},i:U,o:U,d(M){M&&(D(e),D(r),D(a),D(_),D(b)),w=!1,we(k)}}}function Qi(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,m=>t(3,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e,{canReplyAll:o}=e;const f=()=>r.reply(a,!1),d=()=>r.reply(a,!0),c=()=>r.forward(a);return l.$$set=m=>{"store"in m&&i(t(0,r=m.store)),"message"in m&&t(1,a=m.message),"canReplyAll"in m&&t(2,o=m.canReplyAll)},[r,a,o,s,f,d,c]}class Zi extends ce{constructor(e){super(),me(this,e,Qi,Xi,ue,{store:0,message:1,canReplyAll:2})}}function ws(l,e,t){const s=l.slice();return s[3]=e[t],s}function ys(l){let e,t;return e=new _t({props:{course:l[1].course,settings:l[2].settings}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function $s(l,e){let t,s,n;return s=new gt({props:{label:e[3]}}),{key:l,first:null,c(){t=pe(),Y(s.$$.fragment),this.first=t},m(i,r){S(i,t,r),J(s,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.label=e[3]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){N(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(s,i)}}}function xi(l){let e,t=[],s=new Map,n,i,r=l[1].course.id!=l[2].params.courseid&&ys(l),a=fe(l[1].labels);const o=f=>f[3].id;for(let f=0;f<a.length;f+=1){let d=ws(l,a,f),c=o(d);s.set(c,t[f]=$s(c,d))}return{c(){r&&r.c(),e=L();for(let f=0;f<t.length;f+=1)t[f].c();n=pe()},m(f,d){r&&r.m(f,d),S(f,e,d);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(f,d);S(f,n,d),i=!0},p(f,[d]){f[1].course.id!=f[2].params.courseid?r?(r.p(f,d),d&6&&T(r,1)):(r=ys(f),r.c(),T(r,1),r.m(e.parentNode,e)):r&&(ie(),N(r,1,1,()=>{r=null}),re()),d&2&&(a=fe(f[1].labels),ie(),t=De(t,d,o,1,f,a,s,n.parentNode,Ue,$s,n,ws),re())},i(f){if(!i){T(r);for(let d=0;d<a.length;d+=1)T(t[d]);i=!0}},o(f){N(r);for(let d=0;d<t.length;d+=1)N(t[d]);i=!1},d(f){f&&(D(e),D(n)),r&&r.d(f);for(let d=0;d<t.length;d+=1)t[d].d(f)}}}function er(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class tr extends ce{constructor(e){super(),me(this,e,er,xi,ue,{store:0,message:1})}}function sr(l){let e;function t(i,r){if(i[0])return ir;if(i[1])return nr}let s=t(l),n=s&&s(l);return{c(){e=h("span"),n&&n.c(),u(e,"class","local-mail-user-picture-fallback m-0")},m(i,r){S(i,e,r),n&&n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n&&n.d(1),n=s&&s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&D(e),n&&n.d()}}}function lr(l){let e,t;return{c(){e=h("img"),st(e.src,t=l[0].pictureurl)||u(e,"src",t),u(e,"width","35"),u(e,"height","35"),u(e,"alt",""),u(e,"aria-hidden","true"),u(e,"class","rounded-circle")},m(s,n){S(s,e,n)},p(s,n){n&1&&!st(e.src,t=s[0].pictureurl)&&u(e,"src",t)},d(s){s&&D(e)}}}function nr(l){let e,t;return{c(){e=h("i"),u(e,"class",t="fa "+l[1])},m(s,n){S(s,e,n)},p(s,n){n&2&&t!==(t="fa "+s[1])&&u(e,"class",t)},d(s){s&&D(e)}}}function ir(l){let e=l[0].firstname.slice(0,1)+"",t,s=l[0].lastname.slice(0,1)+"",n;return{c(){t=I(e),n=I(s)},m(i,r){S(i,t,r),S(i,n,r)},p(i,r){r&1&&e!==(e=i[0].firstname.slice(0,1)+"")&&R(t,e),r&1&&s!==(s=i[0].lastname.slice(0,1)+"")&&R(n,s)},d(i){i&&(D(t),D(n))}}}function rr(l){let e;function t(i,r){var a;return(a=i[0])!=null&&a.pictureurl?lr:sr}let s=t(l),n=s(l);return{c(){n.c(),e=pe()},m(i,r){n.m(i,r),S(i,e,r)},p(i,[r]){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e.parentNode,e)))},i:U,o:U,d(i){i&&D(e),n.d(i)}}}function ar(l,e,t){let{user:s=void 0}=e,{icon:n=void 0}=e;return l.$$set=i=>{"user"in i&&t(0,s=i.user),"icon"in i&&t(1,n=i.icon)},[s,n]}class xe extends ce{constructor(e){super(),me(this,e,ar,rr,ue,{user:0,icon:1})}}function Ms(l){let e,t,s,n;return s=new un({props:{strings:l[0],message:l[1]}}),{c(){e=h("hr"),t=L(),Y(s.$$.fragment)},m(i,r){S(i,e,r),S(i,t,r),J(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.strings=i[0]),r&2&&(a.message=i[1]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){N(s.$$.fragment,i),n=!1},d(i){i&&(D(e),D(t)),W(s,i)}}}function or(l){let e,t,s,n=l[1].subject+"",i,r,a,o,f,d,c,m,_,b=l[1].sender.fullname+"",p,v,y,$,w=l[1].fulltime+"",k,M,j,C,z,B=l[1].content+"",q,G;d=new xe({props:{user:l[1].sender}});let P=l[1].attachments.length>0&&Ms(l);return{c(){e=h("div"),t=h("div"),s=h("h5"),i=I(n),r=L(),a=h("div"),o=h("div"),f=h("div"),Y(d.$$.fragment),c=L(),m=h("div"),_=h("a"),p=I(b),y=L(),$=h("div"),k=I(w),M=L(),j=h("hr"),C=L(),z=h("div"),q=L(),P&&P.c(),u(s,"class","h5 card-title mb-3"),u(f,"class","mr-3"),u(_,"href",v=l[1].sender.profileurl),u(m,"class","mt-1"),u(o,"class","d-flex mb-3 mb-sm-0"),u($,"class","mt-1 ml-auto"),u(a,"class","d-sm-flex mb-n1"),u(z,"class","local-mail-message-reference-content"),u(t,"class","card-body p-3 px-xl-4"),u(e,"class","card mb-4")},m(K,x){S(K,e,x),g(e,t),g(t,s),g(s,i),g(t,r),g(t,a),g(a,o),g(o,f),J(d,f,null),g(o,c),g(o,m),g(m,_),g(_,p),g(a,y),g(a,$),g($,k),g(t,M),g(t,j),g(t,C),g(t,z),z.innerHTML=B,g(t,q),P&&P.m(t,null),G=!0},p(K,[x]){(!G||x&2)&&n!==(n=K[1].subject+"")&&R(i,n);const V={};x&2&&(V.user=K[1].sender),d.$set(V),(!G||x&2)&&b!==(b=K[1].sender.fullname+"")&&R(p,b),(!G||x&2&&v!==(v=K[1].sender.profileurl))&&u(_,"href",v),(!G||x&2)&&w!==(w=K[1].fulltime+"")&&R(k,w),(!G||x&2)&&B!==(B=K[1].content+"")&&(z.innerHTML=B),K[1].attachments.length>0?P?(P.p(K,x),x&2&&T(P,1)):(P=Ms(K),P.c(),T(P,1),P.m(t,null)):P&&(ie(),N(P,1,1,()=>{P=null}),re())},i(K){G||(T(d.$$.fragment,K),T(P),G=!0)},o(K){N(d.$$.fragment,K),N(P),G=!1},d(K){K&&D(e),W(d),P&&P.d()}}}function fr(l,e,t){let{strings:s}=e,{reference:n}=e;return l.$$set=i=>{"strings"in i&&t(0,s=i.strings),"reference"in i&&t(1,n=i.reference)},[s,n]}class cn extends ce{constructor(e){super(),me(this,e,fr,or,ue,{strings:0,reference:1})}}function Cs(l,e,t){const s=l.slice();return s[4]=e[t],s}function Ss(l,e,t){const s=l.slice();return s[7]=e[t],s[9]=t,s}function Ds(l){let e,t,s=l[3].strings[l[4]]+"",n,i,r,a=[],o=new Map,f,d=fe(l[2](l[4]));const c=m=>m[7].id;for(let m=0;m<d.length;m+=1){let _=Ss(l,d,m),b=c(_);o.set(b,a[m]=Ls(b,_))}return{c(){e=h("div"),t=h("span"),n=I(s),i=I(":"),r=L();for(let m=0;m<a.length;m+=1)a[m].c();f=L(),u(e,"class","mb-2")},m(m,_){S(m,e,_),g(e,t),g(t,n),g(t,i),g(e,r);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(e,null);g(e,f)},p(m,_){_&8&&s!==(s=m[3].strings[m[4]]+"")&&R(n,s),_&4&&(d=fe(m[2](m[4])),a=De(a,_,c,1,m,d,o,e,Qe,Ls,f,Ss))},d(m){m&&D(e);for(let _=0;_<a.length;_+=1)a[_].d()}}}function Ts(l){let e;return{c(){e=I(",")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function Ls(l,e){let t,s,n,i=e[7].fullname+"",r,a,o=e[9]>0&&Ts();return{key:l,first:null,c(){t=pe(),o&&o.c(),s=L(),n=h("a"),r=I(i),u(n,"href",a=e[7].profileurl),this.first=t},m(f,d){S(f,t,d),o&&o.m(f,d),S(f,s,d),S(f,n,d),g(n,r)},p(f,d){e=f,e[9]>0?o||(o=Ts(),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),d&4&&i!==(i=e[7].fullname+"")&&R(r,i),d&4&&a!==(a=e[7].profileurl)&&u(n,"href",a)},d(f){f&&(D(t),D(s),D(n)),o&&o.d(f)}}}function zs(l){let e=l[2](l[4]).length>0,t,s=e&&Ds(l);return{c(){s&&s.c(),t=pe()},m(n,i){s&&s.m(n,i),S(n,t,i)},p(n,i){i&4&&(e=n[2](n[4]).length>0),e?s?s.p(n,i):(s=Ds(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},d(n){n&&D(t),s&&s.d(n)}}}function ur(l){let e,t,s,n,i,r,a,o=l[1].sender.fullname+"",f,d,c,m;s=new xe({props:{user:l[1].sender}});let _=fe(Object.values(ze)),b=[];for(let p=0;p<_.length;p+=1)b[p]=zs(Cs(l,_,p));return{c(){e=h("div"),t=h("div"),Y(s.$$.fragment),n=L(),i=h("div"),r=h("div"),a=h("a"),f=I(o),c=L();for(let p=0;p<b.length;p+=1)b[p].c();u(t,"class","mr-3"),u(a,"href",d=l[1].sender.profileurl),u(r,"class","mt-1 mb-2"),u(i,"class","d-flex flex-column"),u(e,"class","local-mail-message-users d-flex mb-n2")},m(p,v){S(p,e,v),g(e,t),J(s,t,null),g(e,n),g(e,i),g(i,r),g(r,a),g(a,f),g(i,c);for(let y=0;y<b.length;y+=1)b[y]&&b[y].m(i,null);m=!0},p(p,[v]){const y={};if(v&2&&(y.user=p[1].sender),s.$set(y),(!m||v&2)&&o!==(o=p[1].sender.fullname+"")&&R(f,o),(!m||v&2&&d!==(d=p[1].sender.profileurl))&&u(a,"href",d),v&12){_=fe(Object.values(ze));let $;for($=0;$<_.length;$+=1){const w=Cs(p,_,$);b[$]?b[$].p(w,v):(b[$]=zs(w),b[$].c(),b[$].m(i,null))}for(;$<b.length;$+=1)b[$].d(1);b.length=_.length}},i(p){m||(T(s.$$.fragment,p),m=!0)},o(p){N(s.$$.fragment,p),m=!1},d(p){p&&D(e),W(s),Be(b,p)}}}function cr(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,f=>t(3,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return l.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=f=>o.recipients.filter(d=>d.type==f))},[a,o,s,n]}class mr extends ce{constructor(e){super(),me(this,e,cr,ur,ue,{store:0,message:1})}}function js(l,e,t){const s=l.slice();return s[4]=e[t],s}function Ns(l){let e,t,s,n;return s=new un({props:{strings:l[2].strings,message:l[1]}}),{c(){e=h("hr"),t=L(),Y(s.$$.fragment)},m(i,r){S(i,e,r),S(i,t,r),J(s,i,r),n=!0},p(i,r){const a={};r&4&&(a.strings=i[2].strings),r&2&&(a.message=i[1]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){N(s.$$.fragment,i),n=!1},d(i){i&&(D(e),D(t)),W(s,i)}}}function Bs(l){let e,t=l[2].strings.references+"",s,n,i=[],r=new Map,a,o,f=fe(l[1].references);const d=c=>c[4].id;for(let c=0;c<f.length;c+=1){let m=js(l,f,c),_=d(m);r.set(_,i[c]=As(_,m))}return{c(){e=h("div"),s=I(t),n=L();for(let c=0;c<i.length;c+=1)i[c].c();a=pe(),u(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(c,m){S(c,e,m),g(e,s),S(c,n,m);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(c,m);S(c,a,m),o=!0},p(c,m){(!o||m&4)&&t!==(t=c[2].strings.references+"")&&R(s,t),m&6&&(f=fe(c[1].references),ie(),i=De(i,m,d,1,c,f,r,a.parentNode,Ue,As,a,js),re())},i(c){if(!o){for(let m=0;m<f.length;m+=1)T(i[m]);o=!0}},o(c){for(let m=0;m<i.length;m+=1)N(i[m]);o=!1},d(c){c&&(D(e),D(n),D(a));for(let m=0;m<i.length;m+=1)i[m].d(c)}}}function As(l,e){let t,s,n;return s=new cn({props:{strings:e[2].strings,reference:e[4]}}),{key:l,first:null,c(){t=pe(),Y(s.$$.fragment),this.first=t},m(i,r){S(i,t,r),J(s,i,r),n=!0},p(i,r){e=i;const a={};r&4&&(a.strings=e[2].strings),r&2&&(a.reference=e[4]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){N(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(s,i)}}}function dr(l){let e,t,s,n=l[1].subject+"",i,r,a,o,f,d,c,m,_=l[1].fulltime+"",b,p,v,y,$,w,k,M,j,C,z=l[1].content+"",B,q,G,P,K,x,V,te,le;f=new tr({props:{store:l[0],message:l[1]}}),y=new Yi({props:{store:l[0],message:l[1],canReplyAll:l[3]}}),w=new mr({props:{store:l[0],message:l[1]}});let ee=l[1].attachments.length>0&&Ns(l);x=new Zi({props:{store:l[0],message:l[1],canReplyAll:l[3]}});let X=l[1].references.length>0&&Bs(l);return{c(){e=h("div"),t=h("div"),s=h("h3"),i=I(n),r=L(),a=h("div"),o=h("div"),Y(f.$$.fragment),d=L(),c=h("div"),m=h("div"),b=I(_),p=L(),v=h("div"),Y(y.$$.fragment),$=L(),Y(w.$$.fragment),k=L(),M=h("hr"),j=L(),C=h("div"),B=L(),ee&&ee.c(),q=L(),G=h("hr"),P=L(),K=h("div"),Y(x.$$.fragment),V=L(),X&&X.c(),te=pe(),u(s,"class","h4 card-title mb-3 mb-md-2"),u(o,"class","d-flex flex-wrap mx-n2 mt-2"),_e(o,"min-width","0"),u(m,"class","my-2 text-truncate"),u(v,"class","d-flex flex-shrink-0 ml-3 mr-n2"),u(c,"class","d-flex justify-content-between flex-shrink-0 ml-auto"),u(a,"class","d-md-flex align-items-start mb-2"),u(C,"class","local-mail-message-content"),u(K,"class","mt-3 d-flex mr-n3 mb-n3 flex-column flex-sm-row justify-content-end"),u(t,"class","card-body p-3 px-xl-4"),u(e,"class","card")},m(A,E){S(A,e,E),g(e,t),g(t,s),g(s,i),g(t,r),g(t,a),g(a,o),J(f,o,null),g(a,d),g(a,c),g(c,m),g(m,b),g(c,p),g(c,v),J(y,v,null),g(t,$),J(w,t,null),g(t,k),g(t,M),g(t,j),g(t,C),C.innerHTML=z,g(t,B),ee&&ee.m(t,null),g(t,q),g(t,G),g(t,P),g(t,K),J(x,K,null),S(A,V,E),X&&X.m(A,E),S(A,te,E),le=!0},p(A,[E]){(!le||E&2)&&n!==(n=A[1].subject+"")&&R(i,n);const se={};E&1&&(se.store=A[0]),E&2&&(se.message=A[1]),f.$set(se),(!le||E&2)&&_!==(_=A[1].fulltime+"")&&R(b,_);const ae={};E&1&&(ae.store=A[0]),E&2&&(ae.message=A[1]),E&8&&(ae.canReplyAll=A[3]),y.$set(ae);const F={};E&1&&(F.store=A[0]),E&2&&(F.message=A[1]),w.$set(F),(!le||E&2)&&z!==(z=A[1].content+"")&&(C.innerHTML=z),A[1].attachments.length>0?ee?(ee.p(A,E),E&2&&T(ee,1)):(ee=Ns(A),ee.c(),T(ee,1),ee.m(t,q)):ee&&(ie(),N(ee,1,1,()=>{ee=null}),re());const oe={};E&1&&(oe.store=A[0]),E&2&&(oe.message=A[1]),E&8&&(oe.canReplyAll=A[3]),x.$set(oe),A[1].references.length>0?X?(X.p(A,E),E&2&&T(X,1)):(X=Bs(A),X.c(),T(X,1),X.m(te.parentNode,te)):X&&(ie(),N(X,1,1,()=>{X=null}),re())},i(A){le||(T(f.$$.fragment,A),T(y.$$.fragment,A),T(w.$$.fragment,A),T(ee),T(x.$$.fragment,A),T(X),le=!0)},o(A){N(f.$$.fragment,A),N(y.$$.fragment,A),N(w.$$.fragment,A),N(ee),N(x.$$.fragment,A),N(X),le=!1},d(A){A&&(D(e),D(V),D(te)),W(f),W(y),W(w),ee&&ee.d(),W(x),X&&X.d(A)}}}function _r(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,f=>t(2,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return l.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=o.sender.id==n.userid?o.recipients.filter(f=>f.type=="cc").length>0:o.recipients.filter(f=>["to","cc"].includes(f.type)&&f.id!=n.userid).length>0)},[a,o,n,s]}class gr extends ce{constructor(e){super(),me(this,e,_r,dr,ue,{store:0,message:1})}}function qs(l,e,t){const s=l.slice();s[6]=e[t];const n=Array.from(s[1].values()).filter(function(...r){return l[5](s[6],...r)});return s[7]=n,s}function Is(l,e,t){const s=l.slice();return s[10]=e[t],s}function Es(l){let e,t,s=l[3].strings[l[6]]+"",n,i,r,a,o=[],f=new Map,d,c,m,_=fe(l[7]);const b=p=>p[10].id;for(let p=0;p<_.length;p+=1){let v=Is(l,_,p),y=b(v);f.set(y,o[p]=Ps(y,v))}return{c(){e=h("div"),t=h("div"),n=I(s),i=I(":"),r=L(),a=h("div");for(let p=0;p<o.length;p+=1)o[p].c();d=L(),u(t,"class","local-mail-message-form-recipients-type flex-shrink-0 py-2 mr-2"),u(a,"class","d-flex flex-wrap"),_e(a,"min-width","0"),u(e,"class","d-flex mb-2")},m(p,v){S(p,e,v),g(e,t),g(t,n),g(t,i),g(e,r),g(e,a);for(let y=0;y<o.length;y+=1)o[y]&&o[y].m(a,null);g(e,d),m=!0},p(p,v){(!m||v&8)&&s!==(s=p[3].strings[p[6]]+"")&&R(n,s),v&14&&(_=fe(p[7]),ie(),o=De(o,v,b,1,p,_,f,a,Ue,Ps,null,Is),re())},i(p){if(!m){for(let v=0;v<_.length;v+=1)T(o[v]);p&&Le(()=>{m&&(c||(c=qe(e,Ne,{},!0)),c.run(1))}),m=!0}},o(p){for(let v=0;v<o.length;v+=1)N(o[v]);p&&(c||(c=qe(e,Ne,{},!1)),c.run(0)),m=!1},d(p){p&&D(e);for(let v=0;v<o.length;v+=1)o[v].d();p&&c&&c.end()}}}function pr(l){let e,t,s;return{c(){e=h("div"),t=h("i"),u(t,"class","fa fa-exclamation-circle"),u(e,"class","m-0 d-flex justify-content-center align-items-center"),_e(e,"width","35px"),_e(e,"height","35px"),u(e,"title",s=l[3].strings.cannotsendmailtouser)},m(n,i){S(n,e,i),g(e,t)},p(n,i){i&8&&s!==(s=n[3].strings.cannotsendmailtouser)&&u(e,"title",s)},i:U,o:U,d(n){n&&D(e)}}}function br(l){let e,t;return e=new xe({props:{user:l[10]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.user=s[10]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Ps(l,e){let t,s,n,i,r,a,o=e[10].fullname+"",f,d,c,m,_,b,p,v,y,$,w,k;const M=[br,pr],j=[];function C(B,q){return B[10].isvalid?0:1}n=C(e),i=j[n]=M[n](e);function z(){return e[4](e[10])}return{key:l,first:null,c(){t=h("div"),s=h("div"),i.c(),r=L(),a=h("div"),f=I(o),c=L(),m=h("button"),_=h("i"),p=L(),u(s,"class","d-flex m-1 mr-2"),u(a,"class","py-2"),u(_,"class","fa fa-fw fa-times"),u(m,"type","button"),u(m,"class","btn align-self-middle p-2 align-bottom"),u(m,"title",b=e[3].strings.delete),u(t,"class","local-mail-message-form-recipients-user d-flex flex-shrink align-items-center mr-2 mb-2"),O(t,"alert-danger",!e[10].isvalid),this.first=t},m(B,q){S(B,t,q),g(t,s),j[n].m(s,null),g(t,r),g(t,a),g(a,f),g(t,c),g(t,m),g(m,_),g(t,p),$=!0,w||(k=[Ce(d=Ee.call(null,a,e[10].fullname)),H(m,"click",z),Ce(v=Ee.call(null,t,e[10].fullname))],w=!0)},p(B,q){e=B;let G=n;n=C(e),n===G?j[n].p(e,q):(ie(),N(j[G],1,1,()=>{j[G]=null}),re(),i=j[n],i?i.p(e,q):(i=j[n]=M[n](e),i.c()),T(i,1),i.m(s,null)),(!$||q&2)&&o!==(o=e[10].fullname+"")&&R(f,o),d&&$e(d.update)&&q&2&&d.update.call(null,e[10].fullname),(!$||q&8&&b!==(b=e[3].strings.delete))&&u(m,"title",b),v&&$e(v.update)&&q&2&&v.update.call(null,e[10].fullname),(!$||q&2)&&O(t,"alert-danger",!e[10].isvalid)},i(B){$||(T(i),B&&Le(()=>{$&&(y||(y=qe(t,Ne,{},!0)),y.run(1))}),$=!0)},o(B){N(i),B&&(y||(y=qe(t,Ne,{},!1)),y.run(0)),$=!1},d(B){B&&D(t),j[n].d(),B&&y&&y.end(),w=!1,we(k)}}}function Rs(l){let e,t,s=l[7].length&&Es(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,i){n[7].length?s?(s.p(n,i),i&2&&T(s,1)):(s=Es(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),N(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){N(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function hr(l){let e,t,s=fe(Object.values(ze)),n=[];for(let r=0;r<s.length;r+=1)n[r]=Rs(qs(l,s,r));const i=r=>N(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=pe()},m(r,a){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(r,a);S(r,e,a),t=!0},p(r,[a]){if(a&14){s=fe(Object.values(ze));let o;for(o=0;o<s.length;o+=1){const f=qs(r,s,o);n[o]?(n[o].p(f,a),T(n[o],1)):(n[o]=Rs(f),n[o].c(),T(n[o],1),n[o].m(e.parentNode,e))}for(ie(),o=s.length;o<n.length;o+=1)i(o);re()}},i(r){if(!t){for(let a=0;a<s.length;a+=1)T(n[a]);t=!0}},o(r){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)N(n[a]);t=!1},d(r){r&&D(e),Be(n,r)}}}function kr(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,c=>t(3,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{recipients:a}=e,{onDelete:o}=e;const f=c=>o(c),d=(c,m)=>m.type==c;return l.$$set=c=>{"store"in c&&i(t(0,r=c.store)),"recipients"in c&&t(1,a=c.recipients),"onDelete"in c&&t(2,o=c.onDelete)},[r,a,o,s,f,d]}class vr extends ce{constructor(e){super(),me(this,e,kr,hr,ue,{store:0,recipients:1,onDelete:2})}}function Fs(l,e,t){const s=l.slice();return s[4]=e[t],s}function wr(l){let e,t,s=l[1].shorttime+"",n;return{c(){e=h("i"),t=L(),n=I(s),u(e,"class","fa fa-clock-o mr-1"),u(e,"aria-hidden","true")},m(i,r){S(i,e,r),S(i,t,r),S(i,n,r)},p(i,r){r&2&&s!==(s=i[1].shorttime+"")&&R(n,s)},d(i){i&&(D(e),D(t),D(n))}}}function yr(l){let e,t,s=l[2].strings.draftsaved+"",n;return{c(){e=h("i"),t=L(),n=I(s),u(e,"class","fa fa-check mr-1"),u(e,"aria-hidden","true")},m(i,r){S(i,e,r),S(i,t,r),S(i,n,r)},p(i,r){r&4&&s!==(s=i[2].strings.draftsaved+"")&&R(n,s)},d(i){i&&(D(e),D(t),D(n))}}}function Us(l){let e,t=[],s=new Map,n,i=fe(l[1].labels);const r=a=>a[4].id;for(let a=0;a<i.length;a+=1){let o=Fs(l,i,a),f=r(o);s.set(f,t[a]=Gs(f,o))}return{c(){e=h("div");for(let a=0;a<t.length;a+=1)t[a].c();u(e,"class","d-flex flex-wrap mt-2 mr-2"),_e(e,"min-width","0")},m(a,o){S(a,e,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,o){o&2&&(i=fe(a[1].labels),ie(),t=De(t,o,r,1,a,i,s,e,Ue,Gs,null,Fs),re())},i(a){if(!n){for(let o=0;o<i.length;o+=1)T(t[o]);n=!0}},o(a){for(let o=0;o<t.length;o+=1)N(t[o]);n=!1},d(a){a&&D(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Gs(l,e){let t,s,n;return s=new gt({props:{label:e[4]}}),{key:l,first:null,c(){t=pe(),Y(s.$$.fragment),this.first=t},m(i,r){S(i,t,r),J(s,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.label=e[4]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){N(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(s,i)}}}function $r(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p;function v(k,M){return k[2].draftSaved?yr:wr}let y=v(l),$=y(l),w=l[1].labels&&Us(l);return{c(){e=h("div"),t=h("div"),s=h("div"),$.c(),i=L(),r=h("button"),a=h("i"),m=L(),w&&w.c(),u(s,"class","align-self-center alert-info px-2 text-truncate"),u(s,"title",n=l[1].fulltime),u(a,"class",o="fa "+(l[1].starred?"fa-star text-warning":"fa-star-o")),u(r,"type","button"),u(r,"class","btn border-0 py-2 ml-auto mr-3 mr-sm-2"),u(r,"role","checkbox"),u(r,"aria-checked",f=l[1].starred),r.disabled=d=l[1].deleted,u(r,"title",c=l[1].starred?l[2].strings.markasunstarred:l[2].strings.markasstarred),u(t,"class","d-flex flex-grow-1"),u(e,"class","d-sm-flex justify-content-between mb-2 mr-n3")},m(k,M){S(k,e,M),g(e,t),g(t,s),$.m(s,null),g(t,i),g(t,r),g(r,a),g(e,m),w&&w.m(e,null),_=!0,b||(p=H(r,"click",l[3]),b=!0)},p(k,[M]){y===(y=v(k))&&$?$.p(k,M):($.d(1),$=y(k),$&&($.c(),$.m(s,null))),(!_||M&2&&n!==(n=k[1].fulltime))&&u(s,"title",n),(!_||M&2&&o!==(o="fa "+(k[1].starred?"fa-star text-warning":"fa-star-o")))&&u(a,"class",o),(!_||M&2&&f!==(f=k[1].starred))&&u(r,"aria-checked",f),(!_||M&2&&d!==(d=k[1].deleted))&&(r.disabled=d),(!_||M&6&&c!==(c=k[1].starred?k[2].strings.markasunstarred:k[2].strings.markasstarred))&&u(r,"title",c),k[1].labels?w?(w.p(k,M),M&2&&T(w,1)):(w=Us(k),w.c(),T(w,1),w.m(e,null)):w&&(ie(),N(w,1,1,()=>{w=null}),re())},i(k){_||(T(w),_=!0)},o(k){N(w),_=!1},d(k){k&&D(e),$.d(),w&&w.d(),b=!1,p()}}}function Mr(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;const o=()=>r.setStarred([a.id],!a.starred);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"message"in f&&t(1,a=f.message)},[r,a,s,o]}class Cr extends ce{constructor(e){super(),me(this,e,Mr,$r,ue,{store:0,message:1})}}async function Ye(l){const e=await ot("core/ajax"),t=Array.from(l).map(({methodname:s,...n})=>({methodname:`local_mail_${s}`,args:n}));try{return await Promise.all(e.call(t))}catch(s){throw typeof s=="string"?{message:s}:s}}function Os(l,e,t){var i;const s=l.slice();s[30]=e[t];const n=(i=s[2].get(s[30].id))==null?void 0:i.type;return s[31]=n,s}function Hs(l,e,t){const s=l.slice();return s[34]=e[t],s}function Vs(l,e,t){const s=l.slice();s[34]=e[t];const n=s[10].every(function(...r){return l[27](s[34],...r)});return s[37]=n,s}function Ks(l,e,t){const s=l.slice();return s[40]=e[t],s}function Ys(l,e,t){const s=l.slice();return s[43]=e[t],s}function Js(l){let e,t,s,n,i,r=l[14].strings.allroles+"",a,o=[],f=new Map,d,c,m,_,b,p,v,y=fe(l[8]);const $=C=>C[43].id;for(let C=0;C<y.length;C+=1){let z=Ys(l,y,C),B=$(z);f.set(B,o[C]=Ws(B,z))}let w=l[9].length>0&&Xs(l);const k=[Tr,Dr,Sr],M=[];function j(C,z){return C[10].length?C[11]?1:2:0}return m=j(l),_=M[m]=k[m](l),{c(){e=h("div"),t=h("div"),s=h("div"),n=h("select"),i=h("option"),a=I(r);for(let C=0;C<o.length;C+=1)o[C].c();d=L(),w&&w.c(),c=L(),_.c(),i.__value=0,ye(i,i.__value),u(n,"class","form-control text-truncate"),l[12]===void 0&&Le(()=>l[22].call(n)),u(s,"class","flex-grow-1 mx-2"),u(t,"class","list-group-item d-sm-flex px-2 py-2"),u(e,"class","local-mail-message-form-search-users-dropdown dropdown-menu dropdown-menu-left list-group show p-0 w-100"),_e(e,"min-width","18rem")},m(C,z){S(C,e,z),g(e,t),g(t,s),g(s,n),g(n,i),g(i,a);for(let B=0;B<o.length;B+=1)o[B]&&o[B].m(n,null);Je(n,l[12],!0),g(t,d),w&&w.m(t,null),g(e,c),M[m].m(e,null),b=!0,p||(v=[H(n,"change",l[22]),H(n,"change",l[23])],p=!0)},p(C,z){(!b||z[0]&16384)&&r!==(r=C[14].strings.allroles+"")&&R(a,r),z[0]&256&&(y=fe(C[8]),o=De(o,z,$,1,C,y,f,n,Qe,Ws,null,Ys)),z[0]&4352&&Je(n,C[12]),C[9].length>0?w?w.p(C,z):(w=Xs(C),w.c(),w.m(t,null)):w&&(w.d(1),w=null);let B=m;m=j(C),m===B?M[m].p(C,z):(ie(),N(M[B],1,1,()=>{M[B]=null}),re(),_=M[m],_?_.p(C,z):(_=M[m]=k[m](C),_.c()),T(_,1),_.m(e,null))},i(C){b||(T(_),b=!0)},o(C){N(_),b=!1},d(C){C&&D(e);for(let z=0;z<o.length;z+=1)o[z].d();w&&w.d(),M[m].d(),p=!1,we(v)}}}function Ws(l,e){let t,s=e[43].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=I(s),i=L(),t.__value=r=e[43].id,ye(t,t.__value),this.first=t},m(a,o){S(a,t,o),g(t,n),g(t,i)},p(a,o){e=a,o[0]&256&&s!==(s=e[43].name+"")&&R(n,s),o[0]&256&&r!==(r=e[43].id)&&(t.__value=r,ye(t,t.__value))},d(a){a&&D(t)}}}function Xs(l){let e,t,s,n=[],i=new Map,r,a,o=l[1].groupmode!=lt.Separate&&Qs(l),f=fe(l[9]);const d=c=>c[40].id;for(let c=0;c<f.length;c+=1){let m=Ks(l,f,c),_=d(m);i.set(_,n[c]=Zs(_,m))}return{c(){e=h("div"),t=h("select"),o&&o.c(),s=pe();for(let c=0;c<n.length;c+=1)n[c].c();u(t,"class","form-control text-truncate"),_e(t,"min-width","0"),l[13]===void 0&&Le(()=>l[24].call(t)),u(e,"class","flex-grow-1 mx-2 mt-2 mt-sm-0")},m(c,m){S(c,e,m),g(e,t),o&&o.m(t,null),g(t,s);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(t,null);Je(t,l[13],!0),r||(a=[H(t,"change",l[24]),H(t,"change",l[25])],r=!0)},p(c,m){c[1].groupmode!=lt.Separate?o?o.p(c,m):(o=Qs(c),o.c(),o.m(t,s)):o&&(o.d(1),o=null),m[0]&512&&(f=fe(c[9]),n=De(n,m,d,1,c,f,i,t,Qe,Zs,null,Ks)),m[0]&8704&&Je(t,c[13])},d(c){c&&D(e),o&&o.d();for(let m=0;m<n.length;m+=1)n[m].d();r=!1,we(a)}}}function Qs(l){let e,t=l[14].strings.allgroups+"",s;return{c(){e=h("option"),s=I(t),e.__value=0,ye(e,e.__value)},m(n,i){S(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.allgroups+"")&&R(s,t)},d(n){n&&D(e)}}}function Zs(l,e){let t,s=e[40].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=I(s),i=L(),t.__value=r=e[40].id,ye(t,t.__value),u(t,"class","text-truncate"),this.first=t},m(a,o){S(a,t,o),g(t,n),g(t,i)},p(a,o){e=a,o[0]&512&&s!==(s=e[40].name+"")&&R(n,s),o[0]&512&&r!==(r=e[40].id)&&(t.__value=r,ye(t,t.__value))},d(a){a&&D(t)}}}function Sr(l){let e,t,s,n,i,r,a=l[14].strings.allusers+"",o,f,d,c,m,_=[],b=new Map,p,v,y,$;s=new xe({props:{icon:"fa-users"}});let w=fe(Object.values(ze)),k=[];for(let C=0;C<w.length;C+=1)k[C]=xs(Vs(l,w,C));let M=fe(l[10]);const j=C=>C[30].id;for(let C=0;C<M.length;C+=1){let z=Os(l,M,C),B=j(z);b.set(B,_[C]=tl(B,z))}return{c(){e=h("div"),t=h("div"),Y(s.$$.fragment),n=L(),i=h("div"),r=h("div"),o=I(a),d=L(),c=h("div");for(let C=0;C<k.length;C+=1)k[C].c();m=L();for(let C=0;C<_.length;C+=1)_[C].c();p=pe(),u(t,"class","mx-3 my-2"),u(r,"class","py-2 mr-3"),u(c,"class","d-flex ml-auto mr-2"),u(i,"class","d-sm-flex align-items-center flex-grow-1"),u(e,"class","list-group-item d-flex align-items-sm-center p-0")},m(C,z){S(C,e,z),g(e,t),J(s,t,null),g(e,n),g(e,i),g(i,r),g(r,o),g(i,d),g(i,c);for(let B=0;B<k.length;B+=1)k[B]&&k[B].m(c,null);S(C,m,z);for(let B=0;B<_.length;B+=1)_[B]&&_[B].m(C,z);S(C,p,z),v=!0,y||($=Ce(f=Ee.call(null,r,l[14].strings.allusers)),y=!0)},p(C,z){if((!v||z[0]&16384)&&a!==(a=C[14].strings.allusers+"")&&R(o,a),f&&$e(f.update)&&z[0]&16384&&f.update.call(null,C[14].strings.allusers),z[0]&17420){w=fe(Object.values(ze));let B;for(B=0;B<w.length;B+=1){const q=Vs(C,w,B);k[B]?k[B].p(q,z):(k[B]=xs(q),k[B].c(),k[B].m(c,null))}for(;B<k.length;B+=1)k[B].d(1);k.length=w.length}z[0]&17420&&(M=fe(C[10]),ie(),_=De(_,z,j,1,C,M,b,p.parentNode,Ue,tl,p,Os),re())},i(C){if(!v){T(s.$$.fragment,C);for(let z=0;z<M.length;z+=1)T(_[z]);v=!0}},o(C){N(s.$$.fragment,C);for(let z=0;z<_.length;z+=1)N(_[z]);v=!1},d(C){C&&(D(e),D(m),D(p)),W(s),Be(k,C);for(let z=0;z<_.length;z+=1)_[z].d(C);y=!1,$()}}}function Dr(l){let e,t=l[14].strings.toomanyusersfound+"",s;return{c(){e=h("div"),s=I(t),u(e,"class","list-group-item text-danger")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.toomanyusersfound+"")&&R(s,t)},i:U,o:U,d(n){n&&D(e)}}}function Tr(l){let e,t=l[14].strings.nousersfound+"",s;return{c(){e=h("div"),s=I(t),u(e,"class","list-group-item text-danger")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.nousersfound+"")&&R(s,t)},i:U,o:U,d(n){n&&D(e)}}}function xs(l){let e,t=l[14].strings[l[34]]+"",s,n,i,r,a;function o(){return l[26](l[37],l[34])}return{c(){e=h("button"),s=I(t),n=L(),u(e,"type","button"),u(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),u(e,"aria-pressed",i=l[37]),O(e,"btn-primary",l[37]),O(e,"btn-secondary",!l[37])},m(f,d){S(f,e,d),g(e,s),g(e,n),r||(a=H(e,"click",o),r=!0)},p(f,d){l=f,d[0]&16384&&t!==(t=l[14].strings[l[34]]+"")&&R(s,t),d[0]&1028&&i!==(i=l[37])&&u(e,"aria-pressed",i),d[0]&1028&&O(e,"btn-primary",l[37]),d[0]&1028&&O(e,"btn-secondary",!l[37])},d(f){f&&D(e),r=!1,a()}}}function el(l){let e,t=l[14].strings[l[34]]+"",s,n,i,r,a;function o(){return l[28](l[30],l[31],l[34])}return{c(){e=h("button"),s=I(t),n=L(),u(e,"type","button"),u(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),u(e,"aria-pressed",i=l[31]==l[34]),O(e,"btn-primary",l[31]==l[34]),O(e,"btn-secondary",l[31]!=l[34])},m(f,d){S(f,e,d),g(e,s),g(e,n),r||(a=H(e,"click",o),r=!0)},p(f,d){l=f,d[0]&16384&&t!==(t=l[14].strings[l[34]]+"")&&R(s,t),d[0]&1028&&i!==(i=l[31]==l[34])&&u(e,"aria-pressed",i),d[0]&1028&&O(e,"btn-primary",l[31]==l[34]),d[0]&1028&&O(e,"btn-secondary",l[31]!=l[34])},d(f){f&&D(e),r=!1,a()}}}function tl(l,e){let t,s,n,i,r,a,o=e[30].fullname+"",f,d,c,m,_,b,p,v;n=new xe({props:{user:e[30]}});let y=fe(Object.values(ze)),$=[];for(let w=0;w<y.length;w+=1)$[w]=el(Hs(e,y,w));return{key:l,first:null,c(){t=h("div"),s=h("div"),Y(n.$$.fragment),i=L(),r=h("div"),a=h("div"),f=I(o),c=L(),m=h("div");for(let w=0;w<$.length;w+=1)$[w].c();_=L(),u(s,"class","mx-3 my-2"),u(a,"class","py-2 mr-3"),u(m,"class","d-flex ml-auto mr-2"),u(r,"class","d-sm-flex align-items-center flex-grow-1"),u(t,"class","list-group-item d-flex align-items-sm-center p-0"),this.first=t},m(w,k){S(w,t,k),g(t,s),J(n,s,null),g(t,i),g(t,r),g(r,a),g(a,f),g(r,c),g(r,m);for(let M=0;M<$.length;M+=1)$[M]&&$[M].m(m,null);g(t,_),b=!0,p||(v=Ce(d=Ee.call(null,a,e[30].fullname)),p=!0)},p(w,k){e=w;const M={};if(k[0]&1024&&(M.user=e[30]),n.$set(M),(!b||k[0]&1024)&&o!==(o=e[30].fullname+"")&&R(f,o),d&&$e(d.update)&&k[0]&1024&&d.update.call(null,e[30].fullname),k[0]&17420){y=fe(Object.values(ze));let j;for(j=0;j<y.length;j+=1){const C=Hs(e,y,j);$[j]?$[j].p(C,k):($[j]=el(C),$[j].c(),$[j].m(m,null))}for(;j<$.length;j+=1)$[j].d(1);$.length=y.length}},i(w){b||(T(n.$$.fragment,w),b=!0)},o(w){N(n.$$.fragment,w),b=!1},d(w){w&&D(t),W(n),Be($,w),p=!1,v()}}}function Lr(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,y,$,w=l[4]&&Js(l);return{c(){e=h("div"),t=h("div"),s=h("i"),i=L(),r=h("input"),f=L(),d=h("div"),c=h("button"),m=h("i"),p=L(),w&&w.c(),u(s,"class",n="fa fa-fw "+(l[7]?"fa-spinner fa-pulse":"fa-user")),u(s,"aria-hidden","true"),u(t,"class","position-absolute h-100 d-flex justify-content-center align-items-center px-2"),_e(t,"top","0"),_e(t,"left","0"),u(r,"type","text"),u(r,"class","form-control px-5"),u(r,"placeholder",a=l[14].strings.addrecipients),u(r,"aria-label",o=l[14].strings.addrecipients),u(r,"autocomplete","off"),O(r,"is-invalid",!l[2].size),u(m,"class",_="fa fa-fw "+(l[5]?"fa-times":l[4]?"fa-caret-up":"fa-caret-down")),u(m,"aria-hidden","true"),u(c,"type","button"),u(c,"aria-expanded",l[4]),u(c,"class","btn px-2"),u(c,"title",b=l[14].strings.addrecipients),u(d,"class","position-absolute h-100 d-flex align-items-center"),_e(d,"top","0"),_e(d,"right","0"),u(e,"class","local-mail-message-form-search-users-input form-group position-relative")},m(k,M){S(k,e,M),g(e,t),g(t,s),g(e,i),g(e,r),ye(r,l[5]),l[20](r),g(e,f),g(e,d),g(d,c),g(c,m),g(e,p),w&&w.m(e,null),v=!0,y||($=[H(r,"input",l[19]),H(r,"input",l[21]),H(r,"focus",l[18]),H(c,"click",Se(l[15])),Ce(Fe.call(null,e,l[17]))],y=!0)},p(k,M){(!v||M[0]&128&&n!==(n="fa fa-fw "+(k[7]?"fa-spinner fa-pulse":"fa-user")))&&u(s,"class",n),(!v||M[0]&16384&&a!==(a=k[14].strings.addrecipients))&&u(r,"placeholder",a),(!v||M[0]&16384&&o!==(o=k[14].strings.addrecipients))&&u(r,"aria-label",o),M[0]&32&&r.value!==k[5]&&ye(r,k[5]),(!v||M[0]&4)&&O(r,"is-invalid",!k[2].size),(!v||M[0]&48&&_!==(_="fa fa-fw "+(k[5]?"fa-times":k[4]?"fa-caret-up":"fa-caret-down")))&&u(m,"class",_),(!v||M[0]&16)&&u(c,"aria-expanded",k[4]),(!v||M[0]&16384&&b!==(b=k[14].strings.addrecipients))&&u(c,"title",b),k[4]?w?(w.p(k,M),M[0]&16&&T(w,1)):(w=Js(k),w.c(),T(w,1),w.m(e,null)):w&&(ie(),N(w,1,1,()=>{w=null}),re())},i(k){v||(T(w),v=!0)},o(k){N(w),v=!1},d(k){k&&D(e),l[20](null),w&&w.d(),y=!1,we($)}}}const zr=500;function jr(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,X=>t(14,s=X)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{course:a}=e,{recipients:o}=e,{onChange:f}=e,d=!1,c="",m,_=!1,b,p=[],v=[],y=[],$=!1,w=0,k=0;const M=async()=>{d?(t(5,c=""),t(4,d=!1),window.clearTimeout(b)):(j(!1),m.focus())},j=async X=>{const A=s.settings.usersearchlimit;t(7,_=!0),window.clearTimeout(b),b=window.setTimeout(async()=>{var ae;const E=[{methodname:"get_roles",courseid:a.id},{methodname:"get_groups",courseid:a.id},{methodname:"search_users",query:{courseid:a.id,fullname:c,roleid:w,groupid:k},limit:A+1}];let se;try{se=await Ye(E)}catch(F){r.setError(F),t(7,_=!1),t(4,d=!1),t(11,$=!1),t(10,y=[]);return}t(10,y=se.pop()),t(11,$=y.length>A),t(10,y=y.slice(0,A)),t(9,v=se.pop()),t(13,k=v.find(F=>F.id==k)?k:a.groupmode==lt.Separate&&((ae=v[0])==null?void 0:ae.id)||0),t(8,p=se.pop()),t(12,w=p.find(F=>F.id==w)?w:0),t(7,_=!1),t(4,d=!0)},X?zr:0)},C=()=>{t(5,c=""),t(4,d=!1)},z=()=>{d||j(!1)};function B(){c=this.value,t(5,c)}function q(X){Me[X?"unshift":"push"](()=>{m=X,t(6,m)})}const G=()=>j(!0);function P(){w=ft(this),t(12,w),t(8,p)}const K=()=>j(!1);function x(){k=ft(this),t(13,k),t(9,v)}const V=()=>j(!1),te=(X,A)=>f(y,X?null:A),le=(X,A)=>{var E;return((E=o.get(A.id))==null?void 0:E.type)==X},ee=(X,A,E)=>f([X],A==E?null:E);return l.$$set=X=>{"store"in X&&i(t(0,r=X.store)),"course"in X&&t(1,a=X.course),"recipients"in X&&t(2,o=X.recipients),"onChange"in X&&t(3,f=X.onChange)},[r,a,o,f,d,c,m,_,p,v,y,$,w,k,s,M,j,C,z,B,q,G,P,K,x,V,te,le,ee]}class Nr extends ce{constructor(e){super(),me(this,e,jr,Lr,ue,{store:0,course:1,recipients:2,onChange:3},null,[-1,-1])}}function Br(l){let e,t,s,n=l[1].strings.send+"",i,r,a,o;return{c(){e=h("button"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-send mr-2"),u(e,"type","button"),u(e,"class","local-mail-action-send btn btn-primary flex-shrink-0 text-nowrap px-3 text-truncate ml-auto"),u(e,"title",r=l[1].strings.send)},m(f,d){S(f,e,d),g(e,t),g(e,s),g(e,i),a||(o=H(e,"click",l[2]),a=!0)},p(f,[d]){d&2&&n!==(n=f[1].strings.send+"")&&R(i,n),d&2&&r!==(r=f[1].strings.send)&&u(e,"title",r)},i:U,o:U,d(f){f&&D(e),a=!1,o()}}}function Ar(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.sendMessage();return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class mn extends ce{constructor(e){super(),me(this,e,Ar,Br,ue,{store:0})}}const{Map:qr}=Ze;function sl(l,e,t){const s=l.slice();return s[20]=e[t],s}function ll(l){let e,t,s,n=l[7].strings.errorinvalidrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,a){S(r,e,a),g(e,t),g(e,s),g(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.errorinvalidrecipients+"")&&R(i,n)},d(r){r&&D(e)}}}function Ir(l){let e,t,s,n=Ie(l[7].strings.errortoomanyrecipients,l[7].settings.maxrecipients)+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,a){S(r,e,a),g(e,t),g(e,s),g(e,i)},p(r,a){a&128&&n!==(n=Ie(r[7].strings.errortoomanyrecipients,r[7].settings.maxrecipients)+"")&&R(i,n)},d(r){r&&D(e)}}}function Er(l){let e,t,s,n=l[7].strings.erroremptyrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,a){S(r,e,a),g(e,t),g(e,s),g(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.erroremptyrecipients+"")&&R(i,n)},d(r){r&&D(e)}}}function nl(l){let e,t,s,n=l[7].strings.erroremptysubject+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,a){S(r,e,a),g(e,t),g(e,s),g(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.erroremptysubject+"")&&R(i,n)},d(r){r&&D(e)}}}function il(l){let e,t=l[7].strings.references+"",s,n,i=[],r=new qr,a,o,f=fe(l[1].references);const d=c=>c[20].id;for(let c=0;c<f.length;c+=1){let m=sl(l,f,c),_=d(m);r.set(_,i[c]=rl(_,m))}return{c(){e=h("div"),s=I(t),n=L();for(let c=0;c<i.length;c+=1)i[c].c();a=pe(),u(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(c,m){S(c,e,m),g(e,s),S(c,n,m);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(c,m);S(c,a,m),o=!0},p(c,m){(!o||m&128)&&t!==(t=c[7].strings.references+"")&&R(s,t),m&130&&(f=fe(c[1].references),ie(),i=De(i,m,d,1,c,f,r,a.parentNode,Ue,rl,a,sl),re())},i(c){if(!o){for(let m=0;m<f.length;m+=1)T(i[m]);o=!0}},o(c){for(let m=0;m<i.length;m+=1)N(i[m]);o=!1},d(c){c&&(D(e),D(n),D(a));for(let m=0;m<i.length;m+=1)i[m].d(c)}}}function rl(l,e){let t,s,n;return s=new cn({props:{strings:e[7].strings,reference:e[20]}}),{key:l,first:null,c(){t=pe(),Y(s.$$.fragment),this.first=t},m(i,r){S(i,t,r),J(s,i,r),n=!0},p(i,r){e=i;const a={};r&128&&(a.strings=e[7].strings),r&2&&(a.reference=e[20]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){N(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(s,i)}}}function Pr(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,y,$,w,k,M=l[2].editorhtml+"",j,C,z=l[2].filemanagerhtml+"",B,q=Array.from(l[5].values()).some(al),G,P,K=!l[4].trim(),x,V,te,le,ee,X,A,E;n=new Cr({props:{store:l[0],message:l[1]}}),o=new Hl({props:{settings:l[7].settings,strings:l[7].strings,courses:l[7].courses,label:l[7].strings.course,selected:l[6].id,required:!0,readonly:l[1].references.length>0,style:"filter-left",onChange:l[8]}}),c=new Nr({props:{store:l[0],course:l[6],recipients:l[5],onChange:l[9]}}),_=new vr({props:{store:l[0],recipients:l[5],onDelete:l[10]}});let se=q&&ll(l);function ae(Z,ne){if(Z[5].size==0)return Er;if(Z[5].size>Z[7].settings.maxrecipients)return Ir}let F=ae(l),oe=F&&F(l),Q=K&&nl(l);te=new mn({props:{store:l[0]}});let he=l[1].references.length>0&&il(l);return{c(){e=h("hr"),t=L(),s=h("form"),Y(n.$$.fragment),i=L(),r=h("div"),a=h("div"),Y(o.$$.fragment),f=L(),d=h("div"),Y(c.$$.fragment),m=L(),Y(_.$$.fragment),b=L(),p=h("div"),v=h("input"),w=L(),k=h("div"),j=L(),C=h("div"),B=L(),se&&se.c(),G=L(),oe&&oe.c(),P=L(),Q&&Q.c(),x=L(),V=h("div"),Y(te.$$.fragment),le=L(),he&&he.c(),ee=pe(),u(e,"class","d-lg-none mt-0 mb-3 mb-sm-2"),u(a,"class","form-group col-12 col-xl-5"),u(d,"class","col-12 col-xl-7"),u(r,"class","row"),u(v,"type","text"),u(v,"id","local-mail-message-form-subject"),u(v,"class","form-control"),u(v,"placeholder",y=l[7].strings.subject),u(v,"aria-label",$=l[7].strings.subject),u(v,"autocomplete","off"),u(v,"maxlength","100"),O(v,"is-invalid",!l[4].trim()),u(p,"class","form-group"),u(k,"class","form-group"),u(C,"class","form-group"),u(V,"class","d-flex justify-content-end align-items-center"),u(s,"class","pt-lg-2 pb-3 px-lg-4"),O(s,"card",l[7].viewportSize>=de.LG)},m(Z,ne){S(Z,e,ne),S(Z,t,ne),S(Z,s,ne),J(n,s,null),g(s,i),g(s,r),g(r,a),J(o,a,null),g(r,f),g(r,d),J(c,d,null),g(s,m),J(_,s,null),g(s,b),g(s,p),g(p,v),ye(v,l[4]),g(s,w),g(s,k),k.innerHTML=M,g(s,j),g(s,C),C.innerHTML=z,g(s,B),se&&se.m(s,null),g(s,G),oe&&oe.m(s,null),g(s,P),Q&&Q.m(s,null),g(s,x),g(s,V),J(te,V,null),l[15](s),S(Z,le,ne),he&&he.m(Z,ne),S(Z,ee,ne),X=!0,A||(E=[H(v,"input",l[12]),H(v,"input",l[13]),H(k,"change",l[14]),H(s,"submit",Se(l[16]))],A=!0)},p(Z,[ne]){const be={};ne&1&&(be.store=Z[0]),ne&2&&(be.message=Z[1]),n.$set(be);const ke={};ne&128&&(ke.settings=Z[7].settings),ne&128&&(ke.strings=Z[7].strings),ne&128&&(ke.courses=Z[7].courses),ne&128&&(ke.label=Z[7].strings.course),ne&64&&(ke.selected=Z[6].id),ne&2&&(ke.readonly=Z[1].references.length>0),o.$set(ke);const je={};ne&1&&(je.store=Z[0]),ne&64&&(je.course=Z[6]),ne&32&&(je.recipients=Z[5]),c.$set(je);const Ae={};ne&1&&(Ae.store=Z[0]),ne&32&&(Ae.recipients=Z[5]),_.$set(Ae),(!X||ne&128&&y!==(y=Z[7].strings.subject))&&u(v,"placeholder",y),(!X||ne&128&&$!==($=Z[7].strings.subject))&&u(v,"aria-label",$),ne&16&&v.value!==Z[4]&&ye(v,Z[4]),(!X||ne&16)&&O(v,"is-invalid",!Z[4].trim()),(!X||ne&4)&&M!==(M=Z[2].editorhtml+"")&&(k.innerHTML=M),(!X||ne&4)&&z!==(z=Z[2].filemanagerhtml+"")&&(C.innerHTML=z),ne&32&&(q=Array.from(Z[5].values()).some(al)),q?se?se.p(Z,ne):(se=ll(Z),se.c(),se.m(s,G)):se&&(se.d(1),se=null),F===(F=ae(Z))&&oe?oe.p(Z,ne):(oe&&oe.d(1),oe=F&&F(Z),oe&&(oe.c(),oe.m(s,P))),ne&16&&(K=!Z[4].trim()),K?Q?Q.p(Z,ne):(Q=nl(Z),Q.c(),Q.m(s,x)):Q&&(Q.d(1),Q=null);const Te={};ne&1&&(Te.store=Z[0]),te.$set(Te),(!X||ne&128)&&O(s,"card",Z[7].viewportSize>=de.LG),Z[1].references.length>0?he?(he.p(Z,ne),ne&2&&T(he,1)):(he=il(Z),he.c(),T(he,1),he.m(ee.parentNode,ee)):he&&(ie(),N(he,1,1,()=>{he=null}),re())},i(Z){X||(T(n.$$.fragment,Z),T(o.$$.fragment,Z),T(c.$$.fragment,Z),T(_.$$.fragment,Z),T(te.$$.fragment,Z),T(he),X=!0)},o(Z){N(n.$$.fragment,Z),N(o.$$.fragment,Z),N(c.$$.fragment,Z),N(_.$$.fragment,Z),N(te.$$.fragment,Z),N(he),X=!1},d(Z){Z&&(D(e),D(t),D(s),D(le),D(ee)),W(n),W(o),W(c),W(_),se&&se.d(),oe&&oe.d(),Q&&Q.d(),W(te),l[15](null),he&&he.d(Z),A=!1,we(E)}}}const al=l=>!l.isvalid;function Rr(l,e,t){let s,n,i,r,a=U,o=()=>(a(),a=ge(f,B=>t(7,r=B)),f);l.$$.on_destroy.push(()=>a());let{store:f}=e;o();let{message:d}=e,{form:c}=e,m,_;Xe(()=>{_==null||_.addEventListener("core_form/uploadChanged",()=>w(!1));const B=b();return()=>{m==null||m.remove(),B()}});const b=()=>{let B,q;const G=()=>{q==null||q.save(),w(!1)},P=K=>{K.editor.id==`local-mail-compose-editor-${d.id}`&&(q==null||q.off("input",G),q==null||q.off("ExecCommand",G),q=K.editor,K.editor.on("input",G),K.editor.on("ExecCommand",G))};return ot("editor_tiny/loader").then(async K=>{B=await K.getTinyMCE(),B.EditorManager.get().forEach(x=>P({editor:x})),B.EditorManager.on("SetupEditor",P)}),()=>{B==null||B.EditorManager.off("SetupEditor",P),q==null||q.off("input",G),q==null||q.off("ExecCommand",G)}},p=async B=>{const q=await ot("core/fragment");m==null||m.remove(),await We(),m=document.createElement("script"),m.setAttribute("type","text/javascript"),m.innerHTML=q.processCollectedJavascript(B),document.head.append(m)},v=B=>{t(6,s=r.courses.find(q=>q.id==B)||r.courses[0]),w(!0)},y=(B,q)=>{const G=new Map(i);for(const K of B)q?G.set(K.id,{...K,type:q,isvalid:!0}):G.delete(K.id);const P=Array.from(G.values());P.sort((K,x)=>K.sortorder.localeCompare(x.sortorder)),t(5,i=new Map(P.map(K=>[K.id,K]))),w(!1)},$=B=>{y([B],null)},w=async B=>{var P,K,x;if(!_)return;const q=new FormData(_),G={courseid:s.id,to:Array.from(i.values()).filter(V=>V.type=="to").map(V=>V.id),cc:Array.from(i.values()).filter(V=>V.type=="cc").map(V=>V.id),bcc:Array.from(i.values()).filter(V=>V.type=="bcc").map(V=>V.id),subject:n,content:((P=q.get("content[text]"))==null?void 0:P.toString())||"",format:parseInt(((K=q.get("content[format]"))==null?void 0:K.toString())||"")||1,draftitemid:parseInt(((x=q.get("content[itemid]"))==null?void 0:x.toString())||"")||0};await f.updateDraft(G,B)};function k(){n=this.value,t(4,n),t(1,d)}const M=()=>w(!1),j=()=>w(!1);function C(B){Me[B?"unshift":"push"](()=>{_=B,t(3,_)})}const z=()=>w(!0);return l.$$set=B=>{"store"in B&&o(t(0,f=B.store)),"message"in B&&t(1,d=B.message),"form"in B&&t(2,c=B.form)},l.$$.update=()=>{l.$$.dirty&2&&t(6,s=d.course),l.$$.dirty&2&&t(4,n=d.subject),l.$$.dirty&2&&t(5,i=new Map(d.recipients.map(B=>[B.id,B]))),l.$$.dirty&4&&p(c.javascript)},[f,d,c,_,n,i,s,r,v,y,$,w,k,M,j,C,z]}class Fr extends ce{constructor(e){super(),me(this,e,Rr,Pr,ue,{store:0,message:1,form:2})}}function ol(l,e,t){const s=l.slice();return s[7]=e[t],s}function fl(l){let e,t=l[7]+"",s,n;return{c(){e=h("option"),s=I(t),e.__value=n=l[7],ye(e,e.__value)},m(i,r){S(i,e,r),g(e,s)},p(i,r){r&8&&t!==(t=i[7]+"")&&R(s,t),r&8&&n!==(n=i[7])&&(e.__value=n,ye(e,e.__value))},d(i){i&&D(e)}}}function Ur(l){let e,t,s,n=l[1].strings.messagesperpage+"",i,r,a,o,f,d,c=fe(l[3]),m=[];for(let _=0;_<c.length;_+=1)m[_]=fl(ol(l,c,_));return{c(){e=h("div"),t=h("div"),s=h("label"),i=I(n),r=I(":"),a=L(),o=h("select");for(let _=0;_<m.length;_+=1)m[_].c();u(s,"for","local-mail-perpage-select"),u(o,"id","local-mail-perpage-select"),u(o,"class","custom-select"),l[2]===void 0&&Le(()=>l[4].call(o)),u(t,"class","form-group"),u(e,"class","form-inline justify-content-end mt-3")},m(_,b){S(_,e,b),g(e,t),g(t,s),g(s,i),g(s,r),g(t,a),g(t,o);for(let p=0;p<m.length;p+=1)m[p]&&m[p].m(o,null);Je(o,l[2],!0),f||(d=[H(o,"change",l[4]),H(o,"change",l[5])],f=!0)},p(_,[b]){if(b&2&&n!==(n=_[1].strings.messagesperpage+"")&&R(i,n),b&8){c=fe(_[3]);let p;for(p=0;p<c.length;p+=1){const v=ol(_,c,p);m[p]?m[p].p(v,b):(m[p]=fl(v),m[p].c(),m[p].m(o,null))}for(;p<m.length;p+=1)m[p].d(1);m.length=c.length}b&12&&Je(o,_[2])},i:U,o:U,d(_){_&&D(e),Be(m,_),f=!1,we(d)}}}function Gr(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,m=>t(1,n=m)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();const o=[5,10,20,50,100];let f=n.preferences.perpage;function d(){f=ft(this),t(2,f),t(3,s),t(1,n)}const c=()=>a.savePreferences({perpage:f});return l.$$set=m=>{"store"in m&&r(t(0,a=m.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=o.includes(n.preferences.perpage)?o:o.concat([n.preferences.perpage]).sort((m,_)=>m-_))},[a,n,f,s,d,c]}class Or extends ce{constructor(e){super(),me(this,e,Gr,Ur,ue,{store:0})}}function ul(l,e,t){const s=l.slice();return s[9]=e[t],s}function cl(l){let e,t,s=l[4].strings.locked+"",n,i;return{c(){e=h("span"),t=I("("),n=I(s),i=I(")"),u(e,"class","ml-1")},m(r,a){S(r,e,a),g(e,t),g(e,n),g(e,i)},p(r,a){a&16&&s!==(s=r[4].strings.locked+"")&&R(n,s)},d(r){r&&D(e)}}}function ml(l){let e,t,s,n,i,r,a,o=l[9].displayname+"",f,d,c,m,_;function b(){return l[8](l[9])}let p=l[9].locked&&cl(l);return{c(){e=h("div"),t=h("input"),r=L(),a=h("label"),f=I(o),d=L(),p&&p.c(),u(t,"id",s="local-mail-preferences-messageprocessor-"+l[9].name),u(t,"class","custom-control-input"),u(t,"type","checkbox"),t.checked=n=l[9].locked?l[9].enabled:l[3].includes(l[9].name),t.disabled=i=l[9].locked,u(a,"for",c="local-mail-preferences-messageprocessor-"+l[9].name),u(a,"class","custom-control-label pl-1"),u(e,"class","custom-control custom-switch my-2")},m(v,y){S(v,e,y),g(e,t),g(e,r),g(e,a),g(a,f),g(a,d),p&&p.m(a,null),m||(_=H(t,"click",b),m=!0)},p(v,y){l=v,y&16&&s!==(s="local-mail-preferences-messageprocessor-"+l[9].name)&&u(t,"id",s),y&24&&n!==(n=l[9].locked?l[9].enabled:l[3].includes(l[9].name))&&(t.checked=n),y&16&&i!==(i=l[9].locked)&&(t.disabled=i),y&16&&o!==(o=l[9].displayname+"")&&R(f,o),l[9].locked?p?p.p(l,y):(p=cl(l),p.c(),p.m(a,null)):p&&(p.d(1),p=null),y&16&&c!==(c="local-mail-preferences-messageprocessor-"+l[9].name)&&u(a,"for",c)},d(v){v&&D(e),p&&p.d(),m=!1,_()}}}function Hr(l){let e,t=l[4].strings.notifications+"",s,n,i,r,a,o,f,d,c,m=l[4].strings.markmessagesasread+"",_,b,p,v=fe(l[4].settings.messageprocessors),y=[];for(let $=0;$<v.length;$+=1)y[$]=ml(ul(l,v,$));return{c(){e=h("h6"),s=I(t),n=L();for(let $=0;$<y.length;$+=1)y[$].c();i=L(),r=h("div"),a=h("input"),d=L(),c=h("label"),_=I(m),u(e,"class","mb-3"),u(a,"id","local-mail-preferences-markasread"),u(a,"class","custom-control-input"),u(a,"type","checkbox"),a.checked=o=l[2]&&l[3].length>0,a.disabled=f=l[3].length==0,u(c,"for","local-mail-preferences-markasread"),u(c,"class","custom-control-label pl-1"),u(r,"class","custom-control custom-switch my-2 mt-3")},m($,w){S($,e,w),g(e,s),S($,n,w);for(let k=0;k<y.length;k+=1)y[k]&&y[k].m($,w);S($,i,w),S($,r,w),g(r,a),g(r,d),g(r,c),g(c,_),b||(p=H(a,"click",l[6]),b=!0)},p($,w){if(w&16&&t!==(t=$[4].strings.notifications+"")&&R(s,t),w&152){v=fe($[4].settings.messageprocessors);let k;for(k=0;k<v.length;k+=1){const M=ul($,v,k);y[k]?y[k].p(M,w):(y[k]=ml(M),y[k].c(),y[k].m(i.parentNode,i))}for(;k<y.length;k+=1)y[k].d(1);y.length=v.length}w&12&&o!==(o=$[2]&&$[3].length>0)&&(a.checked=o),w&8&&f!==(f=$[3].length==0)&&(a.disabled=f),w&16&&m!==(m=$[4].strings.markmessagesasread+"")&&R(_,m)},d($){$&&(D(e),D(n),D(i),D(r)),Be(y,$),b=!1,p()}}}function Vr(l){let e,t;return e=new Ge({props:{title:l[4].strings.preferences,confirmText:l[4].strings.save,cancelText:l[4].strings.cancel,onConfirm:l[5],onCancel:l[1],$$slots:{default:[Hr]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,[n]){const i={};n&16&&(i.title=s[4].strings.preferences),n&16&&(i.confirmText=s[4].strings.save),n&16&&(i.cancelText=s[4].strings.cancel),n&2&&(i.onCancel=s[1]),n&4124&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Kr(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,b=>t(4,s=b)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{onCancel:a}=e,o=s.preferences.markasread,f=s.settings.messageprocessors.map(b=>b.name).filter(b=>s.preferences.notifications.includes(b));const d=()=>{a(),r.savePreferences({markasread:o,notifications:f})},c=()=>{t(2,o=!o)},m=b=>{t(3,f=f.includes(b)?f.filter(p=>p!=b):[...f,b])},_=b=>m(b.name);return l.$$set=b=>{"store"in b&&i(t(0,r=b.store)),"onCancel"in b&&t(1,a=b.onCancel)},[r,a,o,f,s,d,c,m,_]}class Yr extends ce{constructor(e){super(),me(this,e,Kr,Vr,ue,{store:0,onCancel:1})}}function Jr(l){let e,t,s,n=l[9].strings.from+"",i,r,a,o,f,d,c,m=l[9].strings.to+"",_,b,p,v,y,$,w,k=l[9].strings.date+"",M,j,C,z,B,q,G,P,K,x,V=l[9].strings.unreadonly+"",te,le,ee,X,A,E,se=l[9].strings.hasattachments+"",ae,F,oe,Q,he,Z,ne;return{c(){e=h("div"),t=h("div"),s=h("label"),i=I(n),r=L(),a=h("div"),o=h("input"),f=L(),d=h("div"),c=h("label"),_=I(m),b=L(),p=h("div"),v=h("input"),y=L(),$=h("div"),w=h("label"),M=I(k),j=L(),C=h("div"),z=h("input"),B=L(),q=h("div"),G=h("div"),P=h("input"),K=L(),x=h("label"),te=I(V),le=L(),ee=h("div"),X=h("input"),A=L(),E=h("label"),ae=I(se),F=L(),oe=h("input"),u(s,"for","local-mail-search-input-sendername"),u(s,"class","col-3 col-form-label"),u(o,"type","text"),u(o,"class","form-control"),u(o,"id","local-mail-search-input-sendername"),u(a,"class","col-9"),u(t,"class","form-group row"),u(c,"for","local-mail-search-input-recipientname"),u(c,"class","col-3 col-form-label"),u(v,"type","text"),u(v,"class","form-control"),u(v,"id","local-mail-search-input-recipientname"),u(p,"class","col-9"),u(d,"class","form-group row"),u(w,"for","local-mail-search-input-maxdate"),u(w,"class","col-3 col-form-label"),u(z,"type","date"),u(z,"class","form-control"),u(z,"id","local-mail-search-input-maxdate"),u(z,"max",l[10]),z.value=l[8],u(C,"class","col-9"),u($,"class","form-group row"),u(P,"class","form-check-input"),u(P,"type","checkbox"),u(P,"id","local-mail-search-input-unread"),u(x,"class","form-check-label"),u(x,"for","local-mail-search-input-unread"),u(G,"class","form-check"),u(X,"class","form-check-input"),u(X,"type","checkbox"),u(X,"id","local-mail-search-input-withfilesonly"),u(E,"class","form-check-label"),u(E,"for","local-mail-search-input-withfilesonly"),u(ee,"class","form-check"),u(oe,"type","submit"),oe.disabled=Q=!l[6],u(oe,"class","btn btn-primary px-3 ml-auto"),oe.value=he=l[9].strings.search,u(q,"class","d-flex flex-wrap align-items-center"),_e(q,"column-gap","2rem"),_e(q,"row-gap","1rem"),u(e,"class","dropdown-menu dropdown-menu-left show p-3 w-100"),_e(e,"min-width","18rem")},m(be,ke){S(be,e,ke),g(e,t),g(t,s),g(s,i),g(t,r),g(t,a),g(a,o),ye(o,l[0]),l[15](o),g(e,f),g(e,d),g(d,c),g(c,_),g(d,b),g(d,p),g(p,v),ye(v,l[1]),g(e,y),g(e,$),g($,w),g(w,M),g($,j),g($,C),g(C,z),g(e,B),g(e,q),g(q,G),g(G,P),P.checked=l[2],g(G,K),g(G,x),g(x,te),g(q,le),g(q,ee),g(ee,X),X.checked=l[3],g(ee,A),g(ee,E),g(E,ae),g(q,F),g(q,oe),Z||(ne=[H(o,"input",l[14]),H(v,"input",l[16]),H(z,"input",l[11]),H(P,"change",l[17]),H(X,"change",l[18]),H(oe,"click",Se(function(){$e(l[5])&&l[5].apply(this,arguments)}))],Z=!0)},p(be,[ke]){l=be,ke&512&&n!==(n=l[9].strings.from+"")&&R(i,n),ke&1&&o.value!==l[0]&&ye(o,l[0]),ke&512&&m!==(m=l[9].strings.to+"")&&R(_,m),ke&2&&v.value!==l[1]&&ye(v,l[1]),ke&512&&k!==(k=l[9].strings.date+"")&&R(M,k),ke&256&&(z.value=l[8]),ke&4&&(P.checked=l[2]),ke&512&&V!==(V=l[9].strings.unreadonly+"")&&R(te,V),ke&8&&(X.checked=l[3]),ke&512&&se!==(se=l[9].strings.hasattachments+"")&&R(ae,se),ke&64&&Q!==(Q=!l[6])&&(oe.disabled=Q),ke&512&&he!==(he=l[9].strings.search)&&(oe.value=he)},i:U,o:U,d(be){be&&D(e),l[15](null),Z=!1,we(ne)}}}function Wr(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,z=>t(9,n=z)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{sendername:o=""}=e,{recipientname:f=""}=e,{unread:d=!1}=e,{withfilesonly:c=!1}=e,{maxtime:m=0}=e,{submit:_}=e,{submitEnabled:b}=e;function p(){v.focus()}let v,y=Bt(Math.floor(new Date().getTime()/1e3));const $=z=>{t(12,m=Fn(z.target.value))};function w(){o=this.value,t(0,o)}function k(z){Me[z?"unshift":"push"](()=>{v=z,t(7,v)})}function M(){f=this.value,t(1,f)}function j(){d=this.checked,t(2,d)}function C(){c=this.checked,t(3,c)}return l.$$set=z=>{"store"in z&&r(t(4,a=z.store)),"sendername"in z&&t(0,o=z.sendername),"recipientname"in z&&t(1,f=z.recipientname),"unread"in z&&t(2,d=z.unread),"withfilesonly"in z&&t(3,c=z.withfilesonly),"maxtime"in z&&t(12,m=z.maxtime),"submit"in z&&t(5,_=z.submit),"submitEnabled"in z&&t(6,b=z.submitEnabled)},l.$$.update=()=>{l.$$.dirty&4096&&t(8,s=Bt(m))},[o,f,d,c,a,_,b,v,s,n,y,$,m,p,w,k,M,j,C]}class Xr extends ce{constructor(e){super(),me(this,e,Wr,Jr,ue,{store:4,sendername:0,recipientname:1,unread:2,withfilesonly:3,maxtime:12,submit:5,submitEnabled:6,focus:13})}get focus(){return this.$$.ctx[13]}}const{Boolean:Qr}=Ze;function dl(l,e,t){const s=l.slice();return s[14]=e[t],s[16]=t,s}function _l(l){let e,t,s,n=fe(l[4]),i=[];for(let d=0;d<n.length;d+=1)i[d]=gl(dl(l,n,d));const r=d=>N(i[d],1,1,()=>{i[d]=null});function a(d,c){if(d[5])return ea;if(!d[4].length)return xr}let o=a(l),f=o&&o(l);return{c(){e=h("div");for(let d=0;d<i.length;d+=1)i[d].c();t=L(),f&&f.c(),u(e,"class","dropdown-menu dropdown-menu-left overflow-hidden show p-0 w-100"),_e(e,"min-width","18rem")},m(d,c){S(d,e,c);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(e,null);g(e,t),f&&f.m(e,null),s=!0},p(d,c){if(c&401){n=fe(d[4]);let m;for(m=0;m<n.length;m+=1){const _=dl(d,n,m);i[m]?(i[m].p(_,c),T(i[m],1)):(i[m]=gl(_),i[m].c(),T(i[m],1),i[m].m(e,t))}for(ie(),m=n.length;m<i.length;m+=1)r(m);re()}o===(o=a(d))&&f?f.p(d,c):(f&&f.d(1),f=o&&o(d),f&&(f.c(),f.m(e,null)))},i(d){if(!s){for(let c=0;c<n.length;c+=1)T(i[c]);s=!0}},o(d){i=i.filter(Qr);for(let c=0;c<i.length;c+=1)N(i[c]);s=!1},d(d){d&&D(e),Be(i,d),f&&f.d()}}}function Zr(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider my-0")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function gl(l){let e,t,s,n,i,r,a,o,f=l[14].shorttime+"",d,c,m,_,b,p,v=l[16]>0&&Zr();return s=new dt({props:{store:l[0],message:l[14]}}),r=new mt({props:{store:l[0],message:l[14]}}),{c(){v&&v.c(),e=L(),t=h("a"),Y(s.$$.fragment),n=L(),i=h("div"),Y(r.$$.fragment),a=L(),o=h("div"),d=I(f),u(o,"title",c=l[14].fulltime),u(o,"class","ml-auto"),u(i,"class","local-mail-incremental-search-muted d-flex"),u(t,"class","dropdown-item local-mail-incremental-search-item"),u(t,"href",m=Pe(l[7](l[14],l[16]))),O(t,"font-weight-bold",l[14].unread)},m(y,$){v&&v.m(y,$),S(y,e,$),S(y,t,$),J(s,t,null),g(t,n),g(t,i),J(r,i,null),g(i,a),g(i,o),g(o,d),_=!0,b||(p=H(t,"click",function(){$e(l[8](l[14],l[16]))&&l[8](l[14],l[16]).apply(this,arguments)}),b=!0)},p(y,$){l=y;const w={};$&1&&(w.store=l[0]),$&16&&(w.message=l[14]),s.$set(w);const k={};$&1&&(k.store=l[0]),$&16&&(k.message=l[14]),r.$set(k),(!_||$&16)&&f!==(f=l[14].shorttime+"")&&R(d,f),(!_||$&16&&c!==(c=l[14].fulltime))&&u(o,"title",c),(!_||$&144&&m!==(m=Pe(l[7](l[14],l[16]))))&&u(t,"href",m),(!_||$&16)&&O(t,"font-weight-bold",l[14].unread)},i(y){_||(T(s.$$.fragment,y),T(r.$$.fragment,y),_=!0)},o(y){N(s.$$.fragment,y),N(r.$$.fragment,y),_=!1},d(y){y&&(D(e),D(t)),v&&v.d(y),W(s),W(r),b=!1,p()}}}function xr(l){let e,t=l[3].strings.nomessagesfound+"",s;return{c(){e=h("div"),s=I(t),u(e,"class","px-4 py-2 text-danger")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i&8&&t!==(t=n[3].strings.nomessagesfound+"")&&R(s,t)},d(n){n&&D(e)}}}function ea(l){let e,t,s,n=l[3].strings.searchallmessages+"",i,r,a,o;return{c(){e=h("div"),t=L(),s=h("a"),i=I(n),u(e,"class","dropdown-divider my-0"),u(s,"class","dropdown-item py-2"),u(s,"href",r=Pe(l[6]))},m(f,d){S(f,e,d),S(f,t,d),S(f,s,d),g(s,i),a||(o=H(s,"click",Se(l[12])),a=!0)},p(f,d){d&8&&n!==(n=f[3].strings.searchallmessages+"")&&R(i,n),d&64&&r!==(r=Pe(f[6]))&&u(s,"href",r)},d(f){f&&(D(e),D(t),D(s)),a=!1,o()}}}function ta(l){let e,t,s=l[1]&&l[4]!=null&&_l(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,[i]){n[1]&&n[4]!=null?s?(s.p(n,i),i&18&&T(s,1)):(s=_l(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),N(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){N(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}const at=10,sa=500;function la(l,e,t){let s,n,i,r=U,a=()=>(r(),r=ge(o,w=>t(3,i=w)),o);l.$$.on_destroy.push(()=>r());let{store:o}=e;a();let{enabled:f}=e,{content:d}=e,{loading:c=!1}=e,{onClick:m}=e,_,b,p=!1;const v=async w=>{t(9,c=!0),window.clearTimeout(_),t(11,_=window.setTimeout(async()=>{const k=i.params,j={methodname:"search_messages",query:{courseid:k.courseid,labelid:k.tray=="label"?k.labelid:void 0,draft:k.tray=="drafts"?!0:k.tray=="sent"?!1:void 0,roles:k.tray=="inbox"?Object.values(ze):k.tray=="sent"?["from"]:void 0,starred:k.tray=="starred"?!0:void 0,deleted:k.tray=="trash",content:w.trim(),stopid:i.incrementalSearchStopId},limit:at+1};let C;try{C=await Ye([j])}catch(z){o.setError(z),t(9,c=!1),t(4,b=void 0);return}t(9,c=!1),t(4,b=C[0]),t(5,p=b.length>at||!!i.incrementalSearchStopId),t(4,b=b.slice(0,at))},sa))},y=(w,k)=>M=>{w.draft||(M.preventDefault(),m(s(w,k)))};Fl(()=>{window.clearTimeout(_)});const $=()=>m(n);return l.$$set=w=>{"store"in w&&a(t(0,o=w.store)),"enabled"in w&&t(1,f=w.enabled),"content"in w&&t(10,d=w.content),"loading"in w&&t(9,c=w.loading),"onClick"in w&&t(2,m=w.onClick)},l.$$.update=()=>{l.$$.dirty&3074&&(f?v(d):(t(4,b=void 0),t(9,c=!1),window.clearTimeout(_))),l.$$.dirty&1032&&t(7,s=(w,k)=>({...i.params,messageid:w.id,offset:k,search:{content:d.trim()}})),l.$$.dirty&1032&&t(6,n={...i.params,messageid:void 0,offset:0,search:{content:d.trim()}})},[o,f,m,i,b,p,n,s,y,c,d,_,$]}class na extends ce{constructor(e){super(),me(this,e,la,ta,ue,{store:0,enabled:1,content:10,loading:9,onClick:2})}}function pl(l,e,t){const s=l.slice();return s[35]=e[t].label,s[36]=e[t].value,s[38]=t,s}function ia(l){let e,t,s,n=fe(l[15]),i=[];for(let r=0;r<n.length;r+=1)i[r]=hl(pl(l,n,r));return{c(){e=h("button");for(let r=0;r<i.length;r+=1)i[r].c();u(e,"type","button"),u(e,"class","local-mail-search-box-input-enabled alert-primary form-control text-left text-truncate")},m(r,a){S(r,e,a);for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(e,null);t||(s=H(e,"click",l[16]),t=!0)},p(r,a){if(a[0]&32768){n=fe(r[15]);let o;for(o=0;o<n.length;o+=1){const f=pl(r,n,o);i[o]?i[o].p(f,a):(i[o]=hl(f),i[o].c(),i[o].m(e,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d(r){r&&D(e),Be(i,r),t=!1,s()}}}function ra(l){let e,t,s,n,i;return{c(){e=h("input"),u(e,"type","text"),u(e,"class","local-mail-search-box-input form-control"),u(e,"placeholder",t=l[7].strings.search),u(e,"aria-label",s=l[7].strings.search),u(e,"autocomplete","off"),O(e,"local-mail-search-box-input-enabled",l[14]||l[13])},m(r,a){S(r,e,a),ye(e,l[1]),l[26](e),n||(i=[H(e,"input",l[25]),H(e,"keypress",l[21])],n=!0)},p(r,a){a[0]&128&&t!==(t=r[7].strings.search)&&u(e,"placeholder",t),a[0]&128&&s!==(s=r[7].strings.search)&&u(e,"aria-label",s),a[0]&2&&e.value!==r[1]&&ye(e,r[1]),a[0]&24576&&O(e,"local-mail-search-box-input-enabled",r[14]||r[13])},d(r){r&&D(e),l[26](null),n=!1,we(i)}}}function aa(l){let e;return{c(){e=h("span"),e.textContent=",â€‚",u(e,"class","dimmed_text")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function oa(l){let e,t=l[36]+"",s,n=l[35]&&bl(l);return{c(){n&&n.c(),e=L(),s=I(t)},m(i,r){n&&n.m(i,r),S(i,e,r),S(i,s,r)},p(i,r){i[35]?n?n.p(i,r):(n=bl(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),r[0]&32768&&t!==(t=i[36]+"")&&R(s,t)},d(i){i&&(D(e),D(s)),n&&n.d(i)}}}function fa(l){let e,t=l[35]+"",s;return{c(){e=h("span"),s=I(t),u(e,"class","dimmed_text")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i[0]&32768&&t!==(t=n[35]+"")&&R(s,t)},d(n){n&&D(e)}}}function bl(l){let e,t=l[35]+"",s,n;return{c(){e=h("span"),s=I(t),n=I(":"),u(e,"class","dimmed_text")},m(i,r){S(i,e,r),g(e,s),g(e,n)},p(i,r){r[0]&32768&&t!==(t=i[35]+"")&&R(s,t)},d(i){i&&D(e)}}}function hl(l){let e,t,s=l[38]>0&&aa();function n(a,o){return a[36]===!0?fa:oa}let i=n(l),r=i(l);return{c(){s&&s.c(),e=L(),r.c(),t=pe()},m(a,o){s&&s.m(a,o),S(a,e,o),r.m(a,o),S(a,t,o)},p(a,o){i===(i=n(a))&&r?r.p(a,o):(r.d(1),r=i(a),r&&(r.c(),r.m(t.parentNode,t)))},d(a){a&&(D(e),D(t)),s&&s.d(a),r.d(a)}}}function kl(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-times"),u(t,"aria-hidden","true"),u(e,"type","button"),u(e,"class","local-mail-search-box-icon btn px-0"),u(e,"title",s=l[7].strings.clearsearch)},m(r,a){S(r,e,a),g(e,t),n||(i=H(e,"click",Se(l[19])),n=!0)},p(r,a){a[0]&128&&s!==(s=r[7].strings.clearsearch)&&u(e,"title",s)},d(r){r&&D(e),n=!1,i()}}}function vl(l){let e,t,s,n,i,r,a;function o(b){l[28](b)}function f(b){l[29](b)}function d(b){l[30](b)}function c(b){l[31](b)}function m(b){l[32](b)}let _={store:l[0],submit:l[20],submitEnabled:l[13]};return l[2]!==void 0&&(_.sendername=l[2]),l[3]!==void 0&&(_.recipientname=l[3]),l[4]!==void 0&&(_.unread=l[4]),l[5]!==void 0&&(_.withfilesonly=l[5]),l[6]!==void 0&&(_.maxtime=l[6]),e=new Xr({props:_}),l[27](e),Me.push(()=>Ve(e,"sendername",o)),Me.push(()=>Ve(e,"recipientname",f)),Me.push(()=>Ve(e,"unread",d)),Me.push(()=>Ve(e,"withfilesonly",c)),Me.push(()=>Ve(e,"maxtime",m)),{c(){Y(e.$$.fragment)},m(b,p){J(e,b,p),a=!0},p(b,p){const v={};p[0]&1&&(v.store=b[0]),p[0]&8192&&(v.submitEnabled=b[13]),!t&&p[0]&4&&(t=!0,v.sendername=b[2],Ke(()=>t=!1)),!s&&p[0]&8&&(s=!0,v.recipientname=b[3],Ke(()=>s=!1)),!n&&p[0]&16&&(n=!0,v.unread=b[4],Ke(()=>n=!1)),!i&&p[0]&32&&(i=!0,v.withfilesonly=b[5],Ke(()=>i=!1)),!r&&p[0]&64&&(r=!0,v.maxtime=b[6],Ke(()=>r=!1)),e.$set(v)},i(b){a||(T(e.$$.fragment,b),a=!0)},o(b){N(e.$$.fragment,b),a=!1},d(b){l[27](null),W(e,b)}}}function wl(l){let e,t,s;function n(r){l[33](r)}let i={store:l[0],enabled:l[8]&&!l[9]&&!!l[1].trim(),content:l[1],onClick:l[22]};return l[12]!==void 0&&(i.loading=l[12]),e=new na({props:i}),Me.push(()=>Ve(e,"loading",n)),{c(){Y(e.$$.fragment)},m(r,a){J(e,r,a),s=!0},p(r,a){const o={};a[0]&1&&(o.store=r[0]),a[0]&770&&(o.enabled=r[8]&&!r[9]&&!!r[1].trim()),a[0]&2&&(o.content=r[1]),!t&&a[0]&4096&&(t=!0,o.loading=r[12],Ke(()=>t=!1)),e.$set(o)},i(r){s||(T(e.$$.fragment,r),s=!0)},o(r){N(e.$$.fragment,r),s=!1},d(r){W(e,r)}}}function ua(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,y;function $(z,B){return z[8]?ra:ia}let w=$(l),k=w(l),M=(l[14]||l[13])&&kl(l),j=l[9]&&vl(l),C=l[7].settings.incrementalsearch&&wl(l);return{c(){e=h("form"),t=h("div"),s=h("i"),i=L(),k.c(),r=L(),a=h("div"),M&&M.c(),o=L(),f=h("button"),d=h("i"),_=L(),j&&j.c(),b=L(),C&&C.c(),u(s,"class",n="fa fa-fw "+(l[12]?"fa-spinner fa-pulse":"fa-search")),u(s,"aria-hidden","true"),u(t,"class","local-mail-search-box-icon position-absolute h-100 d-flex justify-content-center align-items-center px-0"),_e(t,"top","0"),_e(t,"left","0"),u(d,"class",c="fa fa-fw "+(l[9]?"fa-caret-up":"fa-sliders")),u(d,"aria-hidden","true"),u(f,"type","button"),u(f,"aria-expanded",l[9]),u(f,"class","local-mail-search-box-icon btn px-0"),u(f,"title",m=l[7].strings.searchoptions),u(a,"class","position-absolute h-100 d-flex align-items-center"),_e(a,"top","0"),_e(a,"right","0"),u(e,"class","local-mail-search-box position-relative")},m(z,B){S(z,e,B),g(e,t),g(t,s),g(e,i),k.m(e,null),g(e,r),g(e,a),M&&M.m(a,null),g(a,o),g(a,f),g(f,d),g(e,_),j&&j.m(e,null),g(e,b),C&&C.m(e,null),p=!0,v||(y=[H(f,"click",Se(l[18])),Ce(Fe.call(null,e,l[17]))],v=!0)},p(z,B){(!p||B[0]&4096&&n!==(n="fa fa-fw "+(z[12]?"fa-spinner fa-pulse":"fa-search")))&&u(s,"class",n),w===(w=$(z))&&k?k.p(z,B):(k.d(1),k=w(z),k&&(k.c(),k.m(e,r))),z[14]||z[13]?M?M.p(z,B):(M=kl(z),M.c(),M.m(a,o)):M&&(M.d(1),M=null),(!p||B[0]&512&&c!==(c="fa fa-fw "+(z[9]?"fa-caret-up":"fa-sliders")))&&u(d,"class",c),(!p||B[0]&512)&&u(f,"aria-expanded",z[9]),(!p||B[0]&128&&m!==(m=z[7].strings.searchoptions))&&u(f,"title",m),z[9]?j?(j.p(z,B),B[0]&512&&T(j,1)):(j=vl(z),j.c(),T(j,1),j.m(e,b)):j&&(ie(),N(j,1,1,()=>{j=null}),re()),z[7].settings.incrementalsearch?C?(C.p(z,B),B[0]&128&&T(C,1)):(C=wl(z),C.c(),T(C,1),C.m(e,null)):C&&(ie(),N(C,1,1,()=>{C=null}),re())},i(z){p||(T(j),T(C),p=!0)},o(z){N(j),N(C),p=!1},d(z){z&&D(e),k.d(),M&&M.d(),j&&j.d(),C&&C.d(),v=!1,we(y)}}}function ca(l,e,t){let s,n,i,r,a,o,f=U,d=()=>(f(),f=ge(c,F=>t(7,o=F)),c);l.$$.on_destroy.push(()=>f());let{store:c}=e;d();let m=!o.params.search,_=!1,b,p,v="",y="",$="",w=!1,k=!1,M=0,j=!1;const C=F=>{t(1,v=(F==null?void 0:F.content)||""),t(2,y=(F==null?void 0:F.sendername)||""),t(3,$=(F==null?void 0:F.recipientname)||""),t(4,w=(F==null?void 0:F.unread)||!1),t(5,k=(F==null?void 0:F.withfilesonly)||!1),t(6,M=(F==null?void 0:F.maxtime)||0)},z=async()=>{t(8,m=!0),n&&t(9,_=!0),await We(),b.focus()},B=async()=>{t(8,m=!i),t(9,_=!1),C(s)},q=async()=>{_?(t(9,_=!1),await We(),b.focus()):(t(9,_=!0),z(),await We(),p.focus())},G=async()=>{t(8,m=!0),t(9,_=!1),C(),await c.navigate({...o.params,offset:void 0,search:void 0}),await We(),b.focus()},P=async()=>{await c.navigate({...o.params,messageid:void 0,offset:void 0,search:_?{content:v.trim(),sendername:y.trim(),recipientname:$.trim(),unread:w,withfilesonly:k,maxtime:M}:{content:v.trim()}}),t(9,_=!1),t(8,m=!1)},K=F=>{F.key=="Enter"&&(F.preventDefault(),r?P():G())},x=async F=>{await c.navigate(F),t(9,_=!1),t(8,m=!1)};function V(){v=this.value,t(1,v)}function te(F){Me[F?"unshift":"push"](()=>{b=F,t(10,b)})}function le(F){Me[F?"unshift":"push"](()=>{p=F,t(11,p)})}function ee(F){y=F,t(2,y)}function X(F){$=F,t(3,$)}function A(F){w=F,t(4,w)}function E(F){k=F,t(5,k)}function se(F){M=F,t(6,M)}function ae(F){j=F,t(12,j)}return l.$$set=F=>{"store"in F&&d(t(0,c=F.store))},l.$$.update=()=>{l.$$.dirty[0]&128&&t(23,s=o.params.search),l.$$.dirty[0]&8388608&&C(s),l.$$.dirty[0]&8388608&&t(24,n=!!(s!=null&&s.sendername||s!=null&&s.recipientname||s!=null&&s.unread||s!=null&&s.withfilesonly||s!=null&&s.maxtime)),l.$$.dirty[0]&25165824&&t(14,i=!!(s!=null&&s.content)||n),l.$$.dirty[0]&126&&t(13,r=!!(v.trim()||y.trim()||$.trim()||w||k||M)),l.$$.dirty[0]&254&&t(15,a=[{label:"",value:v},{label:o.strings.from,value:y},{label:o.strings.to,value:$},{label:o.strings.date,value:M>0?new Date(M*1e3).toLocaleDateString():""},{label:o.strings.unreadonly,value:w},{label:o.strings.hasattachments,value:k}].filter(({value:F})=>!!F))},[c,v,y,$,w,k,M,o,m,_,b,p,j,r,i,a,z,B,q,G,P,K,x,s,n,V,te,le,ee,X,A,E,se,ae]}class ma extends ce{constructor(e){super(),me(this,e,ca,ua,ue,{store:0},null,[-1,-1])}}function yl(l,e,t){const s=l.slice();return s[4]=e[t],s}function $l(l){let e,t=l[1].strings.undo+"",s,n,i;function r(){return l[2](l[4])}return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","local-mail-toast-undo btn font-weight-bold px-2 py-0 ml-3")},m(a,o){S(a,e,o),g(e,s),n||(i=H(e,"click",r),n=!0)},p(a,o){l=a,o&2&&t!==(t=l[1].strings.undo+"")&&R(s,t)},d(a){a&&D(e),n=!1,i()}}}function Ml(l,e){let t,s,n,i=e[4].text+"",r,a,o,f,d,c,m,_,b,p,v=U,y,$,w,k=e[4].undo&&$l(e);function M(){return e[3](e[4])}return{key:l,first:null,c(){t=h("div"),s=h("div"),n=h("div"),r=I(i),a=L(),k&&k.c(),o=L(),f=h("button"),d=h("i"),m=L(),u(n,"class","px-1 mr-auto"),u(d,"class","fa fa-times"),u(f,"type","button"),u(f,"class","btn px-2 py-0 ml-2 text-white-50"),u(f,"title",c=e[1].strings.close),u(s,"class","toast-body d-flex align-items-center p-2"),u(t,"class","toast mt-2 mb-0"),u(t,"role","alert"),u(t,"aria-live","assertive"),u(t,"aria-atomic","true"),u(t,"data-autohide","false"),this.first=t},m(j,C){S(j,t,C),g(t,s),g(s,n),g(n,r),g(s,a),k&&k.m(s,null),g(s,o),g(s,f),g(f,d),g(t,m),y=!0,$||(w=H(f,"click",M),$=!0)},p(j,C){e=j,(!y||C&2)&&i!==(i=e[4].text+"")&&R(r,i),e[4].undo?k?k.p(e,C):(k=$l(e),k.c(),k.m(s,o)):k&&(k.d(1),k=null),(!y||C&2&&c!==(c=e[1].strings.close))&&u(f,"title",c)},r(){p=t.getBoundingClientRect()},f(){Jl(t),v(),ct(t,p)},a(){v(),v=Yl(t,p,ln,{})},i(j){y||(Le(()=>{y&&(b&&b.end(1),_=ut(t,nt,{y:50,delay:200}),_.start())}),y=!0)},o(j){_&&_.invalidate(),b=Ol(t,nt,{y:50,duration:400}),y=!1},d(j){j&&D(t),k&&k.d(),j&&b&&b.end(),$=!1,w()}}}function da(l){let e,t=[],s=new Map,n,i=fe(l[1].toasts);const r=a=>a[4];for(let a=0;a<i.length;a+=1){let o=yl(l,i,a),f=r(o);s.set(f,t[a]=Ml(f,o))}return{c(){e=h("div");for(let a=0;a<t.length;a+=1)t[a].c();u(e,"aria-live","polite"),u(e,"aria-atomic","true"),u(e,"class","local-mail-toasts position-fixed d-flex flex-column-reverse p-3")},m(a,o){S(a,e,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,[o]){if(o&3){i=fe(a[1].toasts),ie();for(let f=0;f<t.length;f+=1)t[f].r();t=De(t,o,r,1,a,i,s,e,Gl,Ml,null,yl);for(let f=0;f<t.length;f+=1)t[f].a();re()}},i(a){if(!n){for(let o=0;o<i.length;o+=1)T(t[o]);n=!0}},o(a){for(let o=0;o<t.length;o+=1)N(t[o]);n=!1},d(a){a&&D(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function _a(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=f=>r.undo(f),o=f=>r.hideToast(f);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,a,o]}class ga extends ce{constructor(e){super(),me(this,e,_a,da,ue,{store:0})}}function pa(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa fa-fw fa-arrow-left"),u(e,"type","button"),u(e,"class","local-mail-back-button btn btn-secondary"),u(e,"title",s=l[1].strings.messagelist)},m(r,a){S(r,e,a),g(e,t),n||(i=H(e,"click",l[2]),n=!0)},p(r,[a]){a&2&&s!==(s=r[1].strings.messagelist)&&u(e,"title",s)},i:U,o:U,d(r){r&&D(e),n=!1,i()}}}function ba(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.navigateToList();return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class ha extends ce{constructor(e){super(),me(this,e,ba,pa,ue,{store:0})}}function Cl(l){let e,t,s=l[1].strings.all+"",n,i,r,a=l[1].strings.none+"",o,f,d,c=l[1].strings.read+"",m,_,b,p=l[1].strings.unread+"",v,y,$,w=l[1].strings.starred+"",k,M,j,C=l[1].strings.unstarred+"",z,B,q;return{c(){e=h("div"),t=h("button"),n=I(s),i=L(),r=h("button"),o=I(a),f=L(),d=h("button"),m=I(c),_=L(),b=h("button"),v=I(p),y=L(),$=h("button"),k=I(w),M=L(),j=h("button"),z=I(C),u(t,"type","button"),u(t,"class","dropdown-item"),u(r,"type","button"),u(r,"class","dropdown-item"),u(d,"type","button"),u(d,"class","dropdown-item"),u(b,"type","button"),u(b,"class","dropdown-item"),u($,"type","button"),u($,"class","dropdown-item"),u(j,"type","button"),u(j,"class","dropdown-item"),u(e,"class","dropdown-menu show")},m(G,P){S(G,e,P),g(e,t),g(t,n),g(e,i),g(e,r),g(r,o),g(e,f),g(e,d),g(d,m),g(e,_),g(e,b),g(b,v),g(e,y),g(e,$),g($,k),g(e,M),g(e,j),g(j,z),B||(q=[H(t,"click",l[7]),H(r,"click",l[8]),H(d,"click",l[9]),H(b,"click",l[10]),H($,"click",l[11]),H(j,"click",l[12])],B=!0)},p(G,P){P&2&&s!==(s=G[1].strings.all+"")&&R(n,s),P&2&&a!==(a=G[1].strings.none+"")&&R(o,a),P&2&&c!==(c=G[1].strings.read+"")&&R(m,c),P&2&&p!==(p=G[1].strings.unread+"")&&R(v,p),P&2&&w!==(w=G[1].strings.starred+"")&&R(k,w),P&2&&C!==(C=G[1].strings.unstarred+"")&&R(z,C)},d(G){G&&D(e),B=!1,we(q)}}}function ka(l){let e,t,s,n,i,r,a,o,f=l[2]&&Cl(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=L(),f&&f.c(),u(s,"class",n="fa fa-fw "+l[3]),u(t,"class","btn btn-secondary dropdown-toggle"),u(t,"aria-expanded",l[2]),u(t,"title",i=l[1].strings.select),u(e,"class","btn-group"),u(e,"role","group")},m(d,c){S(d,e,c),g(e,t),g(t,s),g(e,r),f&&f.m(e,null),a||(o=[H(t,"click",l[5]),Ce(Fe.call(null,e,l[4]))],a=!0)},p(d,[c]){c&8&&n!==(n="fa fa-fw "+d[3])&&u(s,"class",n),c&4&&u(t,"aria-expanded",d[2]),c&2&&i!==(i=d[1].strings.select)&&u(t,"title",i),d[2]?f?f.p(d,c):(f=Cl(d),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:U,o:U,d(d){d&&D(e),f&&f.d(),a=!1,we(o)}}}function va(l,e,t){let s,n,i=U,r=()=>(i(),i=ge(a,$=>t(1,n=$)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let o=!1;const f=()=>{t(2,o=!1)},d=()=>{t(2,o=!o)},c=$=>{f(),a.selectAll($)},m=()=>c("all"),_=()=>c("none"),b=()=>c("read"),p=()=>c("unread"),v=()=>c("starred"),y=()=>c("unstarred");return l.$$set=$=>{"store"in $&&r(t(0,a=$.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=n.selectedMessages.size==0?"fa-square-o":n.selectedMessages.size<n.listMessages.length?"fa-minus-square-o":"fa-check-square-o")},[a,n,o,s,f,d,c,m,_,b,p,v,y]}class wa extends ce{constructor(e){super(),me(this,e,va,ka,ue,{store:0})}}function ya(l){let e,t;return e=new wa({props:{store:l[0]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function $a(l){let e,t;return e=new ha({props:{store:l[0]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Sl(l){let e,t,s,n,i,r;const a=[Ca,Ma],o=[];function f(d,c){return d[1].params.tray=="trash"?0:1}return t=f(l),s=o[t]=a[t](l),i=new en({props:{store:l[0]}}),{c(){e=h("div"),s.c(),n=L(),Y(i.$$.fragment),u(e,"class","btn-group"),u(e,"role","group")},m(d,c){S(d,e,c),o[t].m(e,null),g(e,n),J(i,e,null),r=!0},p(d,c){let m=t;t=f(d),t===m?o[t].p(d,c):(ie(),N(o[m],1,1,()=>{o[m]=null}),re(),s=o[t],s?s.p(d,c):(s=o[t]=a[t](d),s.c()),T(s,1),s.m(e,n));const _={};c&1&&(_.store=d[0]),i.$set(_)},i(d){r||(T(s),T(i.$$.fragment,d),r=!0)},o(d){N(s),N(i.$$.fragment,d),r=!1},d(d){d&&D(e),o[t].d(),W(i)}}}function Ma(l){let e,t,s,n;return e=new xl({props:{store:l[0]}}),s=new Xl({props:{store:l[0]}}),{c(){Y(e.$$.fragment),t=L(),Y(s.$$.fragment)},m(i,r){J(e,i,r),S(i,t,r),J(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){N(e.$$.fragment,i),N(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function Ca(l){let e,t,s,n;return e=new sn({props:{store:l[0]}}),s=new Ql({props:{store:l[0]}}),{c(){Y(e.$$.fragment),t=L(),Y(s.$$.fragment)},m(i,r){J(e,i,r),S(i,t,r),J(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){N(e.$$.fragment,i),N(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function Dl(l){let e,t,s;return t=new Hl({props:{settings:l[1].settings,strings:l[1].strings,courses:l[1].courses,label:l[1].strings.allcourses,selected:l[1].params.courseid,readonly:l[1].params.tray=="course",onChange:l[2],primary:!0,style:l[1].viewportSize>=de.MD?"filter-left":"filter-right"}}),{c(){e=h("div"),Y(t.$$.fragment),u(e,"class","d-flex flex-grow-1 ml-auto mr-0 ml-md-0 mr-md-auto"),_e(e,"max-width","20rem"),_e(e,"min-width","0")},m(n,i){S(n,e,i),J(t,e,null),s=!0},p(n,i){const r={};i&2&&(r.settings=n[1].settings),i&2&&(r.strings=n[1].strings),i&2&&(r.courses=n[1].courses),i&2&&(r.label=n[1].strings.allcourses),i&2&&(r.selected=n[1].params.courseid),i&2&&(r.readonly=n[1].params.tray=="course"),i&1&&(r.onChange=n[2]),i&2&&(r.style=n[1].viewportSize>=de.MD?"filter-left":"filter-right"),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){N(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function Sa(l){let e,t;return e=new mn({props:{store:l[0]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Da(l){let e,t;return e=new tn({props:{store:l[0]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Ta(l){var w;let e,t,s,n,i,r=!((w=l[1].message)!=null&&w.draft)&&["shortname","fullname"].includes(l[1].settings.filterbycourse)&&l[1].viewportSize<de.LG,a,o,f,d;const c=[$a,ya],m=[];function _(k,M){return k[1].message?0:1}t=_(l),s=m[t]=c[t](l);let b=l[1].viewportSize>=de.MD&&Sl(l),p=r&&Dl(l);const v=[Da,Sa],y=[];function $(k,M){var j;return k[1].viewportSize>=de.MD?0:(j=k[1].message)!=null&&j.draft?1:-1}return~(o=$(l))&&(f=y[o]=v[o](l)),{c(){e=h("div"),s.c(),n=L(),b&&b.c(),i=L(),p&&p.c(),a=L(),f&&f.c(),u(e,"role","toolbar"),u(e,"class","local-mail-toolbar d-flex w-100")},m(k,M){S(k,e,M),m[t].m(e,null),g(e,n),b&&b.m(e,null),g(e,i),p&&p.m(e,null),g(e,a),~o&&y[o].m(e,null),d=!0},p(k,[M]){var z;let j=t;t=_(k),t===j?m[t].p(k,M):(ie(),N(m[j],1,1,()=>{m[j]=null}),re(),s=m[t],s?s.p(k,M):(s=m[t]=c[t](k),s.c()),T(s,1),s.m(e,n)),k[1].viewportSize>=de.MD?b?(b.p(k,M),M&2&&T(b,1)):(b=Sl(k),b.c(),T(b,1),b.m(e,i)):b&&(ie(),N(b,1,1,()=>{b=null}),re()),M&2&&(r=!((z=k[1].message)!=null&&z.draft)&&["shortname","fullname"].includes(k[1].settings.filterbycourse)&&k[1].viewportSize<de.LG),r?p?(p.p(k,M),M&2&&T(p,1)):(p=Dl(k),p.c(),T(p,1),p.m(e,a)):p&&(ie(),N(p,1,1,()=>{p=null}),re());let C=o;o=$(k),o===C?~o&&y[o].p(k,M):(f&&(ie(),N(y[C],1,1,()=>{y[C]=null}),re()),~o?(f=y[o],f?f.p(k,M):(f=y[o]=v[o](k),f.c()),T(f,1),f.m(e,null)):f=null)},i(k){d||(T(s),T(b),T(p),T(f),d=!0)},o(k){N(s),N(b),N(p),N(f),d=!1},d(k){k&&D(e),m[t].d(),b&&b.d(),p&&p.d(),~o&&y[o].d()}}}function La(l,e,t){let s,n=U,i=()=>(n(),n=ge(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=o=>r.selectCourse(o);return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class za extends ce{constructor(e){super(),me(this,e,La,Ta,ue,{store:0})}}const{window:tt}=Ze;function ja(l){let e,t=l[3].strings.pluginname+"",s,n,i=l[2]&&l[3].viewportSize<de.LG&&Tl(l);return{c(){e=h("h1"),s=I(t),n=L(),i&&i.c(),u(e,"class","h2 local-mail-view-side-column text-truncate mb-4")},m(r,a){S(r,e,a),g(e,s),g(e,n),i&&i.m(e,null)},p(r,a){a&8&&t!==(t=r[3].strings.pluginname+"")&&R(s,t),r[2]&&r[3].viewportSize<de.LG?i?i.p(r,a):(i=Tl(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(r){r&&D(e),i&&i.d()}}}function Na(l){let e;return{c(){e=h("div"),u(e,"class","local-mail-view-side-column")},m(t,s){S(t,e,s)},p:U,d(t){t&&D(e)}}}function Tl(l){let e,t,s;return{c(){e=h("i"),t=L(),s=I(l[2]),u(e,"class","fa fa-angle-right mx-1"),u(e,"aria-hidden","true")},m(n,i){S(n,e,i),S(n,t,i),S(n,s,i)},p(n,i){i&4&&R(s,n[2])},d(n){n&&(D(e),D(t),D(s))}}}function Ll(l){let e,t,s;return t=new ma({props:{store:l[0]}}),{c(){e=h("div"),Y(t.$$.fragment),u(e,"class","local-mail-view-search")},m(n,i){S(n,e,i),J(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){N(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function zl(l){let e,t,s,n;e=new Vl({props:{strings:l[3].strings,iconOnly:l[1]&&l[3].viewportSize<de.SM,onClick:l[12]}});let i=!l[1]&&jl(l);return{c(){Y(e.$$.fragment),t=L(),i&&i.c(),s=pe()},m(r,a){J(e,r,a),S(r,t,a),i&&i.m(r,a),S(r,s,a),n=!0},p(r,a){const o={};a&8&&(o.strings=r[3].strings),a&10&&(o.iconOnly=r[1]&&r[3].viewportSize<de.SM),a&1&&(o.onClick=r[12]),e.$set(o),r[1]?i&&(ie(),N(i,1,1,()=>{i=null}),re()):i?(i.p(r,a),a&2&&T(i,1)):(i=jl(r),i.c(),T(i,1),i.m(s.parentNode,s))},i(r){n||(T(e.$$.fragment,r),T(i),n=!0)},o(r){N(e.$$.fragment,r),N(i),n=!1},d(r){r&&(D(t),D(s)),W(e,r),i&&i.d(r)}}}function jl(l){let e,t,s;return t=new Mn({props:{strings:l[3].strings,onClick:l[13]}}),{c(){e=h("div"),Y(t.$$.fragment),u(e,"class","ml-auto")},m(n,i){S(n,e,i),J(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[13]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){N(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function Nl(l){let e,t,s,n=l[3].viewportSize>=de.LG&&Bl(l),i=l[1]&&Al(l);return{c(){e=h("div"),n&&n.c(),t=L(),i&&i.c(),u(e,"class","row mb-3")},m(r,a){S(r,e,a),n&&n.m(e,null),g(e,t),i&&i.m(e,null),s=!0},p(r,a){r[3].viewportSize>=de.LG?n?(n.p(r,a),a&8&&T(n,1)):(n=Bl(r),n.c(),T(n,1),n.m(e,t)):n&&(ie(),N(n,1,1,()=>{n=null}),re()),r[1]?i?(i.p(r,a),a&2&&T(i,1)):(i=Al(r),i.c(),T(i,1),i.m(e,null)):i&&(ie(),N(i,1,1,()=>{i=null}),re())},i(r){s||(T(n),T(i),s=!0)},o(r){N(n),N(i),s=!1},d(r){r&&D(e),n&&n.d(),i&&i.d()}}}function Bl(l){let e,t,s;return t=new Vl({props:{strings:l[3].strings,onClick:l[14]}}),{c(){e=h("div"),Y(t.$$.fragment),u(e,"class","local-mail-view-side-column")},m(n,i){S(n,e,i),J(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[14]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){N(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function Al(l){let e,t,s;return t=new za({props:{store:l[0]}}),{c(){e=h("div"),Y(t.$$.fragment),u(e,"class","local-mail-view-main-column d-flex")},m(n,i){S(n,e,i),J(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){N(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function ql(l){let e,t,s;return t=new Cn({props:{settings:l[3].settings,strings:l[3].strings,courses:l[3].courses,labels:l[3].labels,params:l[3].params,onClick:l[0].navigate,onCourseChange:l[0].selectCourse}}),{c(){e=h("div"),Y(t.$$.fragment),u(e,"class","local-mail-view-side-column")},m(n,i){S(n,e,i),J(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.settings=n[3].settings),i&8&&(r.strings=n[3].strings),i&8&&(r.courses=n[3].courses),i&8&&(r.labels=n[3].labels),i&8&&(r.params=n[3].params),i&1&&(r.onClick=n[0].navigate),i&1&&(r.onCourseChange=n[0].selectCourse),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){N(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function Il(l){let e,t,s,n;const i=[qa,Aa,Ba],r=[];function a(o,f){var d;return(d=o[3].message)!=null&&d.draft&&o[3].draftForm?0:o[3].message?1:2}return t=a(l),s=r[t]=i[t](l),{c(){e=h("div"),s.c(),u(e,"class","local-mail-view-main-column")},m(o,f){S(o,e,f),r[t].m(e,null),n=!0},p(o,f){let d=t;t=a(o),t===d?r[t].p(o,f):(ie(),N(r[d],1,1,()=>{r[d]=null}),re(),s=r[t],s?s.p(o,f):(s=r[t]=i[t](o),s.c()),T(s,1),s.m(e,null))},i(o){n||(T(s),n=!0)},o(o){N(s),n=!1},d(o){o&&D(e),r[t].d()}}}function Ba(l){let e,t,s,n;return e=new Hi({props:{store:l[0]}}),s=new Or({props:{store:l[0]}}),{c(){Y(e.$$.fragment),t=L(),Y(s.$$.fragment)},m(i,r){J(e,i,r),S(i,t,r),J(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){N(e.$$.fragment,i),N(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function Aa(l){let e,t;return e=new gr({props:{store:l[0],message:l[3].message}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function qa(l){let e,t;return e=new Fr({props:{store:l[0],message:l[3].message,form:l[3].draftForm}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),n&8&&(i.form=s[3].draftForm),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function El(l){let e,t;return e=new hi({props:{store:l[0]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Pl(l){let e,t;return e=new Yr({props:{store:l[0],onCancel:l[15]}}),{c(){Y(e.$$.fragment)},m(s,n){J(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[15]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Ia(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,y,$,w,k,M;document.title=t=l[5]+" - "+l[3].strings.pluginname;function j(te,le){return te[3].mobile&&te[3].viewportSize<de.LG?Na:ja}let C=j(l),z=C(l),B=l[1]&&Ll(l),q=l[3].viewportSize<de.LG&&zl(l),G=(l[1]||l[3].viewportSize>=de.LG)&&Nl(l),P=(!l[1]||l[3].viewportSize>=de.LG)&&ql(l),K=l[1]&&Il(l),x=l[1]&&l[3].viewportSize<de.MD&&El(l),V=l[3].params.dialog=="preferences"&&Pl(l);return v=new ga({props:{store:l[0]}}),$=new An({props:{store:l[0]}}),{c(){e=L(),s=L(),n=h("div"),i=h("div"),z.c(),r=L(),a=h("div"),B&&B.c(),o=L(),q&&q.c(),f=L(),G&&G.c(),d=L(),c=h("div"),P&&P.c(),m=L(),K&&K.c(),_=L(),x&&x.c(),b=L(),V&&V.c(),p=L(),Y(v.$$.fragment),y=L(),Y($.$$.fragment),u(a,"class","local-mail-view-main-column d-flex mb-3"),O(a,"mb-4",l[3].viewportSize>=de.LG),u(i,"class","row align-items-center"),u(c,"class","row mb-3"),u(n,"class","local-mail local-mail-view container-fluid pt-2"),O(n,"p-4",!l[3].mobile),O(n,"local-mail-loading",l[3].loading)},m(te,le){S(te,e,le),S(te,s,le),S(te,n,le),g(n,i),z.m(i,null),g(i,r),g(i,a),B&&B.m(a,null),g(a,o),q&&q.m(a,null),g(n,f),G&&G.m(n,null),g(n,d),g(n,c),P&&P.m(c,null),g(c,m),K&&K.m(c,null),g(n,_),x&&x.m(n,null),g(n,b),V&&V.m(n,null),g(n,p),J(v,n,null),g(n,y),J($,n,null),l[16](n),w=!0,k||(M=[H(tt,"resize",l[10]),H(tt,"popstate",l[11]),H(tt,"beforeunload",l[6]),H(tt,"message",l[7]),H(document,"click",function(){$e(l[3].mobile?l[8]:void 0)&&(l[3].mobile?l[8]:void 0).apply(this,arguments)})],k=!0)},p(te,[le]){l=te,(!w||le&40)&&t!==(t=l[5]+" - "+l[3].strings.pluginname)&&(document.title=t),C===(C=j(l))&&z?z.p(l,le):(z.d(1),z=C(l),z&&(z.c(),z.m(i,r))),l[1]?B?(B.p(l,le),le&2&&T(B,1)):(B=Ll(l),B.c(),T(B,1),B.m(a,o)):B&&(ie(),N(B,1,1,()=>{B=null}),re()),l[3].viewportSize<de.LG?q?(q.p(l,le),le&8&&T(q,1)):(q=zl(l),q.c(),T(q,1),q.m(a,null)):q&&(ie(),N(q,1,1,()=>{q=null}),re()),(!w||le&8)&&O(a,"mb-4",l[3].viewportSize>=de.LG),l[1]||l[3].viewportSize>=de.LG?G?(G.p(l,le),le&10&&T(G,1)):(G=Nl(l),G.c(),T(G,1),G.m(n,d)):G&&(ie(),N(G,1,1,()=>{G=null}),re()),!l[1]||l[3].viewportSize>=de.LG?P?(P.p(l,le),le&10&&T(P,1)):(P=ql(l),P.c(),T(P,1),P.m(c,m)):P&&(ie(),N(P,1,1,()=>{P=null}),re()),l[1]?K?(K.p(l,le),le&2&&T(K,1)):(K=Il(l),K.c(),T(K,1),K.m(c,null)):K&&(ie(),N(K,1,1,()=>{K=null}),re()),l[1]&&l[3].viewportSize<de.MD?x?(x.p(l,le),le&10&&T(x,1)):(x=El(l),x.c(),T(x,1),x.m(n,b)):x&&(ie(),N(x,1,1,()=>{x=null}),re()),l[3].params.dialog=="preferences"?V?(V.p(l,le),le&8&&T(V,1)):(V=Pl(l),V.c(),T(V,1),V.m(n,p)):V&&(ie(),N(V,1,1,()=>{V=null}),re());const ee={};le&1&&(ee.store=l[0]),v.$set(ee);const X={};le&1&&(X.store=l[0]),$.$set(X),(!w||le&8)&&O(n,"p-4",!l[3].mobile),(!w||le&8)&&O(n,"local-mail-loading",l[3].loading)},i(te){w||(T(B),T(q),T(G),T(P),T(K),T(x),T(V),T(v.$$.fragment,te),T($.$$.fragment,te),w=!0)},o(te){N(B),N(q),N(G),N(P),N(K),N(x),N(V),N(v.$$.fragment,te),N($.$$.fragment,te),w=!1},d(te){te&&(D(e),D(s),D(n)),z.d(),B&&B.d(),q&&q.d(),G&&G.d(),P&&P.d(),K&&K.d(),x&&x.d(),V&&V.d(),W(v),W($),l[16](null),k=!1,we(M)}}}function Ea(l,e,t){let s,n,i,r,a,o=U,f=()=>(o(),o=ge(d,C=>t(3,a=C)),d);l.$$.on_destroy.push(()=>o());let{store:d}=e;f();let c,m=0;Xe(()=>{d.setViewportSize(window.innerWidth)}),$n(()=>{if(m!=a.navigationId){m=a.navigationId;let C=c.parentElement;for(;C;)C.scrollTop>0&&C.scrollTo({top:0}),C=C.parentElement}});const _=C=>{if(a.draftData)return C.preventDefault(),d.updateDraft(a.draftData,!0),""},b=C=>{a.mobile&&C.data.addon=="local_mail"&&C.data.backClicked&&d.navigateToMenu()},p=C=>{var z;if(a.mobile&&!C.defaultPrevented&&C.target instanceof HTMLElement){const B=C.target.closest("a");B&&((z=window.parent)==null||z.postMessage({addon:"local_mail",openUrl:B.href},"*")),C.defaultPrevented||C.preventDefault()}},v=()=>d.setViewportSize(window.innerWidth),y=()=>d.navigate(Kl()),$=()=>d.createMessage(),w=()=>d.showDialog("preferences"),k=()=>d.createMessage(),M=()=>d.hideDialog();function j(C){Me[C?"unshift":"push"](()=>{c=C,t(4,c)})}return l.$$set=C=>{"store"in C&&f(t(0,d=C.store))},l.$$.update=()=>{var C,z,B;l.$$.dirty&8&&t(1,s=a.params.tray),l.$$.dirty&10&&t(2,n=s=="inbox"?a.strings.inbox:s=="starred"?a.strings.starredplural:s=="sent"?a.strings.sentplural:s=="drafts"?a.strings.drafts:s=="trash"?a.strings.trash:s=="label"?((C=a.labels.find(q=>q.id==a.params.labelid))==null?void 0:C.name)||"":s=="course"&&((z=a.courses.find(q=>q.id==a.params.courseid))==null?void 0:z.fullname)||""),l.$$.dirty&12&&t(5,i=a.message?a.message.subject.trim()||a.strings.nosubject:n),l.$$.dirty&12&&t(9,r=a.viewportSize<de.LG?n||a.strings.pluginname:""),l.$$.dirty&514&&((B=window.parent)==null||B.postMessage({addon:"local_mail",setTitle:r,captureBack:s!=null},"*"))},[d,s,n,a,c,i,_,b,p,r,v,y,$,w,k,M,j]}class Pa extends ce{constructor(e){super(),me(this,e,Ea,Ia,ue,{store:0})}}const He=[];function Ra(l,e=U){let t;const s=new Set;function n(a){if(Sn(l,a)&&(l=a,t)){const o=!He.length;for(const f of s)f[1](),He.push(f,l);if(o){for(let f=0;f<He.length;f+=2)He[f][0](He[f+1]);He.length=0}}}function i(a){n(a(l))}function r(a,o=U){const f=[a,o];return s.add(f),s.size===1&&(t=e(n,i)||U),a(l),()=>{s.delete(f),s.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:r}}async function Fa(l){let e=0,t=0,s={userid:l.userid,settings:l.settings,preferences:l.preferences,strings:l.strings,mobile:l.mobile,params:{},unread:0,drafts:0,courses:[],labels:[],totalCount:0,listMessages:[],loading:!0,selectedMessages:new Map,toasts:[],navigationId:0,viewportSize:0};const{subscribe:n,set:i}=Ra(s),r=A=>i({...s,...A});n(A=>{s=A});const a=async(A,E,se=!1)=>{var kt,vt,wt,yt,$t;const ae=++e,F=(kt=s.message)==null?void 0:kt.id,oe=s.draftData,Q=E||s.params,he=!se&&(Q.tray!=s.params.tray||Q.messageid!=s.params.messageid||Q.courseid!=s.params.courseid||Q.labelid!=s.params.labelid||Q.search!=s.params.search)?{...s.params,dialog:void 0}:s.prevParams,Z=s.preferences.perpage;if(r({loading:!0,error:void 0}),rt(Q,se),F&&oe&&(window.clearTimeout(t),A.unshift({methodname:"update_message",messageid:F,data:oe})),A.push({methodname:"get_courses"}),A.push({methodname:"get_labels"}),Q.tray){const ve={courseid:Q.courseid,labelid:Q.tray=="label"?Q.labelid:void 0,draft:Q.tray=="drafts"?!0:Q.tray=="sent"?!1:void 0,roles:Q.tray=="inbox"?["to","cc","bcc"]:Q.tray=="sent"?["from"]:void 0,starred:Q.tray=="starred"?!0:void 0,deleted:Q.tray=="trash"};A.push({methodname:"count_messages",query:ve}),Q.messageid?(A.push({methodname:"get_message",messageid:Q.messageid}),A.push({methodname:"search_messages",query:{...ve,...Q.search,startid:Q.messageid,reverse:!1},limit:1}),A.push({methodname:"search_messages",query:{...ve,...Q.search,startid:Q.messageid,reverse:!0},limit:1}),Q.search||A.push({methodname:"count_messages",query:{...ve,startid:Q.messageid,reverse:!0}})):A.push({methodname:"search_messages",query:{...ve,...Q.search},offset:Q.search?void 0:Q.offset,limit:Q.search?Z+1:Z})}let ne;try{ne=await Ye(A)}catch(ve){return z(ve),[]}let be,ke,je,Ae,Te=[],pt=0;Q.tray&&(Q.messageid?(Q.search||(ke=ne.pop()),Ae=(vt=ne.pop()[0])==null?void 0:vt.id,je=(wt=ne.pop()[0])==null?void 0:wt.id,be=ne.pop()):(Te=ne.pop(),Q.search&&(Q.search.reverse?(Ae=(yt=Te[Z])==null?void 0:yt.id,je=Q.search.startid,Te=Te.slice(0,Z).reverse()):(Ae=Q.search.startid,je=($t=Te[Z])==null?void 0:$t.id,Te=Te.slice(0,Z)))),pt=ne.pop());const bt=ne.pop(),et=ne.pop();if(F&&oe&&ne.shift(),Q.tray=="course"&&!et.find(ve=>ve.id==Q.courseid)||Q.tray=="label"&&!bt.find(ve=>ve.id==Q.labelid))return await p({tray:"inbox"},!0),ne;let ht;if(be!=null&&be.draft&&(be==null?void 0:be.id)!=F){const ve=[{methodname:"get_message_form",messageid:be.id}];let Oe;try{Oe=await Ye(ve)}catch(dn){return z(dn),ne}ht=Oe.pop()}return ae!=e||(r({params:Q,prevParams:he,unread:et.reduce((ve,Oe)=>ve+Oe.unread,0),drafts:et.reduce((ve,Oe)=>ve+Oe.drafts,0),courses:et,labels:bt,messageOffset:ke,totalCount:pt,listMessages:Te,message:be,nextMessageId:je,prevMessageId:Ae,draftForm:(be==null?void 0:be.id)!=F?ht:s.draftForm,draftData:void 0,draftSaved:(be==null?void 0:be.id)==F?oe==null:!1,selectedMessages:new Map(be?[[be.id,be]]:s.message?[]:Te.filter(ve=>s.selectedMessages.has(ve.id)).map(ve=>[ve.id,ve])),loading:!1,navigationId:se||Q.tray!=s.params.tray||Q.courseid!=s.params.courseid||Q.labelid!=s.params.labelid||Q.messageid!=s.params.messageid||Q.offset!=s.params.offset?s.navigationId+1:s.navigationId}),F&&oe&&F!=(be==null?void 0:be.id)&&x({text:s.strings.draftsaved})),ne},o=async(A,E)=>(await a([{methodname:"create_label",name:A,color:E}])).pop(),f=async A=>{A=A||s.params.courseid||s.courses[0].id;const E={methodname:"create_message",courseid:A};let se;try{se=await Ye([E])}catch(ae){z(ae);return}await p({tray:"drafts",messageid:se.pop(),courseid:A})},d=async A=>{await a([{methodname:"delete_label",labelid:A}],{tray:"inbox"})},c=async A=>{await a([{methodname:"empty_trash",courseid:A}])},m=async A=>{const E=s.params,se={methodname:"forward_message",messageid:A.id},ae=await a([se]);await p({tray:"drafts",messageid:ae.pop(),courseid:E.courseid?A.course.id:void 0})},_=()=>{const A={...s.params,dialog:void 0};r({params:A}),rt(A,!0)},b=A=>{r({toasts:s.toasts.filter(E=>E!=A)})},p=async(A,E=!1,se=!0)=>{var oe;const ae=[];se&&s.settings.incrementalsearch&&ae.push({methodname:"search_messages",query:{deleted:!1},offset:s.settings.incrementalsearchlimit,limit:1}),A!=null&&A.messageid&&ae.push({methodname:"view_message",messageid:A.messageid});const F=await a(ae,A,E);if(se&&s.settings.incrementalsearch){const Q=F.pop();r({incrementalSearchStopId:(oe=Q==null?void 0:Q[0])==null?void 0:oe.id})}},v=async(A=!1)=>{const E={...s.params,messageid:void 0,offset:Math.floor((s.params.offset||0)/s.preferences.perpage)*s.preferences.perpage||void 0};await a([],E,A)},y=async()=>{await a([],{})},$=async(A,E)=>{const se=s.params,ae={methodname:"reply_message",messageid:A.id,all:E},F=await a([ae]);await p({tray:"drafts",messageid:F.pop(),courseid:se.courseid?A.course.id:void 0})},w=async A=>{r({preferences:{...s.preferences,...A}});let E=s.params;A.perpage&&(E={...E,offset:s.params.offset?Math.trunc(s.params.offset/A.perpage)*A.perpage:void 0}),await a([{methodname:"set_preferences",preferences:A}],E,!0)},k=A=>{r({selectedMessages:new Map(s.listMessages.filter(E=>A=="all"||A=="read"&&!E.unread||A=="unread"&&E.unread||A=="starred"&&E.starred||A=="unstarred"&&!E.starred).map(E=>[E.id,E]))})},M=async A=>{await p({...s.params,courseid:A,offset:0,messageid:void 0,search:s.params.search?{...s.params.search,startid:void 0,reverse:void 0}:void 0})},j=async()=>{var se;if(!((se=s.message)!=null&&se.draft))return;const A={methodname:"send_message",messageid:s.message.id},E=s.prevParams?{...s.prevParams,messageid:void 0,offset:Math.floor((s.prevParams.offset||0)/s.preferences.perpage)*s.preferences.perpage||void 0}:["shortname","fullname"].includes(s.settings.filterbycourse)?{tray:"inbox",courseid:s.message.course.id}:{tray:"course",courseid:s.message.course.id};await a([A],E),x({text:s.strings.messagesent})},C=async(A,E,se)=>{const ae=A.map(oe=>({methodname:"set_deleted",messageid:oe,deleted:E})),F={...s.params,messageid:void 0};if(await a(ae,F,!0),E!=Re.DeletedForever){const oe=E?A.length>1?"messagesmovedtotrash":"messagemovedtotrash":A.length>1?"messagesrestored":"messagerestored",Q=Ie(s.strings[oe],A.length);x({text:Q,undo:se?()=>{C(A,E?Re.NotDeleted:Re.Deleted,!1)}:void 0})}},z=async A=>{r({loading:s.loading&&!A,error:A})},B=async(A,E)=>{X(ae=>s.selectedMessages.has(ae.id)?{...ae,labels:s.labels.filter(F=>A.includes(F.id)?!0:E.includes(F.id)?!1:ae.labels.findIndex(oe=>oe.id==F.id)>=0)}:ae);const se=[];s.selectedMessages.forEach(ae=>{se.push({methodname:"set_labels",messageid:ae.id,labelids:ae.labels.map(F=>F.id)})}),await a(se)},q=async(A,E)=>{X(ae=>A.includes(ae.id)?{...ae,starred:E}:ae);const se=A.map(ae=>({methodname:"set_starred",messageid:ae,starred:E}));await a(se)},G=async(A,E)=>{X(F=>A.includes(F.id)?{...F,unread:E}:F);const se=A.map(F=>({methodname:"set_unread",messageid:F,unread:E})),ae={...s.params,messageid:void 0};await a(se,ae)},P=A=>{r({viewportSize:A,navigationId:s.navigationId+1}),!s.params.tray&&A>=de.LG&&!s.error&&p({tray:"inbox",dialog:s.params.dialog},!0)},K=async A=>{const E={...s.params,dialog:A};rt(E,s.params.dialog!=null),r({params:E})},x=async A=>{r({toasts:[A]}),A&&window.setTimeout(()=>b(A),1e4)},V=A=>{r({selectedMessages:new Map(s.listMessages.filter(E=>E.id==A?!s.selectedMessages.has(E.id):s.selectedMessages.has(E.id)).map(E=>[E.id,E]))})},te=async A=>{A.undo&&(b(A),A.undo())},le=(A,E)=>{if(!s.message)return;const se=++e,ae=s.message,F=s.draftData;r({draftData:A,draftSaved:!1});let oe=3e3;E?oe=0:F&&(oe=Math.max(0,ae.time*1e3+oe-Date.now())),window.clearTimeout(t),t=window.setTimeout(async()=>{const Q=[{methodname:"update_message",messageid:ae.id,data:A},{methodname:"get_message",messageid:ae.id}];let he;try{he=await Ye(Q)}catch(ne){z(ne);return}const Z=he.pop();se==e&&r({message:Z,draftData:void 0,draftSaved:!0})},oe)},ee=async(A,E,se)=>{await a([{methodname:"update_label",labelid:A,name:E,color:se}])},X=A=>{r({listMessages:s.listMessages.map(E=>A(E)),message:s.message?A(s.message):void 0,selectedMessages:new Map(Array.from(s.selectedMessages.entries()).map(([E,se])=>[E,A(se)]))})};return await p(Kl(),!0,!0),{createLabel:o,createMessage:f,deleteLabel:d,emptyTrash:c,forward:m,get:()=>s,hideDialog:_,hideToast:b,navigate:p,navigateToList:v,navigateToMenu:y,reply:$,savePreferences:w,selectAll:k,selectCourse:M,sendMessage:j,setDeleted:C,setError:z,setLabels:B,setStarred:q,setUnread:G,setViewportSize:P,showDialog:K,subscribe:n,toggleSelected:V,undo:te,updateDraft:le,updateLabel:ee}}async function Ua(){const l=document.getElementById("local-mail-view"),e=document.getElementById("local-mail-navbar"),t=window.local_mail_view_data;if(!t)return;const s=await Fa({userid:t.userid,settings:t.settings,preferences:t.preferences,strings:t.strings,mobile:!!t.mobile});if(l&&new Pa({target:l,props:{store:s}}),e){e.innerHTML="";const n=s.get(),i=new Dn({target:e,props:{settings:n.settings,strings:n.strings,courses:n.courses,labels:n.labels,params:n.params,onClick:s.navigate,onComposeClick:s.createMessage,onCourseChange:s.selectCourse}});s.subscribe(r=>{i.$set({settings:r.settings,strings:r.strings,courses:r.courses,labels:r.labels,params:r.params})})}}Ua();
//# sourceMappingURL=view-2a19f9f0.js.map
