import{n as F,i as Hl,a as vn,l as wn,c as $n,d as yn,S as oe,b as fe,e as ae,f as pe,g as D,h as S,j as h,k as u,s as de,t as I,m as Ye,r as Ae,o as g,p as G,q as Dt,u as Mn,v as j,w as W,x as De,y as Se,z as Ge,A as Cn,B as Dn,C as Sn,D as T,E as ze,F as Ee,G as z,H as $e,I as et,J as dt,K as Ce,L as ne,M as ie,N as J,O as K,P as V,Q as O,R as it,T as St,U as ce,V as ye,W as Te,X as je,Y as tt,Z as ge,_ as Tn,$ as Ol,a0 as Ue,a1 as He,a2 as _t,a3 as Pe,a4 as Jl,a5 as Kl,a6 as ft,a7 as xe,a8 as Ie,a9 as Tt,aa as rt,ab as jt,ac as Vl,ad as Ze,ae as mt,af as Wl,ag as Lt,ah as jn,ai as We,aj as Xe,ak as Xl,al as Ln,am as zn,an as Yl,ao as Nn,ap as ut,aq as An}from"./global-wUePOHC_.js";const st=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ql(l,e,t,s){if(!e)return F;const n=l.getBoundingClientRect();if(e.left===n.left&&e.right===n.right&&e.top===n.top&&e.bottom===n.bottom)return F;const{delay:i=0,duration:r=300,easing:o=Hl,start:a=vn()+i,end:f=a+r,tick:d=F,css:m}=t(l,{from:e,to:n},s);let c=!0,_=!1,b;function p(){m&&(b=$n(l,0,1,r,i,o,m)),i||(_=!0)}function v(){m&&yn(l,b),c=!1}return wn(w=>{if(!_&&w>=a&&(_=!0),_&&w>=f&&(d(1,0),v()),!c)return!1;if(_){const $=w-a,y=0+1*o($/r);d(y,1-y)}return!0}),p(),d(0,1),v}function Zl(l){const e=getComputedStyle(l);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:s}=e,n=l.getBoundingClientRect();l.style.position="absolute",l.style.width=t,l.style.height=s,gt(l,n)}}function gt(l,e){const t=l.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const s=getComputedStyle(l),n=s.transform==="none"?"":s.transform;l.style.transform=`${n} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}var Fe=(l=>(l[l.NotDeleted=0]="NotDeleted",l[l.Deleted=1]="Deleted",l[l.DeletedForever=2]="DeletedForever",l))(Fe||{}),at=(l=>(l[l.No=0]="No",l[l.Separate=1]="Separate",l[l.Visible=2]="Visible",l))(at||{}),qe=(l=>(l.TO="to",l.CC="cc",l.BCC="bcc",l))(qe||{}),me=(l=>(l[l.SM=576]="SM",l[l.MD=768]="MD",l[l.LG=992]="LG",l[l.XL=1200]="XL",l))(me||{});function zt(l){let e;function t(i,r){return i[2]?Bn:qn}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),u(e,"class","local-mail-course-link mt-n2 mb-3 mb-lg-4")},m(i,r){D(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&S(e),n.d()}}}function qn(l){let e;return{c(){e=I(" ")},m(t,s){D(t,e,s)},p:F,d(t){t&&S(e)}}}function Bn(l){let e,t,s=Ye(l[2],l[1].settings.courselink)+"",n,i,r;return{c(){e=h("nav"),t=h("a"),n=I(s),u(t,"class","text-truncate"),u(t,"href",i=window.M.cfg.wwwroot+"/course/view.php?id="+l[1].params.courseid),u(t,"title",r=Ae(l[1].strings.gotocourse,Ye(l[2],"fullname"))),u(e,"class","d-flex align-items-center")},m(o,a){D(o,e,a),g(e,t),g(t,n)},p(o,a){a&6&&s!==(s=Ye(o[2],o[1].settings.courselink)+"")&&G(n,s),a&2&&i!==(i=window.M.cfg.wwwroot+"/course/view.php?id="+o[1].params.courseid)&&u(t,"href",i),a&6&&r!==(r=Ae(o[1].strings.gotocourse,Ye(o[2],"fullname")))&&u(t,"title",r)},d(o){o&&S(e)}}}function In(l){let e=["shortname","fullname"].includes(l[1].settings.courselink),t,s=e&&zt(l);return{c(){s&&s.c(),t=pe()},m(n,i){s&&s.m(n,i),D(n,t,i)},p(n,[i]){i&2&&(e=["shortname","fullname"].includes(n[1].settings.courselink)),e?s?s.p(n,i):(s=zt(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:F,o:F,d(n){n&&S(t),s&&s.d(n)}}}function En(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,a=>t(1,n=a)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;return r(),l.$$set=a=>{"store"in a&&r(t(0,o=a.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=n.courses.find(a=>a.id==n.params.courseid))},[o,n,s]}class Pn extends oe{constructor(e){super(),fe(this,e,En,In,ae,{store:0})}}function xl(l){const e=l-1;return e*e*e+1}function Be(l,{delay:e=0,duration:t=400,easing:s=Hl}={}){const n=+getComputedStyle(l).opacity;return{delay:e,duration:t,easing:s,css:i=>`opacity: ${i*n}`}}function ot(l,{delay:e=0,duration:t=400,easing:s=xl,x:n=0,y:i=0,opacity:r=0}={}){const o=getComputedStyle(l),a=+o.opacity,f=o.transform==="none"?"":o.transform,d=a*(1-r),[m,c]=Dt(n),[_,b]=Dt(i);return{delay:e,duration:t,easing:s,css:(p,v)=>`
			transform: ${f} translate(${(1-p)*m}${c}, ${(1-p)*_}${b});
			opacity: ${a-d*v}`}}const{document:Rn}=st;function Nt(l){let e,t,s=l[1]&&At(l),n=l[2]&&l[4]&&qt(l);return{c(){e=h("div"),s&&s.c(),t=j(),n&&n.c(),u(e,"class","modal-footer")},m(i,r){D(i,e,r),s&&s.m(e,null),g(e,t),n&&n.m(e,null)},p(i,r){i[1]?s?s.p(i,r):(s=At(i),s.c(),s.m(e,t)):s&&(s.d(1),s=null),i[2]&&i[4]?n?n.p(i,r):(n=qt(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(i){i&&S(e),s&&s.d(),n&&n.d()}}}function At(l){let e,t,s,n;return{c(){e=h("button"),t=I(l[1]),u(e,"type","button"),u(e,"class","btn btn-secondary")},m(i,r){D(i,e,r),g(e,t),s||(n=W(e,"click",function(){De(l[3])&&l[3].apply(this,arguments)}),s=!0)},p(i,r){l=i,r&2&&G(t,l[1])},d(i){i&&S(e),s=!1,n()}}}function qt(l){let e,t,s,n,i;return{c(){e=h("button"),t=I(l[2]),u(e,"type","button"),u(e,"class",s="btn "+l[5]),e.disabled=l[6]},m(r,o){D(r,e,o),g(e,t),n||(i=W(e,"click",function(){De(l[4])&&l[4].apply(this,arguments)}),n=!0)},p(r,o){l=r,o&4&&G(t,l[2]),o&32&&s!==(s="btn "+l[5])&&u(e,"class",s),o&64&&(e.disabled=l[6])},d(r){r&&S(e),n=!1,i()}}}function Fn(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,$,y,k,M;const N=l[10].default,C=Mn(N,l,l[9],null);let L=(l[1]||l[2]&&l[4])&&Nt(l);return{c(){e=j(),t=h("div"),s=h("div"),n=h("div"),i=h("div"),r=h("h5"),o=I(l[0]),a=j(),f=h("button"),d=h("span"),d.textContent="×",m=j(),c=h("div"),C&&C.c(),_=j(),L&&L.c(),v=j(),w=h("div"),u(r,"class","modal-title"),u(d,"aria-hidden","true"),u(f,"type","button"),u(f,"class","close"),u(f,"aria-label",l[1]),u(i,"class","modal-header"),u(c,"class","modal-body"),u(n,"class","modal-content"),u(s,"class","modal-dialog"),u(t,"class","modal show"),u(t,"tabindex","-1"),u(t,"role","dialog"),u(t,"aria-label",l[0]),u(t,"aria-modal","true"),u(w,"class","modal-backdrop show")},m(A,R){D(A,e,R),D(A,t,R),g(t,s),g(s,n),g(n,i),g(i,r),g(r,o),g(i,a),g(i,f),g(f,d),g(n,m),g(n,c),C&&C.m(c,null),g(n,_),L&&L.m(n,null),l[11](t),D(A,v,R),D(A,w,R),y=!0,k||(M=[W(Rn.body,"keyup",l[8]),W(f,"click",function(){De(l[3])&&l[3].apply(this,arguments)}),Se(b=Ge.call(null,t,l[3]))],k=!0)},p(A,[R]){l=A,(!y||R&1)&&G(o,l[0]),(!y||R&2)&&u(f,"aria-label",l[1]),C&&C.p&&(!y||R&512)&&Cn(C,N,l,l[9],y?Sn(N,l[9],R,null):Dn(l[9]),null),l[1]||l[2]&&l[4]?L?L.p(l,R):(L=Nt(l),L.c(),L.m(n,null)):L&&(L.d(1),L=null),(!y||R&1)&&u(t,"aria-label",l[0]),b&&De(b.update)&&R&8&&b.update.call(null,l[3])},i(A){y||(T(C,A),ze(()=>{y&&(p||(p=Ee(t,ot,{y:-100},!0)),p.run(1))}),ze(()=>{y&&($||($=Ee(w,Be,{},!0)),$.run(1))}),y=!0)},o(A){z(C,A),p||(p=Ee(t,ot,{y:-100},!1)),p.run(0),$||($=Ee(w,Be,{},!1)),$.run(0),y=!1},d(A){A&&(S(e),S(t),S(v),S(w)),C&&C.d(A),L&&L.d(),l[11](null),A&&p&&p.end(),A&&$&&$.end(),k=!1,$e(M)}}}function Un(l,e,t){let{$$slots:s={},$$scope:n}=e,{title:i}=e,{cancelText:r=""}=e,{confirmText:o=""}=e,{onCancel:a}=e,{onConfirm:f=void 0}=e,{confirmClass:d="btn-primary"}=e,{confirmDisabled:m=!1}=e,c;et(()=>{document.body.classList.add("modal-open"),c.focus()}),dt(()=>{document.body.classList.remove("modal-open")});const _=p=>{p.key=="Escape"&&a()};function b(p){Ce[p?"unshift":"push"](()=>{c=p,t(7,c)})}return l.$$set=p=>{"title"in p&&t(0,i=p.title),"cancelText"in p&&t(1,r=p.cancelText),"confirmText"in p&&t(2,o=p.confirmText),"onCancel"in p&&t(3,a=p.onCancel),"onConfirm"in p&&t(4,f=p.onConfirm),"confirmClass"in p&&t(5,d=p.confirmClass),"confirmDisabled"in p&&t(6,m=p.confirmDisabled),"$$scope"in p&&t(9,n=p.$$scope)},[i,r,o,a,f,d,m,c,_,n,s,b]}class Oe extends oe{constructor(e){super(),fe(this,e,Un,Fn,ae,{title:0,cancelText:1,confirmText:2,onCancel:3,onConfirm:4,confirmClass:5,confirmDisabled:6})}}function Bt(l){let e,t;return e=new Oe({props:{title:l[1].strings.error,onCancel:l[2],$$slots:{default:[Gn]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.title=s[1].strings.error),n&1&&(i.onCancel=s[2]),n&10&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function It(l){var n;let e,t=((n=l[1].error)==null?void 0:n.debuginfo)+"",s;return{c(){e=h("p"),s=I(t)},m(i,r){D(i,e,r),g(e,s)},p(i,r){var o;r&2&&t!==(t=((o=i[1].error)==null?void 0:o.debuginfo)+"")&&G(s,t)},d(i){i&&S(e)}}}function Et(l){var n;let e,t=((n=l[1].error)==null?void 0:n.stacktrace)+"",s;return{c(){e=h("pre"),s=I(t)},m(i,r){D(i,e,r),g(e,s)},p(i,r){var o;r&2&&t!==(t=((o=i[1].error)==null?void 0:o.stacktrace)+"")&&G(s,t)},d(i){i&&S(e)}}}function Gn(l){var f,d,m;let e,t=((f=l[1].error)==null?void 0:f.message)+"",s,n,i,r,o=((d=l[1].error)==null?void 0:d.debuginfo)&&It(l),a=((m=l[1].error)==null?void 0:m.stacktrace)&&Et(l);return{c(){e=h("p"),s=I(t),n=j(),o&&o.c(),i=j(),a&&a.c(),r=pe()},m(c,_){D(c,e,_),g(e,s),D(c,n,_),o&&o.m(c,_),D(c,i,_),a&&a.m(c,_),D(c,r,_)},p(c,_){var b,p,v;_&2&&t!==(t=((b=c[1].error)==null?void 0:b.message)+"")&&G(s,t),(p=c[1].error)!=null&&p.debuginfo?o?o.p(c,_):(o=It(c),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null),(v=c[1].error)!=null&&v.stacktrace?a?a.p(c,_):(a=Et(c),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null)},d(c){c&&(S(e),S(n),S(i),S(r)),o&&o.d(c),a&&a.d(c)}}}function Hn(l){let e,t,s=l[1].error&&Bt(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),D(n,e,i),t=!0},p(n,[i]){n[1].error?s?(s.p(n,i),i&2&&T(s,1)):(s=Bt(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&S(e),s&&s.d(n)}}}function On(l,e,t){let s,n=F,i=()=>(n(),n=de(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=()=>r.setError();return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class Jn extends oe{constructor(e){super(),fe(this,e,On,Hn,ae,{store:0})}}function Kn(l){let e,t,s,n,i,r;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-trash"),u(e,"type","button"),u(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.movetotrash),O(e,"btn-secondary",!l[1]),O(e,"disabled",!l[2].selectedMessages.size)},m(o,a){D(o,e,a),g(e,t),i||(r=W(e,"click",l[3]),i=!0)},p(o,[a]){a&4&&s!==(s=!o[2].selectedMessages.size)&&(e.disabled=s),a&4&&n!==(n=o[2].strings.movetotrash)&&u(e,"title",n),a&2&&O(e,"btn-secondary",!o[1]),a&4&&O(e,"disabled",!o[2].selectedMessages.size)},i:F,o:F,d(o){o&&S(e),i=!1,r()}}}function Vn(l,e,t){let s,n=F,i=()=>(n(),n=de(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:o=!1}=e;const a=()=>r.setDeleted(Array.from(s.selectedMessages.keys()),Fe.Deleted,!0);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"transparent"in f&&t(1,o=f.transparent)},[r,o,s,a]}class en extends oe{constructor(e){super(),fe(this,e,Vn,Kn,ae,{store:0,transparent:1})}}function Pt(l){let e,t;return e=new Oe({props:{title:l[2].strings.deleteforever,cancelText:l[2].strings.cancel,confirmText:l[2].strings.deleteforever,confirmClass:"btn-danger",onCancel:l[5],onConfirm:l[3],$$slots:{default:[Wn]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.deleteforever),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.deleteforever),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Wn(l){let e=l[2].strings[l[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"",t;return{c(){t=I(e)},m(s,n){D(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings[s[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"")&&G(t,e)},d(s){s&&S(t)}}}function Xn(l){let e,t,s,n,i,r,o,a,f,d=l[2].params.dialog=="deleteforever"&&Pt(l);return{c(){e=h("button"),t=h("i"),i=j(),d&&d.c(),r=pe(),u(t,"class","fa fa-fw fa-trash"),u(e,"type","button"),u(e,"class","local-mail-action-delete-forever btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.deleteforever),O(e,"btn-secondary",!l[1]),O(e,"disabled",!l[2].selectedMessages.size)},m(m,c){D(m,e,c),g(e,t),D(m,i,c),d&&d.m(m,c),D(m,r,c),o=!0,a||(f=W(e,"click",l[4]),a=!0)},p(m,[c]){(!o||c&4&&s!==(s=!m[2].selectedMessages.size))&&(e.disabled=s),(!o||c&4&&n!==(n=m[2].strings.deleteforever))&&u(e,"title",n),(!o||c&2)&&O(e,"btn-secondary",!m[1]),(!o||c&4)&&O(e,"disabled",!m[2].selectedMessages.size),m[2].params.dialog=="deleteforever"?d?(d.p(m,c),c&4&&T(d,1)):(d=Pt(m),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(ne(),z(d,1,1,()=>{d=null}),ie())},i(m){o||(T(d),o=!0)},o(m){z(d),o=!1},d(m){m&&(S(e),S(i),S(r)),d&&d.d(m),a=!1,f()}}}function Yn(l,e,t){let s,n=F,i=()=>(n(),n=de(r,m=>t(2,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:o=!1}=e;const a=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Fe.DeletedForever,!0)},f=()=>r.showDialog("deleteforever"),d=()=>r.hideDialog();return l.$$set=m=>{"store"in m&&i(t(0,r=m.store)),"transparent"in m&&t(1,o=m.transparent)},[r,o,s,a,f,d]}class tn extends oe{constructor(e){super(),fe(this,e,Yn,Xn,ae,{store:0,transparent:1})}}function Rt(l,e,t){const s=l.slice();return s[16]=e[t],s}function Qn(l){let e;return{c(){e=I(" ")},m(t,s){D(t,e,s)},p:F,d(t){t&&S(e)}}}function Zn(l){let e=l[5].strings.errorrepeatedlabelname+"",t;return{c(){t=I(e)},m(s,n){D(s,t,n)},p(s,n){n&32&&e!==(e=s[5].strings.errorrepeatedlabelname+"")&&G(t,e)},d(s){s&&S(t)}}}function xn(l){let e;return{c(){e=h("span"),e.textContent="a",u(e,"aria-hidden","true")},m(t,s){D(t,e,s)},d(t){t&&S(e)}}}function ei(l){let e;return{c(){e=h("i"),u(e,"class","fa fa-check local-mail-label-modal-color-option-check")},m(t,s){D(t,e,s)},d(t){t&&S(e)}}}function Ft(l,e){let t,s,n,i,r,o;function a(c,_){return c[16]==c[7]?ei:xn}let f=a(e),d=f(e);function m(){return e[15](e[16])}return{key:l,first:null,c(){t=h("button"),d.c(),s=j(),u(t,"role","radio"),u(t,"aria-checked",n=e[16]==e[7]),u(t,"tabindex","0"),u(t,"title",i=e[5].strings[`color${e[16]}`]),u(t,"class","local-mail-label-modal-color-option btn"),u(t,"style",`color: var(--local-mail-color-${e[16]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${e[16]}-bg, var(--local-mail-color-gray-bg))`),this.first=t},m(c,_){D(c,t,_),d.m(t,null),g(t,s),r||(o=W(t,"click",Te(m)),r=!0)},p(c,_){e=c,f!==(f=a(e))&&(d.d(1),d=f(e),d&&(d.c(),d.m(t,s))),_&128&&n!==(n=e[16]==e[7])&&u(t,"aria-checked",n),_&32&&i!==(i=e[5].strings[`color${e[16]}`])&&u(t,"title",i)},d(c){c&&S(t),d.d(),r=!1,o()}}}function ti(l){let e,t,s,n=l[5].strings.name+"",i,r,o,a,f,d,m,c,_,b,p,v=l[5].strings.color+"",w,$,y,k,M=[],N=new Map,C,L,A;function R(X,te){return X[4]?Zn:Qn}let E=R(l),H=E(l),Q=ce(it);const le=X=>X[16];for(let X=0;X<Q.length;X+=1){let te=Rt(l,Q,X),re=le(te);N.set(re,M[X]=Ft(re,te))}return{c(){e=h("form"),t=h("div"),s=h("label"),i=I(n),r=j(),o=h("input"),f=j(),d=h("div"),H.c(),m=j(),c=h("div"),c.textContent=" ",_=j(),b=h("div"),p=h("label"),w=I(v),y=j(),k=h("div");for(let X=0;X<M.length;X+=1)M[X].c();u(s,"for","local-mail-label-modal-name"),u(o,"type","text"),o.required=!0,u(o,"class","form-control is-invalid"),u(o,"id",a=l[9]+"-name"),O(o,"is-valid",l[8]),O(o,"is-invalid",!l[8]),u(d,"class","invalid-feedback"),u(c,"class","valid-feedback"),u(t,"class","form-group mb-0"),u(p,"for",$=l[9]+"-color"),u(k,"role","radiogroup"),u(k,"class","local-mail-label-modal-color"),u(k,"id",C=l[9]+"-color"),u(b,"class","form-group")},m(X,te){D(X,e,te),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),l[13](o),ye(o,l[3]),g(t,f),g(t,d),H.m(d,null),g(t,m),g(t,c),g(e,_),g(e,b),g(b,p),g(p,w),g(b,y),g(b,k);for(let re=0;re<M.length;re+=1)M[re]&&M[re].m(k,null);L||(A=[W(o,"input",l[14]),W(e,"submit",Te(l[10]))],L=!0)},p(X,te){te&32&&n!==(n=X[5].strings.name+"")&&G(i,n),te&512&&a!==(a=X[9]+"-name")&&u(o,"id",a),te&8&&o.value!==X[3]&&ye(o,X[3]),te&256&&O(o,"is-valid",X[8]),te&256&&O(o,"is-invalid",!X[8]),E===(E=R(X))&&H?H.p(X,te):(H.d(1),H=E(X),H&&(H.c(),H.m(d,null))),te&32&&v!==(v=X[5].strings.color+"")&&G(w,v),te&512&&$!==($=X[9]+"-color")&&u(p,"for",$),te&160&&(Q=ce(it),M=je(M,te,le,1,X,Q,N,k,tt,Ft,null,Rt)),te&512&&C!==(C=X[9]+"-color")&&u(k,"id",C)},d(X){X&&S(e),l[13](null),H.d();for(let te=0;te<M.length;te+=1)M[te].d();L=!1,$e(A)}}}function si(l){let e,t;return e=new Oe({props:{title:l[5].strings[l[1]?"editlabel":"newlabel"],cancelText:l[5].strings.cancel,onCancel:l[2],confirmText:l[5].strings[l[1]?"save":"create"],confirmDisabled:!l[8],onConfirm:l[10],$$slots:{default:[ti]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,[n]){const i={};n&34&&(i.title=s[5].strings[s[1]?"editlabel":"newlabel"]),n&32&&(i.cancelText=s[5].strings.cancel),n&4&&(i.onCancel=s[2]),n&34&&(i.confirmText=s[5].strings[s[1]?"save":"create"]),n&256&&(i.confirmDisabled=!s[8]),n&525304&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function li(l,e,t){let s,n,i,r,o,a,f,d=F,m=()=>(d(),d=de(c,M=>t(5,f=M)),c);l.$$.on_destroy.push(()=>d());let{store:c}=e;m();let{label:_=void 0}=e,{onCancel:b}=e,{onSubmit:p}=e,v;const w=async()=>{p(n,i)};et(()=>v.focus());function $(M){Ce[M?"unshift":"push"](()=>{v=M,t(6,v)})}function y(){n=this.value,t(3,n),t(1,_)}const k=M=>{t(7,i=M)};return l.$$set=M=>{"store"in M&&m(t(0,c=M.store)),"label"in M&&t(1,_=M.label),"onCancel"in M&&t(2,b=M.onCancel),"onSubmit"in M&&t(11,p=M.onSubmit)},l.$$.update=()=>{l.$$.dirty&2&&t(9,s=`local-mail-label-modal-${(_==null?void 0:_.id)||"new"}`),l.$$.dirty&2&&t(3,n=(_==null?void 0:_.name)||""),l.$$.dirty&2&&t(7,i=(_==null?void 0:_.color)||it[0]),l.$$.dirty&8&&t(12,r=St(n)==""),l.$$.dirty&42&&t(4,o=f.labels.some(M=>M.id!=(_==null?void 0:_.id)&&M.name==St(n))),l.$$.dirty&4112&&t(8,a=!r&&!o)},[c,_,b,n,o,f,v,i,a,s,w,p,r,$,y,k]}class sn extends oe{constructor(e){super(),fe(this,e,li,si,ae,{store:0,label:1,onCancel:2,onSubmit:11})}}const{Map:ni}=st;function Ut(l,e,t){const s=l.slice();return s[16]=e[t],s}function Gt(l){let e,t=[],s=new ni,n,i,r=ce(l[3].labels);const o=c=>c[16].id;for(let c=0;c<r.length;c+=1){let _=Ut(l,r,c),b=o(_);s.set(b,t[c]=Ht(b,_))}let a=l[3].labels.length>0&&Ot();function f(c,_){return c[6]?ri:ii}let d=f(l),m=d(l);return{c(){e=h("div");for(let c=0;c<t.length;c+=1)t[c].c();n=j(),a&&a.c(),i=j(),m.c(),u(e,"class","dropdown-menu show")},m(c,_){D(c,e,_);for(let b=0;b<t.length;b+=1)t[b]&&t[b].m(e,null);g(e,n),a&&a.m(e,null),g(e,i),m.m(e,null)},p(c,_){_&552&&(r=ce(c[3].labels),t=je(t,_,o,1,c,r,s,e,tt,Ht,n,Ut)),c[3].labels.length>0?a||(a=Ot(),a.c(),a.m(e,i)):a&&(a.d(1),a=null),d===(d=f(c))&&m?m.p(c,_):(m.d(1),m=d(c),m&&(m.c(),m.m(e,null)))},d(c){c&&S(e);for(let _=0;_<t.length;_+=1)t[_].d();a&&a.d(),m.d()}}}function Ht(l,e){let t,s,n,i,r=e[16].name+"",o,a,f;function d(){return e[14](e[16])}return{key:l,first:null,c(){t=h("button"),s=h("i"),i=j(),o=I(r),u(s,"class",n="fa fa-fw "+e[5](e[16].id)),u(t,"type","button"),u(t,"class","dropdown-item local-mail-action-label-button-item"),this.first=t},m(m,c){D(m,t,c),g(t,s),g(t,i),g(t,o),a||(f=W(t,"click",d),a=!0)},p(m,c){e=m,c&40&&n!==(n="fa fa-fw "+e[5](e[16].id))&&u(s,"class",n),c&8&&r!==(r=e[16].name+"")&&G(o,r)},d(m){m&&S(t),a=!1,f()}}}function Ot(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider")},m(t,s){D(t,e,s)},d(t){t&&S(e)}}}function ii(l){let e,t=l[3].strings.newlabel+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,o){D(r,e,o),g(e,s),n||(i=W(e,"click",l[11]),n=!0)},p(r,o){o&8&&t!==(t=r[3].strings.newlabel+"")&&G(s,t)},d(r){r&&S(e),n=!1,i()}}}function ri(l){let e,t=l[3].strings.apply+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,o){D(r,e,o),g(e,s),n||(i=W(e,"click",l[10]),n=!0)},p(r,o){o&8&&t!==(t=r[3].strings.apply+"")&&G(s,t)},d(r){r&&S(e),n=!1,i()}}}function Jt(l){let e,t;return e=new sn({props:{store:l[0],onCancel:l[15],onSubmit:l[12]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[15]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function ai(l){let e,t,s,n,i,r,o,a,f,d,m=l[4]&&Gt(l),c=l[3].params.dialog=="createlabel"&&Jt(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=j(),m&&m.c(),o=j(),c&&c.c(),u(s,"class","fa fa-fw fa-tag"),u(t,"type","button"),u(t,"class","local-mail-action-label-button btn dropdown-toggle"),t.disabled=n=!l[3].selectedMessages.size,u(t,"aria-expanded",l[4]),u(t,"title",i=l[3].strings.labels),O(t,"btn-secondary",!l[1]),O(t,"disabled",!l[3].selectedMessages.size),u(e,"class","btn-group"),u(e,"role","group"),O(e,"dropup",l[2])},m(_,b){D(_,e,b),g(e,t),g(t,s),g(e,r),m&&m.m(e,null),g(e,o),c&&c.m(e,null),a=!0,f||(d=[W(t,"click",l[8]),Se(Ge.call(null,e,l[7]))],f=!0)},p(_,[b]){(!a||b&8&&n!==(n=!_[3].selectedMessages.size))&&(t.disabled=n),(!a||b&16)&&u(t,"aria-expanded",_[4]),(!a||b&8&&i!==(i=_[3].strings.labels))&&u(t,"title",i),(!a||b&2)&&O(t,"btn-secondary",!_[1]),(!a||b&8)&&O(t,"disabled",!_[3].selectedMessages.size),_[4]?m?m.p(_,b):(m=Gt(_),m.c(),m.m(e,o)):m&&(m.d(1),m=null),_[3].params.dialog=="createlabel"?c?(c.p(_,b),b&8&&T(c,1)):(c=Jt(_),c.c(),T(c,1),c.m(e,null)):c&&(ne(),z(c,1,1,()=>{c=null}),ie()),(!a||b&4)&&O(e,"dropup",_[2])},i(_){a||(T(c),a=!0)},o(_){z(c),a=!1},d(_){_&&S(e),m&&m.d(),c&&c.d(),f=!1,$e(d)}}}function oi(l,e,t){let s,n,i,r=F,o=()=>(r(),r=de(a,M=>t(3,i=M)),a);l.$$.on_destroy.push(()=>r());let{store:a}=e;o();let{transparent:f=!1}=e,{dropup:d=!1}=e,m=!1,c=new Map;const _=()=>{t(4,m=!1)},b=()=>{t(4,m=!m)},p=M=>{t(13,c=new Map(Array.from(c.entries()).map(([N,C])=>[N,N==M?C=="true"?"false":"true":C])))},v=()=>{t(4,m=!1),a.setLabels(Array.from(c.keys()).filter(M=>c.get(M)=="true"),Array.from(c.keys()).filter(M=>c.get(M)=="false"))},w=()=>{_(),a.showDialog("createlabel")},$=async(M,N)=>{a.hideDialog();const C=await a.createLabel(M,N);C&&a.setLabels([C],[])},y=M=>p(M.id),k=()=>a.hideDialog();return l.$$set=M=>{"store"in M&&o(t(0,a=M.store)),"transparent"in M&&t(1,f=M.transparent),"dropup"in M&&t(2,d=M.dropup)},l.$$.update=()=>{l.$$.dirty&8&&t(13,c=new Map(i.labels.map(M=>{const N=Array.from(i.selectedMessages.values()).filter(C=>C.labels.some(L=>L.id==M.id));return[M.id,N.length==0?"false":N.length<i.selectedMessages.size?"mixed":"true"]}))),l.$$.dirty&8200&&t(6,s=Array.from(c.entries()).some(([M,N])=>Array.from(i.selectedMessages.values()).some(C=>N=="true"&&C.labels.every(L=>L.id!=M)||N=="false"&&C.labels.some(L=>L.id==M)))),l.$$.dirty&8192&&t(5,n=M=>c.get(M)=="false"?"fa-square-o":c.get(M)=="mixed"?"fa-minus-square-o":"fa-check-square-o")},[a,f,d,i,m,n,s,_,b,p,v,w,$,c,y,k]}class ln extends oe{constructor(e){super(),fe(this,e,oi,ai,ae,{store:0,transparent:1,dropup:2})}}function Kt(l){let e;function t(i,r){return i[8].params.tray=="trash"?ui:fi}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),u(e,"class","dropdown-menu show")},m(i,r){D(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&S(e),n.d()}}}function fi(l){let e,t,s,n,i,r=l[6]&&Vt(l),o=l[7]&&Wt(l),a=l[4]&&Xt(l),f=l[5]&&Yt(l),d=l[3]&&Qt(l);return{c(){r&&r.c(),e=j(),o&&o.c(),t=j(),a&&a.c(),s=j(),f&&f.c(),n=j(),d&&d.c(),i=pe()},m(m,c){r&&r.m(m,c),D(m,e,c),o&&o.m(m,c),D(m,t,c),a&&a.m(m,c),D(m,s,c),f&&f.m(m,c),D(m,n,c),d&&d.m(m,c),D(m,i,c)},p(m,c){m[6]?r?r.p(m,c):(r=Vt(m),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),m[7]?o?o.p(m,c):(o=Wt(m),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),m[4]?a?a.p(m,c):(a=Xt(m),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null),m[5]?f?f.p(m,c):(f=Yt(m),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null),m[3]?d?d.p(m,c):(d=Qt(m),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null)},d(m){m&&(S(e),S(t),S(s),S(n),S(i)),r&&r.d(m),o&&o.d(m),a&&a.d(m),f&&f.d(m),d&&d.d(m)}}}function ui(l){let e,t=l[8].strings.emptytrash+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){D(r,e,o),g(e,s),n||(i=W(e,"click",l[19]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.emptytrash+"")&&G(s,t)},d(r){r&&S(e),n=!1,i()}}}function Vt(l){let e,t=l[8].strings.markasread+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){D(r,e,o),g(e,s),n||(i=W(e,"click",l[22]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.markasread+"")&&G(s,t)},d(r){r&&S(e),n=!1,i()}}}function Wt(l){let e,t=l[8].strings.markasunread+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){D(r,e,o),g(e,s),n||(i=W(e,"click",l[23]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.markasunread+"")&&G(s,t)},d(r){r&&S(e),n=!1,i()}}}function Xt(l){let e,t=l[8].strings.markasstarred+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){D(r,e,o),g(e,s),n||(i=W(e,"click",l[24]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.markasstarred+"")&&G(s,t)},d(r){r&&S(e),n=!1,i()}}}function Yt(l){let e,t=l[8].strings.markasunstarred+"",s,n,i;return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,o){D(r,e,o),g(e,s),n||(i=W(e,"click",l[25]),n=!0)},p(r,o){o&256&&t!==(t=r[8].strings.markasunstarred+"")&&G(s,t)},d(r){r&&S(e),n=!1,i()}}}function Qt(l){let e,t,s=l[8].strings.editlabel+"",n,i,r,o=l[8].strings.deletelabel+"",a,f,d,m=(l[6]||l[7]||l[4]||l[5])&&Zt();return{c(){m&&m.c(),e=j(),t=h("button"),n=I(s),i=j(),r=h("button"),a=I(o),u(t,"type","button"),u(t,"class","dropdown-item"),u(r,"type","button"),u(r,"class","dropdown-item")},m(c,_){m&&m.m(c,_),D(c,e,_),D(c,t,_),g(t,n),D(c,i,_),D(c,r,_),g(r,a),f||(d=[W(t,"click",l[15]),W(r,"click",l[17])],f=!0)},p(c,_){c[6]||c[7]||c[4]||c[5]?m||(m=Zt(),m.c(),m.m(e.parentNode,e)):m&&(m.d(1),m=null),_&256&&s!==(s=c[8].strings.editlabel+"")&&G(n,s),_&256&&o!==(o=c[8].strings.deletelabel+"")&&G(a,o)},d(c){c&&(S(e),S(t),S(i),S(r)),m&&m.d(c),f=!1,$e(d)}}}function Zt(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider")},m(t,s){D(t,e,s)},d(t){t&&S(e)}}}function ci(l){let e,t,s,n;const i=[_i,di],r=[];function o(a,f){return a[8].params.dialog=="editlabel"?0:a[8].params.dialog=="deletelabel"?1:-1}return~(e=o(l))&&(t=r[e]=i[e](l)),{c(){t&&t.c(),s=pe()},m(a,f){~e&&r[e].m(a,f),D(a,s,f),n=!0},p(a,f){let d=e;e=o(a),e===d?~e&&r[e].p(a,f):(t&&(ne(),z(r[d],1,1,()=>{r[d]=null}),ie()),~e?(t=r[e],t?t.p(a,f):(t=r[e]=i[e](a),t.c()),T(t,1),t.m(s.parentNode,s)):t=null)},i(a){n||(T(t),n=!0)},o(a){z(t),n=!1},d(a){a&&S(s),~e&&r[e].d(a)}}}function mi(l){let e,t,s=l[8].params.dialog=="emptytrash"&&xt(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),D(n,e,i),t=!0},p(n,i){n[8].params.dialog=="emptytrash"?s?(s.p(n,i),i&256&&T(s,1)):(s=xt(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&S(e),s&&s.d(n)}}}function di(l){let e,t;return e=new Oe({props:{title:l[8].strings.deletelabel,cancelText:l[8].strings.cancel,confirmText:l[8].strings.deletelabel,confirmClass:"btn-danger",onCancel:l[28],onConfirm:l[18],$$slots:{default:[gi]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&256&&(i.title=s[8].strings.deletelabel),n&256&&(i.cancelText=s[8].strings.cancel),n&256&&(i.confirmText=s[8].strings.deletelabel),n&1&&(i.onCancel=s[28]),n&536871176&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function _i(l){let e,t;return e=new sn({props:{store:l[0],label:l[3],onCancel:l[27],onSubmit:l[16]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.label=s[3]),n&1&&(i.onCancel=s[27]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function gi(l){let e=Ae(l[8].strings.deletelabelconfirm,l[3].name)+"",t;return{c(){t=I(e)},m(s,n){D(s,t,n)},p(s,n){n&264&&e!==(e=Ae(s[8].strings.deletelabelconfirm,s[3].name)+"")&&G(t,e)},d(s){s&&S(t)}}}function xt(l){let e,t;return e=new Oe({props:{title:l[8].strings.emptytrash,cancelText:l[8].strings.cancel,confirmText:l[8].strings.emptytrash,confirmClass:"btn-danger",onCancel:l[26],onConfirm:l[20],$$slots:{default:[pi]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&256&&(i.title=s[8].strings.emptytrash),n&256&&(i.cancelText=s[8].strings.cancel),n&256&&(i.confirmText=s[8].strings.emptytrash),n&1&&(i.onCancel=s[26]),n&536871168&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function pi(l){let e=l[8].strings.emptytrashconfirm+"",t;return{c(){t=I(e)},m(s,n){D(s,t,n)},p(s,n){n&256&&e!==(e=s[8].strings.emptytrashconfirm+"")&&G(t,e)},d(s){s&&S(t)}}}function bi(l){let e,t,s,n,i,r,o,a,f,d,m,c,_=l[9]&&Kt(l);const b=[mi,ci],p=[];function v(w,$){return w[8].params.tray=="trash"?0:w[3]?1:-1}return~(o=v(l))&&(a=p[o]=b[o](l)),{c(){e=h("div"),t=h("button"),s=h("i"),i=j(),_&&_.c(),r=j(),a&&a.c(),f=pe(),u(s,"class","fa fa-fw fa-ellipsis-v"),u(t,"type","button"),u(t,"class","local-mail-action-more-button btn dropdown-toggle"),t.disabled=l[10],u(t,"aria-expanded",l[9]),u(t,"title",n=l[8].strings.more),O(t,"btn-secondary",!l[1]),O(t,"disabled",l[10]),u(e,"class","btn-group"),O(e,"dropup",l[2])},m(w,$){D(w,e,$),g(e,t),g(t,s),g(e,i),_&&_.m(e,null),D(w,r,$),~o&&p[o].m(w,$),D(w,f,$),d=!0,m||(c=[W(t,"click",l[12]),Se(Ge.call(null,e,l[11]))],m=!0)},p(w,[$]){(!d||$&1024)&&(t.disabled=w[10]),(!d||$&512)&&u(t,"aria-expanded",w[9]),(!d||$&256&&n!==(n=w[8].strings.more))&&u(t,"title",n),(!d||$&2)&&O(t,"btn-secondary",!w[1]),(!d||$&1024)&&O(t,"disabled",w[10]),w[9]?_?_.p(w,$):(_=Kt(w),_.c(),_.m(e,null)):_&&(_.d(1),_=null),(!d||$&4)&&O(e,"dropup",w[2]);let y=o;o=v(w),o===y?~o&&p[o].p(w,$):(a&&(ne(),z(p[y],1,1,()=>{p[y]=null}),ie()),~o?(a=p[o],a?a.p(w,$):(a=p[o]=b[o](w),a.c()),T(a,1),a.m(f.parentNode,f)):a=null)},i(w){d||(T(a),d=!0)},o(w){z(a),d=!1},d(w){w&&(S(e),S(r),S(f)),_&&_.d(),~o&&p[o].d(w),m=!1,$e(c)}}}function hi(l,e,t){let s,n,i,r,o,a,f,d,m=F,c=()=>(m(),m=de(_,x=>t(8,d=x)),_);l.$$.on_destroy.push(()=>m());let{store:_}=e;c();let{transparent:b=!1}=e,{dropup:p=!1}=e,v=!1;const w=()=>{t(9,v=!1)},$=()=>{t(9,v=!v)},y=x=>{w(),_.setUnread(n.filter(Z=>!Z.draft).map(Z=>Z.id),x)},k=x=>{w(),_.setStarred(n.map(Z=>Z.id),x)},M=()=>{w(),_.showDialog("editlabel")},N=(x,Z)=>{_.hideDialog(),s&&_.updateLabel(s.id,x,Z)},C=()=>{w(),_.showDialog("deletelabel")},L=()=>{_.hideDialog(),_.deleteLabel(d.params.labelid||0)},A=()=>{w(),_.showDialog("emptytrash")},R=()=>{_.hideDialog(),_.emptyTrash(d.params.courseid)},E=()=>y(!1),H=()=>y(!0),Q=()=>k(!0),le=()=>k(!1),X=()=>_.hideDialog(),te=()=>_.hideDialog(),re=()=>_.hideDialog();return l.$$set=x=>{"store"in x&&c(t(0,_=x.store)),"transparent"in x&&t(1,b=x.transparent),"dropup"in x&&t(2,p=x.dropup)},l.$$.update=()=>{l.$$.dirty&256&&t(3,s=d.params.tray=="label"&&d.message==null?d.labels.find(x=>x.id==d.params.labelid):null),l.$$.dirty&256&&t(21,n=Array.from(d.selectedMessages.values())),l.$$.dirty&2097152&&t(7,i=n.some(x=>!x.draft&&!x.unread)),l.$$.dirty&2097152&&t(6,r=n.some(x=>!x.draft&&x.unread)),l.$$.dirty&2097152&&t(5,o=n.some(x=>x.starred)),l.$$.dirty&2097152&&t(4,a=n.some(x=>!x.starred)),l.$$.dirty&504&&t(10,f=d.params.tray=="trash"?!d.totalCount:!s&&!i&&!r&&!o&&!a)},[_,b,p,s,a,o,r,i,d,v,f,w,$,y,k,M,N,C,L,A,R,n,E,H,Q,le,X,te,re]}class nn extends oe{constructor(e){super(),fe(this,e,hi,bi,ae,{store:0,transparent:1,dropup:2})}}function es(l){let e,t;return{c(){e=h("div"),t=I(l[4]),u(e,"class","align-self-center text-nowrap")},m(s,n){D(s,e,n),g(e,t)},p(s,n){n&16&&G(t,s[4])},d(s){s&&S(e)}}}function ts(l){let e,t;return{c(){e=h("div"),t=I(l[4]),u(e,"class","text-truncate align-self-center mx-2")},m(s,n){D(s,e,n),g(e,t)},p(s,n){n&16&&G(t,s[4])},d(s){s&&S(e)}}}function ki(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,$=!l[2]&&es(l),y=l[2]&&ts(l);return{c(){e=h("div"),$&&$.c(),t=j(),s=h("div"),n=h("button"),i=h("i"),f=j(),y&&y.c(),d=j(),m=h("button"),c=h("i"),u(i,"class","fa fa-w fa-chevron-left"),u(i,"aria-label",r=l[3].strings.previouspage),u(n,"type","button"),u(n,"class","btn btn-secondary"),n.disabled=o=!l[5],u(n,"title",a=l[3].strings[l[3].message?"previousmessage":"previouspage"]),O(n,"btn-secondary",!l[1]),u(c,"class","fa fa-w fa-chevron-right"),u(c,"aria-label",_=l[3].strings.nextpage),u(m,"type","button"),u(m,"class","btn"),m.disabled=b=!l[6],u(m,"title",p=l[3].strings[l[3].message?"nextmessage":"nextpage"]),O(m,"btn-secondary",!l[1]),u(s,"class","btn-group d-flex"),u(s,"role","group"),O(s,"btn-group",!l[2]),u(e,"class","local-mail-paging-buttons d-flex"),O(e,"ml-auto",!l[2])},m(k,M){D(k,e,M),$&&$.m(e,null),g(e,t),g(e,s),g(s,n),g(n,i),g(s,f),y&&y.m(s,null),g(s,d),g(s,m),g(m,c),v||(w=[W(n,"click",Te(l[9])),W(m,"click",Te(l[10]))],v=!0)},p(k,[M]){k[2]?$&&($.d(1),$=null):$?$.p(k,M):($=es(k),$.c(),$.m(e,t)),M&8&&r!==(r=k[3].strings.previouspage)&&u(i,"aria-label",r),M&32&&o!==(o=!k[5])&&(n.disabled=o),M&8&&a!==(a=k[3].strings[k[3].message?"previousmessage":"previouspage"])&&u(n,"title",a),M&2&&O(n,"btn-secondary",!k[1]),k[2]?y?y.p(k,M):(y=ts(k),y.c(),y.m(s,d)):y&&(y.d(1),y=null),M&8&&_!==(_=k[3].strings.nextpage)&&u(c,"aria-label",_),M&64&&b!==(b=!k[6])&&(m.disabled=b),M&8&&p!==(p=k[3].strings[k[3].message?"nextmessage":"nextpage"])&&u(m,"title",p),M&2&&O(m,"btn-secondary",!k[1]),M&4&&O(s,"btn-group",!k[2]),M&4&&O(e,"ml-auto",!k[2])},i:F,o:F,d(k){k&&S(e),$&&$.d(),y&&y.d(),v=!1,$e(w)}}}function vi(l,e,t){let s,n,i,r,o,a,f=F,d=()=>(f(),f=de(m,v=>t(3,a=v)),m);l.$$.on_destroy.push(()=>f());let{store:m}=e;d();let{transparent:c=!1}=e,{compact:_=!1}=e;const b=()=>m.navigate(r),p=()=>m.navigate(i);return l.$$set=v=>{"store"in v&&d(t(0,m=v.store)),"transparent"in v&&t(1,c=v.transparent),"compact"in v&&t(2,_=v.compact)},l.$$.update=()=>{var v;l.$$.dirty&8&&t(8,s=a.nextMessageId||!a.params.search&&(a.params.offset||0)+a.preferences.perpage<a.totalCount),l.$$.dirty&8&&t(7,n=a.prevMessageId||!a.params.search&&(a.params.offset||0)),l.$$.dirty&264&&t(6,i=s?a.message?{...a.params,messageid:a.nextMessageId,offset:(a.params.offset||0)+1}:{...a.params,messageid:void 0,offset:(a.params.offset||0)+a.preferences.perpage,search:a.params.search?{...a.params.search,startid:(v=a.listMessages[a.listMessages.length-1])==null?void 0:v.id,reverse:!1}:void 0}:void 0),l.$$.dirty&136&&t(5,r=n?a.message?{...a.params,messageid:a.prevMessageId,offset:Math.max(0,(a.params.offset||0)-1)}:{...a.params,messageid:void 0,offset:Math.max(0,(a.params.offset||0)-a.preferences.perpage),search:a.params.search?{...a.params.search,startid:a.listMessages[0].id,reverse:!0}:void 0}:void 0),l.$$.dirty&8&&t(4,o=a.message?a.params.search?(a.params.offset||0)+1:Ae(a.strings.pagingsingle,{index:(a.messageOffset||0)+1,total:a.totalCount}):a.listMessages.length==0?"":a.params.search?Ae(a.strings.pagingrange,{first:(a.params.offset||0)+1,last:(a.params.offset||0)+a.listMessages.length}):Ae(a.strings.pagingrangetotal,{first:(a.params.offset||0)+1,last:(a.params.offset||0)+a.listMessages.length,total:a.totalCount}))},[m,c,_,a,o,r,i,n,s,b,p]}class rn extends oe{constructor(e){super(),fe(this,e,vi,ki,ae,{store:0,transparent:1,compact:2})}}function ss(l){let e,t;return e=new Oe({props:{title:l[2].strings.restore,cancelText:l[2].strings.cancel,confirmText:l[2].strings.restore,onCancel:l[5],onConfirm:l[3],$$slots:{default:[wi]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.restore),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.restore),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function wi(l){let e=l[2].strings.restoremessageconfirm+"",t;return{c(){t=I(e)},m(s,n){D(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings.restoremessageconfirm+"")&&G(t,e)},d(s){s&&S(t)}}}function $i(l){let e,t,s,n,i,r,o,a,f,d=l[2].params.dialog=="restore"&&ss(l);return{c(){e=h("button"),t=h("i"),i=j(),d&&d.c(),r=pe(),u(t,"class","fa fa-fw fa-undo"),u(e,"type","button"),u(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.restore),O(e,"btn-secondary",!l[1]),O(e,"disabled",!l[2].selectedMessages.size)},m(m,c){D(m,e,c),g(e,t),D(m,i,c),d&&d.m(m,c),D(m,r,c),o=!0,a||(f=W(e,"click",l[4]),a=!0)},p(m,[c]){(!o||c&4&&s!==(s=!m[2].selectedMessages.size))&&(e.disabled=s),(!o||c&4&&n!==(n=m[2].strings.restore))&&u(e,"title",n),(!o||c&2)&&O(e,"btn-secondary",!m[1]),(!o||c&4)&&O(e,"disabled",!m[2].selectedMessages.size),m[2].params.dialog=="restore"?d?(d.p(m,c),c&4&&T(d,1)):(d=ss(m),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(ne(),z(d,1,1,()=>{d=null}),ie())},i(m){o||(T(d),o=!0)},o(m){z(d),o=!1},d(m){m&&(S(e),S(i),S(r)),d&&d.d(m),a=!1,f()}}}function yi(l,e,t){let s,n=F,i=()=>(n(),n=de(r,m=>t(2,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:o=!1}=e;const a=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Fe.NotDeleted,!0)},f=()=>r.showDialog("restore"),d=()=>r.hideDialog();return l.$$set=m=>{"store"in m&&i(t(0,r=m.store)),"transparent"in m&&t(1,o=m.transparent)},[r,o,s,a,f,d]}class an extends oe{constructor(e){super(),fe(this,e,yi,$i,ae,{store:0,transparent:1})}}function Mi(l){let e,t,s,n;return e=new ln({props:{store:l[0],transparent:!0,dropup:!0}}),s=new en({props:{store:l[0],transparent:!0}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){K(e,i,r),D(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&S(t),V(e,i),V(s,i)}}}function Ci(l){let e,t,s,n;return e=new an({props:{store:l[0],transparent:!0}}),s=new tn({props:{store:l[0],transparent:!0}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){K(e,i,r),D(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&S(t),V(e,i),V(s,i)}}}function Di(l){let e,t,s,n,i,r,o,a,f,d,m;const c=[Ci,Mi],_=[];function b(p,v){return p[4].params.tray=="trash"?0:1}return n=b(l),i=_[n]=c[n](l),o=new nn({props:{store:l[0],transparent:!0,dropup:!0}}),f=new rn({props:{store:l[0],transparent:!0,compact:!0}}),{c(){e=h("div"),t=h("div"),s=h("div"),i.c(),r=j(),J(o.$$.fragment),a=j(),J(f.$$.fragment),u(s,"class","w-100 d-flex justify-content-around"),u(s,"role","group"),u(t,"role","toolbar"),u(t,"class","local-mail-toolbar d-flex w-100 py-3 border-top svelte-hn1exj"),ze(()=>l[5].call(t)),O(t,"position-fixed",l[3]),O(t,"position-absolute",!l[3]),O(t,"fixed-bottom",l[3]),O(t,"border-bottom",!l[3]),O(t,"bg-white",!l[3]),O(t,"bg-light",l[3]),u(e,"class","row position-relative"),ge(e,"height",l[1]+"px")},m(p,v){D(p,e,v),g(e,t),g(t,s),_[n].m(s,null),g(s,r),K(o,s,null),g(s,a),K(f,s,null),d=Tn(t,l[5].bind(t)),l[6](e),m=!0},p(p,[v]){let w=n;n=b(p),n===w?_[n].p(p,v):(ne(),z(_[w],1,1,()=>{_[w]=null}),ie(),i=_[n],i?i.p(p,v):(i=_[n]=c[n](p),i.c()),T(i,1),i.m(s,r));const $={};v&1&&($.store=p[0]),o.$set($);const y={};v&1&&(y.store=p[0]),f.$set(y),(!m||v&8)&&O(t,"position-fixed",p[3]),(!m||v&8)&&O(t,"position-absolute",!p[3]),(!m||v&8)&&O(t,"fixed-bottom",p[3]),(!m||v&8)&&O(t,"border-bottom",!p[3]),(!m||v&8)&&O(t,"bg-white",!p[3]),(!m||v&8)&&O(t,"bg-light",p[3]),(!m||v&2)&&ge(e,"height",p[1]+"px")},i(p){m||(T(i),T(o.$$.fragment,p),T(f.$$.fragment,p),m=!0)},o(p){z(i),z(o.$$.fragment,p),z(f.$$.fragment,p),m=!1},d(p){p&&S(e),_[n].d(),V(o),V(f),d(),l[6](null)}}}function Si(l,e,t){let s,n=F,i=()=>(n(),n=de(r,c=>t(4,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let o,a,f=!1;et(()=>{const c=new IntersectionObserver(_=>{for(const b of _)t(3,f=b.intersectionRatio<1&&b.boundingClientRect.top>=b.boundingClientRect.height)},{threshold:1});return c.observe(a),()=>c.disconnect()});function d(){o=this.offsetHeight,t(1,o)}function m(c){Ce[c?"unshift":"push"](()=>{a=c,t(2,a)})}return l.$$set=c=>{"store"in c&&i(t(0,r=c.store))},[r,o,a,f,s,d,m]}class Ti extends oe{constructor(e){super(),fe(this,e,Si,Di,ae,{store:0})}}function on(l,{from:e,to:t},s={}){const n=getComputedStyle(l),i=n.transform==="none"?"":n.transform,[r,o]=n.transformOrigin.split(" ").map(parseFloat),a=e.left+e.width*r/t.width-(t.left+r),f=e.top+e.height*o/t.height-(t.top+o),{delay:d=0,duration:m=_=>Math.sqrt(_)*120,easing:c=xl}=s;return{delay:d,duration:De(m)?m(Math.sqrt(a*a+f*f)):m,easing:c,css:(_,b)=>{const p=b*a,v=b*f,w=_+b*e.width/t.width,$=_+b*e.height/t.height;return`transform: ${i} translate(${p}px, ${v}px) scale(${w}, ${$});`}}}function ji(l){let e,t,s,n,i,r,o;return{c(){e=h("button"),t=h("i"),u(t,"class",s="fa align-middle "+l[3]),u(e,"type","button"),u(e,"class","btn px-2"),u(e,"role","checkbox"),u(e,"aria-checked",n=!!l[2].selectedMessages.has(l[1].id)),u(e,"title",i=l[2].strings.select)},m(a,f){D(a,e,f),g(e,t),r||(o=W(e,"click",Ol(Te(l[4]))),r=!0)},p(a,[f]){f&8&&s!==(s="fa align-middle "+a[3])&&u(t,"class",s),f&6&&n!==(n=!!a[2].selectedMessages.has(a[1].id))&&u(e,"aria-checked",n),f&4&&i!==(i=a[2].strings.select)&&u(e,"title",i)},i:F,o:F,d(a){a&&S(e),r=!1,o()}}}function Li(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,d=>t(2,n=d)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;const f=()=>o.toggleSelected(a.id);return l.$$set=d=>{"store"in d&&r(t(0,o=d.store)),"message"in d&&t(1,a=d.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=n.selectedMessages.has(a.id)?"fa-check-square-o":"fa-square-o")},[o,a,n,s,f]}class fn extends oe{constructor(e){super(),fe(this,e,Li,ji,ae,{store:0,message:1})}}function zi(l){let e,t,s,n,i,r,o,a;return{c(){e=h("button"),t=h("i"),u(t,"class",s="fa "+l[2]),u(e,"type","button"),u(e,"class","btn px-2"),u(e,"role","checkbox"),u(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,u(e,"title",r=l[1].deleted?l[3].strings[l[1].starred?"starred":"unstarred"]:l[3].strings[l[1].starred?"markasunstarred":"markasstarred"])},m(f,d){D(f,e,d),g(e,t),o||(a=W(e,"click",Ol(Te(l[4]))),o=!0)},p(f,[d]){d&4&&s!==(s="fa "+f[2])&&u(t,"class",s),d&2&&n!==(n=f[1].starred)&&u(e,"aria-checked",n),d&2&&i!==(i=f[1].deleted)&&(e.disabled=i),d&10&&r!==(r=f[1].deleted?f[3].strings[f[1].starred?"starred":"unstarred"]:f[3].strings[f[1].starred?"markasunstarred":"markasstarred"])&&u(e,"title",r)},i:F,o:F,d(f){f&&S(e),o=!1,a()}}}function Ni(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,d=>t(3,n=d)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;const f=()=>o.setStarred([a.id],!a.starred);return l.$$set=d=>{"store"in d&&r(t(0,o=d.store)),"message"in d&&t(1,a=d.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=a.starred?"fa-star text-warning":"fa-star-o")},[o,a,s,n,f]}class un extends oe{constructor(e){super(),fe(this,e,Ni,zi,ae,{store:0,message:1})}}function Ai(l){let e,t=l[1].join(", ")+"",s,n,i,r;return{c(){e=h("div"),s=I(t)},m(o,a){D(o,e,a),g(e,s),i||(r=Se(n=Ue.call(null,e,l[1].join(`
`))),i=!0)},p(o,[a]){a&2&&t!==(t=o[1].join(", ")+"")&&G(s,t),n&&De(n.update)&&a&2&&n.update.call(null,o[1].join(`
`))},i:F,o:F,d(o){o&&S(e),i=!1,r()}}}function qi(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,f=>t(3,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;return l.$$set=f=>{"store"in f&&r(t(0,o=f.store)),"message"in f&&t(2,a=f.message)},l.$$.update=()=>{l.$$.dirty&12&&t(1,s=n.params.tray=="sent"||n.params.tray=="drafts"?a.recipients.length>0?a.recipients.map(f=>f.fullname):[n.strings.norecipient]:[a.sender.fullname])},[o,s,a,n]}class pt extends oe{constructor(e){super(),fe(this,e,qi,Ai,ae,{store:0,message:2})}}function ls(l){let e,t=l[2].strings.draft+"",s;return{c(){e=h("span"),s=I(t),u(e,"class","mr-2 text-danger")},m(n,i){D(n,e,i),g(e,s)},p(n,i){i&4&&t!==(t=n[2].strings.draft+"")&&G(s,t)},d(n){n&&S(e)}}}function Bi(l){let e,t,s=(l[1].subject||l[2].strings.nosubject)+"",n,i,r,o,a=l[1].draft&&ls(l);return{c(){e=h("div"),a&&a.c(),t=j(),n=I(s)},m(f,d){D(f,e,d),a&&a.m(e,null),g(e,t),g(e,n),r||(o=Se(i=Ue.call(null,e,l[1].subject||l[2].strings.nosubject)),r=!0)},p(f,[d]){f[1].draft?a?a.p(f,d):(a=ls(f),a.c(),a.m(e,t)):a&&(a.d(1),a=null),d&6&&s!==(s=(f[1].subject||f[2].strings.nosubject)+"")&&G(n,s),i&&De(i.update)&&d&6&&i.update.call(null,f[1].subject||f[2].strings.nosubject)},i:F,o:F,d(f){f&&S(e),a&&a.d(),r=!1,o()}}}function Ii(l,e,t){let s,n=F,i=()=>(n(),n=de(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class bt extends oe{constructor(e){super(),fe(this,e,Ii,Bi,ae,{store:0,message:1})}}function ns(l){let e,t,s,n,i;return{c(){e=h("span"),t=I(l[2]),u(e,"class","local-mail-course-badge badge px-2 mr-2 mb-2"),ge(e,"min-width","3rem"),ge(e,"max-width","calc("+l[1]+"ch + 1.5rem)")},m(r,o){D(r,e,o),g(e,t),n||(i=Se(s=Ue.call(null,e,l[2])),n=!0)},p(r,o){o&4&&G(t,r[2]),o&2&&ge(e,"max-width","calc("+r[1]+"ch + 1.5rem)"),s&&De(s.update)&&o&4&&s.update.call(null,r[2])},d(r){r&&S(e),n=!1,i()}}}function Ei(l){let e=["shortname","fullname"].includes(l[0].coursebadges),t,s=e&&ns(l);return{c(){s&&s.c(),t=pe()},m(n,i){s&&s.m(n,i),D(n,t,i)},p(n,[i]){i&1&&(e=["shortname","fullname"].includes(n[0].coursebadges)),e?s?s.p(n,i):(s=ns(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:F,o:F,d(n){n&&S(t),s&&s.d(n)}}}function Pi(l,e,t){let s,n,{course:i}=e,{settings:r}=e;return l.$$set=o=>{"course"in o&&t(3,i=o.course),"settings"in o&&t(0,r=o.settings)},l.$$.update=()=>{l.$$.dirty&9&&t(2,s=Ye(i,r.coursebadges)),l.$$.dirty&1&&t(1,n=r.coursebadgeslength||20)},[r,n,s,i]}class ht extends oe{constructor(e){super(),fe(this,e,Pi,Ei,ae,{course:3,settings:0})}}function Ri(l){let e,t=l[0].name+"",s,n;return{c(){e=h("span"),s=I(t),u(e,"class","local-mail-label-badge badge flex-shrink-0 px-2 mr-2 mb-2"),u(e,"style",n=`color: var(--local-mail-color-${l[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${l[1]}-bg, var(--local-mail-color-gray-bg))`)},m(i,r){D(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].name+"")&&G(s,t),r&2&&n!==(n=`color: var(--local-mail-color-${i[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${i[1]}-bg, var(--local-mail-color-gray-bg))`)&&u(e,"style",n)},i:F,o:F,d(i){i&&S(e)}}}function Fi(l,e,t){let s,{label:n}=e;return l.$$set=i=>{"label"in i&&t(0,n=i.label)},l.$$.update=()=>{l.$$.dirty&1&&t(1,s=it.includes(n.color)?n.color:"gray")},[n,s]}class kt extends oe{constructor(e){super(),fe(this,e,Fi,Ri,ae,{label:0})}}function is(l,e,t){const s=l.slice();return s[3]=e[t],s}function rs(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&as(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),D(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&T(s,1)):(s=as(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&S(e),s&&s.d(n)}}}function as(l){let e,t;return e=new ht({props:{course:l[1].course,settings:l[2].settings}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function os(l){let e,t;return e=new kt({props:{label:l[3]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.label=s[3]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function fs(l,e){let t,s,n,i=(e[2].params.tray!="label"||e[2].params.labelid!=e[3].id)&&os(e);return{key:l,first:null,c(){t=pe(),i&&i.c(),s=pe(),this.first=t},m(r,o){D(r,t,o),i&&i.m(r,o),D(r,s,o),n=!0},p(r,o){e=r,e[2].params.tray!="label"||e[2].params.labelid!=e[3].id?i?(i.p(e,o),o&6&&T(i,1)):(i=os(e),i.c(),T(i,1),i.m(s.parentNode,s)):i&&(ne(),z(i,1,1,()=>{i=null}),ie())},i(r){n||(T(i),n=!0)},o(r){z(i),n=!1},d(r){r&&(S(t),S(s)),i&&i.d(r)}}}function us(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&cs(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),D(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&T(s,1)):(s=cs(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&S(e),s&&s.d(n)}}}function cs(l){let e,t;return e=new ht({props:{course:l[1].course,settings:l[2].settings}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Ui(l){let e,t=[],s=new Map,n,i,r,o=l[2].viewportSize<me.MD&&rs(l),a=ce(l[1].labels);const f=m=>m[3].id;for(let m=0;m<a.length;m+=1){let c=is(l,a,m),_=f(c);s.set(_,t[m]=fs(_,c))}let d=l[2].viewportSize>=me.MD&&us(l);return{c(){o&&o.c(),e=j();for(let m=0;m<t.length;m+=1)t[m].c();n=j(),d&&d.c(),i=pe()},m(m,c){o&&o.m(m,c),D(m,e,c);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(m,c);D(m,n,c),d&&d.m(m,c),D(m,i,c),r=!0},p(m,[c]){m[2].viewportSize<me.MD?o?(o.p(m,c),c&4&&T(o,1)):(o=rs(m),o.c(),T(o,1),o.m(e.parentNode,e)):o&&(ne(),z(o,1,1,()=>{o=null}),ie()),c&6&&(a=ce(m[1].labels),ne(),t=je(t,c,f,1,m,a,s,n.parentNode,He,fs,n,is),ie()),m[2].viewportSize>=me.MD?d?(d.p(m,c),c&4&&T(d,1)):(d=us(m),d.c(),T(d,1),d.m(i.parentNode,i)):d&&(ne(),z(d,1,1,()=>{d=null}),ie())},i(m){if(!r){T(o);for(let c=0;c<a.length;c+=1)T(t[c]);T(d),r=!0}},o(m){z(o);for(let c=0;c<t.length;c+=1)z(t[c]);z(d),r=!1},d(m){m&&(S(e),S(n),S(i)),o&&o.d(m);for(let c=0;c<t.length;c+=1)t[c].d(m);d&&d.d(m)}}}function Gi(l,e,t){let s,n=F,i=()=>(n(),n=de(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class cn extends oe{constructor(e){super(),fe(this,e,Gi,Ui,ae,{store:0,message:1})}}function ms(l){let e,t,s,n,i;return{c(){e=h("span"),t=h("i"),u(t,"class",s="fa fa-fw "+(l[1].numattachments>0?"fa-paperclip":"")),u(t,"aria-hidden",!0),u(e,"class","-shrink-0 mr-2"),u(e,"aria-hidden",n=l[1].numattachments==0),u(e,"title",i=l[1].numattachments>0?l[2].strings.hasattachments:void 0)},m(r,o){D(r,e,o),g(e,t)},p(r,o){o&2&&s!==(s="fa fa-fw "+(r[1].numattachments>0?"fa-paperclip":""))&&u(t,"class",s),o&2&&n!==(n=r[1].numattachments==0)&&u(e,"aria-hidden",n),o&6&&i!==(i=r[1].numattachments>0?r[2].strings.hasattachments:void 0)&&u(e,"title",i)},d(r){r&&S(e)}}}function Hi(l){let e,t=(l[1].numattachments>0||l[2].viewportSize>=me.MD)&&ms(l);return{c(){t&&t.c(),e=pe()},m(s,n){t&&t.m(s,n),D(s,e,n)},p(s,[n]){s[1].numattachments>0||s[2].viewportSize>=me.MD?t?t.p(s,n):(t=ms(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:F,o:F,d(s){s&&S(e),t&&t.d(s)}}}function Oi(l,e,t){let s,n=F,i=()=>(n(),n=de(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class mn extends oe{constructor(e){super(),fe(this,e,Oi,Hi,ae,{store:0,message:1})}}function Ji(l){let e,t=l[0].shorttime+"",s,n;return{c(){e=h("span"),s=I(t),u(e,"class","local-mail-list-message-time d-shrink-0 text-nowrap text-right"),u(e,"title",n=l[0].fulltime),O(e,"local-mail-list-message-time-md",l[2].viewportSize>=me.MD)},m(i,r){D(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].shorttime+"")&&G(s,t),r&1&&n!==(n=i[0].fulltime)&&u(e,"title",n),r&4&&O(e,"local-mail-list-message-time-md",i[2].viewportSize>=me.MD)},i:F,o:F,d(i){i&&S(e)}}}function Ki(l,e,t){let s,n=F,i=()=>(n(),n=de(o,a=>t(2,s=a)),o);l.$$.on_destroy.push(()=>n());let{message:r}=e,{store:o}=e;return i(),l.$$set=a=>{"message"in a&&t(0,r=a.message),"store"in a&&i(t(1,o=a.store))},[r,o,s]}class dn extends oe{constructor(e){super(),fe(this,e,Ki,Ji,ae,{message:0,store:1})}}function ds(l){let e,t,s=l[1].strings.nomessagesfound+"",n,i,r,o=l[1].totalCount>0&&_s(l);return{c(){e=h("div"),t=h("div"),n=I(s),i=j(),o&&o.c(),u(e,"class","alert alert-info")},m(a,f){D(a,e,f),g(e,t),g(t,n),g(e,i),o&&o.m(e,null)},p(a,f){f&2&&s!==(s=a[1].strings.nomessagesfound+"")&&G(n,s),a[1].totalCount>0?o?o.p(a,f):(o=_s(a),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(a){a&&(r||ze(()=>{r=_t(e,Be,{delay:400}),r.start()}))},o:F,d(a){a&&S(e),o&&o.d()}}}function _s(l){let e,t=l[1].strings.showrecentmessages+"",s,n,i,r;return{c(){e=h("a"),s=I(t),u(e,"class","btn btn-info text-white mt-3"),u(e,"href",n=Pe(l[2]))},m(o,a){D(o,e,a),g(e,s),i||(r=W(e,"click",Te(l[3])),i=!0)},p(o,a){a&2&&t!==(t=o[1].strings.showrecentmessages+"")&&G(s,t),a&4&&n!==(n=Pe(o[2]))&&u(e,"href",n)},d(o){o&&S(e),i=!1,r()}}}function Vi(l){let e,t=!l[1].listMessages.length&&ds(l);return{c(){t&&t.c(),e=pe()},m(s,n){t&&t.m(s,n),D(s,e,n)},p(s,[n]){s[1].listMessages.length?t&&(t.d(1),t=null):t?(t.p(s,n),n&2&&T(t,1)):(t=ds(s),t.c(),T(t,1),t.m(e.parentNode,e))},i(s){T(t)},o:F,d(s){s&&S(e),t&&t.d(s)}}}function Wi(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,f=>t(1,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();const a=()=>o.navigate(s);return l.$$set=f=>{"store"in f&&r(t(0,o=f.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s={tray:n.params.tray,courseid:n.params.courseid,labelid:n.params.labelid})},[o,n,s,a]}class Xi extends oe{constructor(e){super(),fe(this,e,Wi,Vi,ae,{store:0})}}function gs(l,e,t){const s=l.slice();return s[4]=e[t],s[6]=t,s}function Yi(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,$,y,k,M;return t=new fn({props:{store:l[0],message:l[4]}}),r=new pt({props:{store:l[0],message:l[4]}}),a=new mn({props:{store:l[0],message:l[4]}}),m=new dn({props:{store:l[0],message:l[4]}}),p=new bt({props:{store:l[0],message:l[4]}}),w=new un({props:{store:l[0],message:l[4]}}),k=new cn({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),J(t.$$.fragment),s=j(),n=h("div"),i=h("div"),J(r.$$.fragment),o=j(),J(a.$$.fragment),f=j(),d=h("div"),J(m.$$.fragment),c=j(),_=h("div"),b=h("div"),J(p.$$.fragment),v=j(),J(w.$$.fragment),$=j(),y=h("div"),J(k.$$.fragment),u(d,"class","ml-auto mr-2"),u(i,"class","d-flex mt-2"),u(b,"class","d-flex w-100 my-2 mr-2"),ge(b,"min-width","0"),u(_,"class","d-flex"),u(y,"class","d-flex flex-wrap ml-n2 mr-2"),u(n,"class","w-100 ml-1"),ge(n,"min-width","0"),u(e,"class","d-flex align-items-start pt-1 pb-2 pl-1 pr-2")},m(N,C){D(N,e,C),K(t,e,null),g(e,s),g(e,n),g(n,i),K(r,i,null),g(i,o),K(a,i,null),g(i,f),g(i,d),K(m,d,null),g(n,c),g(n,_),g(_,b),K(p,b,null),g(_,v),K(w,_,null),g(n,$),g(n,y),K(k,y,null),M=!0},p(N,C){const L={};C&1&&(L.store=N[0]),C&2&&(L.message=N[4]),t.$set(L);const A={};C&1&&(A.store=N[0]),C&2&&(A.message=N[4]),r.$set(A);const R={};C&1&&(R.store=N[0]),C&2&&(R.message=N[4]),a.$set(R);const E={};C&1&&(E.store=N[0]),C&2&&(E.message=N[4]),m.$set(E);const H={};C&1&&(H.store=N[0]),C&2&&(H.message=N[4]),p.$set(H);const Q={};C&1&&(Q.store=N[0]),C&2&&(Q.message=N[4]),w.$set(Q);const le={};C&1&&(le.store=N[0]),C&2&&(le.message=N[4]),k.$set(le)},i(N){M||(T(t.$$.fragment,N),T(r.$$.fragment,N),T(a.$$.fragment,N),T(m.$$.fragment,N),T(p.$$.fragment,N),T(w.$$.fragment,N),T(k.$$.fragment,N),M=!0)},o(N){z(t.$$.fragment,N),z(r.$$.fragment,N),z(a.$$.fragment,N),z(m.$$.fragment,N),z(p.$$.fragment,N),z(w.$$.fragment,N),z(k.$$.fragment,N),M=!1},d(N){N&&S(e),V(t),V(r),V(a),V(m),V(p),V(w),V(k)}}}function Qi(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,$,y;return t=new fn({props:{store:l[0],message:l[4]}}),n=new un({props:{store:l[0],message:l[4]}}),a=new pt({props:{store:l[0],message:l[4]}}),m=new bt({props:{store:l[0],message:l[4]}}),b=new cn({props:{store:l[0],message:l[4]}}),v=new mn({props:{store:l[0],message:l[4]}}),$=new dn({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),J(t.$$.fragment),s=j(),J(n.$$.fragment),i=j(),r=h("div"),o=h("div"),J(a.$$.fragment),f=j(),d=h("div"),J(m.$$.fragment),c=j(),_=h("div"),J(b.$$.fragment),p=j(),J(v.$$.fragment),w=j(),J($.$$.fragment),u(o,"class","flex-grow-1 mx-2"),ge(o,"width","25%"),ge(o,"min-width","0"),u(_,"class","d-flex text-truncate flex-shrink-0 justify-content-end mb-n2 ml-auto"),ge(_,"max-width","80%"),u(d,"class","flex-grow-1 d-flex my-2 mx-2"),ge(d,"width","75%"),ge(d,"min-width","0"),u(r,"class","d-flex w-100 flex-grow-1 align-items-center"),ge(r,"min-width","0"),u(e,"class","d-flex align-items-center pl-1 pr-3")},m(k,M){D(k,e,M),K(t,e,null),g(e,s),K(n,e,null),g(e,i),g(e,r),g(r,o),K(a,o,null),g(r,f),g(r,d),K(m,d,null),g(d,c),g(d,_),K(b,_,null),g(e,p),K(v,e,null),g(e,w),K($,e,null),y=!0},p(k,M){const N={};M&1&&(N.store=k[0]),M&2&&(N.message=k[4]),t.$set(N);const C={};M&1&&(C.store=k[0]),M&2&&(C.message=k[4]),n.$set(C);const L={};M&1&&(L.store=k[0]),M&2&&(L.message=k[4]),a.$set(L);const A={};M&1&&(A.store=k[0]),M&2&&(A.message=k[4]),m.$set(A);const R={};M&1&&(R.store=k[0]),M&2&&(R.message=k[4]),b.$set(R);const E={};M&1&&(E.store=k[0]),M&2&&(E.message=k[4]),v.$set(E);const H={};M&1&&(H.store=k[0]),M&2&&(H.message=k[4]),$.$set(H)},i(k){y||(T(t.$$.fragment,k),T(n.$$.fragment,k),T(a.$$.fragment,k),T(m.$$.fragment,k),T(b.$$.fragment,k),T(v.$$.fragment,k),T($.$$.fragment,k),y=!0)},o(k){z(t.$$.fragment,k),z(n.$$.fragment,k),z(a.$$.fragment,k),z(m.$$.fragment,k),z(b.$$.fragment,k),z(v.$$.fragment,k),z($.$$.fragment,k),y=!1},d(k){k&&S(e),V(t),V(n),V(a),V(m),V(b),V(v),V($)}}}function ps(l,e){let t,s,n,i,r,o,a,f=F,d,m,c;const _=[Qi,Yi],b=[];function p(w,$){return w[1].viewportSize>=me.MD?0:1}s=p(e),n=b[s]=_[s](e);function v(){return e[3](e[4],e[6])}return{key:l,first:null,c(){t=h("a"),n.c(),u(t,"class","local-mail-list-message list-group-item list-group-item-action p-0"),u(t,"href",i=Pe(e[2](e[4],e[6]))),O(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),O(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),O(t,"font-weight-bold",e[4].unread),this.first=t},m(w,$){D(w,t,$),b[s].m(t,null),d=!0,m||(c=W(t,"click",Te(v)),m=!0)},p(w,$){e=w;let y=s;s=p(e),s===y?b[s].p(e,$):(ne(),z(b[y],1,1,()=>{b[y]=null}),ie(),n=b[s],n?n.p(e,$):(n=b[s]=_[s](e),n.c()),T(n,1),n.m(t,null)),(!d||$&2&&i!==(i=Pe(e[2](e[4],e[6]))))&&u(t,"href",i),(!d||$&2)&&O(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),(!d||$&2)&&O(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),(!d||$&2)&&O(t,"font-weight-bold",e[4].unread)},r(){a=t.getBoundingClientRect()},f(){Zl(t),f(),gt(t,a)},a(){f(),f=Ql(t,a,on,{delay:400,duration:400})},i(w){d||(T(n),w&&ze(()=>{d&&(o&&o.end(1),r=_t(t,Be,{delay:400}),r.start())}),d=!0)},o(w){z(n),r&&r.invalidate(),w&&(o=Kl(t,Be,{duration:400})),d=!1},d(w){w&&S(t),b[s].d(),w&&o&&o.end(),m=!1,c()}}}function bs(l){let e,t=[],s=new Map,n,i,r,o=ce(l[1].listMessages);const a=f=>f[4].id;for(let f=0;f<o.length;f+=1){let d=gs(l,o,f),m=a(d);s.set(m,t[f]=ps(m,d))}return i=new Xi({props:{store:l[0]}}),{c(){e=h("div");for(let f=0;f<t.length;f+=1)t[f].c();n=j(),J(i.$$.fragment),u(e,"class","list-group")},m(f,d){D(f,e,d);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(e,null);g(e,n),K(i,e,null),r=!0},p(f,d){if(d&7){o=ce(f[1].listMessages),ne();for(let c=0;c<t.length;c+=1)t[c].r();t=je(t,d,a,1,f,o,s,e,Jl,ps,n,gs);for(let c=0;c<t.length;c+=1)t[c].a();ie()}const m={};d&1&&(m.store=f[0]),i.$set(m)},i(f){if(!r){for(let d=0;d<o.length;d+=1)T(t[d]);T(i.$$.fragment,f),r=!0}},o(f){for(let d=0;d<t.length;d+=1)z(t[d]);z(i.$$.fragment,f),r=!1},d(f){f&&S(e);for(let d=0;d<t.length;d+=1)t[d].d();V(i)}}}function Zi(l){let e=l[1].navigationId,t,s,n=bs(l);return{c(){n.c(),t=pe()},m(i,r){n.m(i,r),D(i,t,r),s=!0},p(i,[r]){r&2&&ae(e,e=i[1].navigationId)?(ne(),z(n,1,1,F),ie(),n=bs(i),n.c(),T(n,1),n.m(t.parentNode,t)):n.p(i,r)},i(i){s||(T(n),s=!0)},o(i){z(n),s=!1},d(i){i&&S(t),n.d(i)}}}function xi(l,e,t){let s,n=F,i=()=>(n(),n=de(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=(f,d)=>({...s.params,messageid:f.id,offset:(s.params.offset||0)+d}),a=(f,d)=>r.navigate(o(f,d));return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,o,a]}class er extends oe{constructor(e){super(),fe(this,e,xi,Zi,ae,{store:0})}}function tr(l,e,t){let{javascript:s}=e,n;const i=async r=>{const o=await ft("core/fragment");n==null||n.remove(),n=void 0,await xe(),n=document.createElement("script"),n.setAttribute("type","text/javascript"),n.innerHTML=o.processCollectedJavascript(r),document.head.append(n)};return dt(()=>{n==null||n.remove()}),l.$$set=r=>{"javascript"in r&&t(0,s=r.javascript)},l.$$.update=()=>{l.$$.dirty&1&&i(s||"")},[s]}class _n extends oe{constructor(e){super(),fe(this,e,tr,null,ae,{javascript:0})}}function hs(l){let e,t,s,n,i,r,o,a=l[3]&&ks(l);return{c(){e=h("div"),t=h("button"),s=h("i"),i=j(),a&&a.c(),u(s,"class","fa fa-fw fa-ellipsis-v align-middle"),u(t,"type","button"),u(t,"class","btn"),u(t,"aria-expanded",l[3]),u(t,"title",n=l[5].strings.more),u(e,"class","dropdown")},m(f,d){D(f,e,d),g(e,t),g(t,s),g(e,i),a&&a.m(e,null),r||(o=[W(t,"click",l[6]),Se(Ge.call(null,e,l[7]))],r=!0)},p(f,d){d&8&&u(t,"aria-expanded",f[3]),d&32&&n!==(n=f[5].strings.more)&&u(t,"title",n),f[3]?a?a.p(f,d):(a=ks(f),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(f){f&&S(e),a&&a.d(),r=!1,$e(o)}}}function ks(l){let e,t,s,n,i=l[5].strings.reply+"",r,o,a,f,d,m=l[5].strings.replyall+"",c,_,b,p,v,w,$=l[5].strings.forward+"",y,k,M;return{c(){e=h("div"),t=h("button"),s=h("i"),n=j(),r=I(i),o=j(),a=h("button"),f=h("i"),d=j(),c=I(m),b=j(),p=h("button"),v=h("i"),w=j(),y=I($),u(s,"class","fa fa-fw fa-reply"),u(s,"aria-hidden","true"),u(t,"type","button"),u(t,"class","dropdown-item"),u(f,"class","fa fa-fw fa-reply-all"),u(f,"aria-hidden","true"),u(a,"type","button"),a.disabled=_=!l[2],u(a,"class","dropdown-item"),O(a,"disabled",!l[2]),u(v,"class","fa fa-fw fa-share"),u(v,"aria-hidden","true"),u(p,"type","button"),u(p,"class","dropdown-item"),u(e,"class","dropdown-menu dropdown-menu-right show")},m(N,C){D(N,e,C),g(e,t),g(t,s),g(t,n),g(t,r),g(e,o),g(e,a),g(a,f),g(a,d),g(a,c),g(e,b),g(e,p),g(p,v),g(p,w),g(p,y),k||(M=[W(t,"click",l[9]),W(a,"click",l[10]),W(p,"click",l[11])],k=!0)},p(N,C){C&32&&i!==(i=N[5].strings.reply+"")&&G(r,i),C&32&&m!==(m=N[5].strings.replyall+"")&&G(c,m),C&4&&_!==(_=!N[2])&&(a.disabled=_),C&4&&O(a,"disabled",!N[2]),C&32&&$!==($=N[5].strings.forward+"")&&G(y,$)},d(N){N&&S(e),k=!1,$e(M)}}}function vs(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b;return{c(){e=h("button"),t=h("i"),n=j(),i=h("button"),r=h("i"),f=j(),d=h("button"),m=h("i"),u(t,"class","fa fa-fw fa-reply"),u(t,"aria-hidden","true"),u(e,"type","button"),u(e,"title",s=l[5].strings.reply),u(e,"class","btn py-2 border-0"),u(r,"class","fa fa-fw fa-reply-all"),u(r,"aria-hidden","true"),u(i,"type","button"),i.disabled=o=!l[2],u(i,"title",a=l[5].strings.replyall),u(i,"class","btn py-2 border-0"),O(i,"disabled",!l[2]),u(m,"class","fa fa-fw fa-share"),u(m,"aria-hidden","true"),u(d,"type","button"),u(d,"title",c=l[5].strings.forward),u(d,"class","btn py-2 border-0")},m(p,v){D(p,e,v),g(e,t),D(p,n,v),D(p,i,v),g(i,r),D(p,f,v),D(p,d,v),g(d,m),_||(b=[W(e,"click",l[12]),W(i,"click",l[13]),W(d,"click",l[14])],_=!0)},p(p,v){v&32&&s!==(s=p[5].strings.reply)&&u(e,"title",s),v&4&&o!==(o=!p[2])&&(i.disabled=o),v&32&&a!==(a=p[5].strings.replyall)&&u(i,"title",a),v&4&&O(i,"disabled",!p[2]),v&32&&c!==(c=p[5].strings.forward)&&u(d,"title",c)},d(p){p&&(S(e),S(n),S(i),S(f),S(d)),_=!1,$e(b)}}}function sr(l){let e,t,s,n,i,r,o,a,f,d,m,c=l[5].viewportSize<me.SM&&hs(l),_=l[5].viewportSize>=me.SM&&vs(l);return{c(){e=h("button"),t=h("i"),o=j(),c&&c.c(),a=j(),_&&_.c(),f=pe(),u(t,"class",s="fa "+l[4]),u(e,"type","button"),u(e,"class","btn py-2 border-0"),u(e,"role","checkbox"),u(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,u(e,"title",r=l[1].starred?l[5].strings.markasunstarred:l[5].strings.markasstarred)},m(b,p){D(b,e,p),g(e,t),D(b,o,p),c&&c.m(b,p),D(b,a,p),_&&_.m(b,p),D(b,f,p),d||(m=W(e,"click",l[8]),d=!0)},p(b,[p]){p&16&&s!==(s="fa "+b[4])&&u(t,"class",s),p&2&&n!==(n=b[1].starred)&&u(e,"aria-checked",n),p&2&&i!==(i=b[1].deleted)&&(e.disabled=i),p&34&&r!==(r=b[1].starred?b[5].strings.markasunstarred:b[5].strings.markasstarred)&&u(e,"title",r),b[5].viewportSize<me.SM?c?c.p(b,p):(c=hs(b),c.c(),c.m(a.parentNode,a)):c&&(c.d(1),c=null),b[5].viewportSize>=me.SM?_?_.p(b,p):(_=vs(b),_.c(),_.m(f.parentNode,f)):_&&(_.d(1),_=null)},i:F,o:F,d(b){b&&(S(e),S(o),S(a),S(f)),c&&c.d(b),_&&_.d(b),d=!1,m()}}}function lr(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,k=>t(5,n=k)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e,{canReplyAll:f}=e,d=!1;const m=()=>{t(3,d=!d)},c=()=>{t(3,d=!1)},_=()=>o.setStarred([a.id],!a.starred),b=()=>o.reply(a,!1),p=()=>o.reply(a,!0),v=()=>o.forward(a),w=()=>o.reply(a,!1),$=()=>o.reply(a,!0),y=()=>o.forward(a);return l.$$set=k=>{"store"in k&&r(t(0,o=k.store)),"message"in k&&t(1,a=k.message),"canReplyAll"in k&&t(2,f=k.canReplyAll)},l.$$.update=()=>{l.$$.dirty&2&&t(4,s=a.starred?"fa-star text-warning":"fa-star-o")},[o,a,f,d,s,n,m,c,_,b,p,v,w,$,y]}class nr extends oe{constructor(e){super(),fe(this,e,lr,sr,ae,{store:0,message:1,canReplyAll:2})}}function ws(l,e,t){const s=l.slice();return s[3]=e[t],s}function $s(l){let e,t,s,n,i,r,o,a,f,d=l[2](l[3])+"",m,c,_,b,p=Tt(l[3].filesize)+"",v,w,$,y;return{c(){e=h("a"),t=h("img"),i=j(),r=h("i"),o=j(),a=h("div"),f=h("div"),m=I(d),_=j(),b=h("div"),v=I(p),u(t,"aria-hidden","true"),u(t,"alt",s=l[3].filename),rt(t.src,n=l[3].iconurl)||u(t,"src",n),u(t,"width","24"),u(t,"height","24"),u(t,"class","flex-shrink-0"),u(r,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),u(r,"aria-hidden","true"),ge(r,"width","24px"),ge(r,"height","24px"),u(b,"class","text-left text-muted"),u(a,"class","ml-2 mr-1"),ge(a,"min-width","0"),u(e,"href",w=l[3].fileurl),u(e,"class","local-mail-message-attachments-file btn btn-light d-flex align-items-center px-2 py-1 mr-3 mb-3")},m(k,M){D(k,e,M),g(e,t),g(e,i),g(e,r),g(e,o),g(e,a),g(a,f),g(f,m),g(a,_),g(a,b),g(b,v),$||(y=Se(c=Ue.call(null,f,l[2](l[3]))),$=!0)},p(k,M){l=k,M&2&&s!==(s=l[3].filename)&&u(t,"alt",s),M&2&&!rt(t.src,n=l[3].iconurl)&&u(t,"src",n),M&2&&d!==(d=l[2](l[3])+"")&&G(m,d),c&&De(c.update)&&M&2&&c.update.call(null,l[2](l[3])),M&2&&p!==(p=Tt(l[3].filesize)+"")&&G(v,p),M&2&&w!==(w=l[3].fileurl)&&u(e,"href",w)},d(k){k&&S(e),$=!1,y()}}}function ys(l){let e,t,s,n,i=l[0].downloadall+"",r,o;return{c(){e=h("a"),t=h("i"),s=j(),n=h("div"),r=I(i),u(t,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),u(t,"aria-hidden","true"),ge(t,"width","24px"),ge(t,"height","24px"),u(n,"class","text-truncate ml-2"),u(e,"href",o=jt(l[1].id)),u(e,"class","btn btn-light d-flex align-items-center p-2 mr-3 mb-3")},m(a,f){D(a,e,f),g(e,t),g(e,s),g(e,n),g(n,r)},p(a,f){f&1&&i!==(i=a[0].downloadall+"")&&G(r,i),f&2&&o!==(o=jt(a[1].id))&&u(e,"href",o)},d(a){a&&S(e)}}}function ir(l){let e,t,s=ce(l[1].attachments),n=[];for(let r=0;r<s.length;r+=1)n[r]=$s(ws(l,s,r));let i=l[1].attachments.length>1&&ys(l);return{c(){e=h("div");for(let r=0;r<n.length;r+=1)n[r].c();t=j(),i&&i.c(),u(e,"class","local-mail-message-attachments d-sm-flex flex-wrap mr-n3 mt-3 mb-sm-n3")},m(r,o){D(r,e,o);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null);g(e,t),i&&i.m(e,null)},p(r,[o]){if(o&6){s=ce(r[1].attachments);let a;for(a=0;a<s.length;a+=1){const f=ws(r,s,a);n[a]?n[a].p(f,o):(n[a]=$s(f),n[a].c(),n[a].m(e,t))}for(;a<n.length;a+=1)n[a].d(1);n.length=s.length}r[1].attachments.length>1?i?i.p(r,o):(i=ys(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i:F,o:F,d(r){r&&S(e),Ie(n,r),i&&i.d()}}}function rr(l,e,t){let{strings:s}=e,{message:n}=e;const i=r=>(r.filepath+r.filename).replace(/^\//,"");return l.$$set=r=>{"strings"in r&&t(0,s=r.strings),"message"in r&&t(1,n=r.message)},[s,n,i]}class gn extends oe{constructor(e){super(),fe(this,e,rr,ir,ae,{strings:0,message:1})}}function ar(l){let e,t,s,n=l[3].strings.reply+"",i,r,o,a,f,d=l[3].strings.replyall+"",m,c,_,b,p,v,w=l[3].strings.forward+"",$,y,k;return{c(){e=h("button"),t=h("i"),s=j(),i=I(n),r=j(),o=h("button"),a=h("i"),f=j(),m=I(d),_=j(),b=h("button"),p=h("i"),v=j(),$=I(w),u(t,"class","fa fa-fw fa-reply mr-2"),u(e,"type","button"),u(e,"class","btn btn-primary mr-3 mb-3"),u(a,"class","fa fa-fw fa-reply-all mr-2"),u(o,"type","button"),o.disabled=c=!l[2],u(o,"class","btn mr-3 mb-3"),O(o,"disabled",!l[2]),O(o,"btn-primary",l[2]),O(o,"btn-secondary",!l[2]),u(p,"class","fa fa-fw fa-share mr-2"),u(b,"type","button"),u(b,"class","btn btn-primary mr-3 mb-3")},m(M,N){D(M,e,N),g(e,t),g(e,s),g(e,i),D(M,r,N),D(M,o,N),g(o,a),g(o,f),g(o,m),D(M,_,N),D(M,b,N),g(b,p),g(b,v),g(b,$),y||(k=[W(e,"click",l[4]),W(o,"click",l[5]),W(b,"click",l[6])],y=!0)},p(M,[N]){N&8&&n!==(n=M[3].strings.reply+"")&&G(i,n),N&8&&d!==(d=M[3].strings.replyall+"")&&G(m,d),N&4&&c!==(c=!M[2])&&(o.disabled=c),N&4&&O(o,"disabled",!M[2]),N&4&&O(o,"btn-primary",M[2]),N&4&&O(o,"btn-secondary",!M[2]),N&8&&w!==(w=M[3].strings.forward+"")&&G($,w)},i:F,o:F,d(M){M&&(S(e),S(r),S(o),S(_),S(b)),y=!1,$e(k)}}}function or(l,e,t){let s,n=F,i=()=>(n(),n=de(r,c=>t(3,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e,{canReplyAll:a}=e;const f=()=>r.reply(o,!1),d=()=>r.reply(o,!0),m=()=>r.forward(o);return l.$$set=c=>{"store"in c&&i(t(0,r=c.store)),"message"in c&&t(1,o=c.message),"canReplyAll"in c&&t(2,a=c.canReplyAll)},[r,o,a,s,f,d,m]}class fr extends oe{constructor(e){super(),fe(this,e,or,ar,ae,{store:0,message:1,canReplyAll:2})}}function ur(l){let e;return{c(){e=h("div"),u(e,"class","local-mail-message-content")},m(t,s){D(t,e,s),e.innerHTML=l[0],l[2](e)},p(t,[s]){s&1&&(e.innerHTML=t[0])},i:F,o:F,d(t){t&&S(e),l[2](null)}}}function cr(l,e,t){let{content:s}=e,n;Vl(async()=>{(await ft("core_filters/events")).notifyFilterContentUpdated([n])});function i(r){Ce[r?"unshift":"push"](()=>{n=r,t(1,n)})}return l.$$set=r=>{"content"in r&&t(0,s=r.content)},[s,n,i]}class pn extends oe{constructor(e){super(),fe(this,e,cr,ur,ae,{content:0})}}function Ms(l,e,t){const s=l.slice();return s[3]=e[t],s}function Cs(l){let e,t;return e=new ht({props:{course:l[1].course,settings:l[2].settings}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Ds(l,e){let t,s,n;return s=new kt({props:{label:e[3]}}),{key:l,first:null,c(){t=pe(),J(s.$$.fragment),this.first=t},m(i,r){D(i,t,r),K(s,i,r),n=!0},p(i,r){e=i;const o={};r&2&&(o.label=e[3]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&S(t),V(s,i)}}}function mr(l){let e,t=[],s=new Map,n,i,r=l[1].course.id!=l[2].params.courseid&&Cs(l),o=ce(l[1].labels);const a=f=>f[3].id;for(let f=0;f<o.length;f+=1){let d=Ms(l,o,f),m=a(d);s.set(m,t[f]=Ds(m,d))}return{c(){r&&r.c(),e=j();for(let f=0;f<t.length;f+=1)t[f].c();n=pe()},m(f,d){r&&r.m(f,d),D(f,e,d);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(f,d);D(f,n,d),i=!0},p(f,[d]){f[1].course.id!=f[2].params.courseid?r?(r.p(f,d),d&6&&T(r,1)):(r=Cs(f),r.c(),T(r,1),r.m(e.parentNode,e)):r&&(ne(),z(r,1,1,()=>{r=null}),ie()),d&2&&(o=ce(f[1].labels),ne(),t=je(t,d,a,1,f,o,s,n.parentNode,He,Ds,n,Ms),ie())},i(f){if(!i){T(r);for(let d=0;d<o.length;d+=1)T(t[d]);i=!0}},o(f){z(r);for(let d=0;d<t.length;d+=1)z(t[d]);i=!1},d(f){f&&(S(e),S(n)),r&&r.d(f);for(let d=0;d<t.length;d+=1)t[d].d(f)}}}function dr(l,e,t){let s,n=F,i=()=>(n(),n=de(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class _r extends oe{constructor(e){super(),fe(this,e,dr,mr,ae,{store:0,message:1})}}function gr(l){let e;function t(i,r){if(i[0])return hr;if(i[1])return br}let s=t(l),n=s&&s(l);return{c(){e=h("span"),n&&n.c(),u(e,"class","local-mail-user-picture-fallback m-0")},m(i,r){D(i,e,r),n&&n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n&&n.d(1),n=s&&s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&S(e),n&&n.d()}}}function pr(l){let e,t;return{c(){e=h("img"),rt(e.src,t=l[0].pictureurl)||u(e,"src",t),u(e,"width","35"),u(e,"height","35"),u(e,"alt",""),u(e,"aria-hidden","true"),u(e,"class","rounded-circle")},m(s,n){D(s,e,n)},p(s,n){n&1&&!rt(e.src,t=s[0].pictureurl)&&u(e,"src",t)},d(s){s&&S(e)}}}function br(l){let e,t;return{c(){e=h("i"),u(e,"class",t="fa "+l[1])},m(s,n){D(s,e,n)},p(s,n){n&2&&t!==(t="fa "+s[1])&&u(e,"class",t)},d(s){s&&S(e)}}}function hr(l){let e=l[0].firstname.slice(0,1)+"",t,s=l[0].lastname.slice(0,1)+"",n;return{c(){t=I(e),n=I(s)},m(i,r){D(i,t,r),D(i,n,r)},p(i,r){r&1&&e!==(e=i[0].firstname.slice(0,1)+"")&&G(t,e),r&1&&s!==(s=i[0].lastname.slice(0,1)+"")&&G(n,s)},d(i){i&&(S(t),S(n))}}}function kr(l){let e;function t(i,r){var o;return(o=i[0])!=null&&o.pictureurl?pr:gr}let s=t(l),n=s(l);return{c(){n.c(),e=pe()},m(i,r){n.m(i,r),D(i,e,r)},p(i,[r]){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e.parentNode,e)))},i:F,o:F,d(i){i&&S(e),n.d(i)}}}function vr(l,e,t){let{user:s=void 0}=e,{icon:n=void 0}=e;return l.$$set=i=>{"user"in i&&t(0,s=i.user),"icon"in i&&t(1,n=i.icon)},[s,n]}class lt extends oe{constructor(e){super(),fe(this,e,vr,kr,ae,{user:0,icon:1})}}function Ss(l){let e,t,s,n;return s=new gn({props:{strings:l[0],message:l[1]}}),{c(){e=h("hr"),t=j(),J(s.$$.fragment)},m(i,r){D(i,e,r),D(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.strings=i[0]),r&2&&(o.message=i[1]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&(S(e),S(t)),V(s,i)}}}function wr(l){let e,t,s,n=l[1].subject+"",i,r,o,a,f,d,m,c,_,b=l[1].sender.fullname+"",p,v,w,$,y=l[1].fulltime+"",k,M,N,C,L,A,R;d=new lt({props:{user:l[1].sender}}),L=new pn({props:{content:l[1].content}});let E=l[1].attachments.length>0&&Ss(l);return{c(){e=h("div"),t=h("div"),s=h("h5"),i=I(n),r=j(),o=h("div"),a=h("div"),f=h("div"),J(d.$$.fragment),m=j(),c=h("div"),_=h("a"),p=I(b),w=j(),$=h("div"),k=I(y),M=j(),N=h("hr"),C=j(),J(L.$$.fragment),A=j(),E&&E.c(),u(s,"class","h5 card-title mb-3"),u(f,"class","mr-3"),u(_,"href",v=l[1].sender.profileurl),u(c,"class","mt-1"),u(a,"class","d-flex mb-3 mb-sm-0"),u($,"class","mt-1 ml-auto"),u(o,"class","d-sm-flex mb-n1"),u(t,"class","card-body p-3 px-xl-4"),u(e,"class","card mb-4")},m(H,Q){D(H,e,Q),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),g(o,a),g(a,f),K(d,f,null),g(a,m),g(a,c),g(c,_),g(_,p),g(o,w),g(o,$),g($,k),g(t,M),g(t,N),g(t,C),K(L,t,null),g(t,A),E&&E.m(t,null),R=!0},p(H,[Q]){(!R||Q&2)&&n!==(n=H[1].subject+"")&&G(i,n);const le={};Q&2&&(le.user=H[1].sender),d.$set(le),(!R||Q&2)&&b!==(b=H[1].sender.fullname+"")&&G(p,b),(!R||Q&2&&v!==(v=H[1].sender.profileurl))&&u(_,"href",v),(!R||Q&2)&&y!==(y=H[1].fulltime+"")&&G(k,y);const X={};Q&2&&(X.content=H[1].content),L.$set(X),H[1].attachments.length>0?E?(E.p(H,Q),Q&2&&T(E,1)):(E=Ss(H),E.c(),T(E,1),E.m(t,null)):E&&(ne(),z(E,1,1,()=>{E=null}),ie())},i(H){R||(T(d.$$.fragment,H),T(L.$$.fragment,H),T(E),R=!0)},o(H){z(d.$$.fragment,H),z(L.$$.fragment,H),z(E),R=!1},d(H){H&&S(e),V(d),V(L),E&&E.d()}}}function $r(l,e,t){let{strings:s}=e,{reference:n}=e;return l.$$set=i=>{"strings"in i&&t(0,s=i.strings),"reference"in i&&t(1,n=i.reference)},[s,n]}class bn extends oe{constructor(e){super(),fe(this,e,$r,wr,ae,{strings:0,reference:1})}}function Ts(l,e,t){const s=l.slice();return s[4]=e[t],s}function js(l,e,t){const s=l.slice();return s[7]=e[t],s[9]=t,s}function Ls(l){let e,t,s=l[3].strings[l[4]]+"",n,i,r,o=[],a=new Map,f,d=ce(l[2](l[4]));const m=c=>c[7].id;for(let c=0;c<d.length;c+=1){let _=js(l,d,c),b=m(_);a.set(b,o[c]=Ns(b,_))}return{c(){e=h("div"),t=h("span"),n=I(s),i=I(":"),r=j();for(let c=0;c<o.length;c+=1)o[c].c();f=j(),u(e,"class","mb-2")},m(c,_){D(c,e,_),g(e,t),g(t,n),g(t,i),g(e,r);for(let b=0;b<o.length;b+=1)o[b]&&o[b].m(e,null);g(e,f)},p(c,_){_&8&&s!==(s=c[3].strings[c[4]]+"")&&G(n,s),_&4&&(d=ce(c[2](c[4])),o=je(o,_,m,1,c,d,a,e,tt,Ns,f,js))},d(c){c&&S(e);for(let _=0;_<o.length;_+=1)o[_].d()}}}function zs(l){let e;return{c(){e=I(",")},m(t,s){D(t,e,s)},d(t){t&&S(e)}}}function Ns(l,e){let t,s,n,i=e[7].fullname+"",r,o,a=e[9]>0&&zs();return{key:l,first:null,c(){t=pe(),a&&a.c(),s=j(),n=h("a"),r=I(i),u(n,"href",o=e[7].profileurl),this.first=t},m(f,d){D(f,t,d),a&&a.m(f,d),D(f,s,d),D(f,n,d),g(n,r)},p(f,d){e=f,e[9]>0?a||(a=zs(),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null),d&4&&i!==(i=e[7].fullname+"")&&G(r,i),d&4&&o!==(o=e[7].profileurl)&&u(n,"href",o)},d(f){f&&(S(t),S(s),S(n)),a&&a.d(f)}}}function As(l){let e=l[2](l[4]).length>0,t,s=e&&Ls(l);return{c(){s&&s.c(),t=pe()},m(n,i){s&&s.m(n,i),D(n,t,i)},p(n,i){i&4&&(e=n[2](n[4]).length>0),e?s?s.p(n,i):(s=Ls(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},d(n){n&&S(t),s&&s.d(n)}}}function yr(l){let e,t,s,n,i,r,o,a=l[1].sender.fullname+"",f,d,m,c;s=new lt({props:{user:l[1].sender}});let _=ce(Object.values(qe)),b=[];for(let p=0;p<_.length;p+=1)b[p]=As(Ts(l,_,p));return{c(){e=h("div"),t=h("div"),J(s.$$.fragment),n=j(),i=h("div"),r=h("div"),o=h("a"),f=I(a),m=j();for(let p=0;p<b.length;p+=1)b[p].c();u(t,"class","mr-3"),u(o,"href",d=l[1].sender.profileurl),u(r,"class","mt-1 mb-2"),u(i,"class","d-flex flex-column"),u(e,"class","local-mail-message-users d-flex mb-n2")},m(p,v){D(p,e,v),g(e,t),K(s,t,null),g(e,n),g(e,i),g(i,r),g(r,o),g(o,f),g(i,m);for(let w=0;w<b.length;w+=1)b[w]&&b[w].m(i,null);c=!0},p(p,[v]){const w={};if(v&2&&(w.user=p[1].sender),s.$set(w),(!c||v&2)&&a!==(a=p[1].sender.fullname+"")&&G(f,a),(!c||v&2&&d!==(d=p[1].sender.profileurl))&&u(o,"href",d),v&12){_=ce(Object.values(qe));let $;for($=0;$<_.length;$+=1){const y=Ts(p,_,$);b[$]?b[$].p(y,v):(b[$]=As(y),b[$].c(),b[$].m(i,null))}for(;$<b.length;$+=1)b[$].d(1);b.length=_.length}},i(p){c||(T(s.$$.fragment,p),c=!0)},o(p){z(s.$$.fragment,p),c=!1},d(p){p&&S(e),V(s),Ie(b,p)}}}function Mr(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,f=>t(3,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;return l.$$set=f=>{"store"in f&&r(t(0,o=f.store)),"message"in f&&t(1,a=f.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=f=>a.recipients.filter(d=>d.type==f))},[o,a,s,n]}class Cr extends oe{constructor(e){super(),fe(this,e,Mr,yr,ae,{store:0,message:1})}}function qs(l,e,t){const s=l.slice();return s[4]=e[t],s}function Bs(l){let e,t,s,n;return s=new gn({props:{strings:l[2].strings,message:l[1]}}),{c(){e=h("hr"),t=j(),J(s.$$.fragment)},m(i,r){D(i,e,r),D(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&4&&(o.strings=i[2].strings),r&2&&(o.message=i[1]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&(S(e),S(t)),V(s,i)}}}function Is(l){let e,t=l[2].strings.references+"",s,n,i=[],r=new Map,o,a,f=ce(l[1].references);const d=m=>m[4].id;for(let m=0;m<f.length;m+=1){let c=qs(l,f,m),_=d(c);r.set(_,i[m]=Es(_,c))}return{c(){e=h("div"),s=I(t),n=j();for(let m=0;m<i.length;m+=1)i[m].c();o=pe(),u(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(m,c){D(m,e,c),g(e,s),D(m,n,c);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(m,c);D(m,o,c),a=!0},p(m,c){(!a||c&4)&&t!==(t=m[2].strings.references+"")&&G(s,t),c&6&&(f=ce(m[1].references),ne(),i=je(i,c,d,1,m,f,r,o.parentNode,He,Es,o,qs),ie())},i(m){if(!a){for(let c=0;c<f.length;c+=1)T(i[c]);a=!0}},o(m){for(let c=0;c<i.length;c+=1)z(i[c]);a=!1},d(m){m&&(S(e),S(n),S(o));for(let c=0;c<i.length;c+=1)i[c].d(m)}}}function Es(l,e){let t,s,n;return s=new bn({props:{strings:e[2].strings,reference:e[4]}}),{key:l,first:null,c(){t=pe(),J(s.$$.fragment),this.first=t},m(i,r){D(i,t,r),K(s,i,r),n=!0},p(i,r){e=i;const o={};r&4&&(o.strings=e[2].strings),r&2&&(o.reference=e[4]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&S(t),V(s,i)}}}function Dr(l){let e,t,s,n,i,r=l[1].subject+"",o,a,f,d,m,c,_,b,p=l[1].fulltime+"",v,w,$,y,k,M,N,C,L,A,R,E,H,Q,le,X,te,re,x;e=new _n({props:{javascript:l[1].javascript}}),m=new _r({props:{store:l[0],message:l[1]}}),y=new nr({props:{store:l[0],message:l[1],canReplyAll:l[3]}}),M=new Cr({props:{store:l[0],message:l[1]}}),A=new pn({props:{content:l[1].content}});let Z=l[1].attachments.length>0&&Bs(l);X=new fr({props:{store:l[0],message:l[1],canReplyAll:l[3]}});let q=l[1].references.length>0&&Is(l);return{c(){J(e.$$.fragment),t=j(),s=h("div"),n=h("div"),i=h("h3"),o=I(r),a=j(),f=h("div"),d=h("div"),J(m.$$.fragment),c=j(),_=h("div"),b=h("div"),v=I(p),w=j(),$=h("div"),J(y.$$.fragment),k=j(),J(M.$$.fragment),N=j(),C=h("hr"),L=j(),J(A.$$.fragment),R=j(),Z&&Z.c(),E=j(),H=h("hr"),Q=j(),le=h("div"),J(X.$$.fragment),te=j(),q&&q.c(),re=pe(),u(i,"class","h4 card-title mb-3 mb-md-2"),u(d,"class","d-flex flex-wrap mx-n2 mt-2"),ge(d,"min-width","0"),u(b,"class","my-2 text-truncate"),u($,"class","d-flex flex-shrink-0 ml-3 mr-n2"),u(_,"class","d-flex justify-content-between flex-shrink-0 ml-auto"),u(f,"class","d-md-flex align-items-start mb-2"),u(le,"class","mt-3 d-flex mr-n3 mb-n3 flex-column flex-sm-row justify-content-end"),u(n,"class","card-body p-3 px-xl-4"),u(s,"class","card")},m(B,Y){K(e,B,Y),D(B,t,Y),D(B,s,Y),g(s,n),g(n,i),g(i,o),g(n,a),g(n,f),g(f,d),K(m,d,null),g(f,c),g(f,_),g(_,b),g(b,v),g(_,w),g(_,$),K(y,$,null),g(n,k),K(M,n,null),g(n,N),g(n,C),g(n,L),K(A,n,null),g(n,R),Z&&Z.m(n,null),g(n,E),g(n,H),g(n,Q),g(n,le),K(X,le,null),D(B,te,Y),q&&q.m(B,Y),D(B,re,Y),x=!0},p(B,[Y]){const se={};Y&2&&(se.javascript=B[1].javascript),e.$set(se),(!x||Y&2)&&r!==(r=B[1].subject+"")&&G(o,r);const P={};Y&1&&(P.store=B[0]),Y&2&&(P.message=B[1]),m.$set(P),(!x||Y&2)&&p!==(p=B[1].fulltime+"")&&G(v,p);const be={};Y&1&&(be.store=B[0]),Y&2&&(be.message=B[1]),Y&8&&(be.canReplyAll=B[3]),y.$set(be);const ee={};Y&1&&(ee.store=B[0]),Y&2&&(ee.message=B[1]),M.$set(ee);const he={};Y&2&&(he.content=B[1].content),A.$set(he),B[1].attachments.length>0?Z?(Z.p(B,Y),Y&2&&T(Z,1)):(Z=Bs(B),Z.c(),T(Z,1),Z.m(n,E)):Z&&(ne(),z(Z,1,1,()=>{Z=null}),ie());const ke={};Y&1&&(ke.store=B[0]),Y&2&&(ke.message=B[1]),Y&8&&(ke.canReplyAll=B[3]),X.$set(ke),B[1].references.length>0?q?(q.p(B,Y),Y&2&&T(q,1)):(q=Is(B),q.c(),T(q,1),q.m(re.parentNode,re)):q&&(ne(),z(q,1,1,()=>{q=null}),ie())},i(B){x||(T(e.$$.fragment,B),T(m.$$.fragment,B),T(y.$$.fragment,B),T(M.$$.fragment,B),T(A.$$.fragment,B),T(Z),T(X.$$.fragment,B),T(q),x=!0)},o(B){z(e.$$.fragment,B),z(m.$$.fragment,B),z(y.$$.fragment,B),z(M.$$.fragment,B),z(A.$$.fragment,B),z(Z),z(X.$$.fragment,B),z(q),x=!1},d(B){B&&(S(t),S(s),S(te),S(re)),V(e,B),V(m),V(y),V(M),V(A),Z&&Z.d(),V(X),q&&q.d(B)}}}function Sr(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,f=>t(2,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;return l.$$set=f=>{"store"in f&&r(t(0,o=f.store)),"message"in f&&t(1,a=f.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=a.sender.id==n.userid?a.recipients.filter(f=>f.type=="cc").length>0:a.recipients.filter(f=>["to","cc"].includes(f.type)&&f.id!=n.userid).length>0)},[o,a,n,s]}class Tr extends oe{constructor(e){super(),fe(this,e,Sr,Dr,ae,{store:0,message:1})}}function Ps(l,e,t){const s=l.slice();s[6]=e[t];const n=Array.from(s[1].values()).filter(function(...r){return l[5](s[6],...r)});return s[7]=n,s}function Rs(l,e,t){const s=l.slice();return s[10]=e[t],s}function Fs(l){let e,t,s=l[3].strings[l[6]]+"",n,i,r,o,a=[],f=new Map,d,m,c,_=ce(l[7]);const b=p=>p[10].id;for(let p=0;p<_.length;p+=1){let v=Rs(l,_,p),w=b(v);f.set(w,a[p]=Us(w,v))}return{c(){e=h("div"),t=h("div"),n=I(s),i=I(":"),r=j(),o=h("div");for(let p=0;p<a.length;p+=1)a[p].c();d=j(),u(t,"class","local-mail-draft-form-recipients-type flex-shrink-0 py-2 mr-2"),u(o,"class","d-flex flex-wrap"),ge(o,"min-width","0"),u(e,"class","d-flex mb-2")},m(p,v){D(p,e,v),g(e,t),g(t,n),g(t,i),g(e,r),g(e,o);for(let w=0;w<a.length;w+=1)a[w]&&a[w].m(o,null);g(e,d),c=!0},p(p,v){(!c||v&8)&&s!==(s=p[3].strings[p[6]]+"")&&G(n,s),v&14&&(_=ce(p[7]),ne(),a=je(a,v,b,1,p,_,f,o,He,Us,null,Rs),ie())},i(p){if(!c){for(let v=0;v<_.length;v+=1)T(a[v]);p&&ze(()=>{c&&(m||(m=Ee(e,Be,{},!0)),m.run(1))}),c=!0}},o(p){for(let v=0;v<a.length;v+=1)z(a[v]);p&&(m||(m=Ee(e,Be,{},!1)),m.run(0)),c=!1},d(p){p&&S(e);for(let v=0;v<a.length;v+=1)a[v].d();p&&m&&m.end()}}}function jr(l){let e,t,s;return{c(){e=h("div"),t=h("i"),u(t,"class","fa fa-exclamation-circle"),u(e,"class","m-0 d-flex justify-content-center align-items-center"),ge(e,"width","35px"),ge(e,"height","35px"),u(e,"title",s=l[3].strings.cannotsendmailtouser)},m(n,i){D(n,e,i),g(e,t)},p(n,i){i&8&&s!==(s=n[3].strings.cannotsendmailtouser)&&u(e,"title",s)},i:F,o:F,d(n){n&&S(e)}}}function Lr(l){let e,t;return e=new lt({props:{user:l[10]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.user=s[10]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Us(l,e){let t,s,n,i,r,o,a=e[10].fullname+"",f,d,m,c,_,b,p,v,w,$,y,k;const M=[Lr,jr],N=[];function C(A,R){return A[10].isvalid?0:1}n=C(e),i=N[n]=M[n](e);function L(){return e[4](e[10])}return{key:l,first:null,c(){t=h("div"),s=h("div"),i.c(),r=j(),o=h("div"),f=I(a),m=j(),c=h("button"),_=h("i"),p=j(),u(s,"class","d-flex m-1 mr-2"),u(o,"class","py-2"),u(_,"class","fa fa-fw fa-times"),u(c,"type","button"),u(c,"class","btn align-self-middle p-2 align-bottom"),u(c,"title",b=e[3].strings.delete),u(t,"class","local-mail-draft-form-recipients-user d-flex flex-shrink align-items-center mr-2 mb-2"),O(t,"alert-danger",!e[10].isvalid),this.first=t},m(A,R){D(A,t,R),g(t,s),N[n].m(s,null),g(t,r),g(t,o),g(o,f),g(t,m),g(t,c),g(c,_),g(t,p),$=!0,y||(k=[Se(d=Ue.call(null,o,e[10].fullname)),W(c,"click",L),Se(v=Ue.call(null,t,e[10].fullname))],y=!0)},p(A,R){e=A;let E=n;n=C(e),n===E?N[n].p(e,R):(ne(),z(N[E],1,1,()=>{N[E]=null}),ie(),i=N[n],i?i.p(e,R):(i=N[n]=M[n](e),i.c()),T(i,1),i.m(s,null)),(!$||R&2)&&a!==(a=e[10].fullname+"")&&G(f,a),d&&De(d.update)&&R&2&&d.update.call(null,e[10].fullname),(!$||R&8&&b!==(b=e[3].strings.delete))&&u(c,"title",b),v&&De(v.update)&&R&2&&v.update.call(null,e[10].fullname),(!$||R&2)&&O(t,"alert-danger",!e[10].isvalid)},i(A){$||(T(i),A&&ze(()=>{$&&(w||(w=Ee(t,Be,{},!0)),w.run(1))}),$=!0)},o(A){z(i),A&&(w||(w=Ee(t,Be,{},!1)),w.run(0)),$=!1},d(A){A&&S(t),N[n].d(),A&&w&&w.end(),y=!1,$e(k)}}}function Gs(l){let e,t,s=l[7].length&&Fs(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),D(n,e,i),t=!0},p(n,i){n[7].length?s?(s.p(n,i),i&2&&T(s,1)):(s=Fs(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&S(e),s&&s.d(n)}}}function zr(l){let e,t,s=ce(Object.values(qe)),n=[];for(let r=0;r<s.length;r+=1)n[r]=Gs(Ps(l,s,r));const i=r=>z(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=pe()},m(r,o){for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(r,o);D(r,e,o),t=!0},p(r,[o]){if(o&14){s=ce(Object.values(qe));let a;for(a=0;a<s.length;a+=1){const f=Ps(r,s,a);n[a]?(n[a].p(f,o),T(n[a],1)):(n[a]=Gs(f),n[a].c(),T(n[a],1),n[a].m(e.parentNode,e))}for(ne(),a=s.length;a<n.length;a+=1)i(a);ie()}},i(r){if(!t){for(let o=0;o<s.length;o+=1)T(n[o]);t=!0}},o(r){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)z(n[o]);t=!1},d(r){r&&S(e),Ie(n,r)}}}function Nr(l,e,t){let s,n=F,i=()=>(n(),n=de(r,m=>t(3,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{recipients:o}=e,{onDelete:a}=e;const f=m=>a(m),d=(m,c)=>c.type==m;return l.$$set=m=>{"store"in m&&i(t(0,r=m.store)),"recipients"in m&&t(1,o=m.recipients),"onDelete"in m&&t(2,a=m.onDelete)},[r,o,a,s,f,d]}class Ar extends oe{constructor(e){super(),fe(this,e,Nr,zr,ae,{store:0,recipients:1,onDelete:2})}}function Hs(l,e,t){const s=l.slice();return s[4]=e[t],s}function qr(l){let e,t,s=l[1].shorttime+"",n;return{c(){e=h("i"),t=j(),n=I(s),u(e,"class","fa fa-clock-o mr-1"),u(e,"aria-hidden","true")},m(i,r){D(i,e,r),D(i,t,r),D(i,n,r)},p(i,r){r&2&&s!==(s=i[1].shorttime+"")&&G(n,s)},d(i){i&&(S(e),S(t),S(n))}}}function Br(l){let e,t,s=l[2].strings.draftsaved+"",n;return{c(){e=h("i"),t=j(),n=I(s),u(e,"class","fa fa-check mr-1"),u(e,"aria-hidden","true")},m(i,r){D(i,e,r),D(i,t,r),D(i,n,r)},p(i,r){r&4&&s!==(s=i[2].strings.draftsaved+"")&&G(n,s)},d(i){i&&(S(e),S(t),S(n))}}}function Os(l){let e,t=[],s=new Map,n,i=ce(l[1].labels);const r=o=>o[4].id;for(let o=0;o<i.length;o+=1){let a=Hs(l,i,o),f=r(a);s.set(f,t[o]=Js(f,a))}return{c(){e=h("div");for(let o=0;o<t.length;o+=1)t[o].c();u(e,"class","d-flex flex-wrap mt-2 mr-2"),ge(e,"min-width","0")},m(o,a){D(o,e,a);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(o,a){a&2&&(i=ce(o[1].labels),ne(),t=je(t,a,r,1,o,i,s,e,He,Js,null,Hs),ie())},i(o){if(!n){for(let a=0;a<i.length;a+=1)T(t[a]);n=!0}},o(o){for(let a=0;a<t.length;a+=1)z(t[a]);n=!1},d(o){o&&S(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function Js(l,e){let t,s,n;return s=new kt({props:{label:e[4]}}),{key:l,first:null,c(){t=pe(),J(s.$$.fragment),this.first=t},m(i,r){D(i,t,r),K(s,i,r),n=!0},p(i,r){e=i;const o={};r&2&&(o.label=e[4]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&S(t),V(s,i)}}}function Ir(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p;function v(k,M){return k[2].draftSaved?Br:qr}let w=v(l),$=w(l),y=l[1].labels&&Os(l);return{c(){e=h("div"),t=h("div"),s=h("div"),$.c(),i=j(),r=h("button"),o=h("i"),c=j(),y&&y.c(),u(s,"class","align-self-center alert-info px-2 text-truncate"),u(s,"title",n=l[1].fulltime),u(o,"class",a="fa "+(l[1].starred?"fa-star text-warning":"fa-star-o")),u(r,"type","button"),u(r,"class","btn border-0 py-2 ml-auto mr-3 mr-sm-2"),u(r,"role","checkbox"),u(r,"aria-checked",f=l[1].starred),r.disabled=d=l[1].deleted,u(r,"title",m=l[1].starred?l[2].strings.markasunstarred:l[2].strings.markasstarred),u(t,"class","d-flex flex-grow-1"),u(e,"class","d-sm-flex justify-content-between mb-2 mr-n3")},m(k,M){D(k,e,M),g(e,t),g(t,s),$.m(s,null),g(t,i),g(t,r),g(r,o),g(e,c),y&&y.m(e,null),_=!0,b||(p=W(r,"click",l[3]),b=!0)},p(k,[M]){w===(w=v(k))&&$?$.p(k,M):($.d(1),$=w(k),$&&($.c(),$.m(s,null))),(!_||M&2&&n!==(n=k[1].fulltime))&&u(s,"title",n),(!_||M&2&&a!==(a="fa "+(k[1].starred?"fa-star text-warning":"fa-star-o")))&&u(o,"class",a),(!_||M&2&&f!==(f=k[1].starred))&&u(r,"aria-checked",f),(!_||M&2&&d!==(d=k[1].deleted))&&(r.disabled=d),(!_||M&6&&m!==(m=k[1].starred?k[2].strings.markasunstarred:k[2].strings.markasstarred))&&u(r,"title",m),k[1].labels?y?(y.p(k,M),M&2&&T(y,1)):(y=Os(k),y.c(),T(y,1),y.m(e,null)):y&&(ne(),z(y,1,1,()=>{y=null}),ie())},i(k){_||(T(y),_=!0)},o(k){z(y),_=!1},d(k){k&&S(e),$.d(),y&&y.d(),b=!1,p()}}}function Er(l,e,t){let s,n=F,i=()=>(n(),n=de(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;const a=()=>r.setStarred([o.id],!o.starred);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"message"in f&&t(1,o=f.message)},[r,o,s,a]}class Pr extends oe{constructor(e){super(),fe(this,e,Er,Ir,ae,{store:0,message:1})}}async function Qe(l){const e=await ft("core/ajax"),t=Array.from(l).map(({methodname:s,...n})=>({methodname:`local_mail_${s}`,args:n}));try{return await Promise.all(e.call(t))}catch(s){throw typeof s=="string"?{message:s}:s}}function Ks(l,e,t){var i;const s=l.slice();s[31]=e[t];const n=(i=s[2].get(s[31].id))==null?void 0:i.type;return s[32]=n,s}function Vs(l,e,t){const s=l.slice();return s[35]=e[t],s}function Ws(l,e,t){const s=l.slice();s[35]=e[t];const n=s[10].every(function(...r){return l[28](s[35],...r)});return s[38]=n,s}function Xs(l,e,t){const s=l.slice();return s[41]=e[t],s}function Ys(l,e,t){const s=l.slice();return s[44]=e[t],s}function Qs(l){let e,t,s,n,i,r=l[14].strings.allroles+"",o,a=[],f=new Map,d,m,c,_,b,p,v,w=ce(l[8]);const $=C=>C[44].id;for(let C=0;C<w.length;C+=1){let L=Ys(l,w,C),A=$(L);f.set(A,a[C]=Zs(A,L))}let y=l[9].length>0&&xs(l);const k=[Ur,Fr,Rr],M=[];function N(C,L){return C[10].length?C[11]?1:2:0}return c=N(l),_=M[c]=k[c](l),{c(){e=h("div"),t=h("div"),s=h("div"),n=h("select"),i=h("option"),o=I(r);for(let C=0;C<a.length;C+=1)a[C].c();d=j(),y&&y.c(),m=j(),_.c(),i.__value=0,ye(i,i.__value),u(n,"class","form-control text-truncate"),l[12]===void 0&&ze(()=>l[23].call(n)),u(s,"class","flex-grow-1 mx-2"),u(t,"class","list-group-item d-sm-flex px-2 py-2"),u(e,"class","local-mail-draft-form-user-search-dropdown dropdown-menu dropdown-menu-left list-group show p-0 w-100"),ge(e,"min-width","18rem")},m(C,L){D(C,e,L),g(e,t),g(t,s),g(s,n),g(n,i),g(i,o);for(let A=0;A<a.length;A+=1)a[A]&&a[A].m(n,null);Ze(n,l[12],!0),g(t,d),y&&y.m(t,null),g(e,m),M[c].m(e,null),b=!0,p||(v=[W(n,"change",l[23]),W(n,"change",l[24])],p=!0)},p(C,L){(!b||L[0]&16384)&&r!==(r=C[14].strings.allroles+"")&&G(o,r),L[0]&256&&(w=ce(C[8]),a=je(a,L,$,1,C,w,f,n,tt,Zs,null,Ys)),L[0]&4352&&Ze(n,C[12]),C[9].length>0?y?y.p(C,L):(y=xs(C),y.c(),y.m(t,null)):y&&(y.d(1),y=null);let A=c;c=N(C),c===A?M[c].p(C,L):(ne(),z(M[A],1,1,()=>{M[A]=null}),ie(),_=M[c],_?_.p(C,L):(_=M[c]=k[c](C),_.c()),T(_,1),_.m(e,null))},i(C){b||(T(_),b=!0)},o(C){z(_),b=!1},d(C){C&&S(e);for(let L=0;L<a.length;L+=1)a[L].d();y&&y.d(),M[c].d(),p=!1,$e(v)}}}function Zs(l,e){let t,s=e[44].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=I(s),i=j(),t.__value=r=e[44].id,ye(t,t.__value),this.first=t},m(o,a){D(o,t,a),g(t,n),g(t,i)},p(o,a){e=o,a[0]&256&&s!==(s=e[44].name+"")&&G(n,s),a[0]&256&&r!==(r=e[44].id)&&(t.__value=r,ye(t,t.__value))},d(o){o&&S(t)}}}function xs(l){let e,t,s,n=[],i=new Map,r,o,a=l[1].groupmode!=at.Separate&&el(l),f=ce(l[9]);const d=m=>m[41].id;for(let m=0;m<f.length;m+=1){let c=Xs(l,f,m),_=d(c);i.set(_,n[m]=tl(_,c))}return{c(){e=h("div"),t=h("select"),a&&a.c(),s=pe();for(let m=0;m<n.length;m+=1)n[m].c();u(t,"class","form-control text-truncate"),ge(t,"min-width","0"),l[13]===void 0&&ze(()=>l[25].call(t)),u(e,"class","flex-grow-1 mx-2 mt-2 mt-sm-0")},m(m,c){D(m,e,c),g(e,t),a&&a.m(t,null),g(t,s);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(t,null);Ze(t,l[13],!0),r||(o=[W(t,"change",l[25]),W(t,"change",l[26])],r=!0)},p(m,c){m[1].groupmode!=at.Separate?a?a.p(m,c):(a=el(m),a.c(),a.m(t,s)):a&&(a.d(1),a=null),c[0]&512&&(f=ce(m[9]),n=je(n,c,d,1,m,f,i,t,tt,tl,null,Xs)),c[0]&8704&&Ze(t,m[13])},d(m){m&&S(e),a&&a.d();for(let c=0;c<n.length;c+=1)n[c].d();r=!1,$e(o)}}}function el(l){let e,t=l[14].strings.allgroups+"",s;return{c(){e=h("option"),s=I(t),e.__value=0,ye(e,e.__value)},m(n,i){D(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.allgroups+"")&&G(s,t)},d(n){n&&S(e)}}}function tl(l,e){let t,s=e[41].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=I(s),i=j(),t.__value=r=e[41].id,ye(t,t.__value),u(t,"class","text-truncate"),this.first=t},m(o,a){D(o,t,a),g(t,n),g(t,i)},p(o,a){e=o,a[0]&512&&s!==(s=e[41].name+"")&&G(n,s),a[0]&512&&r!==(r=e[41].id)&&(t.__value=r,ye(t,t.__value))},d(o){o&&S(t)}}}function Rr(l){let e,t,s,n,i,r,o=l[14].strings.allusers+"",a,f,d,m,c,_=[],b=new Map,p,v,w,$;s=new lt({props:{icon:"fa-users"}});let y=ce(Object.values(qe)),k=[];for(let C=0;C<y.length;C+=1)k[C]=sl(Ws(l,y,C));let M=ce(l[10]);const N=C=>C[31].id;for(let C=0;C<M.length;C+=1){let L=Ks(l,M,C),A=N(L);b.set(A,_[C]=nl(A,L))}return{c(){e=h("div"),t=h("div"),J(s.$$.fragment),n=j(),i=h("div"),r=h("div"),a=I(o),d=j(),m=h("div");for(let C=0;C<k.length;C+=1)k[C].c();c=j();for(let C=0;C<_.length;C+=1)_[C].c();p=pe(),u(t,"class","mx-3 my-2"),u(r,"class","py-2 mr-3"),u(m,"class","d-flex ml-auto mr-2"),u(i,"class","d-sm-flex align-items-center flex-grow-1"),u(e,"class","list-group-item d-flex align-items-sm-center p-0")},m(C,L){D(C,e,L),g(e,t),K(s,t,null),g(e,n),g(e,i),g(i,r),g(r,a),g(i,d),g(i,m);for(let A=0;A<k.length;A+=1)k[A]&&k[A].m(m,null);D(C,c,L);for(let A=0;A<_.length;A+=1)_[A]&&_[A].m(C,L);D(C,p,L),v=!0,w||($=Se(f=Ue.call(null,r,l[14].strings.allusers)),w=!0)},p(C,L){if((!v||L[0]&16384)&&o!==(o=C[14].strings.allusers+"")&&G(a,o),f&&De(f.update)&&L[0]&16384&&f.update.call(null,C[14].strings.allusers),L[0]&17420){y=ce(Object.values(qe));let A;for(A=0;A<y.length;A+=1){const R=Ws(C,y,A);k[A]?k[A].p(R,L):(k[A]=sl(R),k[A].c(),k[A].m(m,null))}for(;A<k.length;A+=1)k[A].d(1);k.length=y.length}L[0]&17420&&(M=ce(C[10]),ne(),_=je(_,L,N,1,C,M,b,p.parentNode,He,nl,p,Ks),ie())},i(C){if(!v){T(s.$$.fragment,C);for(let L=0;L<M.length;L+=1)T(_[L]);v=!0}},o(C){z(s.$$.fragment,C);for(let L=0;L<_.length;L+=1)z(_[L]);v=!1},d(C){C&&(S(e),S(c),S(p)),V(s),Ie(k,C);for(let L=0;L<_.length;L+=1)_[L].d(C);w=!1,$()}}}function Fr(l){let e,t=l[14].strings.toomanyusersfound+"",s;return{c(){e=h("div"),s=I(t),u(e,"class","list-group-item text-danger")},m(n,i){D(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.toomanyusersfound+"")&&G(s,t)},i:F,o:F,d(n){n&&S(e)}}}function Ur(l){let e,t=l[14].strings.nousersfound+"",s;return{c(){e=h("div"),s=I(t),u(e,"class","list-group-item text-danger")},m(n,i){D(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.nousersfound+"")&&G(s,t)},i:F,o:F,d(n){n&&S(e)}}}function sl(l){let e,t=l[14].strings[l[35]]+"",s,n,i,r,o;function a(){return l[27](l[38],l[35])}return{c(){e=h("button"),s=I(t),n=j(),u(e,"type","button"),u(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),u(e,"aria-pressed",i=l[38]),O(e,"btn-primary",l[38]),O(e,"btn-secondary",!l[38])},m(f,d){D(f,e,d),g(e,s),g(e,n),r||(o=W(e,"click",a),r=!0)},p(f,d){l=f,d[0]&16384&&t!==(t=l[14].strings[l[35]]+"")&&G(s,t),d[0]&1028&&i!==(i=l[38])&&u(e,"aria-pressed",i),d[0]&1028&&O(e,"btn-primary",l[38]),d[0]&1028&&O(e,"btn-secondary",!l[38])},d(f){f&&S(e),r=!1,o()}}}function ll(l){let e,t=l[14].strings[l[35]]+"",s,n,i,r,o;function a(){return l[29](l[31],l[32],l[35])}return{c(){e=h("button"),s=I(t),n=j(),u(e,"type","button"),u(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),u(e,"aria-pressed",i=l[32]==l[35]),O(e,"btn-primary",l[32]==l[35]),O(e,"btn-secondary",l[32]!=l[35])},m(f,d){D(f,e,d),g(e,s),g(e,n),r||(o=W(e,"click",a),r=!0)},p(f,d){l=f,d[0]&16384&&t!==(t=l[14].strings[l[35]]+"")&&G(s,t),d[0]&1028&&i!==(i=l[32]==l[35])&&u(e,"aria-pressed",i),d[0]&1028&&O(e,"btn-primary",l[32]==l[35]),d[0]&1028&&O(e,"btn-secondary",l[32]!=l[35])},d(f){f&&S(e),r=!1,o()}}}function nl(l,e){let t,s,n,i,r,o,a=e[31].fullname+"",f,d,m,c,_;n=new lt({props:{user:e[31]}});let b=ce(Object.values(qe)),p=[];for(let v=0;v<b.length;v+=1)p[v]=ll(Vs(e,b,v));return{key:l,first:null,c(){t=h("div"),s=h("div"),J(n.$$.fragment),i=j(),r=h("div"),o=h("div"),f=I(a),d=j(),m=h("div");for(let v=0;v<p.length;v+=1)p[v].c();c=j(),u(s,"class","mx-3 my-2"),u(o,"class","py-2 mr-3 align-self-center"),u(m,"class","d-flex ml-auto mr-2 align-self-start"),u(r,"class","d-sm-flex flex-grow-1"),u(t,"class","list-group-item d-flex p-0"),this.first=t},m(v,w){D(v,t,w),g(t,s),K(n,s,null),g(t,i),g(t,r),g(r,o),g(o,f),g(r,d),g(r,m);for(let $=0;$<p.length;$+=1)p[$]&&p[$].m(m,null);g(t,c),_=!0},p(v,w){e=v;const $={};if(w[0]&1024&&($.user=e[31]),n.$set($),(!_||w[0]&1024)&&a!==(a=e[31].fullname+"")&&G(f,a),w[0]&17420){b=ce(Object.values(qe));let y;for(y=0;y<b.length;y+=1){const k=Vs(e,b,y);p[y]?p[y].p(k,w):(p[y]=ll(k),p[y].c(),p[y].m(m,null))}for(;y<p.length;y+=1)p[y].d(1);p.length=b.length}},i(v){_||(T(n.$$.fragment,v),_=!0)},o(v){z(n.$$.fragment,v),_=!1},d(v){v&&S(t),V(n),Ie(p,v)}}}function Gr(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,$,y=l[4]&&Qs(l);return{c(){e=h("div"),t=h("div"),s=h("i"),i=j(),r=h("input"),f=j(),d=h("div"),m=h("button"),c=h("i"),p=j(),y&&y.c(),u(s,"class",n="fa fa-fw "+(l[7]?"fa-spinner fa-pulse":"fa-user")),u(s,"aria-hidden","true"),u(t,"class","position-absolute h-100 d-flex justify-content-center align-items-center px-2"),ge(t,"top","0"),ge(t,"left","0"),u(r,"type","text"),u(r,"class","form-control px-5"),u(r,"placeholder",o=l[14].strings.addrecipients),u(r,"aria-label",a=l[14].strings.addrecipients),u(r,"autocomplete","off"),O(r,"is-invalid",!l[2].size),u(c,"class",_="fa fa-fw "+(l[5]?"fa-times":l[4]?"fa-caret-up":"fa-caret-down")),u(c,"aria-hidden","true"),u(m,"type","button"),u(m,"aria-expanded",l[4]),u(m,"class","btn px-2"),u(m,"title",b=l[14].strings.addrecipients),u(d,"class","position-absolute h-100 d-flex align-items-center"),ge(d,"top","0"),ge(d,"right","0"),u(e,"class","local-mail-draft-form-user-search-input form-group position-relative")},m(k,M){D(k,e,M),g(e,t),g(t,s),g(e,i),g(e,r),ye(r,l[5]),l[21](r),g(e,f),g(e,d),g(d,m),g(m,c),g(e,p),y&&y.m(e,null),v=!0,w||($=[W(r,"input",l[20]),W(r,"input",l[22]),W(r,"focus",l[18]),W(m,"click",Te(l[15])),Se(Ge.call(null,e,l[17]))],w=!0)},p(k,M){(!v||M[0]&128&&n!==(n="fa fa-fw "+(k[7]?"fa-spinner fa-pulse":"fa-user")))&&u(s,"class",n),(!v||M[0]&16384&&o!==(o=k[14].strings.addrecipients))&&u(r,"placeholder",o),(!v||M[0]&16384&&a!==(a=k[14].strings.addrecipients))&&u(r,"aria-label",a),M[0]&32&&r.value!==k[5]&&ye(r,k[5]),(!v||M[0]&4)&&O(r,"is-invalid",!k[2].size),(!v||M[0]&48&&_!==(_="fa fa-fw "+(k[5]?"fa-times":k[4]?"fa-caret-up":"fa-caret-down")))&&u(c,"class",_),(!v||M[0]&16)&&u(m,"aria-expanded",k[4]),(!v||M[0]&16384&&b!==(b=k[14].strings.addrecipients))&&u(m,"title",b),k[4]?y?(y.p(k,M),M[0]&16&&T(y,1)):(y=Qs(k),y.c(),T(y,1),y.m(e,null)):y&&(ne(),z(y,1,1,()=>{y=null}),ie())},i(k){v||(T(y),v=!0)},o(k){z(y),v=!1},d(k){k&&S(e),l[21](null),y&&y.d(),w=!1,$e($)}}}const Hr=500;function Or(l,e,t){let s,n=F,i=()=>(n(),n=de(r,q=>t(14,s=q)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{course:o}=e,{recipients:a}=e,{onChange:f}=e,d=!1,m="",c,_=!1,b,p=[],v=[],w=[],$=!1,y=o.id,k=0,M=0;const N=async()=>{d?(t(5,m=""),t(4,d=!1),window.clearTimeout(b)):(C(!1),c.focus())},C=async q=>{const B=s.settings.usersearchlimit;t(7,_=!0),window.clearTimeout(b),b=window.setTimeout(async()=>{var P;const Y=[{methodname:"get_roles",courseid:o.id},{methodname:"get_groups",courseid:o.id},{methodname:"search_users",query:{courseid:o.id,fullname:m,roleid:k,groupid:M},limit:B+1}];let se;try{se=await Qe(Y)}catch(be){r.setError(be),t(7,_=!1),t(4,d=!1),t(11,$=!1),t(10,w=[]);return}t(10,w=se.pop()),t(11,$=w.length>B),t(10,w=w.slice(0,B)),t(9,v=se.pop()),t(13,M=v.find(be=>be.id==M)?M:o.groupmode==at.Separate&&((P=v[0])==null?void 0:P.id)||0),t(8,p=se.pop()),t(12,k=p.find(be=>be.id==k)?k:0),t(7,_=!1),t(4,d=!0)},q?Hr:0)},L=()=>{t(5,m=""),t(4,d=!1)},A=()=>{d||C(!1)};function R(){m=this.value,t(5,m)}function E(q){Ce[q?"unshift":"push"](()=>{c=q,t(6,c)})}const H=()=>C(!0);function Q(){k=mt(this),t(12,k),t(19,y),t(1,o),t(8,p)}const le=()=>C(!1);function X(){M=mt(this),t(13,M),t(19,y),t(1,o),t(9,v)}const te=()=>C(!1),re=(q,B)=>f(w,q?null:B),x=(q,B)=>{var Y;return((Y=a.get(B.id))==null?void 0:Y.type)==q},Z=(q,B,Y)=>f([q],B==Y?null:Y);return l.$$set=q=>{"store"in q&&i(t(0,r=q.store)),"course"in q&&t(1,o=q.course),"recipients"in q&&t(2,a=q.recipients),"onChange"in q&&t(3,f=q.onChange)},l.$$.update=()=>{l.$$.dirty[0]&524290&&y!=o.id&&(t(19,y=o.id),t(12,k=0),t(13,M=0))},[r,o,a,f,d,m,c,_,p,v,w,$,k,M,s,N,C,L,A,y,R,E,H,Q,le,X,te,re,x,Z]}class Jr extends oe{constructor(e){super(),fe(this,e,Or,Gr,ae,{store:0,course:1,recipients:2,onChange:3},null,[-1,-1])}}function Kr(l){let e,t,s,n=l[1].strings.send+"",i,r,o,a;return{c(){e=h("button"),t=h("i"),s=j(),i=I(n),u(t,"class","fa fa-send mr-2"),u(e,"type","button"),u(e,"class","local-mail-action-send btn btn-primary flex-shrink-0 text-nowrap px-3 text-truncate ml-auto"),u(e,"title",r=l[1].strings.send)},m(f,d){D(f,e,d),g(e,t),g(e,s),g(e,i),o||(a=W(e,"click",l[2]),o=!0)},p(f,[d]){d&2&&n!==(n=f[1].strings.send+"")&&G(i,n),d&2&&r!==(r=f[1].strings.send)&&u(e,"title",r)},i:F,o:F,d(f){f&&S(e),o=!1,a()}}}function Vr(l,e,t){let s,n=F,i=()=>(n(),n=de(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=()=>r.sendMessage();return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class hn extends oe{constructor(e){super(),fe(this,e,Vr,Kr,ae,{store:0})}}const{Map:Wr}=st;function il(l,e,t){const s=l.slice();return s[18]=e[t],s}function rl(l){let e,t,s,n=l[7].strings.errorinvalidrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=j(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,o){D(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=r[7].strings.errorinvalidrecipients+"")&&G(i,n)},d(r){r&&S(e)}}}function Xr(l){let e,t,s,n=Ae(l[7].strings.errortoomanyrecipients,l[7].settings.maxrecipients)+"",i;return{c(){e=h("div"),t=h("i"),s=j(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,o){D(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=Ae(r[7].strings.errortoomanyrecipients,r[7].settings.maxrecipients)+"")&&G(i,n)},d(r){r&&S(e)}}}function Yr(l){let e,t,s,n=l[7].strings.erroremptyrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=j(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,o){D(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=r[7].strings.erroremptyrecipients+"")&&G(i,n)},d(r){r&&S(e)}}}function al(l){let e,t,s,n=l[7].strings.erroremptysubject+"",i;return{c(){e=h("div"),t=h("i"),s=j(),i=I(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,o){D(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=r[7].strings.erroremptysubject+"")&&G(i,n)},d(r){r&&S(e)}}}function ol(l){let e,t=l[7].strings.references+"",s,n,i=[],r=new Wr,o,a,f=ce(l[1].references);const d=m=>m[18].id;for(let m=0;m<f.length;m+=1){let c=il(l,f,m),_=d(c);r.set(_,i[m]=fl(_,c))}return{c(){e=h("div"),s=I(t),n=j();for(let m=0;m<i.length;m+=1)i[m].c();o=pe(),u(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(m,c){D(m,e,c),g(e,s),D(m,n,c);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(m,c);D(m,o,c),a=!0},p(m,c){(!a||c&128)&&t!==(t=m[7].strings.references+"")&&G(s,t),c&130&&(f=ce(m[1].references),ne(),i=je(i,c,d,1,m,f,r,o.parentNode,He,fl,o,il),ie())},i(m){if(!a){for(let c=0;c<f.length;c+=1)T(i[c]);a=!0}},o(m){for(let c=0;c<i.length;c+=1)z(i[c]);a=!1},d(m){m&&(S(e),S(n),S(o));for(let c=0;c<i.length;c+=1)i[c].d(m)}}}function fl(l,e){let t,s,n;return s=new bn({props:{strings:e[7].strings,reference:e[18]}}),{key:l,first:null,c(){t=pe(),J(s.$$.fragment),this.first=t},m(i,r){D(i,t,r),K(s,i,r),n=!0},p(i,r){e=i;const o={};r&128&&(o.strings=e[7].strings),r&2&&(o.reference=e[18]),s.$set(o)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&S(t),V(s,i)}}}function Qr(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,$,y,k,M,N,C=l[2].editorhtml+"",L,A,R=l[2].filemanagerhtml+"",E,H=Array.from(l[5].values()).some(ul),Q,le,X=!l[4].trim(),te,re,x,Z,q,B,Y,se;e=new _n({props:{javascript:l[2].javascript}}),r=new Pr({props:{store:l[0],message:l[1]}}),d=new Wl({props:{settings:l[7].settings,strings:l[7].strings,courses:l[7].courses,label:l[7].strings.course,selected:l[6].id,required:!0,readonly:l[1].references.length>0,style:"filter-left",onChange:l[8]}}),_=new Jr({props:{store:l[0],course:l[6],recipients:l[5],onChange:l[9]}}),p=new Ar({props:{store:l[0],recipients:l[5],onDelete:l[10]}});let P=H&&rl(l);function be(U,ue){if(U[5].size==0)return Yr;if(U[5].size>U[7].settings.maxrecipients)return Xr}let ee=be(l),he=ee&&ee(l),ke=X&&al(l);x=new hn({props:{store:l[0]}});let _e=l[1].references.length>0&&ol(l);return{c(){J(e.$$.fragment),t=j(),s=h("hr"),n=j(),i=h("form"),J(r.$$.fragment),o=j(),a=h("div"),f=h("div"),J(d.$$.fragment),m=j(),c=h("div"),J(_.$$.fragment),b=j(),J(p.$$.fragment),v=j(),w=h("div"),$=h("input"),M=j(),N=h("div"),L=j(),A=h("div"),E=j(),P&&P.c(),Q=j(),he&&he.c(),le=j(),ke&&ke.c(),te=j(),re=h("div"),J(x.$$.fragment),Z=j(),_e&&_e.c(),q=pe(),u(s,"class","d-lg-none mt-0 mb-3 mb-sm-2"),u(f,"class","form-group col-12 col-xl-5"),u(c,"class","col-12 col-xl-7"),u(a,"class","row"),u($,"type","text"),u($,"id","local-mail-message-form-subject"),u($,"class","form-control"),u($,"placeholder",y=l[7].strings.subject),u($,"aria-label",k=l[7].strings.subject),u($,"autocomplete","off"),u($,"maxlength","100"),O($,"is-invalid",!l[4].trim()),u(w,"class","form-group"),u(N,"class","form-group"),u(A,"class","form-group"),u(re,"class","d-flex justify-content-end align-items-center"),u(i,"class","pt-lg-2 pb-3 px-lg-4"),O(i,"card",l[7].viewportSize>=me.LG)},m(U,ue){K(e,U,ue),D(U,t,ue),D(U,s,ue),D(U,n,ue),D(U,i,ue),K(r,i,null),g(i,o),g(i,a),g(a,f),K(d,f,null),g(a,m),g(a,c),K(_,c,null),g(i,b),K(p,i,null),g(i,v),g(i,w),g(w,$),ye($,l[4]),g(i,M),g(i,N),N.innerHTML=C,g(i,L),g(i,A),A.innerHTML=R,g(i,E),P&&P.m(i,null),g(i,Q),he&&he.m(i,null),g(i,le),ke&&ke.m(i,null),g(i,te),g(i,re),K(x,re,null),l[15](i),D(U,Z,ue),_e&&_e.m(U,ue),D(U,q,ue),B=!0,Y||(se=[W($,"input",l[12]),W($,"input",l[13]),W(N,"change",l[14]),W(i,"submit",Te(l[16]))],Y=!0)},p(U,[ue]){const Ne={};ue&4&&(Ne.javascript=U[2].javascript),e.$set(Ne);const Me={};ue&1&&(Me.store=U[0]),ue&2&&(Me.message=U[1]),r.$set(Me);const ve={};ue&128&&(ve.settings=U[7].settings),ue&128&&(ve.strings=U[7].strings),ue&128&&(ve.courses=U[7].courses),ue&128&&(ve.label=U[7].strings.course),ue&64&&(ve.selected=U[6].id),ue&2&&(ve.readonly=U[1].references.length>0),d.$set(ve);const Le={};ue&1&&(Le.store=U[0]),ue&64&&(Le.course=U[6]),ue&32&&(Le.recipients=U[5]),_.$set(Le);const Je={};ue&1&&(Je.store=U[0]),ue&32&&(Je.recipients=U[5]),p.$set(Je),(!B||ue&128&&y!==(y=U[7].strings.subject))&&u($,"placeholder",y),(!B||ue&128&&k!==(k=U[7].strings.subject))&&u($,"aria-label",k),ue&16&&$.value!==U[4]&&ye($,U[4]),(!B||ue&16)&&O($,"is-invalid",!U[4].trim()),(!B||ue&4)&&C!==(C=U[2].editorhtml+"")&&(N.innerHTML=C),(!B||ue&4)&&R!==(R=U[2].filemanagerhtml+"")&&(A.innerHTML=R),ue&32&&(H=Array.from(U[5].values()).some(ul)),H?P?P.p(U,ue):(P=rl(U),P.c(),P.m(i,Q)):P&&(P.d(1),P=null),ee===(ee=be(U))&&he?he.p(U,ue):(he&&he.d(1),he=ee&&ee(U),he&&(he.c(),he.m(i,le))),ue&16&&(X=!U[4].trim()),X?ke?ke.p(U,ue):(ke=al(U),ke.c(),ke.m(i,te)):ke&&(ke.d(1),ke=null);const Re={};ue&1&&(Re.store=U[0]),x.$set(Re),(!B||ue&128)&&O(i,"card",U[7].viewportSize>=me.LG),U[1].references.length>0?_e?(_e.p(U,ue),ue&2&&T(_e,1)):(_e=ol(U),_e.c(),T(_e,1),_e.m(q.parentNode,q)):_e&&(ne(),z(_e,1,1,()=>{_e=null}),ie())},i(U){B||(T(e.$$.fragment,U),T(r.$$.fragment,U),T(d.$$.fragment,U),T(_.$$.fragment,U),T(p.$$.fragment,U),T(x.$$.fragment,U),T(_e),B=!0)},o(U){z(e.$$.fragment,U),z(r.$$.fragment,U),z(d.$$.fragment,U),z(_.$$.fragment,U),z(p.$$.fragment,U),z(x.$$.fragment,U),z(_e),B=!1},d(U){U&&(S(t),S(s),S(n),S(i),S(Z),S(q)),V(e,U),V(r),V(d),V(_),V(p),P&&P.d(),he&&he.d(),ke&&ke.d(),V(x),l[15](null),_e&&_e.d(U),Y=!1,$e(se)}}}const ul=l=>!l.isvalid;function Zr(l,e,t){let s,n,i,r,o=F,a=()=>(o(),o=de(f,C=>t(7,r=C)),f);l.$$.on_destroy.push(()=>o());let{store:f}=e;a();let{message:d}=e,{form:m}=e,c;et(()=>{c==null||c.addEventListener("core_form/uploadChanged",()=>w(!1));const C=_();return()=>{C()}});const _=()=>{let C,L;const A=()=>{L==null||L.save(),w(!1)},R=E=>{E.editor.id==`local-mail-compose-editor-${d.id}`&&(L==null||L.off("input",A),L==null||L.off("ExecCommand",A),L=E.editor,E.editor.on("input",A),E.editor.on("ExecCommand",A))};return ft("editor_tiny/loader").then(async E=>{C=await E.getTinyMCE(),C.EditorManager.get().forEach(H=>R({editor:H})),C.EditorManager.on("SetupEditor",R)}),()=>{C==null||C.EditorManager.off("SetupEditor",R),L==null||L.off("input",A),L==null||L.off("ExecCommand",A)}},b=C=>{t(6,s=r.courses.find(L=>L.id==C)||r.courses[0]),w(!0)},p=(C,L)=>{const A=new Map(i);for(const E of C)L?A.set(E.id,{...E,type:L,isvalid:!0}):A.delete(E.id);const R=Array.from(A.values());R.sort((E,H)=>E.sortorder.localeCompare(H.sortorder)),t(5,i=new Map(R.map(E=>[E.id,E]))),w(!1)},v=C=>{p([C],null)},w=async C=>{var R,E,H;if(!c)return;const L=new FormData(c),A={courseid:s.id,to:Array.from(i.values()).filter(Q=>Q.type=="to").map(Q=>Q.id),cc:Array.from(i.values()).filter(Q=>Q.type=="cc").map(Q=>Q.id),bcc:Array.from(i.values()).filter(Q=>Q.type=="bcc").map(Q=>Q.id),subject:n,content:((R=L.get("content[text]"))==null?void 0:R.toString())||"",format:parseInt(((E=L.get("content[format]"))==null?void 0:E.toString())||"")||1,draftitemid:parseInt(((H=L.get("content[itemid]"))==null?void 0:H.toString())||"")||0};await f.updateDraft(A,C)};function $(){n=this.value,t(4,n),t(1,d)}const y=()=>w(!1),k=()=>w(!1);function M(C){Ce[C?"unshift":"push"](()=>{c=C,t(3,c)})}const N=()=>w(!0);return l.$$set=C=>{"store"in C&&a(t(0,f=C.store)),"message"in C&&t(1,d=C.message),"form"in C&&t(2,m=C.form)},l.$$.update=()=>{l.$$.dirty&2&&t(6,s=d.course),l.$$.dirty&2&&t(4,n=d.subject),l.$$.dirty&2&&t(5,i=new Map(d.recipients.map(C=>[C.id,C])))},[f,d,m,c,n,i,s,r,b,p,v,w,$,y,k,M,N]}class xr extends oe{constructor(e){super(),fe(this,e,Zr,Qr,ae,{store:0,message:1,form:2})}}function cl(l,e,t){const s=l.slice();return s[7]=e[t],s}function ml(l){let e,t=l[7]+"",s,n;return{c(){e=h("option"),s=I(t),e.__value=n=l[7],ye(e,e.__value)},m(i,r){D(i,e,r),g(e,s)},p(i,r){r&8&&t!==(t=i[7]+"")&&G(s,t),r&8&&n!==(n=i[7])&&(e.__value=n,ye(e,e.__value))},d(i){i&&S(e)}}}function ea(l){let e,t,s,n=l[1].strings.messagesperpage+"",i,r,o,a,f,d,m=ce(l[3]),c=[];for(let _=0;_<m.length;_+=1)c[_]=ml(cl(l,m,_));return{c(){e=h("div"),t=h("div"),s=h("label"),i=I(n),r=I(":"),o=j(),a=h("select");for(let _=0;_<c.length;_+=1)c[_].c();u(s,"for","local-mail-perpage-select"),u(a,"id","local-mail-perpage-select"),u(a,"class","custom-select"),l[2]===void 0&&ze(()=>l[4].call(a)),u(t,"class","form-group"),u(e,"class","form-inline justify-content-end mt-3")},m(_,b){D(_,e,b),g(e,t),g(t,s),g(s,i),g(s,r),g(t,o),g(t,a);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(a,null);Ze(a,l[2],!0),f||(d=[W(a,"change",l[4]),W(a,"change",l[5])],f=!0)},p(_,[b]){if(b&2&&n!==(n=_[1].strings.messagesperpage+"")&&G(i,n),b&8){m=ce(_[3]);let p;for(p=0;p<m.length;p+=1){const v=cl(_,m,p);c[p]?c[p].p(v,b):(c[p]=ml(v),c[p].c(),c[p].m(a,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=m.length}b&12&&Ze(a,_[2])},i:F,o:F,d(_){_&&S(e),Ie(c,_),f=!1,$e(d)}}}function ta(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,c=>t(1,n=c)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();const a=[5,10,20,50,100];let f=n.preferences.perpage;function d(){f=mt(this),t(2,f),t(3,s),t(1,n)}const m=()=>o.savePreferences({perpage:f});return l.$$set=c=>{"store"in c&&r(t(0,o=c.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=a.includes(n.preferences.perpage)?a:a.concat([n.preferences.perpage]).sort((c,_)=>c-_))},[o,n,f,s,d,m]}class sa extends oe{constructor(e){super(),fe(this,e,ta,ea,ae,{store:0})}}function dl(l,e,t){const s=l.slice();return s[9]=e[t],s}function _l(l){let e,t,s=l[4].strings.locked+"",n,i;return{c(){e=h("span"),t=I("("),n=I(s),i=I(")"),u(e,"class","ml-1")},m(r,o){D(r,e,o),g(e,t),g(e,n),g(e,i)},p(r,o){o&16&&s!==(s=r[4].strings.locked+"")&&G(n,s)},d(r){r&&S(e)}}}function gl(l){let e,t,s,n,i,r,o,a=l[9].displayname+"",f,d,m,c,_;function b(){return l[8](l[9])}let p=l[9].locked&&_l(l);return{c(){e=h("div"),t=h("input"),r=j(),o=h("label"),f=I(a),d=j(),p&&p.c(),u(t,"id",s="local-mail-preferences-messageprocessor-"+l[9].name),u(t,"class","custom-control-input"),u(t,"type","checkbox"),t.checked=n=l[9].locked?l[9].enabled:l[3].includes(l[9].name),t.disabled=i=l[9].locked,u(o,"for",m="local-mail-preferences-messageprocessor-"+l[9].name),u(o,"class","custom-control-label pl-1"),u(e,"class","custom-control custom-switch my-2")},m(v,w){D(v,e,w),g(e,t),g(e,r),g(e,o),g(o,f),g(o,d),p&&p.m(o,null),c||(_=W(t,"click",b),c=!0)},p(v,w){l=v,w&16&&s!==(s="local-mail-preferences-messageprocessor-"+l[9].name)&&u(t,"id",s),w&24&&n!==(n=l[9].locked?l[9].enabled:l[3].includes(l[9].name))&&(t.checked=n),w&16&&i!==(i=l[9].locked)&&(t.disabled=i),w&16&&a!==(a=l[9].displayname+"")&&G(f,a),l[9].locked?p?p.p(l,w):(p=_l(l),p.c(),p.m(o,null)):p&&(p.d(1),p=null),w&16&&m!==(m="local-mail-preferences-messageprocessor-"+l[9].name)&&u(o,"for",m)},d(v){v&&S(e),p&&p.d(),c=!1,_()}}}function la(l){let e,t=l[4].strings.notifications+"",s,n,i,r,o,a,f,d,m,c=l[4].strings.markmessagesasread+"",_,b,p,v=ce(l[4].settings.messageprocessors),w=[];for(let $=0;$<v.length;$+=1)w[$]=gl(dl(l,v,$));return{c(){e=h("h6"),s=I(t),n=j();for(let $=0;$<w.length;$+=1)w[$].c();i=j(),r=h("div"),o=h("input"),d=j(),m=h("label"),_=I(c),u(e,"class","mb-3"),u(o,"id","local-mail-preferences-markasread"),u(o,"class","custom-control-input"),u(o,"type","checkbox"),o.checked=a=l[2]&&l[3].length>0,o.disabled=f=l[3].length==0,u(m,"for","local-mail-preferences-markasread"),u(m,"class","custom-control-label pl-1"),u(r,"class","custom-control custom-switch my-2 mt-3")},m($,y){D($,e,y),g(e,s),D($,n,y);for(let k=0;k<w.length;k+=1)w[k]&&w[k].m($,y);D($,i,y),D($,r,y),g(r,o),g(r,d),g(r,m),g(m,_),b||(p=W(o,"click",l[6]),b=!0)},p($,y){if(y&16&&t!==(t=$[4].strings.notifications+"")&&G(s,t),y&152){v=ce($[4].settings.messageprocessors);let k;for(k=0;k<v.length;k+=1){const M=dl($,v,k);w[k]?w[k].p(M,y):(w[k]=gl(M),w[k].c(),w[k].m(i.parentNode,i))}for(;k<w.length;k+=1)w[k].d(1);w.length=v.length}y&12&&a!==(a=$[2]&&$[3].length>0)&&(o.checked=a),y&8&&f!==(f=$[3].length==0)&&(o.disabled=f),y&16&&c!==(c=$[4].strings.markmessagesasread+"")&&G(_,c)},d($){$&&(S(e),S(n),S(i),S(r)),Ie(w,$),b=!1,p()}}}function na(l){let e,t;return e=new Oe({props:{title:l[4].strings.preferences,confirmText:l[4].strings.save,cancelText:l[4].strings.cancel,onConfirm:l[5],onCancel:l[1],$$slots:{default:[la]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,[n]){const i={};n&16&&(i.title=s[4].strings.preferences),n&16&&(i.confirmText=s[4].strings.save),n&16&&(i.cancelText=s[4].strings.cancel),n&2&&(i.onCancel=s[1]),n&4124&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function ia(l,e,t){let s,n=F,i=()=>(n(),n=de(r,b=>t(4,s=b)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{onCancel:o}=e,a=s.preferences.markasread,f=s.settings.messageprocessors.map(b=>b.name).filter(b=>s.preferences.notifications.includes(b));const d=()=>{o(),r.savePreferences({markasread:a,notifications:f})},m=()=>{t(2,a=!a)},c=b=>{t(3,f=f.includes(b)?f.filter(p=>p!=b):[...f,b])},_=b=>c(b.name);return l.$$set=b=>{"store"in b&&i(t(0,r=b.store)),"onCancel"in b&&t(1,o=b.onCancel)},[r,o,a,f,s,d,m,c,_]}class ra extends oe{constructor(e){super(),fe(this,e,ia,na,ae,{store:0,onCancel:1})}}function aa(l){let e,t,s,n;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-question-circle text-info"),u(t,"role","img"),u(t,"title",s=l[2].strings.help),u(e,"type","button"),u(e,"class","btn btn-help p-0"),u(e,"data-container","body"),u(e,"data-toggle","popover"),u(e,"data-placement","top"),u(e,"data-content",l[1]),u(e,"data-trigger","focus"),u(e,"aria-label",n=l[2].strings.help)},m(i,r){D(i,e,r),g(e,t)},p(i,[r]){r&4&&s!==(s=i[2].strings.help)&&u(t,"title",s),r&2&&u(e,"data-content",i[1]),r&4&&n!==(n=i[2].strings.help)&&u(e,"aria-label",n)},i:F,o:F,d(i){i&&S(e)}}}function oa(l,e,t){let s,n=F,i=()=>(n(),n=de(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class fa extends oe{constructor(e){super(),fe(this,e,oa,aa,ae,{store:0,message:1})}}function ua(l){let e,t,s,n=l[9].strings.searchfrom+"",i,r,o,a,f,d,m,c=l[9].strings.searchto+"",_,b,p,v,w,$,y,k=l[9].strings.searchdate+"",M,N,C,L,A,R,E,H,Q,le,X,te,re=l[9].strings.searchunreadonly+"",x,Z,q,B,Y,se,P=l[9].strings.searchhasattachments+"",be,ee,he,ke,_e,U,ue,Ne;return C=new fa({props:{store:l[4],message:l[9].strings.searchdatehelp}}),{c(){e=h("div"),t=h("div"),s=h("label"),i=I(n),r=j(),o=h("div"),a=h("input"),f=j(),d=h("div"),m=h("label"),_=I(c),b=j(),p=h("div"),v=h("input"),w=j(),$=h("div"),y=h("label"),M=I(k),N=j(),J(C.$$.fragment),L=j(),A=h("div"),R=h("input"),E=j(),H=h("div"),Q=h("div"),le=h("input"),X=j(),te=h("label"),x=I(re),Z=j(),q=h("div"),B=h("input"),Y=j(),se=h("label"),be=I(P),ee=j(),he=h("input"),u(s,"for","local-mail-search-input-sendername"),u(s,"class","col-4 col-form-label pr-0"),u(a,"type","text"),u(a,"class","form-control"),u(a,"id","local-mail-search-input-sendername"),u(o,"class","col-8"),u(t,"class","form-group row"),u(m,"for","local-mail-search-input-recipientname"),u(m,"class","col-4 col-form-label pr-0"),u(v,"type","text"),u(v,"class","form-control"),u(v,"id","local-mail-search-input-recipientname"),u(p,"class","col-8 p"),u(d,"class","form-group row"),u(y,"for","local-mail-search-input-maxdate"),u(y,"class","col-4 col-form-label pr-0"),u(R,"type","date"),u(R,"class","form-control"),u(R,"id","local-mail-search-input-maxdate"),u(R,"max",l[10]),R.value=l[8],u(A,"class","col-8"),u($,"class","form-group row"),u(le,"class","form-check-input"),u(le,"type","checkbox"),u(le,"id","local-mail-search-input-unread"),u(te,"class","form-check-label"),u(te,"for","local-mail-search-input-unread"),u(Q,"class","form-check"),u(B,"class","form-check-input"),u(B,"type","checkbox"),u(B,"id","local-mail-search-input-withfilesonly"),u(se,"class","form-check-label"),u(se,"for","local-mail-search-input-withfilesonly"),u(q,"class","form-check"),u(he,"type","submit"),he.disabled=ke=!l[6],u(he,"class","btn btn-primary px-3 ml-auto"),he.value=_e=l[9].strings.search,u(H,"class","d-flex flex-wrap align-items-center"),ge(H,"column-gap","2rem"),ge(H,"row-gap","1rem"),u(e,"class","dropdown-menu dropdown-menu-left show p-3 w-100"),ge(e,"min-width","18rem")},m(Me,ve){D(Me,e,ve),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),g(o,a),ye(a,l[0]),l[15](a),g(e,f),g(e,d),g(d,m),g(m,_),g(d,b),g(d,p),g(p,v),ye(v,l[1]),g(e,w),g(e,$),g($,y),g(y,M),g(y,N),K(C,y,null),g($,L),g($,A),g(A,R),g(e,E),g(e,H),g(H,Q),g(Q,le),le.checked=l[2],g(Q,X),g(Q,te),g(te,x),g(H,Z),g(H,q),g(q,B),B.checked=l[3],g(q,Y),g(q,se),g(se,be),g(H,ee),g(H,he),U=!0,ue||(Ne=[W(a,"input",l[14]),W(v,"input",l[16]),W(R,"input",l[11]),W(le,"change",l[17]),W(B,"change",l[18]),W(he,"click",Te(function(){De(l[5])&&l[5].apply(this,arguments)}))],ue=!0)},p(Me,[ve]){l=Me,(!U||ve&512)&&n!==(n=l[9].strings.searchfrom+"")&&G(i,n),ve&1&&a.value!==l[0]&&ye(a,l[0]),(!U||ve&512)&&c!==(c=l[9].strings.searchto+"")&&G(_,c),ve&2&&v.value!==l[1]&&ye(v,l[1]),(!U||ve&512)&&k!==(k=l[9].strings.searchdate+"")&&G(M,k);const Le={};ve&16&&(Le.store=l[4]),ve&512&&(Le.message=l[9].strings.searchdatehelp),C.$set(Le),(!U||ve&256)&&(R.value=l[8]),ve&4&&(le.checked=l[2]),(!U||ve&512)&&re!==(re=l[9].strings.searchunreadonly+"")&&G(x,re),ve&8&&(B.checked=l[3]),(!U||ve&512)&&P!==(P=l[9].strings.searchhasattachments+"")&&G(be,P),(!U||ve&64&&ke!==(ke=!l[6]))&&(he.disabled=ke),(!U||ve&512&&_e!==(_e=l[9].strings.search))&&(he.value=_e)},i(Me){U||(T(C.$$.fragment,Me),U=!0)},o(Me){z(C.$$.fragment,Me),U=!1},d(Me){Me&&S(e),l[15](null),V(C),ue=!1,$e(Ne)}}}function ca(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,L=>t(9,n=L)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{sendername:a=""}=e,{recipientname:f=""}=e,{unread:d=!1}=e,{withfilesonly:m=!1}=e,{maxtime:c=0}=e,{submit:_}=e,{submitEnabled:b}=e;function p(){v.focus()}let v,w=Lt(Math.floor(new Date().getTime()/1e3));const $=L=>{t(12,c=jn(L.target.value))};function y(){a=this.value,t(0,a)}function k(L){Ce[L?"unshift":"push"](()=>{v=L,t(7,v)})}function M(){f=this.value,t(1,f)}function N(){d=this.checked,t(2,d)}function C(){m=this.checked,t(3,m)}return l.$$set=L=>{"store"in L&&r(t(4,o=L.store)),"sendername"in L&&t(0,a=L.sendername),"recipientname"in L&&t(1,f=L.recipientname),"unread"in L&&t(2,d=L.unread),"withfilesonly"in L&&t(3,m=L.withfilesonly),"maxtime"in L&&t(12,c=L.maxtime),"submit"in L&&t(5,_=L.submit),"submitEnabled"in L&&t(6,b=L.submitEnabled)},l.$$.update=()=>{l.$$.dirty&4096&&t(8,s=Lt(c))},[a,f,d,m,o,_,b,v,s,n,w,$,c,p,y,k,M,N,C]}class ma extends oe{constructor(e){super(),fe(this,e,ca,ua,ae,{store:4,sendername:0,recipientname:1,unread:2,withfilesonly:3,maxtime:12,submit:5,submitEnabled:6,focus:13})}get focus(){return this.$$.ctx[13]}}const{Boolean:da}=st;function pl(l,e,t){const s=l.slice();return s[14]=e[t],s[16]=t,s}function bl(l){let e,t,s,n=ce(l[4]),i=[];for(let d=0;d<n.length;d+=1)i[d]=hl(pl(l,n,d));const r=d=>z(i[d],1,1,()=>{i[d]=null});function o(d,m){if(d[5])return pa;if(!d[4].length)return ga}let a=o(l),f=a&&a(l);return{c(){e=h("div");for(let d=0;d<i.length;d+=1)i[d].c();t=j(),f&&f.c(),u(e,"class","dropdown-menu dropdown-menu-left overflow-hidden show p-0 w-100"),ge(e,"min-width","18rem")},m(d,m){D(d,e,m);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);g(e,t),f&&f.m(e,null),s=!0},p(d,m){if(m&401){n=ce(d[4]);let c;for(c=0;c<n.length;c+=1){const _=pl(d,n,c);i[c]?(i[c].p(_,m),T(i[c],1)):(i[c]=hl(_),i[c].c(),T(i[c],1),i[c].m(e,t))}for(ne(),c=n.length;c<i.length;c+=1)r(c);ie()}a===(a=o(d))&&f?f.p(d,m):(f&&f.d(1),f=a&&a(d),f&&(f.c(),f.m(e,null)))},i(d){if(!s){for(let m=0;m<n.length;m+=1)T(i[m]);s=!0}},o(d){i=i.filter(da);for(let m=0;m<i.length;m+=1)z(i[m]);s=!1},d(d){d&&S(e),Ie(i,d),f&&f.d()}}}function _a(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider my-0")},m(t,s){D(t,e,s)},d(t){t&&S(e)}}}function hl(l){let e,t,s,n,i,r,o,a,f=l[14].shorttime+"",d,m,c,_,b,p,v=l[16]>0&&_a();return s=new bt({props:{store:l[0],message:l[14]}}),r=new pt({props:{store:l[0],message:l[14]}}),{c(){v&&v.c(),e=j(),t=h("a"),J(s.$$.fragment),n=j(),i=h("div"),J(r.$$.fragment),o=j(),a=h("div"),d=I(f),u(a,"title",m=l[14].fulltime),u(a,"class","ml-auto"),u(i,"class","local-mail-incremental-search-muted d-flex"),u(t,"class","dropdown-item local-mail-incremental-search-item"),u(t,"href",c=Pe(l[7](l[14],l[16]))),O(t,"font-weight-bold",l[14].unread)},m(w,$){v&&v.m(w,$),D(w,e,$),D(w,t,$),K(s,t,null),g(t,n),g(t,i),K(r,i,null),g(i,o),g(i,a),g(a,d),_=!0,b||(p=W(t,"click",function(){De(l[8](l[14],l[16]))&&l[8](l[14],l[16]).apply(this,arguments)}),b=!0)},p(w,$){l=w;const y={};$&1&&(y.store=l[0]),$&16&&(y.message=l[14]),s.$set(y);const k={};$&1&&(k.store=l[0]),$&16&&(k.message=l[14]),r.$set(k),(!_||$&16)&&f!==(f=l[14].shorttime+"")&&G(d,f),(!_||$&16&&m!==(m=l[14].fulltime))&&u(a,"title",m),(!_||$&144&&c!==(c=Pe(l[7](l[14],l[16]))))&&u(t,"href",c),(!_||$&16)&&O(t,"font-weight-bold",l[14].unread)},i(w){_||(T(s.$$.fragment,w),T(r.$$.fragment,w),_=!0)},o(w){z(s.$$.fragment,w),z(r.$$.fragment,w),_=!1},d(w){w&&(S(e),S(t)),v&&v.d(w),V(s),V(r),b=!1,p()}}}function ga(l){let e,t=l[3].strings.nomessagesfound+"",s;return{c(){e=h("div"),s=I(t),u(e,"class","px-4 py-2 text-danger")},m(n,i){D(n,e,i),g(e,s)},p(n,i){i&8&&t!==(t=n[3].strings.nomessagesfound+"")&&G(s,t)},d(n){n&&S(e)}}}function pa(l){let e,t,s,n=l[3].strings.searchallmessages+"",i,r,o,a;return{c(){e=h("div"),t=j(),s=h("a"),i=I(n),u(e,"class","dropdown-divider my-0"),u(s,"class","dropdown-item py-2"),u(s,"href",r=Pe(l[6]))},m(f,d){D(f,e,d),D(f,t,d),D(f,s,d),g(s,i),o||(a=W(s,"click",Te(l[12])),o=!0)},p(f,d){d&8&&n!==(n=f[3].strings.searchallmessages+"")&&G(i,n),d&64&&r!==(r=Pe(f[6]))&&u(s,"href",r)},d(f){f&&(S(e),S(t),S(s)),o=!1,a()}}}function ba(l){let e,t,s=l[1]&&l[4]!=null&&bl(l);return{c(){s&&s.c(),e=pe()},m(n,i){s&&s.m(n,i),D(n,e,i),t=!0},p(n,[i]){n[1]&&n[4]!=null?s?(s.p(n,i),i&18&&T(s,1)):(s=bl(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&S(e),s&&s.d(n)}}}const ct=10,ha=500;function ka(l,e,t){let s,n,i,r=F,o=()=>(r(),r=de(a,y=>t(3,i=y)),a);l.$$.on_destroy.push(()=>r());let{store:a}=e;o();let{enabled:f}=e,{content:d}=e,{loading:m=!1}=e,{onClick:c}=e,_,b,p=!1;const v=async y=>{t(9,m=!0),window.clearTimeout(_),t(11,_=window.setTimeout(async()=>{const k=i.params,N={methodname:"search_messages",query:{courseid:k.courseid,labelid:k.tray=="label"?k.labelid:void 0,draft:k.tray=="drafts"?!0:k.tray=="sent"?!1:void 0,roles:k.tray=="inbox"?Object.values(qe):k.tray=="sent"?["from"]:void 0,starred:k.tray=="starred"?!0:void 0,deleted:k.tray=="trash",content:y.trim(),stopid:i.incrementalSearchStopId},limit:ct+1};let C;try{C=await Qe([N])}catch(L){a.setError(L),t(9,m=!1),t(4,b=void 0);return}t(9,m=!1),t(4,b=C[0]),t(5,p=b.length>ct||!!i.incrementalSearchStopId),t(4,b=b.slice(0,ct))},ha))},w=(y,k)=>M=>{y.draft||(M.preventDefault(),c(s(y,k)))};dt(()=>{window.clearTimeout(_)});const $=()=>c(n);return l.$$set=y=>{"store"in y&&o(t(0,a=y.store)),"enabled"in y&&t(1,f=y.enabled),"content"in y&&t(10,d=y.content),"loading"in y&&t(9,m=y.loading),"onClick"in y&&t(2,c=y.onClick)},l.$$.update=()=>{l.$$.dirty&3074&&(f?v(d):(t(4,b=void 0),t(9,m=!1),window.clearTimeout(_))),l.$$.dirty&1032&&t(7,s=(y,k)=>({...i.params,messageid:y.id,offset:k,search:{content:d.trim()}})),l.$$.dirty&1032&&t(6,n={...i.params,messageid:void 0,offset:0,search:{content:d.trim()}})},[a,f,c,i,b,p,n,s,w,m,d,_,$]}class va extends oe{constructor(e){super(),fe(this,e,ka,ba,ae,{store:0,enabled:1,content:10,loading:9,onClick:2})}}function kl(l,e,t){const s=l.slice();return s[35]=e[t].label,s[36]=e[t].value,s[38]=t,s}function wa(l){let e,t,s,n=ce(l[15]),i=[];for(let r=0;r<n.length;r+=1)i[r]=wl(kl(l,n,r));return{c(){e=h("button");for(let r=0;r<i.length;r+=1)i[r].c();u(e,"type","button"),u(e,"class","local-mail-search-box-input-enabled alert-primary form-control text-left text-truncate")},m(r,o){D(r,e,o);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null);t||(s=W(e,"click",l[16]),t=!0)},p(r,o){if(o[0]&32768){n=ce(r[15]);let a;for(a=0;a<n.length;a+=1){const f=kl(r,n,a);i[a]?i[a].p(f,o):(i[a]=wl(f),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}},d(r){r&&S(e),Ie(i,r),t=!1,s()}}}function $a(l){let e,t,s,n,i;return{c(){e=h("input"),u(e,"type","text"),u(e,"class","local-mail-search-box-input form-control"),u(e,"placeholder",t=l[7].strings.search),u(e,"aria-label",s=l[7].strings.search),u(e,"autocomplete","off"),O(e,"local-mail-search-box-input-enabled",l[14]||l[13])},m(r,o){D(r,e,o),ye(e,l[1]),l[26](e),n||(i=[W(e,"input",l[25]),W(e,"keypress",l[21])],n=!0)},p(r,o){o[0]&128&&t!==(t=r[7].strings.search)&&u(e,"placeholder",t),o[0]&128&&s!==(s=r[7].strings.search)&&u(e,"aria-label",s),o[0]&2&&e.value!==r[1]&&ye(e,r[1]),o[0]&24576&&O(e,"local-mail-search-box-input-enabled",r[14]||r[13])},d(r){r&&S(e),l[26](null),n=!1,$e(i)}}}function ya(l){let e;return{c(){e=h("span"),e.textContent=", ",u(e,"class","dimmed_text")},m(t,s){D(t,e,s)},d(t){t&&S(e)}}}function Ma(l){let e,t=l[36]+"",s,n=l[35]&&vl(l);return{c(){n&&n.c(),e=j(),s=I(t)},m(i,r){n&&n.m(i,r),D(i,e,r),D(i,s,r)},p(i,r){i[35]?n?n.p(i,r):(n=vl(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),r[0]&32768&&t!==(t=i[36]+"")&&G(s,t)},d(i){i&&(S(e),S(s)),n&&n.d(i)}}}function Ca(l){let e,t=l[35]+"",s;return{c(){e=h("span"),s=I(t),u(e,"class","dimmed_text")},m(n,i){D(n,e,i),g(e,s)},p(n,i){i[0]&32768&&t!==(t=n[35]+"")&&G(s,t)},d(n){n&&S(e)}}}function vl(l){let e,t=l[35]+"",s,n;return{c(){e=h("span"),s=I(t),n=I(":"),u(e,"class","dimmed_text")},m(i,r){D(i,e,r),g(e,s),g(e,n)},p(i,r){r[0]&32768&&t!==(t=i[35]+"")&&G(s,t)},d(i){i&&S(e)}}}function wl(l){let e,t,s=l[38]>0&&ya();function n(o,a){return o[36]===!0?Ca:Ma}let i=n(l),r=i(l);return{c(){s&&s.c(),e=j(),r.c(),t=pe()},m(o,a){s&&s.m(o,a),D(o,e,a),r.m(o,a),D(o,t,a)},p(o,a){i===(i=n(o))&&r?r.p(o,a):(r.d(1),r=i(o),r&&(r.c(),r.m(t.parentNode,t)))},d(o){o&&(S(e),S(t)),s&&s.d(o),r.d(o)}}}function $l(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-times"),u(t,"aria-hidden","true"),u(e,"type","button"),u(e,"class","local-mail-search-box-icon btn px-0"),u(e,"title",s=l[7].strings.clearsearch)},m(r,o){D(r,e,o),g(e,t),n||(i=W(e,"click",Te(l[19])),n=!0)},p(r,o){o[0]&128&&s!==(s=r[7].strings.clearsearch)&&u(e,"title",s)},d(r){r&&S(e),n=!1,i()}}}function yl(l){let e,t,s,n,i,r,o;function a(b){l[28](b)}function f(b){l[29](b)}function d(b){l[30](b)}function m(b){l[31](b)}function c(b){l[32](b)}let _={store:l[0],submit:l[20],submitEnabled:l[13]};return l[2]!==void 0&&(_.sendername=l[2]),l[3]!==void 0&&(_.recipientname=l[3]),l[4]!==void 0&&(_.unread=l[4]),l[5]!==void 0&&(_.withfilesonly=l[5]),l[6]!==void 0&&(_.maxtime=l[6]),e=new ma({props:_}),l[27](e),Ce.push(()=>We(e,"sendername",a)),Ce.push(()=>We(e,"recipientname",f)),Ce.push(()=>We(e,"unread",d)),Ce.push(()=>We(e,"withfilesonly",m)),Ce.push(()=>We(e,"maxtime",c)),{c(){J(e.$$.fragment)},m(b,p){K(e,b,p),o=!0},p(b,p){const v={};p[0]&1&&(v.store=b[0]),p[0]&8192&&(v.submitEnabled=b[13]),!t&&p[0]&4&&(t=!0,v.sendername=b[2],Xe(()=>t=!1)),!s&&p[0]&8&&(s=!0,v.recipientname=b[3],Xe(()=>s=!1)),!n&&p[0]&16&&(n=!0,v.unread=b[4],Xe(()=>n=!1)),!i&&p[0]&32&&(i=!0,v.withfilesonly=b[5],Xe(()=>i=!1)),!r&&p[0]&64&&(r=!0,v.maxtime=b[6],Xe(()=>r=!1)),e.$set(v)},i(b){o||(T(e.$$.fragment,b),o=!0)},o(b){z(e.$$.fragment,b),o=!1},d(b){l[27](null),V(e,b)}}}function Ml(l){let e,t,s;function n(r){l[33](r)}let i={store:l[0],enabled:l[8]&&!l[9]&&!!l[1].trim(),content:l[1],onClick:l[22]};return l[12]!==void 0&&(i.loading=l[12]),e=new va({props:i}),Ce.push(()=>We(e,"loading",n)),{c(){J(e.$$.fragment)},m(r,o){K(e,r,o),s=!0},p(r,o){const a={};o[0]&1&&(a.store=r[0]),o[0]&770&&(a.enabled=r[8]&&!r[9]&&!!r[1].trim()),o[0]&2&&(a.content=r[1]),!t&&o[0]&4096&&(t=!0,a.loading=r[12],Xe(()=>t=!1)),e.$set(a)},i(r){s||(T(e.$$.fragment,r),s=!0)},o(r){z(e.$$.fragment,r),s=!1},d(r){V(e,r)}}}function Da(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w;function $(L,A){return L[8]?$a:wa}let y=$(l),k=y(l),M=(l[14]||l[13])&&$l(l),N=l[9]&&yl(l),C=l[7].settings.incrementalsearch&&Ml(l);return{c(){e=h("form"),t=h("div"),s=h("i"),i=j(),k.c(),r=j(),o=h("div"),M&&M.c(),a=j(),f=h("button"),d=h("i"),_=j(),N&&N.c(),b=j(),C&&C.c(),u(s,"class",n="fa fa-fw "+(l[12]?"fa-spinner fa-pulse":"fa-search")),u(s,"aria-hidden","true"),u(t,"class","local-mail-search-box-icon position-absolute h-100 d-flex justify-content-center align-items-center px-0"),ge(t,"top","0"),ge(t,"left","0"),u(d,"class",m="fa fa-fw "+(l[9]?"fa-caret-up":"fa-sliders")),u(d,"aria-hidden","true"),u(f,"type","button"),u(f,"aria-expanded",l[9]),u(f,"class","local-mail-search-box-icon btn px-0"),u(f,"title",c=l[7].strings.searchoptions),u(o,"class","position-absolute h-100 d-flex align-items-center"),ge(o,"top","0"),ge(o,"right","0"),u(e,"class","local-mail-search-box position-relative")},m(L,A){D(L,e,A),g(e,t),g(t,s),g(e,i),k.m(e,null),g(e,r),g(e,o),M&&M.m(o,null),g(o,a),g(o,f),g(f,d),g(e,_),N&&N.m(e,null),g(e,b),C&&C.m(e,null),p=!0,v||(w=[W(f,"click",Te(l[18])),Se(Ge.call(null,e,l[17]))],v=!0)},p(L,A){(!p||A[0]&4096&&n!==(n="fa fa-fw "+(L[12]?"fa-spinner fa-pulse":"fa-search")))&&u(s,"class",n),y===(y=$(L))&&k?k.p(L,A):(k.d(1),k=y(L),k&&(k.c(),k.m(e,r))),L[14]||L[13]?M?M.p(L,A):(M=$l(L),M.c(),M.m(o,a)):M&&(M.d(1),M=null),(!p||A[0]&512&&m!==(m="fa fa-fw "+(L[9]?"fa-caret-up":"fa-sliders")))&&u(d,"class",m),(!p||A[0]&512)&&u(f,"aria-expanded",L[9]),(!p||A[0]&128&&c!==(c=L[7].strings.searchoptions))&&u(f,"title",c),L[9]?N?(N.p(L,A),A[0]&512&&T(N,1)):(N=yl(L),N.c(),T(N,1),N.m(e,b)):N&&(ne(),z(N,1,1,()=>{N=null}),ie()),L[7].settings.incrementalsearch?C?(C.p(L,A),A[0]&128&&T(C,1)):(C=Ml(L),C.c(),T(C,1),C.m(e,null)):C&&(ne(),z(C,1,1,()=>{C=null}),ie())},i(L){p||(T(N),T(C),p=!0)},o(L){z(N),z(C),p=!1},d(L){L&&S(e),k.d(),M&&M.d(),N&&N.d(),C&&C.d(),v=!1,$e(w)}}}function Sa(l,e,t){let s,n,i,r,o,a,f=F,d=()=>(f(),f=de(m,P=>t(7,a=P)),m);l.$$.on_destroy.push(()=>f());let{store:m}=e;d();let c=!a.params.search,_=!1,b,p,v="",w="",$="",y=!1,k=!1,M=0,N=!1;const C=P=>{t(1,v=(P==null?void 0:P.content)||""),t(2,w=(P==null?void 0:P.sendername)||""),t(3,$=(P==null?void 0:P.recipientname)||""),t(4,y=(P==null?void 0:P.unread)||!1),t(5,k=(P==null?void 0:P.withfilesonly)||!1),t(6,M=(P==null?void 0:P.maxtime)||0)},L=async()=>{t(8,c=!0),n&&t(9,_=!0),await xe(),b.focus()},A=async()=>{t(8,c=!i),t(9,_=!1),C(s)},R=async()=>{_?(t(9,_=!1),await xe(),b.focus()):(t(9,_=!0),L(),await xe(),p.focus())},E=async()=>{t(8,c=!0),t(9,_=!1),C(),await m.navigate({...a.params,offset:void 0,search:void 0}),await xe(),b.focus()},H=async()=>{await m.navigate({...a.params,messageid:void 0,offset:void 0,search:_?{content:v.trim(),sendername:w.trim(),recipientname:$.trim(),unread:y,withfilesonly:k,maxtime:M}:{content:v.trim()}}),t(9,_=!1),t(8,c=!1)},Q=P=>{P.key=="Enter"&&(P.preventDefault(),r?H():E())},le=async P=>{await m.navigate(P),t(9,_=!1),t(8,c=!1)};function X(){v=this.value,t(1,v)}function te(P){Ce[P?"unshift":"push"](()=>{b=P,t(10,b)})}function re(P){Ce[P?"unshift":"push"](()=>{p=P,t(11,p)})}function x(P){w=P,t(2,w)}function Z(P){$=P,t(3,$)}function q(P){y=P,t(4,y)}function B(P){k=P,t(5,k)}function Y(P){M=P,t(6,M)}function se(P){N=P,t(12,N)}return l.$$set=P=>{"store"in P&&d(t(0,m=P.store))},l.$$.update=()=>{l.$$.dirty[0]&128&&t(23,s=a.params.search),l.$$.dirty[0]&8388608&&C(s),l.$$.dirty[0]&8388608&&t(24,n=!!(s!=null&&s.sendername||s!=null&&s.recipientname||s!=null&&s.unread||s!=null&&s.withfilesonly||s!=null&&s.maxtime)),l.$$.dirty[0]&25165824&&t(14,i=!!(s!=null&&s.content)||n),l.$$.dirty[0]&126&&t(13,r=!!(v.trim()||w.trim()||$.trim()||y||k||M)),l.$$.dirty[0]&254&&t(15,o=[{label:"",value:v},{label:a.strings.searchfrom,value:w},{label:a.strings.searchto,value:$},{label:a.strings.searchdate,value:M>0?new Date(M*1e3).toLocaleDateString():""},{label:a.strings.searchunreadonly,value:y},{label:a.strings.searchhasattachments,value:k}].filter(({value:P})=>!!P))},[m,v,w,$,y,k,M,a,c,_,b,p,N,r,i,o,L,A,R,E,H,Q,le,s,n,X,te,re,x,Z,q,B,Y,se]}class Ta extends oe{constructor(e){super(),fe(this,e,Sa,Da,ae,{store:0},null,[-1,-1])}}function Cl(l,e,t){const s=l.slice();return s[4]=e[t],s}function Dl(l){let e,t=l[1].strings.undo+"",s,n,i;function r(){return l[2](l[4])}return{c(){e=h("button"),s=I(t),u(e,"type","button"),u(e,"class","local-mail-toast-undo btn font-weight-bold px-2 py-0 ml-3")},m(o,a){D(o,e,a),g(e,s),n||(i=W(e,"click",r),n=!0)},p(o,a){l=o,a&2&&t!==(t=l[1].strings.undo+"")&&G(s,t)},d(o){o&&S(e),n=!1,i()}}}function Sl(l,e){let t,s,n,i=e[4].text+"",r,o,a,f,d,m,c,_,b,p,v=F,w,$,y,k=e[4].undo&&Dl(e);function M(){return e[3](e[4])}return{key:l,first:null,c(){t=h("div"),s=h("div"),n=h("div"),r=I(i),o=j(),k&&k.c(),a=j(),f=h("button"),d=h("i"),c=j(),u(n,"class","px-1 mr-auto"),u(d,"class","fa fa-times"),u(f,"type","button"),u(f,"class","btn px-2 py-0 ml-2 text-white-50"),u(f,"title",m=e[1].strings.close),u(s,"class","toast-body d-flex align-items-center p-2"),u(t,"class","toast mt-2 mb-0"),u(t,"role","alert"),u(t,"aria-live","assertive"),u(t,"aria-atomic","true"),u(t,"data-autohide","false"),this.first=t},m(N,C){D(N,t,C),g(t,s),g(s,n),g(n,r),g(s,o),k&&k.m(s,null),g(s,a),g(s,f),g(f,d),g(t,c),w=!0,$||(y=W(f,"click",M),$=!0)},p(N,C){e=N,(!w||C&2)&&i!==(i=e[4].text+"")&&G(r,i),e[4].undo?k?k.p(e,C):(k=Dl(e),k.c(),k.m(s,a)):k&&(k.d(1),k=null),(!w||C&2&&m!==(m=e[1].strings.close))&&u(f,"title",m)},r(){p=t.getBoundingClientRect()},f(){Zl(t),v(),gt(t,p)},a(){v(),v=Ql(t,p,on,{})},i(N){w||(ze(()=>{w&&(b&&b.end(1),_=_t(t,ot,{y:50,delay:200}),_.start())}),w=!0)},o(N){_&&_.invalidate(),b=Kl(t,ot,{y:50,duration:400}),w=!1},d(N){N&&S(t),k&&k.d(),N&&b&&b.end(),$=!1,y()}}}function ja(l){let e,t=[],s=new Map,n,i=ce(l[1].toasts);const r=o=>o[4];for(let o=0;o<i.length;o+=1){let a=Cl(l,i,o),f=r(a);s.set(f,t[o]=Sl(f,a))}return{c(){e=h("div");for(let o=0;o<t.length;o+=1)t[o].c();u(e,"aria-live","polite"),u(e,"aria-atomic","true"),u(e,"class","local-mail-toasts position-fixed d-flex flex-column-reverse p-3")},m(o,a){D(o,e,a);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(o,[a]){if(a&3){i=ce(o[1].toasts),ne();for(let f=0;f<t.length;f+=1)t[f].r();t=je(t,a,r,1,o,i,s,e,Jl,Sl,null,Cl);for(let f=0;f<t.length;f+=1)t[f].a();ie()}},i(o){if(!n){for(let a=0;a<i.length;a+=1)T(t[a]);n=!0}},o(o){for(let a=0;a<t.length;a+=1)z(t[a]);n=!1},d(o){o&&S(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function La(l,e,t){let s,n=F,i=()=>(n(),n=de(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=f=>r.undo(f),a=f=>r.hideToast(f);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,o,a]}class za extends oe{constructor(e){super(),fe(this,e,La,ja,ae,{store:0})}}function Na(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa fa-fw fa-arrow-left"),u(e,"type","button"),u(e,"class","local-mail-back-button btn btn-secondary"),u(e,"title",s=l[1].strings.messagelist)},m(r,o){D(r,e,o),g(e,t),n||(i=W(e,"click",l[2]),n=!0)},p(r,[o]){o&2&&s!==(s=r[1].strings.messagelist)&&u(e,"title",s)},i:F,o:F,d(r){r&&S(e),n=!1,i()}}}function Aa(l,e,t){let s,n=F,i=()=>(n(),n=de(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=()=>r.navigateToList();return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class qa extends oe{constructor(e){super(),fe(this,e,Aa,Na,ae,{store:0})}}function Tl(l){let e,t,s=l[1].strings.all+"",n,i,r,o=l[1].strings.none+"",a,f,d,m=l[1].strings.read+"",c,_,b,p=l[1].strings.unread+"",v,w,$,y=l[1].strings.starred+"",k,M,N,C=l[1].strings.unstarred+"",L,A,R;return{c(){e=h("div"),t=h("button"),n=I(s),i=j(),r=h("button"),a=I(o),f=j(),d=h("button"),c=I(m),_=j(),b=h("button"),v=I(p),w=j(),$=h("button"),k=I(y),M=j(),N=h("button"),L=I(C),u(t,"type","button"),u(t,"class","dropdown-item"),u(r,"type","button"),u(r,"class","dropdown-item"),u(d,"type","button"),u(d,"class","dropdown-item"),u(b,"type","button"),u(b,"class","dropdown-item"),u($,"type","button"),u($,"class","dropdown-item"),u(N,"type","button"),u(N,"class","dropdown-item"),u(e,"class","dropdown-menu show")},m(E,H){D(E,e,H),g(e,t),g(t,n),g(e,i),g(e,r),g(r,a),g(e,f),g(e,d),g(d,c),g(e,_),g(e,b),g(b,v),g(e,w),g(e,$),g($,k),g(e,M),g(e,N),g(N,L),A||(R=[W(t,"click",l[7]),W(r,"click",l[8]),W(d,"click",l[9]),W(b,"click",l[10]),W($,"click",l[11]),W(N,"click",l[12])],A=!0)},p(E,H){H&2&&s!==(s=E[1].strings.all+"")&&G(n,s),H&2&&o!==(o=E[1].strings.none+"")&&G(a,o),H&2&&m!==(m=E[1].strings.read+"")&&G(c,m),H&2&&p!==(p=E[1].strings.unread+"")&&G(v,p),H&2&&y!==(y=E[1].strings.starred+"")&&G(k,y),H&2&&C!==(C=E[1].strings.unstarred+"")&&G(L,C)},d(E){E&&S(e),A=!1,$e(R)}}}function Ba(l){let e,t,s,n,i,r,o,a,f=l[2]&&Tl(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=j(),f&&f.c(),u(s,"class",n="fa fa-fw "+l[3]),u(t,"class","btn btn-secondary dropdown-toggle"),u(t,"aria-expanded",l[2]),u(t,"title",i=l[1].strings.select),u(e,"class","btn-group"),u(e,"role","group")},m(d,m){D(d,e,m),g(e,t),g(t,s),g(e,r),f&&f.m(e,null),o||(a=[W(t,"click",l[5]),Se(Ge.call(null,e,l[4]))],o=!0)},p(d,[m]){m&8&&n!==(n="fa fa-fw "+d[3])&&u(s,"class",n),m&4&&u(t,"aria-expanded",d[2]),m&2&&i!==(i=d[1].strings.select)&&u(t,"title",i),d[2]?f?f.p(d,m):(f=Tl(d),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:F,o:F,d(d){d&&S(e),f&&f.d(),o=!1,$e(a)}}}function Ia(l,e,t){let s,n,i=F,r=()=>(i(),i=de(o,$=>t(1,n=$)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let a=!1;const f=()=>{t(2,a=!1)},d=()=>{t(2,a=!a)},m=$=>{f(),o.selectAll($)},c=()=>m("all"),_=()=>m("none"),b=()=>m("read"),p=()=>m("unread"),v=()=>m("starred"),w=()=>m("unstarred");return l.$$set=$=>{"store"in $&&r(t(0,o=$.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=n.selectedMessages.size==0?"fa-square-o":n.selectedMessages.size<n.listMessages.length?"fa-minus-square-o":"fa-check-square-o")},[o,n,a,s,f,d,m,c,_,b,p,v,w]}class Ea extends oe{constructor(e){super(),fe(this,e,Ia,Ba,ae,{store:0})}}function Pa(l){let e,t;return e=new Ea({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Ra(l){let e,t;return e=new qa({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function jl(l){let e,t,s,n,i,r;const o=[Ua,Fa],a=[];function f(d,m){return d[1].params.tray=="trash"?0:1}return t=f(l),s=a[t]=o[t](l),i=new nn({props:{store:l[0]}}),{c(){e=h("div"),s.c(),n=j(),J(i.$$.fragment),u(e,"class","btn-group"),u(e,"role","group")},m(d,m){D(d,e,m),a[t].m(e,null),g(e,n),K(i,e,null),r=!0},p(d,m){let c=t;t=f(d),t===c?a[t].p(d,m):(ne(),z(a[c],1,1,()=>{a[c]=null}),ie(),s=a[t],s?s.p(d,m):(s=a[t]=o[t](d),s.c()),T(s,1),s.m(e,n));const _={};m&1&&(_.store=d[0]),i.$set(_)},i(d){r||(T(s),T(i.$$.fragment,d),r=!0)},o(d){z(s),z(i.$$.fragment,d),r=!1},d(d){d&&S(e),a[t].d(),V(i)}}}function Fa(l){let e,t,s,n;return e=new ln({props:{store:l[0]}}),s=new en({props:{store:l[0]}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){K(e,i,r),D(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&S(t),V(e,i),V(s,i)}}}function Ua(l){let e,t,s,n;return e=new an({props:{store:l[0]}}),s=new tn({props:{store:l[0]}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){K(e,i,r),D(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&S(t),V(e,i),V(s,i)}}}function Ll(l){let e,t,s;return t=new Wl({props:{settings:l[1].settings,strings:l[1].strings,courses:l[1].courses,label:l[1].strings.allcourses,selected:l[1].params.courseid,readonly:l[1].params.tray=="course",onChange:l[2],primary:!0,style:l[1].viewportSize>=me.MD?"filter-left":"filter-right"}}),{c(){e=h("div"),J(t.$$.fragment),u(e,"class","d-flex flex-grow-1 ml-auto mr-0 ml-md-0 mr-md-auto"),ge(e,"max-width","20rem"),ge(e,"min-width","0")},m(n,i){D(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&2&&(r.settings=n[1].settings),i&2&&(r.strings=n[1].strings),i&2&&(r.courses=n[1].courses),i&2&&(r.label=n[1].strings.allcourses),i&2&&(r.selected=n[1].params.courseid),i&2&&(r.readonly=n[1].params.tray=="course"),i&1&&(r.onChange=n[2]),i&2&&(r.style=n[1].viewportSize>=me.MD?"filter-left":"filter-right"),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&S(e),V(t)}}}function Ga(l){let e,t;return e=new hn({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Ha(l){let e,t;return e=new rn({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Oa(l){var y;let e,t,s,n,i,r=!((y=l[1].message)!=null&&y.draft)&&["shortname","fullname"].includes(l[1].settings.filterbycourse)&&l[1].viewportSize<me.LG,o,a,f,d;const m=[Ra,Pa],c=[];function _(k,M){return k[1].message?0:1}t=_(l),s=c[t]=m[t](l);let b=l[1].viewportSize>=me.MD&&jl(l),p=r&&Ll(l);const v=[Ha,Ga],w=[];function $(k,M){var N;return k[1].viewportSize>=me.MD?0:(N=k[1].message)!=null&&N.draft?1:-1}return~(a=$(l))&&(f=w[a]=v[a](l)),{c(){e=h("div"),s.c(),n=j(),b&&b.c(),i=j(),p&&p.c(),o=j(),f&&f.c(),u(e,"role","toolbar"),u(e,"class","local-mail-toolbar d-flex w-100")},m(k,M){D(k,e,M),c[t].m(e,null),g(e,n),b&&b.m(e,null),g(e,i),p&&p.m(e,null),g(e,o),~a&&w[a].m(e,null),d=!0},p(k,[M]){var L;let N=t;t=_(k),t===N?c[t].p(k,M):(ne(),z(c[N],1,1,()=>{c[N]=null}),ie(),s=c[t],s?s.p(k,M):(s=c[t]=m[t](k),s.c()),T(s,1),s.m(e,n)),k[1].viewportSize>=me.MD?b?(b.p(k,M),M&2&&T(b,1)):(b=jl(k),b.c(),T(b,1),b.m(e,i)):b&&(ne(),z(b,1,1,()=>{b=null}),ie()),M&2&&(r=!((L=k[1].message)!=null&&L.draft)&&["shortname","fullname"].includes(k[1].settings.filterbycourse)&&k[1].viewportSize<me.LG),r?p?(p.p(k,M),M&2&&T(p,1)):(p=Ll(k),p.c(),T(p,1),p.m(e,o)):p&&(ne(),z(p,1,1,()=>{p=null}),ie());let C=a;a=$(k),a===C?~a&&w[a].p(k,M):(f&&(ne(),z(w[C],1,1,()=>{w[C]=null}),ie()),~a?(f=w[a],f?f.p(k,M):(f=w[a]=v[a](k),f.c()),T(f,1),f.m(e,null)):f=null)},i(k){d||(T(s),T(b),T(p),T(f),d=!0)},o(k){z(s),z(b),z(p),z(f),d=!1},d(k){k&&S(e),c[t].d(),b&&b.d(),p&&p.d(),~a&&w[a].d()}}}function Ja(l,e,t){let s,n=F,i=()=>(n(),n=de(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=a=>r.selectCourse(a);return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class Ka extends oe{constructor(e){super(),fe(this,e,Ja,Oa,ae,{store:0})}}const{window:nt}=st;function zl(l){let e,t;return e=new Pn({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Va(l){let e,t=l[3].strings.pluginname+"",s,n,i=l[2]&&l[3].viewportSize<me.LG&&Nl(l);return{c(){e=h("h1"),s=I(t),n=j(),i&&i.c(),u(e,"class","h2 local-mail-view-side-column text-truncate mb-4")},m(r,o){D(r,e,o),g(e,s),g(e,n),i&&i.m(e,null)},p(r,o){o&8&&t!==(t=r[3].strings.pluginname+"")&&G(s,t),r[2]&&r[3].viewportSize<me.LG?i?i.p(r,o):(i=Nl(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(r){r&&S(e),i&&i.d()}}}function Wa(l){let e;return{c(){e=h("div"),u(e,"class","local-mail-view-side-column")},m(t,s){D(t,e,s)},p:F,d(t){t&&S(e)}}}function Nl(l){let e,t,s;return{c(){e=h("i"),t=j(),s=I(l[2]),u(e,"class","fa fa-angle-right mx-1"),u(e,"aria-hidden","true")},m(n,i){D(n,e,i),D(n,t,i),D(n,s,i)},p(n,i){i&4&&G(s,n[2])},d(n){n&&(S(e),S(t),S(s))}}}function Al(l){let e,t,s;return t=new Ta({props:{store:l[0]}}),{c(){e=h("div"),J(t.$$.fragment),u(e,"class","local-mail-view-search")},m(n,i){D(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&S(e),V(t)}}}function ql(l){let e,t,s,n;e=new Xl({props:{strings:l[3].strings,iconOnly:l[1]&&l[3].viewportSize<me.SM,onClick:l[14]}});let i=!l[1]&&Bl(l);return{c(){J(e.$$.fragment),t=j(),i&&i.c(),s=pe()},m(r,o){K(e,r,o),D(r,t,o),i&&i.m(r,o),D(r,s,o),n=!0},p(r,o){const a={};o&8&&(a.strings=r[3].strings),o&10&&(a.iconOnly=r[1]&&r[3].viewportSize<me.SM),o&1&&(a.onClick=r[14]),e.$set(a),r[1]?i&&(ne(),z(i,1,1,()=>{i=null}),ie()):i?(i.p(r,o),o&2&&T(i,1)):(i=Bl(r),i.c(),T(i,1),i.m(s.parentNode,s))},i(r){n||(T(e.$$.fragment,r),T(i),n=!0)},o(r){z(e.$$.fragment,r),z(i),n=!1},d(r){r&&(S(t),S(s)),V(e,r),i&&i.d(r)}}}function Bl(l){let e,t,s;return t=new Ln({props:{strings:l[3].strings,onClick:l[15]}}),{c(){e=h("div"),J(t.$$.fragment),u(e,"class","ml-auto")},m(n,i){D(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[15]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&S(e),V(t)}}}function Il(l){let e,t,s,n=l[3].viewportSize>=me.LG&&El(l),i=l[1]&&Pl(l);return{c(){e=h("div"),n&&n.c(),t=j(),i&&i.c(),u(e,"class","row mb-3")},m(r,o){D(r,e,o),n&&n.m(e,null),g(e,t),i&&i.m(e,null),s=!0},p(r,o){r[3].viewportSize>=me.LG?n?(n.p(r,o),o&8&&T(n,1)):(n=El(r),n.c(),T(n,1),n.m(e,t)):n&&(ne(),z(n,1,1,()=>{n=null}),ie()),r[1]?i?(i.p(r,o),o&2&&T(i,1)):(i=Pl(r),i.c(),T(i,1),i.m(e,null)):i&&(ne(),z(i,1,1,()=>{i=null}),ie())},i(r){s||(T(n),T(i),s=!0)},o(r){z(n),z(i),s=!1},d(r){r&&S(e),n&&n.d(),i&&i.d()}}}function El(l){let e,t,s;return t=new Xl({props:{strings:l[3].strings,onClick:l[16]}}),{c(){e=h("div"),J(t.$$.fragment),u(e,"class","local-mail-view-side-column")},m(n,i){D(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[16]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&S(e),V(t)}}}function Pl(l){let e,t,s;return t=new Ka({props:{store:l[0]}}),{c(){e=h("div"),J(t.$$.fragment),u(e,"class","local-mail-view-main-column d-flex")},m(n,i){D(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&S(e),V(t)}}}function Rl(l){let e,t,s;return t=new zn({props:{settings:l[3].settings,strings:l[3].strings,courses:l[3].courses,labels:l[3].labels,params:l[3].params,onClick:l[0].navigate,onCourseChange:l[0].selectCourse}}),{c(){e=h("div"),J(t.$$.fragment),u(e,"class","local-mail-view-side-column")},m(n,i){D(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.settings=n[3].settings),i&8&&(r.strings=n[3].strings),i&8&&(r.courses=n[3].courses),i&8&&(r.labels=n[3].labels),i&8&&(r.params=n[3].params),i&1&&(r.onClick=n[0].navigate),i&1&&(r.onCourseChange=n[0].selectCourse),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&S(e),V(t)}}}function Fl(l){let e,t,s,n;const i=[Qa,Ya,Xa],r=[];function o(a,f){var d;return(d=a[3].message)!=null&&d.draft&&a[3].draftForm?0:a[3].message?1:2}return t=o(l),s=r[t]=i[t](l),{c(){e=h("div"),s.c(),u(e,"class","local-mail-view-main-column")},m(a,f){D(a,e,f),r[t].m(e,null),n=!0},p(a,f){let d=t;t=o(a),t===d?r[t].p(a,f):(ne(),z(r[d],1,1,()=>{r[d]=null}),ie(),s=r[t],s?s.p(a,f):(s=r[t]=i[t](a),s.c()),T(s,1),s.m(e,null))},i(a){n||(T(s),n=!0)},o(a){z(s),n=!1},d(a){a&&S(e),r[t].d()}}}function Xa(l){let e,t,s,n;return e=new er({props:{store:l[0]}}),s=new sa({props:{store:l[0]}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){K(e,i,r),D(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&S(t),V(e,i),V(s,i)}}}function Ya(l){let e,t;return e=new Tr({props:{store:l[0],message:l[3].message}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Qa(l){let e,t;return e=new xr({props:{store:l[0],message:l[3].message,form:l[3].draftForm}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),n&8&&(i.form=s[3].draftForm),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Ul(l){let e,t;return e=new Ti({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Gl(l){let e,t;return e=new ra({props:{store:l[0],onCancel:l[17]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[17]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Za(l){let e,t,s,n,i,r,o,a,f,d,m,c,_,b,p,v,w,$,y,k,M,N;document.title=t=l[5]+" - "+l[3].strings.pluginname;let C=!l[3].mobile&&zl(l);function L(x,Z){return x[3].mobile&&x[3].viewportSize<me.LG?Wa:Va}let A=L(l),R=A(l),E=l[1]&&Al(l),H=l[3].viewportSize<me.LG&&ql(l),Q=(l[1]||l[3].viewportSize>=me.LG)&&Il(l),le=(!l[1]||l[3].viewportSize>=me.LG)&&Rl(l),X=l[1]&&Fl(l),te=l[1]&&l[3].viewportSize<me.MD&&Ul(l),re=l[3].params.dialog=="preferences"&&Gl(l);return w=new za({props:{store:l[0]}}),y=new Jn({props:{store:l[0]}}),{c(){e=j(),s=j(),n=h("div"),C&&C.c(),i=j(),r=h("div"),R.c(),o=j(),a=h("div"),E&&E.c(),f=j(),H&&H.c(),d=j(),Q&&Q.c(),m=j(),c=h("div"),le&&le.c(),_=j(),X&&X.c(),b=j(),te&&te.c(),p=j(),re&&re.c(),v=j(),J(w.$$.fragment),$=j(),J(y.$$.fragment),u(a,"class","local-mail-view-main-column d-flex mb-3"),O(a,"mb-4",l[3].viewportSize>=me.LG),u(r,"class","row align-items-center"),u(c,"class","row mb-3"),u(n,"class","local-mail local-mail-view container-fluid pt-2"),O(n,"p-4",!l[3].mobile),O(n,"local-mail-loading",l[3].loading)},m(x,Z){D(x,e,Z),D(x,s,Z),D(x,n,Z),C&&C.m(n,null),g(n,i),g(n,r),R.m(r,null),g(r,o),g(r,a),E&&E.m(a,null),g(a,f),H&&H.m(a,null),g(n,d),Q&&Q.m(n,null),g(n,m),g(n,c),le&&le.m(c,null),g(c,_),X&&X.m(c,null),g(n,b),te&&te.m(n,null),g(n,p),re&&re.m(n,null),g(n,v),K(w,n,null),g(n,$),K(y,n,null),l[18](n),k=!0,M||(N=[W(nt,"resize",l[12]),W(nt,"popstate",l[13]),W(nt,"beforeunload",l[6]),W(nt,"message",l[7]),W(document,"click",function(){De(l[3].mobile?l[8]:void 0)&&(l[3].mobile?l[8]:void 0).apply(this,arguments)})],M=!0)},p(x,[Z]){l=x,(!k||Z&40)&&t!==(t=l[5]+" - "+l[3].strings.pluginname)&&(document.title=t),l[3].mobile?C&&(ne(),z(C,1,1,()=>{C=null}),ie()):C?(C.p(l,Z),Z&8&&T(C,1)):(C=zl(l),C.c(),T(C,1),C.m(n,i)),A===(A=L(l))&&R?R.p(l,Z):(R.d(1),R=A(l),R&&(R.c(),R.m(r,o))),l[1]?E?(E.p(l,Z),Z&2&&T(E,1)):(E=Al(l),E.c(),T(E,1),E.m(a,f)):E&&(ne(),z(E,1,1,()=>{E=null}),ie()),l[3].viewportSize<me.LG?H?(H.p(l,Z),Z&8&&T(H,1)):(H=ql(l),H.c(),T(H,1),H.m(a,null)):H&&(ne(),z(H,1,1,()=>{H=null}),ie()),(!k||Z&8)&&O(a,"mb-4",l[3].viewportSize>=me.LG),l[1]||l[3].viewportSize>=me.LG?Q?(Q.p(l,Z),Z&10&&T(Q,1)):(Q=Il(l),Q.c(),T(Q,1),Q.m(n,m)):Q&&(ne(),z(Q,1,1,()=>{Q=null}),ie()),!l[1]||l[3].viewportSize>=me.LG?le?(le.p(l,Z),Z&10&&T(le,1)):(le=Rl(l),le.c(),T(le,1),le.m(c,_)):le&&(ne(),z(le,1,1,()=>{le=null}),ie()),l[1]?X?(X.p(l,Z),Z&2&&T(X,1)):(X=Fl(l),X.c(),T(X,1),X.m(c,null)):X&&(ne(),z(X,1,1,()=>{X=null}),ie()),l[1]&&l[3].viewportSize<me.MD?te?(te.p(l,Z),Z&10&&T(te,1)):(te=Ul(l),te.c(),T(te,1),te.m(n,p)):te&&(ne(),z(te,1,1,()=>{te=null}),ie()),l[3].params.dialog=="preferences"?re?(re.p(l,Z),Z&8&&T(re,1)):(re=Gl(l),re.c(),T(re,1),re.m(n,v)):re&&(ne(),z(re,1,1,()=>{re=null}),ie());const q={};Z&1&&(q.store=l[0]),w.$set(q);const B={};Z&1&&(B.store=l[0]),y.$set(B),(!k||Z&8)&&O(n,"p-4",!l[3].mobile),(!k||Z&8)&&O(n,"local-mail-loading",l[3].loading)},i(x){k||(T(C),T(E),T(H),T(Q),T(le),T(X),T(te),T(re),T(w.$$.fragment,x),T(y.$$.fragment,x),k=!0)},o(x){z(C),z(E),z(H),z(Q),z(le),z(X),z(te),z(re),z(w.$$.fragment,x),z(y.$$.fragment,x),k=!1},d(x){x&&(S(e),S(s),S(n)),C&&C.d(),R.d(),E&&E.d(),H&&H.d(),Q&&Q.d(),le&&le.d(),X&&X.d(),te&&te.d(),re&&re.d(),V(w),V(y),l[18](null),M=!1,$e(N)}}}function xa(l,e,t){let s,n,i,r,o,a,f,d=F,m=()=>(d(),d=de(c,A=>t(3,f=A)),c);l.$$.on_destroy.push(()=>d());let{store:c}=e;m();let _,b=0;et(()=>{c.setViewportSize(window.innerWidth)}),Vl(()=>{if(b!=f.navigationId){b=f.navigationId;let A=_.parentElement;for(;A;)A.scrollTop>0&&A.scrollTo({top:0}),A=A.parentElement}});const p=A=>{if(f.draftData)return A.preventDefault(),c.updateDraft(f.draftData,!0),""},v=A=>{f.mobile&&A.data.addon=="local_mail"&&A.data.backClicked&&c.navigateToMenu()},w=A=>{var R;if(f.mobile&&!A.defaultPrevented&&A.target instanceof HTMLElement){const E=A.target.closest("a");E&&((R=window.parent)==null||R.postMessage({addon:"local_mail",openUrl:E.href},"*")),A.defaultPrevented||A.preventDefault()}},$=()=>c.setViewportSize(window.innerWidth),y=()=>c.navigate(Yl()),k=()=>c.createMessage(),M=()=>c.showDialog("preferences"),N=()=>c.createMessage(),C=()=>c.hideDialog();function L(A){Ce[A?"unshift":"push"](()=>{_=A,t(4,_)})}return l.$$set=A=>{"store"in A&&m(t(0,c=A.store))},l.$$.update=()=>{var A;l.$$.dirty&8&&t(1,s=f.params.tray),l.$$.dirty&8&&t(10,n=f.courses.find(R=>R.id==f.params.courseid)),l.$$.dirty&8&&t(11,i=f.labels.find(R=>R.id==f.params.labelid)),l.$$.dirty&3082&&t(2,r=s=="inbox"?f.strings.inbox:s=="starred"?f.strings.starredplural:s=="sent"?f.strings.sentplural:s=="drafts"?f.strings.drafts:s=="trash"?f.strings.trash:s=="label"?(i==null?void 0:i.name)||"":s=="course"?Ye(n,"fullname"):""),l.$$.dirty&12&&t(5,o=f.message?f.message.subject.trim()||f.strings.nosubject:r),l.$$.dirty&12&&t(9,a=f.viewportSize<me.LG?r||f.strings.pluginname:""),l.$$.dirty&514&&((A=window.parent)==null||A.postMessage({addon:"local_mail",setTitle:a,captureBack:s!=null},"*"))},[c,s,r,f,_,o,p,v,w,a,n,i,$,y,k,M,N,C,L]}class eo extends oe{constructor(e){super(),fe(this,e,xa,Za,ae,{store:0})}}const Ve=[];function to(l,e=F){let t;const s=new Set;function n(o){if(Nn(l,o)&&(l=o,t)){const a=!Ve.length;for(const f of s)f[1](),Ve.push(f,l);if(a){for(let f=0;f<Ve.length;f+=2)Ve[f][0](Ve[f+1]);Ve.length=0}}}function i(o){n(o(l))}function r(o,a=F){const f=[o,a];return s.add(f),s.size===1&&(t=e(n,i)||F),o(l),()=>{s.delete(f),s.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:r}}async function so(l){let e=0,t=0,s={userid:l.userid,settings:l.settings,preferences:l.preferences,strings:l.strings,mobile:l.mobile,params:{},unread:0,drafts:0,courses:[],labels:[],totalCount:0,listMessages:[],loading:!0,selectedMessages:new Map,toasts:[],navigationId:0,viewportSize:0};const{subscribe:n,set:i}=to(s),r=q=>i({...s,...q});n(q=>{s=q});const o=async(q,B,Y=!1)=>{var wt,$t,yt,Mt,Ct;const se=++e,P=(wt=s.message)==null?void 0:wt.id,be=s.draftData,ee=B||s.params,he=!Y&&(ee.tray!=s.params.tray||ee.messageid!=s.params.messageid||ee.courseid!=s.params.courseid||ee.labelid!=s.params.labelid||ee.search!=s.params.search)?{...s.params,dialog:void 0}:s.prevParams,ke=s.preferences.perpage;if(r({loading:!0,error:void 0}),ut(ee,Y),P&&be&&(window.clearTimeout(t),q.unshift({methodname:"update_message",messageid:P,data:be})),q.push({methodname:"get_courses"}),q.push({methodname:"get_labels"}),ee.tray){const we={courseid:ee.courseid,labelid:ee.tray=="label"?ee.labelid:void 0,draft:ee.tray=="drafts"?!0:ee.tray=="sent"?!1:void 0,roles:ee.tray=="inbox"?["to","cc","bcc"]:ee.tray=="sent"?["from"]:void 0,starred:ee.tray=="starred"?!0:void 0,deleted:ee.tray=="trash"};q.push({methodname:"count_messages",query:we}),ee.messageid?(q.push({methodname:"get_message",messageid:ee.messageid}),q.push({methodname:"search_messages",query:{...we,...ee.search,startid:ee.messageid,reverse:!1},limit:1}),q.push({methodname:"search_messages",query:{...we,...ee.search,startid:ee.messageid,reverse:!0},limit:1}),ee.search||q.push({methodname:"count_messages",query:{...we,startid:ee.messageid,reverse:!0}})):q.push({methodname:"search_messages",query:{...we,...ee.search},offset:ee.search?void 0:ee.offset,limit:ee.search?ke+1:ke})}let _e;try{_e=await Qe(q)}catch(we){return L(we),null}let U,ue,Ne,Me,ve=[],Le=0;ee.tray&&(ee.messageid?(ee.search||(ue=_e.pop()),Me=($t=_e.pop()[0])==null?void 0:$t.id,Ne=(yt=_e.pop()[0])==null?void 0:yt.id,U=_e.pop()):(ve=_e.pop(),ee.search&&(ee.search.reverse?(Me=(Mt=ve[ke])==null?void 0:Mt.id,Ne=ee.search.startid,ve=ve.slice(0,ke).reverse()):(Me=ee.search.startid,Ne=(Ct=ve[ke])==null?void 0:Ct.id,ve=ve.slice(0,ke)))),Le=_e.pop());const Je=_e.pop(),Re=_e.pop();if(P&&be&&_e.shift(),ee.tray=="course"&&!Re.find(we=>we.id==ee.courseid)||ee.tray=="label"&&!Je.find(we=>we.id==ee.labelid))return await p({tray:"inbox"},!0),_e;let vt;if(U!=null&&U.draft&&(U==null?void 0:U.id)!=P){const we=[{methodname:"get_message_form",messageid:U.id}];let Ke;try{Ke=await Qe(we)}catch(kn){return L(kn),null}vt=Ke.pop()}return se!=e||(r({params:ee,prevParams:he,unread:Re.reduce((we,Ke)=>we+Ke.unread,0),drafts:Re.reduce((we,Ke)=>we+Ke.drafts,0),courses:Re,labels:Je,messageOffset:ue,totalCount:Le,listMessages:ve,message:U,nextMessageId:Ne,prevMessageId:Me,draftForm:(U==null?void 0:U.id)!=P?vt:s.draftForm,draftData:void 0,draftSaved:(U==null?void 0:U.id)==P?be==null:!1,selectedMessages:new Map(U?[[U.id,U]]:s.message?[]:ve.filter(we=>s.selectedMessages.has(we.id)).map(we=>[we.id,we])),loading:!1,navigationId:Y||ee.tray!=s.params.tray||ee.courseid!=s.params.courseid||ee.labelid!=s.params.labelid||ee.messageid!=s.params.messageid||ee.offset!=s.params.offset?s.navigationId+1:s.navigationId}),P&&be&&P!=(U==null?void 0:U.id)&&le({text:s.strings.draftsaved})),_e},a=async(q,B)=>{const se=await o([{methodname:"create_label",name:q,color:B}]);return se==null?void 0:se.pop()},f=async q=>{q=q||s.params.courseid||s.courses[0].id;const B={methodname:"create_message",courseid:q};let Y;try{Y=await Qe([B])}catch(se){L(se);return}await p({tray:"drafts",messageid:Y.pop(),courseid:q})},d=async q=>{await o([{methodname:"delete_label",labelid:q}],{tray:"inbox"})},m=async q=>{await o([{methodname:"empty_trash",courseid:q}])},c=async q=>{const B=s.params,Y={methodname:"forward_message",messageid:q.id},se=await o([Y]);se!=null&&await p({tray:"drafts",messageid:se.pop(),courseid:B.courseid?q.course.id:void 0})},_=()=>{const q={...s.params,dialog:void 0};r({params:q}),ut(q,!0)},b=q=>{r({toasts:s.toasts.filter(B=>B!=q)})},p=async(q,B=!1,Y=!0)=>{var be;const se=[];Y&&s.settings.incrementalsearch&&se.push({methodname:"search_messages",query:{deleted:!1},offset:s.settings.incrementalsearchlimit,limit:1}),q!=null&&q.messageid&&se.push({methodname:"view_message",messageid:q.messageid});const P=await o(se,q,B);if(P!=null&&Y&&s.settings.incrementalsearch){const ee=P[0];r({incrementalSearchStopId:(be=ee[0])==null?void 0:be.id})}},v=async(q=!1)=>{const B={...s.params,messageid:void 0,offset:Math.floor((s.params.offset||0)/s.preferences.perpage)*s.preferences.perpage||void 0};await o([],B,q)},w=async()=>{await o([],{})},$=async(q,B)=>{const Y=s.params,se={methodname:"reply_message",messageid:q.id,all:B},P=await o([se]);P!=null&&await p({tray:"drafts",messageid:P.pop(),courseid:Y.courseid?q.course.id:void 0})},y=async q=>{r({preferences:{...s.preferences,...q}});let B=s.params;q.perpage&&(B={...B,offset:s.params.offset?Math.trunc(s.params.offset/q.perpage)*q.perpage:void 0}),await o([{methodname:"set_preferences",preferences:q}],B,!0)},k=q=>{r({selectedMessages:new Map(s.listMessages.filter(B=>q=="all"||q=="read"&&!B.unread||q=="unread"&&B.unread||q=="starred"&&B.starred||q=="unstarred"&&!B.starred).map(B=>[B.id,B]))})},M=async q=>{await p({...s.params,courseid:q,offset:0,messageid:void 0,search:s.params.search?{...s.params.search,startid:void 0,reverse:void 0}:void 0})},N=async()=>{var se;if(!((se=s.message)!=null&&se.draft))return;const q={methodname:"send_message",messageid:s.message.id},B=s.prevParams?{...s.prevParams,messageid:void 0,offset:Math.floor((s.prevParams.offset||0)/s.preferences.perpage)*s.preferences.perpage||void 0}:["shortname","fullname"].includes(s.settings.filterbycourse)?{tray:"inbox",courseid:s.message.course.id}:{tray:"course",courseid:s.message.course.id};await o([q],B)!=null&&le({text:s.strings.messagesent})},C=async(q,B,Y)=>{const se=q.map(ee=>({methodname:"set_deleted",messageid:ee,deleted:B})),P={...s.params,messageid:void 0};if(await o(se,P,!0)!=null&&B!=Fe.DeletedForever){const ee=B?q.length>1?"messagesmovedtotrash":"messagemovedtotrash":q.length>1?"messagesrestored":"messagerestored",he=Ae(s.strings[ee],q.length);le({text:he,undo:Y?()=>{C(q,B?Fe.NotDeleted:Fe.Deleted,!1)}:void 0})}},L=async q=>{r({loading:s.loading&&!q,error:q})},A=async(q,B)=>{Z(se=>s.selectedMessages.has(se.id)?{...se,labels:s.labels.filter(P=>q.includes(P.id)?!0:B.includes(P.id)?!1:se.labels.findIndex(be=>be.id==P.id)>=0)}:se);const Y=[];s.selectedMessages.forEach(se=>{Y.push({methodname:"set_labels",messageid:se.id,labelids:se.labels.map(P=>P.id)})}),await o(Y)},R=async(q,B)=>{Z(se=>q.includes(se.id)?{...se,starred:B}:se);const Y=q.map(se=>({methodname:"set_starred",messageid:se,starred:B}));await o(Y)},E=async(q,B)=>{Z(P=>q.includes(P.id)?{...P,unread:B}:P);const Y=q.map(P=>({methodname:"set_unread",messageid:P,unread:B})),se={...s.params,messageid:void 0};await o(Y,se)},H=q=>{r({viewportSize:q,navigationId:s.navigationId+1}),!s.params.tray&&q>=me.LG&&!s.error&&p({tray:"inbox",dialog:s.params.dialog},!0)},Q=async q=>{const B={...s.params,dialog:q};ut(B,s.params.dialog!=null),r({params:B})},le=async q=>{r({toasts:[q]}),q&&window.setTimeout(()=>b(q),1e4)},X=q=>{r({selectedMessages:new Map(s.listMessages.filter(B=>B.id==q?!s.selectedMessages.has(B.id):s.selectedMessages.has(B.id)).map(B=>[B.id,B]))})},te=async q=>{q.undo&&(b(q),q.undo())},re=(q,B)=>{if(!s.message)return;const Y=++e,se=s.message,P=s.draftData;r({draftData:q,draftSaved:!1});let be=3e3;B?be=0:P&&(be=Math.max(0,se.time*1e3+be-Date.now())),window.clearTimeout(t),t=window.setTimeout(async()=>{const ee=[{methodname:"update_message",messageid:se.id,data:q},{methodname:"get_message",messageid:se.id}];let he;try{he=await Qe(ee)}catch(_e){L(_e);return}const ke=he.pop();Y==e&&r({message:ke,draftData:void 0,draftSaved:!0})},be)},x=async(q,B,Y)=>{await o([{methodname:"update_label",labelid:q,name:B,color:Y}])},Z=q=>{r({listMessages:s.listMessages.map(B=>q(B)),message:s.message?q(s.message):void 0,selectedMessages:new Map(Array.from(s.selectedMessages.entries()).map(([B,Y])=>[B,q(Y)]))})};return await p(Yl(),!0,!0),{createLabel:a,createMessage:f,deleteLabel:d,emptyTrash:m,forward:c,get:()=>s,hideDialog:_,hideToast:b,navigate:p,navigateToList:v,navigateToMenu:w,reply:$,savePreferences:y,selectAll:k,selectCourse:M,sendMessage:N,setDeleted:C,setError:L,setLabels:A,setStarred:R,setUnread:E,setViewportSize:H,showDialog:Q,subscribe:n,toggleSelected:X,undo:te,updateDraft:re,updateLabel:x}}async function lo(){const l=document.getElementById("local-mail-view"),e=document.getElementById("local-mail-navbar"),t=window.local_mail_view_data;if(!t)return;const s=await so({userid:t.userid,settings:t.settings,preferences:t.preferences,strings:t.strings,mobile:!!t.mobile});if(l&&new eo({target:l,props:{store:s}}),e){e.innerHTML="";const n=s.get(),i=new An({target:e,props:{settings:n.settings,strings:n.strings,courses:n.courses,labels:n.labels,params:n.params,onClick:s.navigate,onComposeClick:s.createMessage,onCourseChange:s.selectCourse}});s.subscribe(r=>{i.$set({settings:r.settings,strings:r.strings,courses:r.courses,labels:r.labels,params:r.params})})}}lo();
//# sourceMappingURL=view-Efio-FbT.js.map
