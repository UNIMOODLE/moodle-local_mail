{"version":3,"file":"navigation-85dd82b9.js","sources":["../src/components/UserListSendButton.svelte","../src/components/UserProfileSendButton.svelte","../src/navigation.ts"],"sourcesContent":["<svelte:options immutable={true} />\n\n<script lang=\"ts\">\n    import { onDestroy, onMount } from 'svelte';\n    import { require, type CorePubSub } from '../lib/amd';\n    import type { Course, Strings } from '../lib/state';\n    import { createUrl } from '../lib/url';\n\n    export let strings: Strings;\n    export let courses: ReadonlyArray<Course>;\n    export let userid: number;\n    export let courseid: number;\n    export let form: HTMLFormElement;\n\n    $: course = courses.find((course) => course.id == courseid);\n    let recipients: number[] = [];\n\n    onMount(async () => {\n        const pubsub = (await require('core/pubsub')) as CorePubSub;\n        pubsub.subscribe('core/checkbox-toggleall:checkboxToggled', updateRecipients);\n        updateRecipients();\n    });\n\n    onDestroy(async () => {\n        const pubsub = (await require('core/pubsub')) as CorePubSub;\n        pubsub.unsubscribe('core/checkbox-toggleall:checkboxToggled', updateRecipients);\n    });\n\n    const updateRecipients = async () => {\n        recipients = [];\n        const formData = new FormData(form);\n        for (const name of formData.keys()) {\n            const match = /^user(\\d+)$/.exec(name);\n            if (match) {\n                const id = parseInt(match[1]);\n                if (id != userid) {\n                    recipients.push(id);\n                }\n            }\n        }\n    };\n</script>\n\n{#if course}\n    <div class=\"btn-group ml-3\">\n        <button\n            type=\"button\"\n            class=\"btn btn-outline-secondary text-dark bg-white dropdown-toggle\"\n            data-toggle=\"dropdown\"\n            aria-expanded=\"false\"\n            disabled={!recipients.length}\n        >\n            <i class=\"fa fa-envelope-o mr-1\" aria-hidden=\"true\" />\n            {strings.sendmail}\n        </button>\n        <div class=\"dropdown-menu\">\n            {#each ['to', 'cc', 'bcc'] as role (role)}\n                <a class=\"dropdown-item\" href={createUrl(course.id, recipients, role)}>\n                    {strings[role]}\n                </a>\n            {/each}\n        </div>\n    </div>\n{/if}\n","<svelte:options immutable={true} />\n\n<script lang=\"ts\">\n    import type { Course, Strings } from '../lib/state';\n    import { createUrl } from '../lib/url';\n\n    export let userid: number;\n    export let strings: Strings;\n    export let courses: ReadonlyArray<Course>;\n    export let id: number;\n    export let courseid: number;\n\n    $: course = courses.find((course) => course.id == courseid);\n</script>\n\n{#if id != userid && course}\n    <a class=\"btn\" href={createUrl(courseid, [id], 'to')}>\n        <i class=\"fa fa-envelope-o mr-1\" aria-hidden=\"true\" />\n        {strings.sendmail}\n    </a>\n{/if}\n","import Navbar from './components/Navbar.svelte';\nimport UserListSendButton from './components/UserListSendButton.svelte';\nimport UserProfileSendButton from './components/UserProfileSendButton.svelte';\nimport type { Course, Label, Settings, Strings, ViewParams } from './lib/state';\nimport { createUrl, viewUrl } from './lib/url';\nimport './global.css';\n\nasync function init() {\n    // Get needed data from script tag, to avoid doing web service requests.\n    const data = window.local_mail_navbar_data;\n    if (!data) {\n        return;\n    }\n\n    initNavbar(data);\n\n    const url = window.location.origin + window.location.pathname;\n    const params = new URLSearchParams(window.location.search);\n\n    if (url == window.M.cfg.wwwroot + '/user/view.php') {\n        initUserProfile(\n            data,\n            parseInt(params.get('id') || ''),\n            parseInt(params.get('course') || ''),\n        );\n    } else if (url == window.M.cfg.wwwroot + '/user/index.php') {\n        initUserList(data, parseInt(params.get('id') || ''));\n    } else if (url == window.M.cfg.wwwroot + '/blocks/completion_progress/overview.php') {\n        initUserList(data, parseInt(params.get('courseid') || ''));\n    }\n}\n\nfunction initNavbar(data: Record<string, unknown>) {\n    const target = document.getElementById('local-mail-navbar');\n    if (target) {\n        // Remove fallback link created in local_mail_render_navbar_output.\n        target.innerHTML = '';\n\n        new Navbar({\n            target,\n            props: {\n                settings: data.settings as Settings,\n                strings: data.strings as Strings,\n                unread: data.unread as number,\n                drafts: data.drafts as number,\n                courses: data.courses as Course[],\n                labels: data.labels as Label[],\n                onClick: (params: ViewParams) => {\n                    window.location.href = viewUrl(params);\n                },\n                onComposeClick: (courseid: number) => {\n                    window.location.href = createUrl(courseid);\n                },\n            },\n        });\n    }\n}\n\nfunction initUserList(data: Record<string, unknown>, courseid: number) {\n    const target = document.querySelector('#formactionid')?.parentElement;\n    const form = document.querySelector('#participantsform') as HTMLFormElement;\n    if (courseid && target && form) {\n        new UserListSendButton({\n            target,\n            props: {\n                userid: data.userid as number,\n                strings: data.strings as Strings,\n                courses: data.courses as Course[],\n                courseid,\n                form: document.querySelector('#participantsform') as HTMLFormElement,\n            },\n        });\n    }\n}\n\nfunction initUserProfile(data: Record<string, unknown>, id: number, courseid: number) {\n    const target = document.querySelector('.userprofile .header-button-group');\n    if (id && courseid && target) {\n        new UserProfileSendButton({\n            target,\n            props: {\n                userid: data.userid as number,\n                strings: data.strings as Strings,\n                courses: data.courses as Course[],\n                id,\n                courseid,\n            },\n        });\n    }\n}\n\ninit();\n"],"names":["t1_value","ctx","button","button_disabled_value","insert","target","div1","anchor","append","div0","dirty","set_data","t1","t0_value","attr","a","a_href_value","createUrl","t0","create_if_block","strings","$$props","courses","userid","courseid","form","recipients","onMount","require","updateRecipients","onDestroy","$$invalidate","formData","name","match","id","course","i","init","data","initNavbar","url","params","initUserProfile","initUserList","Navbar","viewUrl","_a","UserListSendButton","UserProfileSendButton"],"mappings":"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"}