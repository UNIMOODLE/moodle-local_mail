import{n as F,i as Gl,a as pn,l as bn,c as hn,d as kn,S as ce,b as me,e as oe,f as be,g as S,h as D,j as h,k as u,s as _e,t as E,m as g,o as R,p as Mt,q as vn,r as L,u as J,v as Ce,w as De,x as Fe,y as wn,z as $n,A as yn,B as T,C as je,D as Ie,E as z,F as we,G as Qe,H as Ul,I as Me,J as ie,K as re,L as K,M as Y,N as W,O as U,P as ue,Q as $e,R as Te,T as Le,U as Ze,V as ge,W as Mn,X as Hl,Y as Re,Z as Ge,_ as ct,$ as Ee,a0 as Ol,a1 as Jl,a2 as qe,a3 as lt,a4 as Ct,a5 as ft,a6 as We,a7 as ut,a8 as Vl,a9 as Xe,aa as Ve,ab as Ke,ac as Cn,ad as Kl,ae as Sn,af as Dn,ag as Yl,ah as Tn,ai as at,aj as Ln}from"./global-QlwbzmWg.js";const xe=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Wl(l,e,t,s){if(!e)return F;const n=l.getBoundingClientRect();if(e.left===n.left&&e.right===n.right&&e.top===n.top&&e.bottom===n.bottom)return F;const{delay:i=0,duration:r=300,easing:a=Gl,start:o=pn()+i,end:f=o+r,tick:d=F,css:c}=t(l,{from:e,to:n},s);let m=!0,_=!1,b;function p(){c&&(b=hn(l,0,1,r,i,a,c)),i||(_=!0)}function v(){c&&kn(l,b),m=!1}return bn(w=>{if(!_&&w>=o&&(_=!0),_&&w>=f&&(d(1,0),v()),!m)return!1;if(_){const C=w-o,$=0+1*a(C/r);d($,1-$)}return!0}),p(),d(0,1),v}function Xl(l){const e=getComputedStyle(l);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:s}=e,n=l.getBoundingClientRect();l.style.position="absolute",l.style.width=t,l.style.height=s,mt(l,n)}}function mt(l,e){const t=l.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const s=getComputedStyle(l),n=s.transform==="none"?"":s.transform;l.style.transform=`${n} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}var Pe=(l=>(l[l.NotDeleted=0]="NotDeleted",l[l.Deleted=1]="Deleted",l[l.DeletedForever=2]="DeletedForever",l))(Pe||{}),nt=(l=>(l[l.No=0]="No",l[l.Separate=1]="Separate",l[l.Visible=2]="Visible",l))(nt||{}),Ae=(l=>(l.TO="to",l.CC="cc",l.BCC="bcc",l))(Ae||{}),de=(l=>(l[l.SM=576]="SM",l[l.MD=768]="MD",l[l.LG=992]="LG",l[l.XL=1200]="XL",l))(de||{});const it=["","blue","indigo","purple","pink","red","orange","yellow","green","teal","cyan"];function St(l){if(l==0)return"";const e=new Date(l*1e3);return[String(e.getFullYear()),String(e.getMonth()+1).padStart(2,"0"),String(e.getDate()).padStart(2,"0")].join("-")}function Dt(l){const e=[{bytes:1099511627776,name:"TB"},{bytes:1073741824,name:"GB"},{bytes:1048576,name:"MB"},{bytes:1024,name:"KB"}];for(const t of e)if(l>=t.bytes)return`${Intl.NumberFormat(void 0,{maximumFractionDigits:1}).format(l/t.bytes)} ${t.name}`;return`${l} B`}function Tt(l){return l.trim().replaceAll(/\s+/gu," ")}function Ne(l,e){if(l=l||"",typeof e=="string"||typeof e=="number")l=l.replace("{$a}",e.toString());else for(const t in e)l=l.replace(`{$a->${t}}`,e[t].toString());return l}function zn(l){return l?Math.floor(new Date(parseInt(l.slice(0,4)),parseInt(l.slice(5,7))-1,parseInt(l.slice(8,10)),23,59,59).getTime()/1e3):0}function Lt(l){let e;function t(i,r){return i[2]?Nn:jn}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),u(e,"class","local-mail-course-link mt-n2 mb-3 mb-lg-4")},m(i,r){S(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&D(e),n.d()}}}function jn(l){let e;return{c(){e=E(" ")},m(t,s){S(t,e,s)},p:F,d(t){t&&D(e)}}}function Nn(l){let e,t,s=(l[1].settings.courselink=="shortname"?l[2].shortname:l[2].fullname)+"",n,i,r;return{c(){e=h("nav"),t=h("a"),n=E(s),u(t,"class","text-truncate"),u(t,"href",i=window.M.cfg.wwwroot+"/course/view.php?id="+l[1].params.courseid),u(t,"title",r=Ne(l[1].strings.gotocourse,l[2].fullname)),u(e,"class","d-flex align-items-center")},m(a,o){S(a,e,o),g(e,t),g(t,n)},p(a,o){o&6&&s!==(s=(a[1].settings.courselink=="shortname"?a[2].shortname:a[2].fullname)+"")&&R(n,s),o&2&&i!==(i=window.M.cfg.wwwroot+"/course/view.php?id="+a[1].params.courseid)&&u(t,"href",i),o&6&&r!==(r=Ne(a[1].strings.gotocourse,a[2].fullname))&&u(t,"title",r)},d(a){a&&D(e)}}}function An(l){let e=["shortname","fullname"].includes(l[1].settings.courselink),t,s=e&&Lt(l);return{c(){s&&s.c(),t=be()},m(n,i){s&&s.m(n,i),S(n,t,i)},p(n,[i]){i&2&&(e=["shortname","fullname"].includes(n[1].settings.courselink)),e?s?s.p(n,i):(s=Lt(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:F,o:F,d(n){n&&D(t),s&&s.d(n)}}}function Bn(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,o=>t(1,n=o)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;return r(),l.$$set=o=>{"store"in o&&r(t(0,a=o.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=n.courses.find(o=>o.id==n.params.courseid))},[a,n,s]}class qn extends ce{constructor(e){super(),me(this,e,Bn,An,oe,{store:0})}}function Ql(l){const e=l-1;return e*e*e+1}function Be(l,{delay:e=0,duration:t=400,easing:s=Gl}={}){const n=+getComputedStyle(l).opacity;return{delay:e,duration:t,easing:s,css:i=>`opacity: ${i*n}`}}function rt(l,{delay:e=0,duration:t=400,easing:s=Ql,x:n=0,y:i=0,opacity:r=0}={}){const a=getComputedStyle(l),o=+a.opacity,f=a.transform==="none"?"":a.transform,d=o*(1-r),[c,m]=Mt(n),[_,b]=Mt(i);return{delay:e,duration:t,easing:s,css:(p,v)=>`
			transform: ${f} translate(${(1-p)*c}${m}, ${(1-p)*_}${b});
			opacity: ${o-d*v}`}}const{document:In}=xe;function zt(l){let e,t,s=l[1]&&jt(l),n=l[2]&&l[4]&&Nt(l);return{c(){e=h("div"),s&&s.c(),t=L(),n&&n.c(),u(e,"class","modal-footer")},m(i,r){S(i,e,r),s&&s.m(e,null),g(e,t),n&&n.m(e,null)},p(i,r){i[1]?s?s.p(i,r):(s=jt(i),s.c(),s.m(e,t)):s&&(s.d(1),s=null),i[2]&&i[4]?n?n.p(i,r):(n=Nt(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(i){i&&D(e),s&&s.d(),n&&n.d()}}}function jt(l){let e,t,s,n;return{c(){e=h("button"),t=E(l[1]),u(e,"type","button"),u(e,"class","btn btn-secondary")},m(i,r){S(i,e,r),g(e,t),s||(n=J(e,"click",function(){Ce(l[3])&&l[3].apply(this,arguments)}),s=!0)},p(i,r){l=i,r&2&&R(t,l[1])},d(i){i&&D(e),s=!1,n()}}}function Nt(l){let e,t,s,n,i;return{c(){e=h("button"),t=E(l[2]),u(e,"type","button"),u(e,"class",s="btn "+l[5]),e.disabled=l[6]},m(r,a){S(r,e,a),g(e,t),n||(i=J(e,"click",function(){Ce(l[4])&&l[4].apply(this,arguments)}),n=!0)},p(r,a){l=r,a&4&&R(t,l[2]),a&32&&s!==(s="btn "+l[5])&&u(e,"class",s),a&64&&(e.disabled=l[6])},d(r){r&&D(e),n=!1,i()}}}function En(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,w,C,$,k,M;const A=l[10].default,y=vn(A,l,l[9],null);let j=(l[1]||l[2]&&l[4])&&zt(l);return{c(){e=L(),t=h("div"),s=h("div"),n=h("div"),i=h("div"),r=h("h5"),a=E(l[0]),o=L(),f=h("button"),d=h("span"),d.textContent="×",c=L(),m=h("div"),y&&y.c(),_=L(),j&&j.c(),v=L(),w=h("div"),u(r,"class","modal-title"),u(d,"aria-hidden","true"),u(f,"type","button"),u(f,"class","close"),u(f,"aria-label",l[1]),u(i,"class","modal-header"),u(m,"class","modal-body"),u(n,"class","modal-content"),u(s,"class","modal-dialog"),u(t,"class","modal show"),u(t,"tabindex","-1"),u(t,"role","dialog"),u(t,"aria-label",l[0]),u(t,"aria-modal","true"),u(w,"class","modal-backdrop show")},m(B,q){S(B,e,q),S(B,t,q),g(t,s),g(s,n),g(n,i),g(i,r),g(r,a),g(i,o),g(i,f),g(f,d),g(n,c),g(n,m),y&&y.m(m,null),g(n,_),j&&j.m(n,null),l[11](t),S(B,v,q),S(B,w,q),$=!0,k||(M=[J(In.body,"keyup",l[8]),J(f,"click",function(){Ce(l[3])&&l[3].apply(this,arguments)}),De(b=Fe.call(null,t,l[3]))],k=!0)},p(B,[q]){l=B,(!$||q&1)&&R(a,l[0]),(!$||q&2)&&u(f,"aria-label",l[1]),y&&y.p&&(!$||q&512)&&wn(y,A,l,l[9],$?yn(A,l[9],q,null):$n(l[9]),null),l[1]||l[2]&&l[4]?j?j.p(l,q):(j=zt(l),j.c(),j.m(n,null)):j&&(j.d(1),j=null),(!$||q&1)&&u(t,"aria-label",l[0]),b&&Ce(b.update)&&q&8&&b.update.call(null,l[3])},i(B){$||(T(y,B),je(()=>{$&&(p||(p=Ie(t,rt,{y:-100},!0)),p.run(1))}),je(()=>{$&&(C||(C=Ie(w,Be,{},!0)),C.run(1))}),$=!0)},o(B){z(y,B),p||(p=Ie(t,rt,{y:-100},!1)),p.run(0),C||(C=Ie(w,Be,{},!1)),C.run(0),$=!1},d(B){B&&(D(e),D(t),D(v),D(w)),y&&y.d(B),j&&j.d(),l[11](null),B&&p&&p.end(),B&&C&&C.end(),k=!1,we(M)}}}function Pn(l,e,t){let{$$slots:s={},$$scope:n}=e,{title:i}=e,{cancelText:r=""}=e,{confirmText:a=""}=e,{onCancel:o}=e,{onConfirm:f=void 0}=e,{confirmClass:d="btn-primary"}=e,{confirmDisabled:c=!1}=e,m;Qe(()=>{document.body.classList.add("modal-open"),m.focus()}),Ul(()=>{document.body.classList.remove("modal-open")});const _=p=>{p.key=="Escape"&&o()};function b(p){Me[p?"unshift":"push"](()=>{m=p,t(7,m)})}return l.$$set=p=>{"title"in p&&t(0,i=p.title),"cancelText"in p&&t(1,r=p.cancelText),"confirmText"in p&&t(2,a=p.confirmText),"onCancel"in p&&t(3,o=p.onCancel),"onConfirm"in p&&t(4,f=p.onConfirm),"confirmClass"in p&&t(5,d=p.confirmClass),"confirmDisabled"in p&&t(6,c=p.confirmDisabled),"$$scope"in p&&t(9,n=p.$$scope)},[i,r,a,o,f,d,c,m,_,n,s,b]}class Ue extends ce{constructor(e){super(),me(this,e,Pn,En,oe,{title:0,cancelText:1,confirmText:2,onCancel:3,onConfirm:4,confirmClass:5,confirmDisabled:6})}}function At(l){let e,t;return e=new Ue({props:{title:l[1].strings.error,onCancel:l[2],$$slots:{default:[Rn]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.title=s[1].strings.error),n&1&&(i.onCancel=s[2]),n&10&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Bt(l){var n;let e,t=((n=l[1].error)==null?void 0:n.debuginfo)+"",s;return{c(){e=h("p"),s=E(t)},m(i,r){S(i,e,r),g(e,s)},p(i,r){var a;r&2&&t!==(t=((a=i[1].error)==null?void 0:a.debuginfo)+"")&&R(s,t)},d(i){i&&D(e)}}}function qt(l){var n;let e,t=((n=l[1].error)==null?void 0:n.stacktrace)+"",s;return{c(){e=h("pre"),s=E(t)},m(i,r){S(i,e,r),g(e,s)},p(i,r){var a;r&2&&t!==(t=((a=i[1].error)==null?void 0:a.stacktrace)+"")&&R(s,t)},d(i){i&&D(e)}}}function Rn(l){var f,d,c;let e,t=((f=l[1].error)==null?void 0:f.message)+"",s,n,i,r,a=((d=l[1].error)==null?void 0:d.debuginfo)&&Bt(l),o=((c=l[1].error)==null?void 0:c.stacktrace)&&qt(l);return{c(){e=h("p"),s=E(t),n=L(),a&&a.c(),i=L(),o&&o.c(),r=be()},m(m,_){S(m,e,_),g(e,s),S(m,n,_),a&&a.m(m,_),S(m,i,_),o&&o.m(m,_),S(m,r,_)},p(m,_){var b,p,v;_&2&&t!==(t=((b=m[1].error)==null?void 0:b.message)+"")&&R(s,t),(p=m[1].error)!=null&&p.debuginfo?a?a.p(m,_):(a=Bt(m),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null),(v=m[1].error)!=null&&v.stacktrace?o?o.p(m,_):(o=qt(m),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},d(m){m&&(D(e),D(n),D(i),D(r)),a&&a.d(m),o&&o.d(m)}}}function Fn(l){let e,t,s=l[1].error&&At(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,[i]){n[1].error?s?(s.p(n,i),i&2&&T(s,1)):(s=At(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function Gn(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.setError();return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class Un extends ce{constructor(e){super(),me(this,e,Gn,Fn,oe,{store:0})}}function Hn(l){let e,t,s,n,i,r;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-trash"),u(e,"type","button"),u(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.movetotrash),U(e,"btn-secondary",!l[1]),U(e,"disabled",!l[2].selectedMessages.size)},m(a,o){S(a,e,o),g(e,t),i||(r=J(e,"click",l[3]),i=!0)},p(a,[o]){o&4&&s!==(s=!a[2].selectedMessages.size)&&(e.disabled=s),o&4&&n!==(n=a[2].strings.movetotrash)&&u(e,"title",n),o&2&&U(e,"btn-secondary",!a[1]),o&4&&U(e,"disabled",!a[2].selectedMessages.size)},i:F,o:F,d(a){a&&D(e),i=!1,r()}}}function On(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:a=!1}=e;const o=()=>r.setDeleted(Array.from(s.selectedMessages.keys()),Pe.Deleted,!0);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"transparent"in f&&t(1,a=f.transparent)},[r,a,s,o]}class Zl extends ce{constructor(e){super(),me(this,e,On,Hn,oe,{store:0,transparent:1})}}function It(l){let e,t;return e=new Ue({props:{title:l[2].strings.deleteforever,cancelText:l[2].strings.cancel,confirmText:l[2].strings.deleteforever,confirmClass:"btn-danger",onCancel:l[5],onConfirm:l[3],$$slots:{default:[Jn]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.deleteforever),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.deleteforever),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Jn(l){let e=l[2].strings[l[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"",t;return{c(){t=E(e)},m(s,n){S(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings[s[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"")&&R(t,e)},d(s){s&&D(t)}}}function Vn(l){let e,t,s,n,i,r,a,o,f,d=l[2].params.dialog=="deleteforever"&&It(l);return{c(){e=h("button"),t=h("i"),i=L(),d&&d.c(),r=be(),u(t,"class","fa fa-fw fa-trash"),u(e,"type","button"),u(e,"class","local-mail-action-delete-forever btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.deleteforever),U(e,"btn-secondary",!l[1]),U(e,"disabled",!l[2].selectedMessages.size)},m(c,m){S(c,e,m),g(e,t),S(c,i,m),d&&d.m(c,m),S(c,r,m),a=!0,o||(f=J(e,"click",l[4]),o=!0)},p(c,[m]){(!a||m&4&&s!==(s=!c[2].selectedMessages.size))&&(e.disabled=s),(!a||m&4&&n!==(n=c[2].strings.deleteforever))&&u(e,"title",n),(!a||m&2)&&U(e,"btn-secondary",!c[1]),(!a||m&4)&&U(e,"disabled",!c[2].selectedMessages.size),c[2].params.dialog=="deleteforever"?d?(d.p(c,m),m&4&&T(d,1)):(d=It(c),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(ie(),z(d,1,1,()=>{d=null}),re())},i(c){a||(T(d),a=!0)},o(c){z(d),a=!1},d(c){c&&(D(e),D(i),D(r)),d&&d.d(c),o=!1,f()}}}function Kn(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,c=>t(2,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:a=!1}=e;const o=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Pe.DeletedForever,!0)},f=()=>r.showDialog("deleteforever"),d=()=>r.hideDialog();return l.$$set=c=>{"store"in c&&i(t(0,r=c.store)),"transparent"in c&&t(1,a=c.transparent)},[r,a,s,o,f,d]}class xl extends ce{constructor(e){super(),me(this,e,Kn,Vn,oe,{store:0,transparent:1})}}function Et(l,e,t){const s=l.slice();return s[16]=e[t],s}function Yn(l){let e;return{c(){e=E(" ")},m(t,s){S(t,e,s)},p:F,d(t){t&&D(e)}}}function Wn(l){let e=l[5].strings.errorrepeatedlabelname+"",t;return{c(){t=E(e)},m(s,n){S(s,t,n)},p(s,n){n&32&&e!==(e=s[5].strings.errorrepeatedlabelname+"")&&R(t,e)},d(s){s&&D(t)}}}function Xn(l){let e;return{c(){e=h("span"),e.textContent="a",u(e,"aria-hidden","true")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function Qn(l){let e;return{c(){e=h("i"),u(e,"class","fa fa-check local-mail-label-modal-color-option-check")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function Pt(l,e){let t,s,n,i,r,a;function o(m,_){return m[16]==m[7]?Qn:Xn}let f=o(e),d=f(e);function c(){return e[15](e[16])}return{key:l,first:null,c(){t=h("button"),d.c(),s=L(),u(t,"role","radio"),u(t,"aria-checked",n=e[16]==e[7]),u(t,"tabindex","0"),u(t,"title",i=e[5].strings[`color${e[16]}`]),u(t,"class","local-mail-label-modal-color-option btn"),u(t,"style",`color: var(--local-mail-color-${e[16]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${e[16]}-bg, var(--local-mail-color-gray-bg))`),this.first=t},m(m,_){S(m,t,_),d.m(t,null),g(t,s),r||(a=J(t,"click",Te(c)),r=!0)},p(m,_){e=m,f!==(f=o(e))&&(d.d(1),d=f(e),d&&(d.c(),d.m(t,s))),_&128&&n!==(n=e[16]==e[7])&&u(t,"aria-checked",n),_&32&&i!==(i=e[5].strings[`color${e[16]}`])&&u(t,"title",i)},d(m){m&&D(t),d.d(),r=!1,a()}}}function Zn(l){let e,t,s,n=l[5].strings.name+"",i,r,a,o,f,d,c,m,_,b,p,v=l[5].strings.color+"",w,C,$,k,M=[],A=new Map,y,j,B;function q(V,te){return V[4]?Wn:Yn}let H=q(l),P=H(l),O=ue(it);const x=V=>V[16];for(let V=0;V<O.length;V+=1){let te=Et(l,O,V),ae=x(te);A.set(ae,M[V]=Pt(ae,te))}return{c(){e=h("form"),t=h("div"),s=h("label"),i=E(n),r=L(),a=h("input"),f=L(),d=h("div"),P.c(),c=L(),m=h("div"),m.textContent=" ",_=L(),b=h("div"),p=h("label"),w=E(v),$=L(),k=h("div");for(let V=0;V<M.length;V+=1)M[V].c();u(s,"for","local-mail-label-modal-name"),u(a,"type","text"),a.required=!0,u(a,"class","form-control is-invalid"),u(a,"id",o=l[9]+"-name"),U(a,"is-valid",l[8]),U(a,"is-invalid",!l[8]),u(d,"class","invalid-feedback"),u(m,"class","valid-feedback"),u(t,"class","form-group mb-0"),u(p,"for",C=l[9]+"-color"),u(k,"role","radiogroup"),u(k,"class","local-mail-label-modal-color"),u(k,"id",y=l[9]+"-color"),u(b,"class","form-group")},m(V,te){S(V,e,te),g(e,t),g(t,s),g(s,i),g(t,r),g(t,a),l[13](a),$e(a,l[3]),g(t,f),g(t,d),P.m(d,null),g(t,c),g(t,m),g(e,_),g(e,b),g(b,p),g(p,w),g(b,$),g(b,k);for(let ae=0;ae<M.length;ae+=1)M[ae]&&M[ae].m(k,null);j||(B=[J(a,"input",l[14]),J(e,"submit",Te(l[10]))],j=!0)},p(V,te){te&32&&n!==(n=V[5].strings.name+"")&&R(i,n),te&512&&o!==(o=V[9]+"-name")&&u(a,"id",o),te&8&&a.value!==V[3]&&$e(a,V[3]),te&256&&U(a,"is-valid",V[8]),te&256&&U(a,"is-invalid",!V[8]),H===(H=q(V))&&P?P.p(V,te):(P.d(1),P=H(V),P&&(P.c(),P.m(d,null))),te&32&&v!==(v=V[5].strings.color+"")&&R(w,v),te&512&&C!==(C=V[9]+"-color")&&u(p,"for",C),te&160&&(O=ue(it),M=Le(M,te,x,1,V,O,A,k,Ze,Pt,null,Et)),te&512&&y!==(y=V[9]+"-color")&&u(k,"id",y)},d(V){V&&D(e),l[13](null),P.d();for(let te=0;te<M.length;te+=1)M[te].d();j=!1,we(B)}}}function xn(l){let e,t;return e=new Ue({props:{title:l[5].strings[l[1]?"editlabel":"newlabel"],cancelText:l[5].strings.cancel,onCancel:l[2],confirmText:l[5].strings[l[1]?"save":"create"],confirmDisabled:!l[8],onConfirm:l[10],$$slots:{default:[Zn]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,[n]){const i={};n&34&&(i.title=s[5].strings[s[1]?"editlabel":"newlabel"]),n&32&&(i.cancelText=s[5].strings.cancel),n&4&&(i.onCancel=s[2]),n&34&&(i.confirmText=s[5].strings[s[1]?"save":"create"]),n&256&&(i.confirmDisabled=!s[8]),n&525304&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function ei(l,e,t){let s,n,i,r,a,o,f,d=F,c=()=>(d(),d=_e(m,M=>t(5,f=M)),m);l.$$.on_destroy.push(()=>d());let{store:m}=e;c();let{label:_=void 0}=e,{onCancel:b}=e,{onSubmit:p}=e,v;const w=async()=>{p(n,i)};Qe(()=>v.focus());function C(M){Me[M?"unshift":"push"](()=>{v=M,t(6,v)})}function $(){n=this.value,t(3,n),t(1,_)}const k=M=>{t(7,i=M)};return l.$$set=M=>{"store"in M&&c(t(0,m=M.store)),"label"in M&&t(1,_=M.label),"onCancel"in M&&t(2,b=M.onCancel),"onSubmit"in M&&t(11,p=M.onSubmit)},l.$$.update=()=>{l.$$.dirty&2&&t(9,s=`local-mail-label-modal-${(_==null?void 0:_.id)||"new"}`),l.$$.dirty&2&&t(3,n=(_==null?void 0:_.name)||""),l.$$.dirty&2&&t(7,i=(_==null?void 0:_.color)||it[0]),l.$$.dirty&8&&t(12,r=Tt(n)==""),l.$$.dirty&42&&t(4,a=f.labels.some(M=>M.id!=(_==null?void 0:_.id)&&M.name==Tt(n))),l.$$.dirty&4112&&t(8,o=!r&&!a)},[m,_,b,n,a,f,v,i,o,s,w,p,r,C,$,k]}class en extends ce{constructor(e){super(),me(this,e,ei,xn,oe,{store:0,label:1,onCancel:2,onSubmit:11})}}const{Map:ti}=xe;function Rt(l,e,t){const s=l.slice();return s[16]=e[t],s}function Ft(l){let e,t=[],s=new ti,n,i,r=ue(l[3].labels);const a=m=>m[16].id;for(let m=0;m<r.length;m+=1){let _=Rt(l,r,m),b=a(_);s.set(b,t[m]=Gt(b,_))}let o=l[3].labels.length>0&&Ut();function f(m,_){return m[6]?li:si}let d=f(l),c=d(l);return{c(){e=h("div");for(let m=0;m<t.length;m+=1)t[m].c();n=L(),o&&o.c(),i=L(),c.c(),u(e,"class","dropdown-menu show")},m(m,_){S(m,e,_);for(let b=0;b<t.length;b+=1)t[b]&&t[b].m(e,null);g(e,n),o&&o.m(e,null),g(e,i),c.m(e,null)},p(m,_){_&552&&(r=ue(m[3].labels),t=Le(t,_,a,1,m,r,s,e,Ze,Gt,n,Rt)),m[3].labels.length>0?o||(o=Ut(),o.c(),o.m(e,i)):o&&(o.d(1),o=null),d===(d=f(m))&&c?c.p(m,_):(c.d(1),c=d(m),c&&(c.c(),c.m(e,null)))},d(m){m&&D(e);for(let _=0;_<t.length;_+=1)t[_].d();o&&o.d(),c.d()}}}function Gt(l,e){let t,s,n,i,r=e[16].name+"",a,o,f;function d(){return e[14](e[16])}return{key:l,first:null,c(){t=h("button"),s=h("i"),i=L(),a=E(r),u(s,"class",n="fa fa-fw "+e[5](e[16].id)),u(t,"type","button"),u(t,"class","dropdown-item local-mail-action-label-button-item"),this.first=t},m(c,m){S(c,t,m),g(t,s),g(t,i),g(t,a),o||(f=J(t,"click",d),o=!0)},p(c,m){e=c,m&40&&n!==(n="fa fa-fw "+e[5](e[16].id))&&u(s,"class",n),m&8&&r!==(r=e[16].name+"")&&R(a,r)},d(c){c&&D(t),o=!1,f()}}}function Ut(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function si(l){let e,t=l[3].strings.newlabel+"",s,n,i;return{c(){e=h("button"),s=E(t),u(e,"type","button"),u(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,a){S(r,e,a),g(e,s),n||(i=J(e,"click",l[11]),n=!0)},p(r,a){a&8&&t!==(t=r[3].strings.newlabel+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function li(l){let e,t=l[3].strings.apply+"",s,n,i;return{c(){e=h("button"),s=E(t),u(e,"type","button"),u(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,a){S(r,e,a),g(e,s),n||(i=J(e,"click",l[10]),n=!0)},p(r,a){a&8&&t!==(t=r[3].strings.apply+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Ht(l){let e,t;return e=new en({props:{store:l[0],onCancel:l[15],onSubmit:l[12]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[15]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function ni(l){let e,t,s,n,i,r,a,o,f,d,c=l[4]&&Ft(l),m=l[3].params.dialog=="createlabel"&&Ht(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=L(),c&&c.c(),a=L(),m&&m.c(),u(s,"class","fa fa-fw fa-tag"),u(t,"type","button"),u(t,"class","local-mail-action-label-button btn dropdown-toggle"),t.disabled=n=!l[3].selectedMessages.size,u(t,"aria-expanded",l[4]),u(t,"title",i=l[3].strings.labels),U(t,"btn-secondary",!l[1]),U(t,"disabled",!l[3].selectedMessages.size),u(e,"class","btn-group"),u(e,"role","group"),U(e,"dropup",l[2])},m(_,b){S(_,e,b),g(e,t),g(t,s),g(e,r),c&&c.m(e,null),g(e,a),m&&m.m(e,null),o=!0,f||(d=[J(t,"click",l[8]),De(Fe.call(null,e,l[7]))],f=!0)},p(_,[b]){(!o||b&8&&n!==(n=!_[3].selectedMessages.size))&&(t.disabled=n),(!o||b&16)&&u(t,"aria-expanded",_[4]),(!o||b&8&&i!==(i=_[3].strings.labels))&&u(t,"title",i),(!o||b&2)&&U(t,"btn-secondary",!_[1]),(!o||b&8)&&U(t,"disabled",!_[3].selectedMessages.size),_[4]?c?c.p(_,b):(c=Ft(_),c.c(),c.m(e,a)):c&&(c.d(1),c=null),_[3].params.dialog=="createlabel"?m?(m.p(_,b),b&8&&T(m,1)):(m=Ht(_),m.c(),T(m,1),m.m(e,null)):m&&(ie(),z(m,1,1,()=>{m=null}),re()),(!o||b&4)&&U(e,"dropup",_[2])},i(_){o||(T(m),o=!0)},o(_){z(m),o=!1},d(_){_&&D(e),c&&c.d(),m&&m.d(),f=!1,we(d)}}}function ii(l,e,t){let s,n,i,r=F,a=()=>(r(),r=_e(o,M=>t(3,i=M)),o);l.$$.on_destroy.push(()=>r());let{store:o}=e;a();let{transparent:f=!1}=e,{dropup:d=!1}=e,c=!1,m=new Map;const _=()=>{t(4,c=!1)},b=()=>{t(4,c=!c)},p=M=>{t(13,m=new Map(Array.from(m.entries()).map(([A,y])=>[A,A==M?y=="true"?"false":"true":y])))},v=()=>{t(4,c=!1),o.setLabels(Array.from(m.keys()).filter(M=>m.get(M)=="true"),Array.from(m.keys()).filter(M=>m.get(M)=="false"))},w=()=>{_(),o.showDialog("createlabel")},C=async(M,A)=>{o.hideDialog();const y=await o.createLabel(M,A);y&&o.setLabels([y],[])},$=M=>p(M.id),k=()=>o.hideDialog();return l.$$set=M=>{"store"in M&&a(t(0,o=M.store)),"transparent"in M&&t(1,f=M.transparent),"dropup"in M&&t(2,d=M.dropup)},l.$$.update=()=>{l.$$.dirty&8&&t(13,m=new Map(i.labels.map(M=>{const A=Array.from(i.selectedMessages.values()).filter(y=>y.labels.some(j=>j.id==M.id));return[M.id,A.length==0?"false":A.length<i.selectedMessages.size?"mixed":"true"]}))),l.$$.dirty&8200&&t(6,s=Array.from(m.entries()).some(([M,A])=>Array.from(i.selectedMessages.values()).some(y=>A=="true"&&y.labels.every(j=>j.id!=M)||A=="false"&&y.labels.some(j=>j.id==M)))),l.$$.dirty&8192&&t(5,n=M=>m.get(M)=="false"?"fa-square-o":m.get(M)=="mixed"?"fa-minus-square-o":"fa-check-square-o")},[o,f,d,i,c,n,s,_,b,p,v,w,C,m,$,k]}class tn extends ce{constructor(e){super(),me(this,e,ii,ni,oe,{store:0,transparent:1,dropup:2})}}function Ot(l){let e;function t(i,r){return i[8].params.tray=="trash"?ai:ri}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),u(e,"class","dropdown-menu show")},m(i,r){S(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&D(e),n.d()}}}function ri(l){let e,t,s,n,i,r=l[6]&&Jt(l),a=l[7]&&Vt(l),o=l[4]&&Kt(l),f=l[5]&&Yt(l),d=l[3]&&Wt(l);return{c(){r&&r.c(),e=L(),a&&a.c(),t=L(),o&&o.c(),s=L(),f&&f.c(),n=L(),d&&d.c(),i=be()},m(c,m){r&&r.m(c,m),S(c,e,m),a&&a.m(c,m),S(c,t,m),o&&o.m(c,m),S(c,s,m),f&&f.m(c,m),S(c,n,m),d&&d.m(c,m),S(c,i,m)},p(c,m){c[6]?r?r.p(c,m):(r=Jt(c),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),c[7]?a?a.p(c,m):(a=Vt(c),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),c[4]?o?o.p(c,m):(o=Kt(c),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),c[5]?f?f.p(c,m):(f=Yt(c),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null),c[3]?d?d.p(c,m):(d=Wt(c),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null)},d(c){c&&(D(e),D(t),D(s),D(n),D(i)),r&&r.d(c),a&&a.d(c),o&&o.d(c),f&&f.d(c),d&&d.d(c)}}}function ai(l){let e,t=l[8].strings.emptytrash+"",s,n,i;return{c(){e=h("button"),s=E(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=J(e,"click",l[19]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.emptytrash+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Jt(l){let e,t=l[8].strings.markasread+"",s,n,i;return{c(){e=h("button"),s=E(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=J(e,"click",l[22]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasread+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Vt(l){let e,t=l[8].strings.markasunread+"",s,n,i;return{c(){e=h("button"),s=E(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=J(e,"click",l[23]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasunread+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Kt(l){let e,t=l[8].strings.markasstarred+"",s,n,i;return{c(){e=h("button"),s=E(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=J(e,"click",l[24]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasstarred+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Yt(l){let e,t=l[8].strings.markasunstarred+"",s,n,i;return{c(){e=h("button"),s=E(t),u(e,"type","button"),u(e,"class","dropdown-item")},m(r,a){S(r,e,a),g(e,s),n||(i=J(e,"click",l[25]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasunstarred+"")&&R(s,t)},d(r){r&&D(e),n=!1,i()}}}function Wt(l){let e,t,s=l[8].strings.editlabel+"",n,i,r,a=l[8].strings.deletelabel+"",o,f,d,c=(l[6]||l[7]||l[4]||l[5])&&Xt();return{c(){c&&c.c(),e=L(),t=h("button"),n=E(s),i=L(),r=h("button"),o=E(a),u(t,"type","button"),u(t,"class","dropdown-item"),u(r,"type","button"),u(r,"class","dropdown-item")},m(m,_){c&&c.m(m,_),S(m,e,_),S(m,t,_),g(t,n),S(m,i,_),S(m,r,_),g(r,o),f||(d=[J(t,"click",l[15]),J(r,"click",l[17])],f=!0)},p(m,_){m[6]||m[7]||m[4]||m[5]?c||(c=Xt(),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null),_&256&&s!==(s=m[8].strings.editlabel+"")&&R(n,s),_&256&&a!==(a=m[8].strings.deletelabel+"")&&R(o,a)},d(m){m&&(D(e),D(t),D(i),D(r)),c&&c.d(m),f=!1,we(d)}}}function Xt(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function oi(l){let e,t,s,n;const i=[ci,ui],r=[];function a(o,f){return o[8].params.dialog=="editlabel"?0:o[8].params.dialog=="deletelabel"?1:-1}return~(e=a(l))&&(t=r[e]=i[e](l)),{c(){t&&t.c(),s=be()},m(o,f){~e&&r[e].m(o,f),S(o,s,f),n=!0},p(o,f){let d=e;e=a(o),e===d?~e&&r[e].p(o,f):(t&&(ie(),z(r[d],1,1,()=>{r[d]=null}),re()),~e?(t=r[e],t?t.p(o,f):(t=r[e]=i[e](o),t.c()),T(t,1),t.m(s.parentNode,s)):t=null)},i(o){n||(T(t),n=!0)},o(o){z(t),n=!1},d(o){o&&D(s),~e&&r[e].d(o)}}}function fi(l){let e,t,s=l[8].params.dialog=="emptytrash"&&Qt(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,i){n[8].params.dialog=="emptytrash"?s?(s.p(n,i),i&256&&T(s,1)):(s=Qt(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function ui(l){let e,t;return e=new Ue({props:{title:l[8].strings.deletelabel,cancelText:l[8].strings.cancel,confirmText:l[8].strings.deletelabel,confirmClass:"btn-danger",onCancel:l[28],onConfirm:l[18],$$slots:{default:[mi]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&256&&(i.title=s[8].strings.deletelabel),n&256&&(i.cancelText=s[8].strings.cancel),n&256&&(i.confirmText=s[8].strings.deletelabel),n&1&&(i.onCancel=s[28]),n&536871176&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function ci(l){let e,t;return e=new en({props:{store:l[0],label:l[3],onCancel:l[27],onSubmit:l[16]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.label=s[3]),n&1&&(i.onCancel=s[27]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function mi(l){let e=Ne(l[8].strings.deletelabelconfirm,l[3].name)+"",t;return{c(){t=E(e)},m(s,n){S(s,t,n)},p(s,n){n&264&&e!==(e=Ne(s[8].strings.deletelabelconfirm,s[3].name)+"")&&R(t,e)},d(s){s&&D(t)}}}function Qt(l){let e,t;return e=new Ue({props:{title:l[8].strings.emptytrash,cancelText:l[8].strings.cancel,confirmText:l[8].strings.emptytrash,confirmClass:"btn-danger",onCancel:l[26],onConfirm:l[20],$$slots:{default:[di]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&256&&(i.title=s[8].strings.emptytrash),n&256&&(i.cancelText=s[8].strings.cancel),n&256&&(i.confirmText=s[8].strings.emptytrash),n&1&&(i.onCancel=s[26]),n&536871168&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function di(l){let e=l[8].strings.emptytrashconfirm+"",t;return{c(){t=E(e)},m(s,n){S(s,t,n)},p(s,n){n&256&&e!==(e=s[8].strings.emptytrashconfirm+"")&&R(t,e)},d(s){s&&D(t)}}}function _i(l){let e,t,s,n,i,r,a,o,f,d,c,m,_=l[9]&&Ot(l);const b=[fi,oi],p=[];function v(w,C){return w[8].params.tray=="trash"?0:w[3]?1:-1}return~(a=v(l))&&(o=p[a]=b[a](l)),{c(){e=h("div"),t=h("button"),s=h("i"),i=L(),_&&_.c(),r=L(),o&&o.c(),f=be(),u(s,"class","fa fa-fw fa-ellipsis-v"),u(t,"type","button"),u(t,"class","local-mail-action-more-button btn dropdown-toggle"),t.disabled=l[10],u(t,"aria-expanded",l[9]),u(t,"title",n=l[8].strings.more),U(t,"btn-secondary",!l[1]),U(t,"disabled",l[10]),u(e,"class","btn-group"),U(e,"dropup",l[2])},m(w,C){S(w,e,C),g(e,t),g(t,s),g(e,i),_&&_.m(e,null),S(w,r,C),~a&&p[a].m(w,C),S(w,f,C),d=!0,c||(m=[J(t,"click",l[12]),De(Fe.call(null,e,l[11]))],c=!0)},p(w,[C]){(!d||C&1024)&&(t.disabled=w[10]),(!d||C&512)&&u(t,"aria-expanded",w[9]),(!d||C&256&&n!==(n=w[8].strings.more))&&u(t,"title",n),(!d||C&2)&&U(t,"btn-secondary",!w[1]),(!d||C&1024)&&U(t,"disabled",w[10]),w[9]?_?_.p(w,C):(_=Ot(w),_.c(),_.m(e,null)):_&&(_.d(1),_=null),(!d||C&4)&&U(e,"dropup",w[2]);let $=a;a=v(w),a===$?~a&&p[a].p(w,C):(o&&(ie(),z(p[$],1,1,()=>{p[$]=null}),re()),~a?(o=p[a],o?o.p(w,C):(o=p[a]=b[a](w),o.c()),T(o,1),o.m(f.parentNode,f)):o=null)},i(w){d||(T(o),d=!0)},o(w){z(o),d=!1},d(w){w&&(D(e),D(r),D(f)),_&&_.d(),~a&&p[a].d(w),c=!1,we(m)}}}function gi(l,e,t){let s,n,i,r,a,o,f,d,c=F,m=()=>(c(),c=_e(_,X=>t(8,d=X)),_);l.$$.on_destroy.push(()=>c());let{store:_}=e;m();let{transparent:b=!1}=e,{dropup:p=!1}=e,v=!1;const w=()=>{t(9,v=!1)},C=()=>{t(9,v=!v)},$=X=>{w(),_.setUnread(n.filter(Q=>!Q.draft).map(Q=>Q.id),X)},k=X=>{w(),_.setStarred(n.map(Q=>Q.id),X)},M=()=>{w(),_.showDialog("editlabel")},A=(X,Q)=>{_.hideDialog(),s&&_.updateLabel(s.id,X,Q)},y=()=>{w(),_.showDialog("deletelabel")},j=()=>{_.hideDialog(),_.deleteLabel(d.params.labelid||0)},B=()=>{w(),_.showDialog("emptytrash")},q=()=>{_.hideDialog(),_.emptyTrash(d.params.courseid)},H=()=>$(!1),P=()=>$(!0),O=()=>k(!0),x=()=>k(!1),V=()=>_.hideDialog(),te=()=>_.hideDialog(),ae=()=>_.hideDialog();return l.$$set=X=>{"store"in X&&m(t(0,_=X.store)),"transparent"in X&&t(1,b=X.transparent),"dropup"in X&&t(2,p=X.dropup)},l.$$.update=()=>{l.$$.dirty&256&&t(3,s=d.params.tray=="label"&&d.message==null?d.labels.find(X=>X.id==d.params.labelid):null),l.$$.dirty&256&&t(21,n=Array.from(d.selectedMessages.values())),l.$$.dirty&2097152&&t(7,i=n.some(X=>!X.draft&&!X.unread)),l.$$.dirty&2097152&&t(6,r=n.some(X=>!X.draft&&X.unread)),l.$$.dirty&2097152&&t(5,a=n.some(X=>X.starred)),l.$$.dirty&2097152&&t(4,o=n.some(X=>!X.starred)),l.$$.dirty&504&&t(10,f=d.params.tray=="trash"?!d.totalCount:!s&&!i&&!r&&!a&&!o)},[_,b,p,s,o,a,r,i,d,v,f,w,C,$,k,M,A,y,j,B,q,n,H,P,O,x,V,te,ae]}class sn extends ce{constructor(e){super(),me(this,e,gi,_i,oe,{store:0,transparent:1,dropup:2})}}function Zt(l){let e,t;return{c(){e=h("div"),t=E(l[4]),u(e,"class","align-self-center text-nowrap")},m(s,n){S(s,e,n),g(e,t)},p(s,n){n&16&&R(t,s[4])},d(s){s&&D(e)}}}function xt(l){let e,t;return{c(){e=h("div"),t=E(l[4]),u(e,"class","text-truncate align-self-center mx-2")},m(s,n){S(s,e,n),g(e,t)},p(s,n){n&16&&R(t,s[4])},d(s){s&&D(e)}}}function pi(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,w,C=!l[2]&&Zt(l),$=l[2]&&xt(l);return{c(){e=h("div"),C&&C.c(),t=L(),s=h("div"),n=h("button"),i=h("i"),f=L(),$&&$.c(),d=L(),c=h("button"),m=h("i"),u(i,"class","fa fa-w fa-chevron-left"),u(i,"aria-label",r=l[3].strings.previouspage),u(n,"type","button"),u(n,"class","btn btn-secondary"),n.disabled=a=!l[5],u(n,"title",o=l[3].strings[l[3].message?"previousmessage":"previouspage"]),U(n,"btn-secondary",!l[1]),u(m,"class","fa fa-w fa-chevron-right"),u(m,"aria-label",_=l[3].strings.nextpage),u(c,"type","button"),u(c,"class","btn"),c.disabled=b=!l[6],u(c,"title",p=l[3].strings[l[3].message?"nextmessage":"nextpage"]),U(c,"btn-secondary",!l[1]),u(s,"class","btn-group d-flex"),u(s,"role","group"),U(s,"btn-group",!l[2]),u(e,"class","local-mail-paging-buttons d-flex"),U(e,"ml-auto",!l[2])},m(k,M){S(k,e,M),C&&C.m(e,null),g(e,t),g(e,s),g(s,n),g(n,i),g(s,f),$&&$.m(s,null),g(s,d),g(s,c),g(c,m),v||(w=[J(n,"click",Te(l[9])),J(c,"click",Te(l[10]))],v=!0)},p(k,[M]){k[2]?C&&(C.d(1),C=null):C?C.p(k,M):(C=Zt(k),C.c(),C.m(e,t)),M&8&&r!==(r=k[3].strings.previouspage)&&u(i,"aria-label",r),M&32&&a!==(a=!k[5])&&(n.disabled=a),M&8&&o!==(o=k[3].strings[k[3].message?"previousmessage":"previouspage"])&&u(n,"title",o),M&2&&U(n,"btn-secondary",!k[1]),k[2]?$?$.p(k,M):($=xt(k),$.c(),$.m(s,d)):$&&($.d(1),$=null),M&8&&_!==(_=k[3].strings.nextpage)&&u(m,"aria-label",_),M&64&&b!==(b=!k[6])&&(c.disabled=b),M&8&&p!==(p=k[3].strings[k[3].message?"nextmessage":"nextpage"])&&u(c,"title",p),M&2&&U(c,"btn-secondary",!k[1]),M&4&&U(s,"btn-group",!k[2]),M&4&&U(e,"ml-auto",!k[2])},i:F,o:F,d(k){k&&D(e),C&&C.d(),$&&$.d(),v=!1,we(w)}}}function bi(l,e,t){let s,n,i,r,a,o,f=F,d=()=>(f(),f=_e(c,v=>t(3,o=v)),c);l.$$.on_destroy.push(()=>f());let{store:c}=e;d();let{transparent:m=!1}=e,{compact:_=!1}=e;const b=()=>c.navigate(r),p=()=>c.navigate(i);return l.$$set=v=>{"store"in v&&d(t(0,c=v.store)),"transparent"in v&&t(1,m=v.transparent),"compact"in v&&t(2,_=v.compact)},l.$$.update=()=>{var v;l.$$.dirty&8&&t(8,s=o.nextMessageId||!o.params.search&&(o.params.offset||0)+o.preferences.perpage<o.totalCount),l.$$.dirty&8&&t(7,n=o.prevMessageId||!o.params.search&&(o.params.offset||0)),l.$$.dirty&264&&t(6,i=s?o.message?{...o.params,messageid:o.nextMessageId,offset:(o.params.offset||0)+1}:{...o.params,messageid:void 0,offset:(o.params.offset||0)+o.preferences.perpage,search:o.params.search?{...o.params.search,startid:(v=o.listMessages[o.listMessages.length-1])==null?void 0:v.id,reverse:!1}:void 0}:void 0),l.$$.dirty&136&&t(5,r=n?o.message?{...o.params,messageid:o.prevMessageId,offset:Math.max(0,(o.params.offset||0)-1)}:{...o.params,messageid:void 0,offset:Math.max(0,(o.params.offset||0)-o.preferences.perpage),search:o.params.search?{...o.params.search,startid:o.listMessages[0].id,reverse:!0}:void 0}:void 0),l.$$.dirty&8&&t(4,a=o.message?o.params.search?(o.params.offset||0)+1:Ne(o.strings.pagingsingle,{index:(o.messageOffset||0)+1,total:o.totalCount}):o.listMessages.length==0?"":o.params.search?Ne(o.strings.pagingrange,{first:(o.params.offset||0)+1,last:(o.params.offset||0)+o.listMessages.length}):Ne(o.strings.pagingrangetotal,{first:(o.params.offset||0)+1,last:(o.params.offset||0)+o.listMessages.length,total:o.totalCount}))},[c,m,_,o,a,r,i,n,s,b,p]}class ln extends ce{constructor(e){super(),me(this,e,bi,pi,oe,{store:0,transparent:1,compact:2})}}function es(l){let e,t;return e=new Ue({props:{title:l[2].strings.restore,cancelText:l[2].strings.cancel,confirmText:l[2].strings.restore,onCancel:l[5],onConfirm:l[3],$$slots:{default:[hi]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.restore),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.restore),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function hi(l){let e=l[2].strings.restoremessageconfirm+"",t;return{c(){t=E(e)},m(s,n){S(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings.restoremessageconfirm+"")&&R(t,e)},d(s){s&&D(t)}}}function ki(l){let e,t,s,n,i,r,a,o,f,d=l[2].params.dialog=="restore"&&es(l);return{c(){e=h("button"),t=h("i"),i=L(),d&&d.c(),r=be(),u(t,"class","fa fa-fw fa-undo"),u(e,"type","button"),u(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,u(e,"title",n=l[2].strings.restore),U(e,"btn-secondary",!l[1]),U(e,"disabled",!l[2].selectedMessages.size)},m(c,m){S(c,e,m),g(e,t),S(c,i,m),d&&d.m(c,m),S(c,r,m),a=!0,o||(f=J(e,"click",l[4]),o=!0)},p(c,[m]){(!a||m&4&&s!==(s=!c[2].selectedMessages.size))&&(e.disabled=s),(!a||m&4&&n!==(n=c[2].strings.restore))&&u(e,"title",n),(!a||m&2)&&U(e,"btn-secondary",!c[1]),(!a||m&4)&&U(e,"disabled",!c[2].selectedMessages.size),c[2].params.dialog=="restore"?d?(d.p(c,m),m&4&&T(d,1)):(d=es(c),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(ie(),z(d,1,1,()=>{d=null}),re())},i(c){a||(T(d),a=!0)},o(c){z(d),a=!1},d(c){c&&(D(e),D(i),D(r)),d&&d.d(c),o=!1,f()}}}function vi(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,c=>t(2,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:a=!1}=e;const o=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Pe.NotDeleted,!0)},f=()=>r.showDialog("restore"),d=()=>r.hideDialog();return l.$$set=c=>{"store"in c&&i(t(0,r=c.store)),"transparent"in c&&t(1,a=c.transparent)},[r,a,s,o,f,d]}class nn extends ce{constructor(e){super(),me(this,e,vi,ki,oe,{store:0,transparent:1})}}function wi(l){let e,t,s,n;return e=new tn({props:{store:l[0],transparent:!0,dropup:!0}}),s=new Zl({props:{store:l[0],transparent:!0}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){Y(e,i,r),S(i,t,r),Y(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function $i(l){let e,t,s,n;return e=new nn({props:{store:l[0],transparent:!0}}),s=new xl({props:{store:l[0],transparent:!0}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){Y(e,i,r),S(i,t,r),Y(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function yi(l){let e,t,s,n,i,r,a,o,f,d,c;const m=[$i,wi],_=[];function b(p,v){return p[4].params.tray=="trash"?0:1}return n=b(l),i=_[n]=m[n](l),a=new sn({props:{store:l[0],transparent:!0,dropup:!0}}),f=new ln({props:{store:l[0],transparent:!0,compact:!0}}),{c(){e=h("div"),t=h("div"),s=h("div"),i.c(),r=L(),K(a.$$.fragment),o=L(),K(f.$$.fragment),u(s,"class","w-100 d-flex justify-content-around"),u(s,"role","group"),u(t,"role","toolbar"),u(t,"class","local-mail-toolbar d-flex w-100 py-3 border-top svelte-hn1exj"),je(()=>l[5].call(t)),U(t,"position-fixed",l[3]),U(t,"position-absolute",!l[3]),U(t,"fixed-bottom",l[3]),U(t,"border-bottom",!l[3]),U(t,"bg-white",!l[3]),U(t,"bg-light",l[3]),u(e,"class","row position-relative"),ge(e,"height",l[1]+"px")},m(p,v){S(p,e,v),g(e,t),g(t,s),_[n].m(s,null),g(s,r),Y(a,s,null),g(s,o),Y(f,s,null),d=Mn(t,l[5].bind(t)),l[6](e),c=!0},p(p,[v]){let w=n;n=b(p),n===w?_[n].p(p,v):(ie(),z(_[w],1,1,()=>{_[w]=null}),re(),i=_[n],i?i.p(p,v):(i=_[n]=m[n](p),i.c()),T(i,1),i.m(s,r));const C={};v&1&&(C.store=p[0]),a.$set(C);const $={};v&1&&($.store=p[0]),f.$set($),(!c||v&8)&&U(t,"position-fixed",p[3]),(!c||v&8)&&U(t,"position-absolute",!p[3]),(!c||v&8)&&U(t,"fixed-bottom",p[3]),(!c||v&8)&&U(t,"border-bottom",!p[3]),(!c||v&8)&&U(t,"bg-white",!p[3]),(!c||v&8)&&U(t,"bg-light",p[3]),(!c||v&2)&&ge(e,"height",p[1]+"px")},i(p){c||(T(i),T(a.$$.fragment,p),T(f.$$.fragment,p),c=!0)},o(p){z(i),z(a.$$.fragment,p),z(f.$$.fragment,p),c=!1},d(p){p&&D(e),_[n].d(),W(a),W(f),d(),l[6](null)}}}function Mi(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,m=>t(4,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let a,o,f=!1;Qe(()=>{const m=new IntersectionObserver(_=>{for(const b of _)t(3,f=b.intersectionRatio<1&&b.boundingClientRect.top>=b.boundingClientRect.height)},{threshold:1});return m.observe(o),()=>m.disconnect()});function d(){a=this.offsetHeight,t(1,a)}function c(m){Me[m?"unshift":"push"](()=>{o=m,t(2,o)})}return l.$$set=m=>{"store"in m&&i(t(0,r=m.store))},[r,a,o,f,s,d,c]}class Ci extends ce{constructor(e){super(),me(this,e,Mi,yi,oe,{store:0})}}function rn(l,{from:e,to:t},s={}){const n=getComputedStyle(l),i=n.transform==="none"?"":n.transform,[r,a]=n.transformOrigin.split(" ").map(parseFloat),o=e.left+e.width*r/t.width-(t.left+r),f=e.top+e.height*a/t.height-(t.top+a),{delay:d=0,duration:c=_=>Math.sqrt(_)*120,easing:m=Ql}=s;return{delay:d,duration:Ce(c)?c(Math.sqrt(o*o+f*f)):c,easing:m,css:(_,b)=>{const p=b*o,v=b*f,w=_+b*e.width/t.width,C=_+b*e.height/t.height;return`transform: ${i} translate(${p}px, ${v}px) scale(${w}, ${C});`}}}function Si(l){let e,t,s,n,i,r,a;return{c(){e=h("button"),t=h("i"),u(t,"class",s="fa align-middle "+l[3]),u(e,"type","button"),u(e,"class","btn px-2"),u(e,"role","checkbox"),u(e,"aria-checked",n=!!l[2].selectedMessages.has(l[1].id)),u(e,"title",i=l[2].strings.select)},m(o,f){S(o,e,f),g(e,t),r||(a=J(e,"click",Hl(Te(l[4]))),r=!0)},p(o,[f]){f&8&&s!==(s="fa align-middle "+o[3])&&u(t,"class",s),f&6&&n!==(n=!!o[2].selectedMessages.has(o[1].id))&&u(e,"aria-checked",n),f&4&&i!==(i=o[2].strings.select)&&u(e,"title",i)},i:F,o:F,d(o){o&&D(e),r=!1,a()}}}function Di(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,d=>t(2,n=d)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;const f=()=>a.toggleSelected(o.id);return l.$$set=d=>{"store"in d&&r(t(0,a=d.store)),"message"in d&&t(1,o=d.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=n.selectedMessages.has(o.id)?"fa-check-square-o":"fa-square-o")},[a,o,n,s,f]}class an extends ce{constructor(e){super(),me(this,e,Di,Si,oe,{store:0,message:1})}}function Ti(l){let e,t,s,n,i,r,a,o;return{c(){e=h("button"),t=h("i"),u(t,"class",s="fa "+l[2]),u(e,"type","button"),u(e,"class","btn px-2"),u(e,"role","checkbox"),u(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,u(e,"title",r=l[1].deleted?l[3].strings[l[1].starred?"starred":"unstarred"]:l[3].strings[l[1].starred?"markasunstarred":"markasstarred"])},m(f,d){S(f,e,d),g(e,t),a||(o=J(e,"click",Hl(Te(l[4]))),a=!0)},p(f,[d]){d&4&&s!==(s="fa "+f[2])&&u(t,"class",s),d&2&&n!==(n=f[1].starred)&&u(e,"aria-checked",n),d&2&&i!==(i=f[1].deleted)&&(e.disabled=i),d&10&&r!==(r=f[1].deleted?f[3].strings[f[1].starred?"starred":"unstarred"]:f[3].strings[f[1].starred?"markasunstarred":"markasstarred"])&&u(e,"title",r)},i:F,o:F,d(f){f&&D(e),a=!1,o()}}}function Li(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,d=>t(3,n=d)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;const f=()=>a.setStarred([o.id],!o.starred);return l.$$set=d=>{"store"in d&&r(t(0,a=d.store)),"message"in d&&t(1,o=d.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,s,n,f]}class on extends ce{constructor(e){super(),me(this,e,Li,Ti,oe,{store:0,message:1})}}function zi(l){let e,t=l[1].join(", ")+"",s,n,i,r;return{c(){e=h("div"),s=E(t)},m(a,o){S(a,e,o),g(e,s),i||(r=De(n=Re.call(null,e,l[1].join(`
`))),i=!0)},p(a,[o]){o&2&&t!==(t=a[1].join(", ")+"")&&R(s,t),n&&Ce(n.update)&&o&2&&n.update.call(null,a[1].join(`
`))},i:F,o:F,d(a){a&&D(e),i=!1,r()}}}function ji(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,f=>t(3,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return l.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(2,o=f.message)},l.$$.update=()=>{l.$$.dirty&12&&t(1,s=n.params.tray=="sent"||n.params.tray=="drafts"?o.recipients.length>0?o.recipients.map(f=>f.fullname):[n.strings.norecipient]:[o.sender.fullname])},[a,s,o,n]}class dt extends ce{constructor(e){super(),me(this,e,ji,zi,oe,{store:0,message:2})}}function ts(l){let e,t=l[2].strings.draft+"",s;return{c(){e=h("span"),s=E(t),u(e,"class","mr-2 text-danger")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i&4&&t!==(t=n[2].strings.draft+"")&&R(s,t)},d(n){n&&D(e)}}}function Ni(l){let e,t,s=(l[1].subject||l[2].strings.nosubject)+"",n,i,r,a,o=l[1].draft&&ts(l);return{c(){e=h("div"),o&&o.c(),t=L(),n=E(s)},m(f,d){S(f,e,d),o&&o.m(e,null),g(e,t),g(e,n),r||(a=De(i=Re.call(null,e,l[1].subject||l[2].strings.nosubject)),r=!0)},p(f,[d]){f[1].draft?o?o.p(f,d):(o=ts(f),o.c(),o.m(e,t)):o&&(o.d(1),o=null),d&6&&s!==(s=(f[1].subject||f[2].strings.nosubject)+"")&&R(n,s),i&&Ce(i.update)&&d&6&&i.update.call(null,f[1].subject||f[2].strings.nosubject)},i:F,o:F,d(f){f&&D(e),o&&o.d(),r=!1,a()}}}function Ai(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class _t extends ce{constructor(e){super(),me(this,e,Ai,Ni,oe,{store:0,message:1})}}function ss(l){let e,t,s,n,i;return{c(){e=h("span"),t=E(l[2]),u(e,"class","local-mail-course-badge badge px-2 mr-2 mb-2"),ge(e,"min-width","3rem"),ge(e,"max-width","calc("+l[1]+"ch + 1.5rem)")},m(r,a){S(r,e,a),g(e,t),n||(i=De(s=Re.call(null,e,l[2])),n=!0)},p(r,a){a&4&&R(t,r[2]),a&2&&ge(e,"max-width","calc("+r[1]+"ch + 1.5rem)"),s&&Ce(s.update)&&a&4&&s.update.call(null,r[2])},d(r){r&&D(e),n=!1,i()}}}function Bi(l){let e=["shortname","fullname"].includes(l[0].coursebadges),t,s=e&&ss(l);return{c(){s&&s.c(),t=be()},m(n,i){s&&s.m(n,i),S(n,t,i)},p(n,[i]){i&1&&(e=["shortname","fullname"].includes(n[0].coursebadges)),e?s?s.p(n,i):(s=ss(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:F,o:F,d(n){n&&D(t),s&&s.d(n)}}}function qi(l,e,t){let s,n,{course:i}=e,{settings:r}=e;return l.$$set=a=>{"course"in a&&t(3,i=a.course),"settings"in a&&t(0,r=a.settings)},l.$$.update=()=>{l.$$.dirty&9&&t(2,s=r.coursebadges=="shortname"?i.shortname:i.fullname),l.$$.dirty&1&&t(1,n=r.coursebadgeslength||20)},[r,n,s,i]}class gt extends ce{constructor(e){super(),me(this,e,qi,Bi,oe,{course:3,settings:0})}}function Ii(l){let e,t=l[0].name+"",s,n;return{c(){e=h("span"),s=E(t),u(e,"class","local-mail-label-badge badge flex-shrink-0 px-2 mr-2 mb-2"),u(e,"style",n=`color: var(--local-mail-color-${l[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${l[1]}-bg, var(--local-mail-color-gray-bg))`)},m(i,r){S(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].name+"")&&R(s,t),r&2&&n!==(n=`color: var(--local-mail-color-${i[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${i[1]}-bg, var(--local-mail-color-gray-bg))`)&&u(e,"style",n)},i:F,o:F,d(i){i&&D(e)}}}function Ei(l,e,t){let s,{label:n}=e;return l.$$set=i=>{"label"in i&&t(0,n=i.label)},l.$$.update=()=>{l.$$.dirty&1&&t(1,s=it.includes(n.color)?n.color:"gray")},[n,s]}class pt extends ce{constructor(e){super(),me(this,e,Ei,Ii,oe,{label:0})}}function ls(l,e,t){const s=l.slice();return s[3]=e[t],s}function ns(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&is(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&T(s,1)):(s=is(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function is(l){let e,t;return e=new gt({props:{course:l[1].course,settings:l[2].settings}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function rs(l){let e,t;return e=new pt({props:{label:l[3]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.label=s[3]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function as(l,e){let t,s,n,i=(e[2].params.tray!="label"||e[2].params.labelid!=e[3].id)&&rs(e);return{key:l,first:null,c(){t=be(),i&&i.c(),s=be(),this.first=t},m(r,a){S(r,t,a),i&&i.m(r,a),S(r,s,a),n=!0},p(r,a){e=r,e[2].params.tray!="label"||e[2].params.labelid!=e[3].id?i?(i.p(e,a),a&6&&T(i,1)):(i=rs(e),i.c(),T(i,1),i.m(s.parentNode,s)):i&&(ie(),z(i,1,1,()=>{i=null}),re())},i(r){n||(T(i),n=!0)},o(r){z(i),n=!1},d(r){r&&(D(t),D(s)),i&&i.d(r)}}}function os(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&fs(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&T(s,1)):(s=fs(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function fs(l){let e,t;return e=new gt({props:{course:l[1].course,settings:l[2].settings}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Pi(l){let e,t=[],s=new Map,n,i,r,a=l[2].viewportSize<de.MD&&ns(l),o=ue(l[1].labels);const f=c=>c[3].id;for(let c=0;c<o.length;c+=1){let m=ls(l,o,c),_=f(m);s.set(_,t[c]=as(_,m))}let d=l[2].viewportSize>=de.MD&&os(l);return{c(){a&&a.c(),e=L();for(let c=0;c<t.length;c+=1)t[c].c();n=L(),d&&d.c(),i=be()},m(c,m){a&&a.m(c,m),S(c,e,m);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(c,m);S(c,n,m),d&&d.m(c,m),S(c,i,m),r=!0},p(c,[m]){c[2].viewportSize<de.MD?a?(a.p(c,m),m&4&&T(a,1)):(a=ns(c),a.c(),T(a,1),a.m(e.parentNode,e)):a&&(ie(),z(a,1,1,()=>{a=null}),re()),m&6&&(o=ue(c[1].labels),ie(),t=Le(t,m,f,1,c,o,s,n.parentNode,Ge,as,n,ls),re()),c[2].viewportSize>=de.MD?d?(d.p(c,m),m&4&&T(d,1)):(d=os(c),d.c(),T(d,1),d.m(i.parentNode,i)):d&&(ie(),z(d,1,1,()=>{d=null}),re())},i(c){if(!r){T(a);for(let m=0;m<o.length;m+=1)T(t[m]);T(d),r=!0}},o(c){z(a);for(let m=0;m<t.length;m+=1)z(t[m]);z(d),r=!1},d(c){c&&(D(e),D(n),D(i)),a&&a.d(c);for(let m=0;m<t.length;m+=1)t[m].d(c);d&&d.d(c)}}}function Ri(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class fn extends ce{constructor(e){super(),me(this,e,Ri,Pi,oe,{store:0,message:1})}}function us(l){let e,t,s,n,i;return{c(){e=h("span"),t=h("i"),u(t,"class",s="fa fa-fw "+(l[1].numattachments>0?"fa-paperclip":"")),u(t,"aria-hidden",!0),u(e,"class","-shrink-0 mr-2"),u(e,"aria-hidden",n=l[1].numattachments==0),u(e,"title",i=l[1].numattachments>0?l[2].strings.hasattachments:void 0)},m(r,a){S(r,e,a),g(e,t)},p(r,a){a&2&&s!==(s="fa fa-fw "+(r[1].numattachments>0?"fa-paperclip":""))&&u(t,"class",s),a&2&&n!==(n=r[1].numattachments==0)&&u(e,"aria-hidden",n),a&6&&i!==(i=r[1].numattachments>0?r[2].strings.hasattachments:void 0)&&u(e,"title",i)},d(r){r&&D(e)}}}function Fi(l){let e,t=(l[1].numattachments>0||l[2].viewportSize>=de.MD)&&us(l);return{c(){t&&t.c(),e=be()},m(s,n){t&&t.m(s,n),S(s,e,n)},p(s,[n]){s[1].numattachments>0||s[2].viewportSize>=de.MD?t?t.p(s,n):(t=us(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:F,o:F,d(s){s&&D(e),t&&t.d(s)}}}function Gi(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class un extends ce{constructor(e){super(),me(this,e,Gi,Fi,oe,{store:0,message:1})}}function Ui(l){let e,t=l[0].shorttime+"",s,n;return{c(){e=h("span"),s=E(t),u(e,"class","local-mail-list-message-time d-shrink-0 text-nowrap text-right"),u(e,"title",n=l[0].fulltime),U(e,"local-mail-list-message-time-md",l[2].viewportSize>=de.MD)},m(i,r){S(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].shorttime+"")&&R(s,t),r&1&&n!==(n=i[0].fulltime)&&u(e,"title",n),r&4&&U(e,"local-mail-list-message-time-md",i[2].viewportSize>=de.MD)},i:F,o:F,d(i){i&&D(e)}}}function Hi(l,e,t){let s,n=F,i=()=>(n(),n=_e(a,o=>t(2,s=o)),a);l.$$.on_destroy.push(()=>n());let{message:r}=e,{store:a}=e;return i(),l.$$set=o=>{"message"in o&&t(0,r=o.message),"store"in o&&i(t(1,a=o.store))},[r,a,s]}class cn extends ce{constructor(e){super(),me(this,e,Hi,Ui,oe,{message:0,store:1})}}function cs(l){let e,t,s=l[1].strings.nomessagesfound+"",n,i,r,a=l[1].totalCount>0&&ms(l);return{c(){e=h("div"),t=h("div"),n=E(s),i=L(),a&&a.c(),u(e,"class","alert alert-info")},m(o,f){S(o,e,f),g(e,t),g(t,n),g(e,i),a&&a.m(e,null)},p(o,f){f&2&&s!==(s=o[1].strings.nomessagesfound+"")&&R(n,s),o[1].totalCount>0?a?a.p(o,f):(a=ms(o),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i(o){o&&(r||je(()=>{r=ct(e,Be,{delay:400}),r.start()}))},o:F,d(o){o&&D(e),a&&a.d()}}}function ms(l){let e,t=l[1].strings.showrecentmessages+"",s,n,i,r;return{c(){e=h("a"),s=E(t),u(e,"class","btn btn-info text-white mt-3"),u(e,"href",n=Ee(l[2]))},m(a,o){S(a,e,o),g(e,s),i||(r=J(e,"click",Te(l[3])),i=!0)},p(a,o){o&2&&t!==(t=a[1].strings.showrecentmessages+"")&&R(s,t),o&4&&n!==(n=Ee(a[2]))&&u(e,"href",n)},d(a){a&&D(e),i=!1,r()}}}function Oi(l){let e,t=!l[1].listMessages.length&&cs(l);return{c(){t&&t.c(),e=be()},m(s,n){t&&t.m(s,n),S(s,e,n)},p(s,[n]){s[1].listMessages.length?t&&(t.d(1),t=null):t?(t.p(s,n),n&2&&T(t,1)):(t=cs(s),t.c(),T(t,1),t.m(e.parentNode,e))},i(s){T(t)},o:F,d(s){s&&D(e),t&&t.d(s)}}}function Ji(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,f=>t(1,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();const o=()=>a.navigate(s);return l.$$set=f=>{"store"in f&&r(t(0,a=f.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s={tray:n.params.tray,courseid:n.params.courseid,labelid:n.params.labelid})},[a,n,s,o]}class Vi extends ce{constructor(e){super(),me(this,e,Ji,Oi,oe,{store:0})}}function ds(l,e,t){const s=l.slice();return s[4]=e[t],s[6]=t,s}function Ki(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,w,C,$,k,M;return t=new an({props:{store:l[0],message:l[4]}}),r=new dt({props:{store:l[0],message:l[4]}}),o=new un({props:{store:l[0],message:l[4]}}),c=new cn({props:{store:l[0],message:l[4]}}),p=new _t({props:{store:l[0],message:l[4]}}),w=new on({props:{store:l[0],message:l[4]}}),k=new fn({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),K(t.$$.fragment),s=L(),n=h("div"),i=h("div"),K(r.$$.fragment),a=L(),K(o.$$.fragment),f=L(),d=h("div"),K(c.$$.fragment),m=L(),_=h("div"),b=h("div"),K(p.$$.fragment),v=L(),K(w.$$.fragment),C=L(),$=h("div"),K(k.$$.fragment),u(d,"class","ml-auto mr-2"),u(i,"class","d-flex mt-2"),u(b,"class","d-flex w-100 my-2 mr-2"),ge(b,"min-width","0"),u(_,"class","d-flex"),u($,"class","d-flex flex-wrap ml-n2 mr-2"),u(n,"class","w-100 ml-1"),ge(n,"min-width","0"),u(e,"class","d-flex align-items-start pt-1 pb-2 pl-1 pr-2")},m(A,y){S(A,e,y),Y(t,e,null),g(e,s),g(e,n),g(n,i),Y(r,i,null),g(i,a),Y(o,i,null),g(i,f),g(i,d),Y(c,d,null),g(n,m),g(n,_),g(_,b),Y(p,b,null),g(_,v),Y(w,_,null),g(n,C),g(n,$),Y(k,$,null),M=!0},p(A,y){const j={};y&1&&(j.store=A[0]),y&2&&(j.message=A[4]),t.$set(j);const B={};y&1&&(B.store=A[0]),y&2&&(B.message=A[4]),r.$set(B);const q={};y&1&&(q.store=A[0]),y&2&&(q.message=A[4]),o.$set(q);const H={};y&1&&(H.store=A[0]),y&2&&(H.message=A[4]),c.$set(H);const P={};y&1&&(P.store=A[0]),y&2&&(P.message=A[4]),p.$set(P);const O={};y&1&&(O.store=A[0]),y&2&&(O.message=A[4]),w.$set(O);const x={};y&1&&(x.store=A[0]),y&2&&(x.message=A[4]),k.$set(x)},i(A){M||(T(t.$$.fragment,A),T(r.$$.fragment,A),T(o.$$.fragment,A),T(c.$$.fragment,A),T(p.$$.fragment,A),T(w.$$.fragment,A),T(k.$$.fragment,A),M=!0)},o(A){z(t.$$.fragment,A),z(r.$$.fragment,A),z(o.$$.fragment,A),z(c.$$.fragment,A),z(p.$$.fragment,A),z(w.$$.fragment,A),z(k.$$.fragment,A),M=!1},d(A){A&&D(e),W(t),W(r),W(o),W(c),W(p),W(w),W(k)}}}function Yi(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,w,C,$;return t=new an({props:{store:l[0],message:l[4]}}),n=new on({props:{store:l[0],message:l[4]}}),o=new dt({props:{store:l[0],message:l[4]}}),c=new _t({props:{store:l[0],message:l[4]}}),b=new fn({props:{store:l[0],message:l[4]}}),v=new un({props:{store:l[0],message:l[4]}}),C=new cn({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),K(t.$$.fragment),s=L(),K(n.$$.fragment),i=L(),r=h("div"),a=h("div"),K(o.$$.fragment),f=L(),d=h("div"),K(c.$$.fragment),m=L(),_=h("div"),K(b.$$.fragment),p=L(),K(v.$$.fragment),w=L(),K(C.$$.fragment),u(a,"class","flex-grow-1 mx-2"),ge(a,"width","25%"),ge(a,"min-width","0"),u(_,"class","d-flex text-truncate flex-shrink-0 justify-content-end mb-n2 ml-auto"),ge(_,"max-width","80%"),u(d,"class","flex-grow-1 d-flex my-2 mx-2"),ge(d,"width","75%"),ge(d,"min-width","0"),u(r,"class","d-flex w-100 flex-grow-1 align-items-center"),ge(r,"min-width","0"),u(e,"class","d-flex align-items-center pl-1 pr-3")},m(k,M){S(k,e,M),Y(t,e,null),g(e,s),Y(n,e,null),g(e,i),g(e,r),g(r,a),Y(o,a,null),g(r,f),g(r,d),Y(c,d,null),g(d,m),g(d,_),Y(b,_,null),g(e,p),Y(v,e,null),g(e,w),Y(C,e,null),$=!0},p(k,M){const A={};M&1&&(A.store=k[0]),M&2&&(A.message=k[4]),t.$set(A);const y={};M&1&&(y.store=k[0]),M&2&&(y.message=k[4]),n.$set(y);const j={};M&1&&(j.store=k[0]),M&2&&(j.message=k[4]),o.$set(j);const B={};M&1&&(B.store=k[0]),M&2&&(B.message=k[4]),c.$set(B);const q={};M&1&&(q.store=k[0]),M&2&&(q.message=k[4]),b.$set(q);const H={};M&1&&(H.store=k[0]),M&2&&(H.message=k[4]),v.$set(H);const P={};M&1&&(P.store=k[0]),M&2&&(P.message=k[4]),C.$set(P)},i(k){$||(T(t.$$.fragment,k),T(n.$$.fragment,k),T(o.$$.fragment,k),T(c.$$.fragment,k),T(b.$$.fragment,k),T(v.$$.fragment,k),T(C.$$.fragment,k),$=!0)},o(k){z(t.$$.fragment,k),z(n.$$.fragment,k),z(o.$$.fragment,k),z(c.$$.fragment,k),z(b.$$.fragment,k),z(v.$$.fragment,k),z(C.$$.fragment,k),$=!1},d(k){k&&D(e),W(t),W(n),W(o),W(c),W(b),W(v),W(C)}}}function _s(l,e){let t,s,n,i,r,a,o,f=F,d,c,m;const _=[Yi,Ki],b=[];function p(w,C){return w[1].viewportSize>=de.MD?0:1}s=p(e),n=b[s]=_[s](e);function v(){return e[3](e[4],e[6])}return{key:l,first:null,c(){t=h("a"),n.c(),u(t,"class","local-mail-list-message list-group-item list-group-item-action p-0"),u(t,"href",i=Ee(e[2](e[4],e[6]))),U(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),U(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),U(t,"font-weight-bold",e[4].unread),this.first=t},m(w,C){S(w,t,C),b[s].m(t,null),d=!0,c||(m=J(t,"click",Te(v)),c=!0)},p(w,C){e=w;let $=s;s=p(e),s===$?b[s].p(e,C):(ie(),z(b[$],1,1,()=>{b[$]=null}),re(),n=b[s],n?n.p(e,C):(n=b[s]=_[s](e),n.c()),T(n,1),n.m(t,null)),(!d||C&2&&i!==(i=Ee(e[2](e[4],e[6]))))&&u(t,"href",i),(!d||C&2)&&U(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),(!d||C&2)&&U(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),(!d||C&2)&&U(t,"font-weight-bold",e[4].unread)},r(){o=t.getBoundingClientRect()},f(){Xl(t),f(),mt(t,o)},a(){f(),f=Wl(t,o,rn,{delay:400,duration:400})},i(w){d||(T(n),w&&je(()=>{d&&(a&&a.end(1),r=ct(t,Be,{delay:400}),r.start())}),d=!0)},o(w){z(n),r&&r.invalidate(),w&&(a=Jl(t,Be,{duration:400})),d=!1},d(w){w&&D(t),b[s].d(),w&&a&&a.end(),c=!1,m()}}}function gs(l){let e,t=[],s=new Map,n,i,r,a=ue(l[1].listMessages);const o=f=>f[4].id;for(let f=0;f<a.length;f+=1){let d=ds(l,a,f),c=o(d);s.set(c,t[f]=_s(c,d))}return i=new Vi({props:{store:l[0]}}),{c(){e=h("div");for(let f=0;f<t.length;f+=1)t[f].c();n=L(),K(i.$$.fragment),u(e,"class","list-group")},m(f,d){S(f,e,d);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);g(e,n),Y(i,e,null),r=!0},p(f,d){if(d&7){a=ue(f[1].listMessages),ie();for(let m=0;m<t.length;m+=1)t[m].r();t=Le(t,d,o,1,f,a,s,e,Ol,_s,n,ds);for(let m=0;m<t.length;m+=1)t[m].a();re()}const c={};d&1&&(c.store=f[0]),i.$set(c)},i(f){if(!r){for(let d=0;d<a.length;d+=1)T(t[d]);T(i.$$.fragment,f),r=!0}},o(f){for(let d=0;d<t.length;d+=1)z(t[d]);z(i.$$.fragment,f),r=!1},d(f){f&&D(e);for(let d=0;d<t.length;d+=1)t[d].d();W(i)}}}function Wi(l){let e=l[1].navigationId,t,s,n=gs(l);return{c(){n.c(),t=be()},m(i,r){n.m(i,r),S(i,t,r),s=!0},p(i,[r]){r&2&&oe(e,e=i[1].navigationId)?(ie(),z(n,1,1,F),re(),n=gs(i),n.c(),T(n,1),n.m(t.parentNode,t)):n.p(i,r)},i(i){s||(T(n),s=!0)},o(i){z(n),s=!1},d(i){i&&D(t),n.d(i)}}}function Xi(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=(f,d)=>({...s.params,messageid:f.id,offset:(s.params.offset||0)+d}),o=(f,d)=>r.navigate(a(f,d));return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,a,o]}class Qi extends ce{constructor(e){super(),me(this,e,Xi,Wi,oe,{store:0})}}function ps(l){let e,t,s,n,i,r,a,o=l[3]&&bs(l);return{c(){e=h("div"),t=h("button"),s=h("i"),i=L(),o&&o.c(),u(s,"class","fa fa-fw fa-ellipsis-v align-middle"),u(t,"type","button"),u(t,"class","btn"),u(t,"aria-expanded",l[3]),u(t,"title",n=l[5].strings.more),u(e,"class","dropdown")},m(f,d){S(f,e,d),g(e,t),g(t,s),g(e,i),o&&o.m(e,null),r||(a=[J(t,"click",l[6]),De(Fe.call(null,e,l[7]))],r=!0)},p(f,d){d&8&&u(t,"aria-expanded",f[3]),d&32&&n!==(n=f[5].strings.more)&&u(t,"title",n),f[3]?o?o.p(f,d):(o=bs(f),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(f){f&&D(e),o&&o.d(),r=!1,we(a)}}}function bs(l){let e,t,s,n,i=l[5].strings.reply+"",r,a,o,f,d,c=l[5].strings.replyall+"",m,_,b,p,v,w,C=l[5].strings.forward+"",$,k,M;return{c(){e=h("div"),t=h("button"),s=h("i"),n=L(),r=E(i),a=L(),o=h("button"),f=h("i"),d=L(),m=E(c),b=L(),p=h("button"),v=h("i"),w=L(),$=E(C),u(s,"class","fa fa-fw fa-reply"),u(s,"aria-hidden","true"),u(t,"type","button"),u(t,"class","dropdown-item"),u(f,"class","fa fa-fw fa-reply-all"),u(f,"aria-hidden","true"),u(o,"type","button"),o.disabled=_=!l[2],u(o,"class","dropdown-item"),U(o,"disabled",!l[2]),u(v,"class","fa fa-fw fa-share"),u(v,"aria-hidden","true"),u(p,"type","button"),u(p,"class","dropdown-item"),u(e,"class","dropdown-menu dropdown-menu-right show")},m(A,y){S(A,e,y),g(e,t),g(t,s),g(t,n),g(t,r),g(e,a),g(e,o),g(o,f),g(o,d),g(o,m),g(e,b),g(e,p),g(p,v),g(p,w),g(p,$),k||(M=[J(t,"click",l[9]),J(o,"click",l[10]),J(p,"click",l[11])],k=!0)},p(A,y){y&32&&i!==(i=A[5].strings.reply+"")&&R(r,i),y&32&&c!==(c=A[5].strings.replyall+"")&&R(m,c),y&4&&_!==(_=!A[2])&&(o.disabled=_),y&4&&U(o,"disabled",!A[2]),y&32&&C!==(C=A[5].strings.forward+"")&&R($,C)},d(A){A&&D(e),k=!1,we(M)}}}function hs(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b;return{c(){e=h("button"),t=h("i"),n=L(),i=h("button"),r=h("i"),f=L(),d=h("button"),c=h("i"),u(t,"class","fa fa-fw fa-reply"),u(t,"aria-hidden","true"),u(e,"type","button"),u(e,"title",s=l[5].strings.reply),u(e,"class","btn py-2 border-0"),u(r,"class","fa fa-fw fa-reply-all"),u(r,"aria-hidden","true"),u(i,"type","button"),i.disabled=a=!l[2],u(i,"title",o=l[5].strings.replyall),u(i,"class","btn py-2 border-0"),U(i,"disabled",!l[2]),u(c,"class","fa fa-fw fa-share"),u(c,"aria-hidden","true"),u(d,"type","button"),u(d,"title",m=l[5].strings.forward),u(d,"class","btn py-2 border-0")},m(p,v){S(p,e,v),g(e,t),S(p,n,v),S(p,i,v),g(i,r),S(p,f,v),S(p,d,v),g(d,c),_||(b=[J(e,"click",l[12]),J(i,"click",l[13]),J(d,"click",l[14])],_=!0)},p(p,v){v&32&&s!==(s=p[5].strings.reply)&&u(e,"title",s),v&4&&a!==(a=!p[2])&&(i.disabled=a),v&32&&o!==(o=p[5].strings.replyall)&&u(i,"title",o),v&4&&U(i,"disabled",!p[2]),v&32&&m!==(m=p[5].strings.forward)&&u(d,"title",m)},d(p){p&&(D(e),D(n),D(i),D(f),D(d)),_=!1,we(b)}}}function Zi(l){let e,t,s,n,i,r,a,o,f,d,c,m=l[5].viewportSize<de.SM&&ps(l),_=l[5].viewportSize>=de.SM&&hs(l);return{c(){e=h("button"),t=h("i"),a=L(),m&&m.c(),o=L(),_&&_.c(),f=be(),u(t,"class",s="fa "+l[4]),u(e,"type","button"),u(e,"class","btn py-2 border-0"),u(e,"role","checkbox"),u(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,u(e,"title",r=l[1].starred?l[5].strings.markasunstarred:l[5].strings.markasstarred)},m(b,p){S(b,e,p),g(e,t),S(b,a,p),m&&m.m(b,p),S(b,o,p),_&&_.m(b,p),S(b,f,p),d||(c=J(e,"click",l[8]),d=!0)},p(b,[p]){p&16&&s!==(s="fa "+b[4])&&u(t,"class",s),p&2&&n!==(n=b[1].starred)&&u(e,"aria-checked",n),p&2&&i!==(i=b[1].deleted)&&(e.disabled=i),p&34&&r!==(r=b[1].starred?b[5].strings.markasunstarred:b[5].strings.markasstarred)&&u(e,"title",r),b[5].viewportSize<de.SM?m?m.p(b,p):(m=ps(b),m.c(),m.m(o.parentNode,o)):m&&(m.d(1),m=null),b[5].viewportSize>=de.SM?_?_.p(b,p):(_=hs(b),_.c(),_.m(f.parentNode,f)):_&&(_.d(1),_=null)},i:F,o:F,d(b){b&&(D(e),D(a),D(o),D(f)),m&&m.d(b),_&&_.d(b),d=!1,c()}}}function xi(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,k=>t(5,n=k)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e,{canReplyAll:f}=e,d=!1;const c=()=>{t(3,d=!d)},m=()=>{t(3,d=!1)},_=()=>a.setStarred([o.id],!o.starred),b=()=>a.reply(o,!1),p=()=>a.reply(o,!0),v=()=>a.forward(o),w=()=>a.reply(o,!1),C=()=>a.reply(o,!0),$=()=>a.forward(o);return l.$$set=k=>{"store"in k&&r(t(0,a=k.store)),"message"in k&&t(1,o=k.message),"canReplyAll"in k&&t(2,f=k.canReplyAll)},l.$$.update=()=>{l.$$.dirty&2&&t(4,s=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,f,d,s,n,c,m,_,b,p,v,w,C,$]}class er extends ce{constructor(e){super(),me(this,e,xi,Zi,oe,{store:0,message:1,canReplyAll:2})}}function ks(l,e,t){const s=l.slice();return s[3]=e[t],s}function vs(l){let e,t,s,n,i,r,a,o,f,d=l[2](l[3])+"",c,m,_,b,p=Dt(l[3].filesize)+"",v,w,C,$;return{c(){e=h("a"),t=h("img"),i=L(),r=h("i"),a=L(),o=h("div"),f=h("div"),c=E(d),_=L(),b=h("div"),v=E(p),u(t,"aria-hidden","true"),u(t,"alt",s=l[3].filename),lt(t.src,n=l[3].iconurl)||u(t,"src",n),u(t,"width","24"),u(t,"height","24"),u(t,"class","flex-shrink-0"),u(r,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),u(r,"aria-hidden","true"),ge(r,"width","24px"),ge(r,"height","24px"),u(b,"class","text-left text-muted"),u(o,"class","ml-2 mr-1"),ge(o,"min-width","0"),u(e,"href",w=l[3].fileurl),u(e,"class","local-mail-message-attachments-file btn btn-light d-flex align-items-center px-2 py-1 mr-3 mb-3")},m(k,M){S(k,e,M),g(e,t),g(e,i),g(e,r),g(e,a),g(e,o),g(o,f),g(f,c),g(o,_),g(o,b),g(b,v),C||($=De(m=Re.call(null,f,l[2](l[3]))),C=!0)},p(k,M){l=k,M&2&&s!==(s=l[3].filename)&&u(t,"alt",s),M&2&&!lt(t.src,n=l[3].iconurl)&&u(t,"src",n),M&2&&d!==(d=l[2](l[3])+"")&&R(c,d),m&&Ce(m.update)&&M&2&&m.update.call(null,l[2](l[3])),M&2&&p!==(p=Dt(l[3].filesize)+"")&&R(v,p),M&2&&w!==(w=l[3].fileurl)&&u(e,"href",w)},d(k){k&&D(e),C=!1,$()}}}function ws(l){let e,t,s,n,i=l[0].downloadall+"",r,a;return{c(){e=h("a"),t=h("i"),s=L(),n=h("div"),r=E(i),u(t,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),u(t,"aria-hidden","true"),ge(t,"width","24px"),ge(t,"height","24px"),u(n,"class","text-truncate ml-2"),u(e,"href",a=Ct(l[1].id)),u(e,"class","btn btn-light d-flex align-items-center p-2 mr-3 mb-3")},m(o,f){S(o,e,f),g(e,t),g(e,s),g(e,n),g(n,r)},p(o,f){f&1&&i!==(i=o[0].downloadall+"")&&R(r,i),f&2&&a!==(a=Ct(o[1].id))&&u(e,"href",a)},d(o){o&&D(e)}}}function tr(l){let e,t,s=ue(l[1].attachments),n=[];for(let r=0;r<s.length;r+=1)n[r]=vs(ks(l,s,r));let i=l[1].attachments.length>1&&ws(l);return{c(){e=h("div");for(let r=0;r<n.length;r+=1)n[r].c();t=L(),i&&i.c(),u(e,"class","local-mail-message-attachments d-sm-flex flex-wrap mr-n3 mt-3 mb-sm-n3")},m(r,a){S(r,e,a);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(e,null);g(e,t),i&&i.m(e,null)},p(r,[a]){if(a&6){s=ue(r[1].attachments);let o;for(o=0;o<s.length;o+=1){const f=ks(r,s,o);n[o]?n[o].p(f,a):(n[o]=vs(f),n[o].c(),n[o].m(e,t))}for(;o<n.length;o+=1)n[o].d(1);n.length=s.length}r[1].attachments.length>1?i?i.p(r,a):(i=ws(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i:F,o:F,d(r){r&&D(e),qe(n,r),i&&i.d()}}}function sr(l,e,t){let{strings:s}=e,{message:n}=e;const i=r=>(r.filepath+r.filename).replace(/^\//,"");return l.$$set=r=>{"strings"in r&&t(0,s=r.strings),"message"in r&&t(1,n=r.message)},[s,n,i]}class mn extends ce{constructor(e){super(),me(this,e,sr,tr,oe,{strings:0,message:1})}}function lr(l){let e,t,s,n=l[3].strings.reply+"",i,r,a,o,f,d=l[3].strings.replyall+"",c,m,_,b,p,v,w=l[3].strings.forward+"",C,$,k;return{c(){e=h("button"),t=h("i"),s=L(),i=E(n),r=L(),a=h("button"),o=h("i"),f=L(),c=E(d),_=L(),b=h("button"),p=h("i"),v=L(),C=E(w),u(t,"class","fa fa-fw fa-reply mr-2"),u(e,"type","button"),u(e,"class","btn btn-primary mr-3 mb-3"),u(o,"class","fa fa-fw fa-reply-all mr-2"),u(a,"type","button"),a.disabled=m=!l[2],u(a,"class","btn mr-3 mb-3"),U(a,"disabled",!l[2]),U(a,"btn-primary",l[2]),U(a,"btn-secondary",!l[2]),u(p,"class","fa fa-fw fa-share mr-2"),u(b,"type","button"),u(b,"class","btn btn-primary mr-3 mb-3")},m(M,A){S(M,e,A),g(e,t),g(e,s),g(e,i),S(M,r,A),S(M,a,A),g(a,o),g(a,f),g(a,c),S(M,_,A),S(M,b,A),g(b,p),g(b,v),g(b,C),$||(k=[J(e,"click",l[4]),J(a,"click",l[5]),J(b,"click",l[6])],$=!0)},p(M,[A]){A&8&&n!==(n=M[3].strings.reply+"")&&R(i,n),A&8&&d!==(d=M[3].strings.replyall+"")&&R(c,d),A&4&&m!==(m=!M[2])&&(a.disabled=m),A&4&&U(a,"disabled",!M[2]),A&4&&U(a,"btn-primary",M[2]),A&4&&U(a,"btn-secondary",!M[2]),A&8&&w!==(w=M[3].strings.forward+"")&&R(C,w)},i:F,o:F,d(M){M&&(D(e),D(r),D(a),D(_),D(b)),$=!1,we(k)}}}function nr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,m=>t(3,s=m)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e,{canReplyAll:o}=e;const f=()=>r.reply(a,!1),d=()=>r.reply(a,!0),c=()=>r.forward(a);return l.$$set=m=>{"store"in m&&i(t(0,r=m.store)),"message"in m&&t(1,a=m.message),"canReplyAll"in m&&t(2,o=m.canReplyAll)},[r,a,o,s,f,d,c]}class ir extends ce{constructor(e){super(),me(this,e,nr,lr,oe,{store:0,message:1,canReplyAll:2})}}function $s(l,e,t){const s=l.slice();return s[3]=e[t],s}function ys(l){let e,t;return e=new gt({props:{course:l[1].course,settings:l[2].settings}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Ms(l,e){let t,s,n;return s=new pt({props:{label:e[3]}}),{key:l,first:null,c(){t=be(),K(s.$$.fragment),this.first=t},m(i,r){S(i,t,r),Y(s,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.label=e[3]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(s,i)}}}function rr(l){let e,t=[],s=new Map,n,i,r=l[1].course.id!=l[2].params.courseid&&ys(l),a=ue(l[1].labels);const o=f=>f[3].id;for(let f=0;f<a.length;f+=1){let d=$s(l,a,f),c=o(d);s.set(c,t[f]=Ms(c,d))}return{c(){r&&r.c(),e=L();for(let f=0;f<t.length;f+=1)t[f].c();n=be()},m(f,d){r&&r.m(f,d),S(f,e,d);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(f,d);S(f,n,d),i=!0},p(f,[d]){f[1].course.id!=f[2].params.courseid?r?(r.p(f,d),d&6&&T(r,1)):(r=ys(f),r.c(),T(r,1),r.m(e.parentNode,e)):r&&(ie(),z(r,1,1,()=>{r=null}),re()),d&2&&(a=ue(f[1].labels),ie(),t=Le(t,d,o,1,f,a,s,n.parentNode,Ge,Ms,n,$s),re())},i(f){if(!i){T(r);for(let d=0;d<a.length;d+=1)T(t[d]);i=!0}},o(f){z(r);for(let d=0;d<t.length;d+=1)z(t[d]);i=!1},d(f){f&&(D(e),D(n)),r&&r.d(f);for(let d=0;d<t.length;d+=1)t[d].d(f)}}}function ar(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class or extends ce{constructor(e){super(),me(this,e,ar,rr,oe,{store:0,message:1})}}function fr(l){let e;function t(i,r){if(i[0])return mr;if(i[1])return cr}let s=t(l),n=s&&s(l);return{c(){e=h("span"),n&&n.c(),u(e,"class","local-mail-user-picture-fallback m-0")},m(i,r){S(i,e,r),n&&n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n&&n.d(1),n=s&&s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&D(e),n&&n.d()}}}function ur(l){let e,t;return{c(){e=h("img"),lt(e.src,t=l[0].pictureurl)||u(e,"src",t),u(e,"width","35"),u(e,"height","35"),u(e,"alt",""),u(e,"aria-hidden","true"),u(e,"class","rounded-circle")},m(s,n){S(s,e,n)},p(s,n){n&1&&!lt(e.src,t=s[0].pictureurl)&&u(e,"src",t)},d(s){s&&D(e)}}}function cr(l){let e,t;return{c(){e=h("i"),u(e,"class",t="fa "+l[1])},m(s,n){S(s,e,n)},p(s,n){n&2&&t!==(t="fa "+s[1])&&u(e,"class",t)},d(s){s&&D(e)}}}function mr(l){let e=l[0].firstname.slice(0,1)+"",t,s=l[0].lastname.slice(0,1)+"",n;return{c(){t=E(e),n=E(s)},m(i,r){S(i,t,r),S(i,n,r)},p(i,r){r&1&&e!==(e=i[0].firstname.slice(0,1)+"")&&R(t,e),r&1&&s!==(s=i[0].lastname.slice(0,1)+"")&&R(n,s)},d(i){i&&(D(t),D(n))}}}function dr(l){let e;function t(i,r){var a;return(a=i[0])!=null&&a.pictureurl?ur:fr}let s=t(l),n=s(l);return{c(){n.c(),e=be()},m(i,r){n.m(i,r),S(i,e,r)},p(i,[r]){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e.parentNode,e)))},i:F,o:F,d(i){i&&D(e),n.d(i)}}}function _r(l,e,t){let{user:s=void 0}=e,{icon:n=void 0}=e;return l.$$set=i=>{"user"in i&&t(0,s=i.user),"icon"in i&&t(1,n=i.icon)},[s,n]}class et extends ce{constructor(e){super(),me(this,e,_r,dr,oe,{user:0,icon:1})}}function Cs(l){let e,t,s,n;return s=new mn({props:{strings:l[0],message:l[1]}}),{c(){e=h("hr"),t=L(),K(s.$$.fragment)},m(i,r){S(i,e,r),S(i,t,r),Y(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.strings=i[0]),r&2&&(a.message=i[1]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&(D(e),D(t)),W(s,i)}}}function gr(l){let e,t,s,n=l[1].subject+"",i,r,a,o,f,d,c,m,_,b=l[1].sender.fullname+"",p,v,w,C,$=l[1].fulltime+"",k,M,A,y,j,B=l[1].content+"",q,H;d=new et({props:{user:l[1].sender}});let P=l[1].attachments.length>0&&Cs(l);return{c(){e=h("div"),t=h("div"),s=h("h5"),i=E(n),r=L(),a=h("div"),o=h("div"),f=h("div"),K(d.$$.fragment),c=L(),m=h("div"),_=h("a"),p=E(b),w=L(),C=h("div"),k=E($),M=L(),A=h("hr"),y=L(),j=h("div"),q=L(),P&&P.c(),u(s,"class","h5 card-title mb-3"),u(f,"class","mr-3"),u(_,"href",v=l[1].sender.profileurl),u(m,"class","mt-1"),u(o,"class","d-flex mb-3 mb-sm-0"),u(C,"class","mt-1 ml-auto"),u(a,"class","d-sm-flex mb-n1"),u(j,"class","local-mail-message-reference-content"),u(t,"class","card-body p-3 px-xl-4"),u(e,"class","card mb-4")},m(O,x){S(O,e,x),g(e,t),g(t,s),g(s,i),g(t,r),g(t,a),g(a,o),g(o,f),Y(d,f,null),g(o,c),g(o,m),g(m,_),g(_,p),g(a,w),g(a,C),g(C,k),g(t,M),g(t,A),g(t,y),g(t,j),j.innerHTML=B,g(t,q),P&&P.m(t,null),H=!0},p(O,[x]){(!H||x&2)&&n!==(n=O[1].subject+"")&&R(i,n);const V={};x&2&&(V.user=O[1].sender),d.$set(V),(!H||x&2)&&b!==(b=O[1].sender.fullname+"")&&R(p,b),(!H||x&2&&v!==(v=O[1].sender.profileurl))&&u(_,"href",v),(!H||x&2)&&$!==($=O[1].fulltime+"")&&R(k,$),(!H||x&2)&&B!==(B=O[1].content+"")&&(j.innerHTML=B),O[1].attachments.length>0?P?(P.p(O,x),x&2&&T(P,1)):(P=Cs(O),P.c(),T(P,1),P.m(t,null)):P&&(ie(),z(P,1,1,()=>{P=null}),re())},i(O){H||(T(d.$$.fragment,O),T(P),H=!0)},o(O){z(d.$$.fragment,O),z(P),H=!1},d(O){O&&D(e),W(d),P&&P.d()}}}function pr(l,e,t){let{strings:s}=e,{reference:n}=e;return l.$$set=i=>{"strings"in i&&t(0,s=i.strings),"reference"in i&&t(1,n=i.reference)},[s,n]}class dn extends ce{constructor(e){super(),me(this,e,pr,gr,oe,{strings:0,reference:1})}}function Ss(l,e,t){const s=l.slice();return s[4]=e[t],s}function Ds(l,e,t){const s=l.slice();return s[7]=e[t],s[9]=t,s}function Ts(l){let e,t,s=l[3].strings[l[4]]+"",n,i,r,a=[],o=new Map,f,d=ue(l[2](l[4]));const c=m=>m[7].id;for(let m=0;m<d.length;m+=1){let _=Ds(l,d,m),b=c(_);o.set(b,a[m]=zs(b,_))}return{c(){e=h("div"),t=h("span"),n=E(s),i=E(":"),r=L();for(let m=0;m<a.length;m+=1)a[m].c();f=L(),u(e,"class","mb-2")},m(m,_){S(m,e,_),g(e,t),g(t,n),g(t,i),g(e,r);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(e,null);g(e,f)},p(m,_){_&8&&s!==(s=m[3].strings[m[4]]+"")&&R(n,s),_&4&&(d=ue(m[2](m[4])),a=Le(a,_,c,1,m,d,o,e,Ze,zs,f,Ds))},d(m){m&&D(e);for(let _=0;_<a.length;_+=1)a[_].d()}}}function Ls(l){let e;return{c(){e=E(",")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function zs(l,e){let t,s,n,i=e[7].fullname+"",r,a,o=e[9]>0&&Ls();return{key:l,first:null,c(){t=be(),o&&o.c(),s=L(),n=h("a"),r=E(i),u(n,"href",a=e[7].profileurl),this.first=t},m(f,d){S(f,t,d),o&&o.m(f,d),S(f,s,d),S(f,n,d),g(n,r)},p(f,d){e=f,e[9]>0?o||(o=Ls(),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),d&4&&i!==(i=e[7].fullname+"")&&R(r,i),d&4&&a!==(a=e[7].profileurl)&&u(n,"href",a)},d(f){f&&(D(t),D(s),D(n)),o&&o.d(f)}}}function js(l){let e=l[2](l[4]).length>0,t,s=e&&Ts(l);return{c(){s&&s.c(),t=be()},m(n,i){s&&s.m(n,i),S(n,t,i)},p(n,i){i&4&&(e=n[2](n[4]).length>0),e?s?s.p(n,i):(s=Ts(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},d(n){n&&D(t),s&&s.d(n)}}}function br(l){let e,t,s,n,i,r,a,o=l[1].sender.fullname+"",f,d,c,m;s=new et({props:{user:l[1].sender}});let _=ue(Object.values(Ae)),b=[];for(let p=0;p<_.length;p+=1)b[p]=js(Ss(l,_,p));return{c(){e=h("div"),t=h("div"),K(s.$$.fragment),n=L(),i=h("div"),r=h("div"),a=h("a"),f=E(o),c=L();for(let p=0;p<b.length;p+=1)b[p].c();u(t,"class","mr-3"),u(a,"href",d=l[1].sender.profileurl),u(r,"class","mt-1 mb-2"),u(i,"class","d-flex flex-column"),u(e,"class","local-mail-message-users d-flex mb-n2")},m(p,v){S(p,e,v),g(e,t),Y(s,t,null),g(e,n),g(e,i),g(i,r),g(r,a),g(a,f),g(i,c);for(let w=0;w<b.length;w+=1)b[w]&&b[w].m(i,null);m=!0},p(p,[v]){const w={};if(v&2&&(w.user=p[1].sender),s.$set(w),(!m||v&2)&&o!==(o=p[1].sender.fullname+"")&&R(f,o),(!m||v&2&&d!==(d=p[1].sender.profileurl))&&u(a,"href",d),v&12){_=ue(Object.values(Ae));let C;for(C=0;C<_.length;C+=1){const $=Ss(p,_,C);b[C]?b[C].p($,v):(b[C]=js($),b[C].c(),b[C].m(i,null))}for(;C<b.length;C+=1)b[C].d(1);b.length=_.length}},i(p){m||(T(s.$$.fragment,p),m=!0)},o(p){z(s.$$.fragment,p),m=!1},d(p){p&&D(e),W(s),qe(b,p)}}}function hr(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,f=>t(3,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return l.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=f=>o.recipients.filter(d=>d.type==f))},[a,o,s,n]}class kr extends ce{constructor(e){super(),me(this,e,hr,br,oe,{store:0,message:1})}}function Ns(l,e,t){const s=l.slice();return s[4]=e[t],s}function As(l){let e,t,s,n;return s=new mn({props:{strings:l[2].strings,message:l[1]}}),{c(){e=h("hr"),t=L(),K(s.$$.fragment)},m(i,r){S(i,e,r),S(i,t,r),Y(s,i,r),n=!0},p(i,r){const a={};r&4&&(a.strings=i[2].strings),r&2&&(a.message=i[1]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&(D(e),D(t)),W(s,i)}}}function Bs(l){let e,t=l[2].strings.references+"",s,n,i=[],r=new Map,a,o,f=ue(l[1].references);const d=c=>c[4].id;for(let c=0;c<f.length;c+=1){let m=Ns(l,f,c),_=d(m);r.set(_,i[c]=qs(_,m))}return{c(){e=h("div"),s=E(t),n=L();for(let c=0;c<i.length;c+=1)i[c].c();a=be(),u(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(c,m){S(c,e,m),g(e,s),S(c,n,m);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(c,m);S(c,a,m),o=!0},p(c,m){(!o||m&4)&&t!==(t=c[2].strings.references+"")&&R(s,t),m&6&&(f=ue(c[1].references),ie(),i=Le(i,m,d,1,c,f,r,a.parentNode,Ge,qs,a,Ns),re())},i(c){if(!o){for(let m=0;m<f.length;m+=1)T(i[m]);o=!0}},o(c){for(let m=0;m<i.length;m+=1)z(i[m]);o=!1},d(c){c&&(D(e),D(n),D(a));for(let m=0;m<i.length;m+=1)i[m].d(c)}}}function qs(l,e){let t,s,n;return s=new dn({props:{strings:e[2].strings,reference:e[4]}}),{key:l,first:null,c(){t=be(),K(s.$$.fragment),this.first=t},m(i,r){S(i,t,r),Y(s,i,r),n=!0},p(i,r){e=i;const a={};r&4&&(a.strings=e[2].strings),r&2&&(a.reference=e[4]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(s,i)}}}function vr(l){let e,t,s,n=l[1].subject+"",i,r,a,o,f,d,c,m,_=l[1].fulltime+"",b,p,v,w,C,$,k,M,A,y,j=l[1].content+"",B,q,H,P,O,x,V,te,ae;f=new or({props:{store:l[0],message:l[1]}}),w=new er({props:{store:l[0],message:l[1],canReplyAll:l[3]}}),$=new kr({props:{store:l[0],message:l[1]}});let X=l[1].attachments.length>0&&As(l);x=new ir({props:{store:l[0],message:l[1],canReplyAll:l[3]}});let Q=l[1].references.length>0&&Bs(l);return{c(){e=h("div"),t=h("div"),s=h("h3"),i=E(n),r=L(),a=h("div"),o=h("div"),K(f.$$.fragment),d=L(),c=h("div"),m=h("div"),b=E(_),p=L(),v=h("div"),K(w.$$.fragment),C=L(),K($.$$.fragment),k=L(),M=h("hr"),A=L(),y=h("div"),B=L(),X&&X.c(),q=L(),H=h("hr"),P=L(),O=h("div"),K(x.$$.fragment),V=L(),Q&&Q.c(),te=be(),u(s,"class","h4 card-title mb-3 mb-md-2"),u(o,"class","d-flex flex-wrap mx-n2 mt-2"),ge(o,"min-width","0"),u(m,"class","my-2 text-truncate"),u(v,"class","d-flex flex-shrink-0 ml-3 mr-n2"),u(c,"class","d-flex justify-content-between flex-shrink-0 ml-auto"),u(a,"class","d-md-flex align-items-start mb-2"),u(y,"class","local-mail-message-content"),u(O,"class","mt-3 d-flex mr-n3 mb-n3 flex-column flex-sm-row justify-content-end"),u(t,"class","card-body p-3 px-xl-4"),u(e,"class","card")},m(N,I){S(N,e,I),g(e,t),g(t,s),g(s,i),g(t,r),g(t,a),g(a,o),Y(f,o,null),g(a,d),g(a,c),g(c,m),g(m,b),g(c,p),g(c,v),Y(w,v,null),g(t,C),Y($,t,null),g(t,k),g(t,M),g(t,A),g(t,y),y.innerHTML=j,g(t,B),X&&X.m(t,null),g(t,q),g(t,H),g(t,P),g(t,O),Y(x,O,null),S(N,V,I),Q&&Q.m(N,I),S(N,te,I),ae=!0},p(N,[I]){(!ae||I&2)&&n!==(n=N[1].subject+"")&&R(i,n);const se={};I&1&&(se.store=N[0]),I&2&&(se.message=N[1]),f.$set(se),(!ae||I&2)&&_!==(_=N[1].fulltime+"")&&R(b,_);const le={};I&1&&(le.store=N[0]),I&2&&(le.message=N[1]),I&8&&(le.canReplyAll=N[3]),w.$set(le);const G={};I&1&&(G.store=N[0]),I&2&&(G.message=N[1]),$.$set(G),(!ae||I&2)&&j!==(j=N[1].content+"")&&(y.innerHTML=j),N[1].attachments.length>0?X?(X.p(N,I),I&2&&T(X,1)):(X=As(N),X.c(),T(X,1),X.m(t,q)):X&&(ie(),z(X,1,1,()=>{X=null}),re());const fe={};I&1&&(fe.store=N[0]),I&2&&(fe.message=N[1]),I&8&&(fe.canReplyAll=N[3]),x.$set(fe),N[1].references.length>0?Q?(Q.p(N,I),I&2&&T(Q,1)):(Q=Bs(N),Q.c(),T(Q,1),Q.m(te.parentNode,te)):Q&&(ie(),z(Q,1,1,()=>{Q=null}),re())},i(N){ae||(T(f.$$.fragment,N),T(w.$$.fragment,N),T($.$$.fragment,N),T(X),T(x.$$.fragment,N),T(Q),ae=!0)},o(N){z(f.$$.fragment,N),z(w.$$.fragment,N),z($.$$.fragment,N),z(X),z(x.$$.fragment,N),z(Q),ae=!1},d(N){N&&(D(e),D(V),D(te)),W(f),W(w),W($),X&&X.d(),W(x),Q&&Q.d(N)}}}function wr(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,f=>t(2,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return l.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=o.sender.id==n.userid?o.recipients.filter(f=>f.type=="cc").length>0:o.recipients.filter(f=>["to","cc"].includes(f.type)&&f.id!=n.userid).length>0)},[a,o,n,s]}class $r extends ce{constructor(e){super(),me(this,e,wr,vr,oe,{store:0,message:1})}}function Is(l,e,t){const s=l.slice();s[6]=e[t];const n=Array.from(s[1].values()).filter(function(...r){return l[5](s[6],...r)});return s[7]=n,s}function Es(l,e,t){const s=l.slice();return s[10]=e[t],s}function Ps(l){let e,t,s=l[3].strings[l[6]]+"",n,i,r,a,o=[],f=new Map,d,c,m,_=ue(l[7]);const b=p=>p[10].id;for(let p=0;p<_.length;p+=1){let v=Es(l,_,p),w=b(v);f.set(w,o[p]=Rs(w,v))}return{c(){e=h("div"),t=h("div"),n=E(s),i=E(":"),r=L(),a=h("div");for(let p=0;p<o.length;p+=1)o[p].c();d=L(),u(t,"class","local-mail-draft-form-recipients-type flex-shrink-0 py-2 mr-2"),u(a,"class","d-flex flex-wrap"),ge(a,"min-width","0"),u(e,"class","d-flex mb-2")},m(p,v){S(p,e,v),g(e,t),g(t,n),g(t,i),g(e,r),g(e,a);for(let w=0;w<o.length;w+=1)o[w]&&o[w].m(a,null);g(e,d),m=!0},p(p,v){(!m||v&8)&&s!==(s=p[3].strings[p[6]]+"")&&R(n,s),v&14&&(_=ue(p[7]),ie(),o=Le(o,v,b,1,p,_,f,a,Ge,Rs,null,Es),re())},i(p){if(!m){for(let v=0;v<_.length;v+=1)T(o[v]);p&&je(()=>{m&&(c||(c=Ie(e,Be,{},!0)),c.run(1))}),m=!0}},o(p){for(let v=0;v<o.length;v+=1)z(o[v]);p&&(c||(c=Ie(e,Be,{},!1)),c.run(0)),m=!1},d(p){p&&D(e);for(let v=0;v<o.length;v+=1)o[v].d();p&&c&&c.end()}}}function yr(l){let e,t,s;return{c(){e=h("div"),t=h("i"),u(t,"class","fa fa-exclamation-circle"),u(e,"class","m-0 d-flex justify-content-center align-items-center"),ge(e,"width","35px"),ge(e,"height","35px"),u(e,"title",s=l[3].strings.cannotsendmailtouser)},m(n,i){S(n,e,i),g(e,t)},p(n,i){i&8&&s!==(s=n[3].strings.cannotsendmailtouser)&&u(e,"title",s)},i:F,o:F,d(n){n&&D(e)}}}function Mr(l){let e,t;return e=new et({props:{user:l[10]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.user=s[10]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Rs(l,e){let t,s,n,i,r,a,o=e[10].fullname+"",f,d,c,m,_,b,p,v,w,C,$,k;const M=[Mr,yr],A=[];function y(B,q){return B[10].isvalid?0:1}n=y(e),i=A[n]=M[n](e);function j(){return e[4](e[10])}return{key:l,first:null,c(){t=h("div"),s=h("div"),i.c(),r=L(),a=h("div"),f=E(o),c=L(),m=h("button"),_=h("i"),p=L(),u(s,"class","d-flex m-1 mr-2"),u(a,"class","py-2"),u(_,"class","fa fa-fw fa-times"),u(m,"type","button"),u(m,"class","btn align-self-middle p-2 align-bottom"),u(m,"title",b=e[3].strings.delete),u(t,"class","local-mail-draft-form-recipients-user d-flex flex-shrink align-items-center mr-2 mb-2"),U(t,"alert-danger",!e[10].isvalid),this.first=t},m(B,q){S(B,t,q),g(t,s),A[n].m(s,null),g(t,r),g(t,a),g(a,f),g(t,c),g(t,m),g(m,_),g(t,p),C=!0,$||(k=[De(d=Re.call(null,a,e[10].fullname)),J(m,"click",j),De(v=Re.call(null,t,e[10].fullname))],$=!0)},p(B,q){e=B;let H=n;n=y(e),n===H?A[n].p(e,q):(ie(),z(A[H],1,1,()=>{A[H]=null}),re(),i=A[n],i?i.p(e,q):(i=A[n]=M[n](e),i.c()),T(i,1),i.m(s,null)),(!C||q&2)&&o!==(o=e[10].fullname+"")&&R(f,o),d&&Ce(d.update)&&q&2&&d.update.call(null,e[10].fullname),(!C||q&8&&b!==(b=e[3].strings.delete))&&u(m,"title",b),v&&Ce(v.update)&&q&2&&v.update.call(null,e[10].fullname),(!C||q&2)&&U(t,"alert-danger",!e[10].isvalid)},i(B){C||(T(i),B&&je(()=>{C&&(w||(w=Ie(t,Be,{},!0)),w.run(1))}),C=!0)},o(B){z(i),B&&(w||(w=Ie(t,Be,{},!1)),w.run(0)),C=!1},d(B){B&&D(t),A[n].d(),B&&w&&w.end(),$=!1,we(k)}}}function Fs(l){let e,t,s=l[7].length&&Ps(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,i){n[7].length?s?(s.p(n,i),i&2&&T(s,1)):(s=Ps(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}function Cr(l){let e,t,s=ue(Object.values(Ae)),n=[];for(let r=0;r<s.length;r+=1)n[r]=Fs(Is(l,s,r));const i=r=>z(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=be()},m(r,a){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(r,a);S(r,e,a),t=!0},p(r,[a]){if(a&14){s=ue(Object.values(Ae));let o;for(o=0;o<s.length;o+=1){const f=Is(r,s,o);n[o]?(n[o].p(f,a),T(n[o],1)):(n[o]=Fs(f),n[o].c(),T(n[o],1),n[o].m(e.parentNode,e))}for(ie(),o=s.length;o<n.length;o+=1)i(o);re()}},i(r){if(!t){for(let a=0;a<s.length;a+=1)T(n[a]);t=!0}},o(r){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)z(n[a]);t=!1},d(r){r&&D(e),qe(n,r)}}}function Sr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,c=>t(3,s=c)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{recipients:a}=e,{onDelete:o}=e;const f=c=>o(c),d=(c,m)=>m.type==c;return l.$$set=c=>{"store"in c&&i(t(0,r=c.store)),"recipients"in c&&t(1,a=c.recipients),"onDelete"in c&&t(2,o=c.onDelete)},[r,a,o,s,f,d]}class Dr extends ce{constructor(e){super(),me(this,e,Sr,Cr,oe,{store:0,recipients:1,onDelete:2})}}function Gs(l,e,t){const s=l.slice();return s[4]=e[t],s}function Tr(l){let e,t,s=l[1].shorttime+"",n;return{c(){e=h("i"),t=L(),n=E(s),u(e,"class","fa fa-clock-o mr-1"),u(e,"aria-hidden","true")},m(i,r){S(i,e,r),S(i,t,r),S(i,n,r)},p(i,r){r&2&&s!==(s=i[1].shorttime+"")&&R(n,s)},d(i){i&&(D(e),D(t),D(n))}}}function Lr(l){let e,t,s=l[2].strings.draftsaved+"",n;return{c(){e=h("i"),t=L(),n=E(s),u(e,"class","fa fa-check mr-1"),u(e,"aria-hidden","true")},m(i,r){S(i,e,r),S(i,t,r),S(i,n,r)},p(i,r){r&4&&s!==(s=i[2].strings.draftsaved+"")&&R(n,s)},d(i){i&&(D(e),D(t),D(n))}}}function Us(l){let e,t=[],s=new Map,n,i=ue(l[1].labels);const r=a=>a[4].id;for(let a=0;a<i.length;a+=1){let o=Gs(l,i,a),f=r(o);s.set(f,t[a]=Hs(f,o))}return{c(){e=h("div");for(let a=0;a<t.length;a+=1)t[a].c();u(e,"class","d-flex flex-wrap mt-2 mr-2"),ge(e,"min-width","0")},m(a,o){S(a,e,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,o){o&2&&(i=ue(a[1].labels),ie(),t=Le(t,o,r,1,a,i,s,e,Ge,Hs,null,Gs),re())},i(a){if(!n){for(let o=0;o<i.length;o+=1)T(t[o]);n=!0}},o(a){for(let o=0;o<t.length;o+=1)z(t[o]);n=!1},d(a){a&&D(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Hs(l,e){let t,s,n;return s=new pt({props:{label:e[4]}}),{key:l,first:null,c(){t=be(),K(s.$$.fragment),this.first=t},m(i,r){S(i,t,r),Y(s,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.label=e[4]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(s,i)}}}function zr(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p;function v(k,M){return k[2].draftSaved?Lr:Tr}let w=v(l),C=w(l),$=l[1].labels&&Us(l);return{c(){e=h("div"),t=h("div"),s=h("div"),C.c(),i=L(),r=h("button"),a=h("i"),m=L(),$&&$.c(),u(s,"class","align-self-center alert-info px-2 text-truncate"),u(s,"title",n=l[1].fulltime),u(a,"class",o="fa "+(l[1].starred?"fa-star text-warning":"fa-star-o")),u(r,"type","button"),u(r,"class","btn border-0 py-2 ml-auto mr-3 mr-sm-2"),u(r,"role","checkbox"),u(r,"aria-checked",f=l[1].starred),r.disabled=d=l[1].deleted,u(r,"title",c=l[1].starred?l[2].strings.markasunstarred:l[2].strings.markasstarred),u(t,"class","d-flex flex-grow-1"),u(e,"class","d-sm-flex justify-content-between mb-2 mr-n3")},m(k,M){S(k,e,M),g(e,t),g(t,s),C.m(s,null),g(t,i),g(t,r),g(r,a),g(e,m),$&&$.m(e,null),_=!0,b||(p=J(r,"click",l[3]),b=!0)},p(k,[M]){w===(w=v(k))&&C?C.p(k,M):(C.d(1),C=w(k),C&&(C.c(),C.m(s,null))),(!_||M&2&&n!==(n=k[1].fulltime))&&u(s,"title",n),(!_||M&2&&o!==(o="fa "+(k[1].starred?"fa-star text-warning":"fa-star-o")))&&u(a,"class",o),(!_||M&2&&f!==(f=k[1].starred))&&u(r,"aria-checked",f),(!_||M&2&&d!==(d=k[1].deleted))&&(r.disabled=d),(!_||M&6&&c!==(c=k[1].starred?k[2].strings.markasunstarred:k[2].strings.markasstarred))&&u(r,"title",c),k[1].labels?$?($.p(k,M),M&2&&T($,1)):($=Us(k),$.c(),T($,1),$.m(e,null)):$&&(ie(),z($,1,1,()=>{$=null}),re())},i(k){_||(T($),_=!0)},o(k){z($),_=!1},d(k){k&&D(e),C.d(),$&&$.d(),b=!1,p()}}}function jr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;const o=()=>r.setStarred([a.id],!a.starred);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"message"in f&&t(1,a=f.message)},[r,a,s,o]}class Nr extends ce{constructor(e){super(),me(this,e,jr,zr,oe,{store:0,message:1})}}async function Ye(l){const e=await ft("core/ajax"),t=Array.from(l).map(({methodname:s,...n})=>({methodname:`local_mail_${s}`,args:n}));try{return await Promise.all(e.call(t))}catch(s){throw typeof s=="string"?{message:s}:s}}function Os(l,e,t){var i;const s=l.slice();s[31]=e[t];const n=(i=s[2].get(s[31].id))==null?void 0:i.type;return s[32]=n,s}function Js(l,e,t){const s=l.slice();return s[35]=e[t],s}function Vs(l,e,t){const s=l.slice();s[35]=e[t];const n=s[10].every(function(...r){return l[28](s[35],...r)});return s[38]=n,s}function Ks(l,e,t){const s=l.slice();return s[41]=e[t],s}function Ys(l,e,t){const s=l.slice();return s[44]=e[t],s}function Ws(l){let e,t,s,n,i,r=l[14].strings.allroles+"",a,o=[],f=new Map,d,c,m,_,b,p,v,w=ue(l[8]);const C=y=>y[44].id;for(let y=0;y<w.length;y+=1){let j=Ys(l,w,y),B=C(j);f.set(B,o[y]=Xs(B,j))}let $=l[9].length>0&&Qs(l);const k=[qr,Br,Ar],M=[];function A(y,j){return y[10].length?y[11]?1:2:0}return m=A(l),_=M[m]=k[m](l),{c(){e=h("div"),t=h("div"),s=h("div"),n=h("select"),i=h("option"),a=E(r);for(let y=0;y<o.length;y+=1)o[y].c();d=L(),$&&$.c(),c=L(),_.c(),i.__value=0,$e(i,i.__value),u(n,"class","form-control text-truncate"),l[12]===void 0&&je(()=>l[23].call(n)),u(s,"class","flex-grow-1 mx-2"),u(t,"class","list-group-item d-sm-flex px-2 py-2"),u(e,"class","local-mail-draft-form-user-search-dropdown dropdown-menu dropdown-menu-left list-group show p-0 w-100"),ge(e,"min-width","18rem")},m(y,j){S(y,e,j),g(e,t),g(t,s),g(s,n),g(n,i),g(i,a);for(let B=0;B<o.length;B+=1)o[B]&&o[B].m(n,null);We(n,l[12],!0),g(t,d),$&&$.m(t,null),g(e,c),M[m].m(e,null),b=!0,p||(v=[J(n,"change",l[23]),J(n,"change",l[24])],p=!0)},p(y,j){(!b||j[0]&16384)&&r!==(r=y[14].strings.allroles+"")&&R(a,r),j[0]&256&&(w=ue(y[8]),o=Le(o,j,C,1,y,w,f,n,Ze,Xs,null,Ys)),j[0]&4352&&We(n,y[12]),y[9].length>0?$?$.p(y,j):($=Qs(y),$.c(),$.m(t,null)):$&&($.d(1),$=null);let B=m;m=A(y),m===B?M[m].p(y,j):(ie(),z(M[B],1,1,()=>{M[B]=null}),re(),_=M[m],_?_.p(y,j):(_=M[m]=k[m](y),_.c()),T(_,1),_.m(e,null))},i(y){b||(T(_),b=!0)},o(y){z(_),b=!1},d(y){y&&D(e);for(let j=0;j<o.length;j+=1)o[j].d();$&&$.d(),M[m].d(),p=!1,we(v)}}}function Xs(l,e){let t,s=e[44].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=E(s),i=L(),t.__value=r=e[44].id,$e(t,t.__value),this.first=t},m(a,o){S(a,t,o),g(t,n),g(t,i)},p(a,o){e=a,o[0]&256&&s!==(s=e[44].name+"")&&R(n,s),o[0]&256&&r!==(r=e[44].id)&&(t.__value=r,$e(t,t.__value))},d(a){a&&D(t)}}}function Qs(l){let e,t,s,n=[],i=new Map,r,a,o=l[1].groupmode!=nt.Separate&&Zs(l),f=ue(l[9]);const d=c=>c[41].id;for(let c=0;c<f.length;c+=1){let m=Ks(l,f,c),_=d(m);i.set(_,n[c]=xs(_,m))}return{c(){e=h("div"),t=h("select"),o&&o.c(),s=be();for(let c=0;c<n.length;c+=1)n[c].c();u(t,"class","form-control text-truncate"),ge(t,"min-width","0"),l[13]===void 0&&je(()=>l[25].call(t)),u(e,"class","flex-grow-1 mx-2 mt-2 mt-sm-0")},m(c,m){S(c,e,m),g(e,t),o&&o.m(t,null),g(t,s);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(t,null);We(t,l[13],!0),r||(a=[J(t,"change",l[25]),J(t,"change",l[26])],r=!0)},p(c,m){c[1].groupmode!=nt.Separate?o?o.p(c,m):(o=Zs(c),o.c(),o.m(t,s)):o&&(o.d(1),o=null),m[0]&512&&(f=ue(c[9]),n=Le(n,m,d,1,c,f,i,t,Ze,xs,null,Ks)),m[0]&8704&&We(t,c[13])},d(c){c&&D(e),o&&o.d();for(let m=0;m<n.length;m+=1)n[m].d();r=!1,we(a)}}}function Zs(l){let e,t=l[14].strings.allgroups+"",s;return{c(){e=h("option"),s=E(t),e.__value=0,$e(e,e.__value)},m(n,i){S(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.allgroups+"")&&R(s,t)},d(n){n&&D(e)}}}function xs(l,e){let t,s=e[41].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=E(s),i=L(),t.__value=r=e[41].id,$e(t,t.__value),u(t,"class","text-truncate"),this.first=t},m(a,o){S(a,t,o),g(t,n),g(t,i)},p(a,o){e=a,o[0]&512&&s!==(s=e[41].name+"")&&R(n,s),o[0]&512&&r!==(r=e[41].id)&&(t.__value=r,$e(t,t.__value))},d(a){a&&D(t)}}}function Ar(l){let e,t,s,n,i,r,a=l[14].strings.allusers+"",o,f,d,c,m,_=[],b=new Map,p,v,w,C;s=new et({props:{icon:"fa-users"}});let $=ue(Object.values(Ae)),k=[];for(let y=0;y<$.length;y+=1)k[y]=el(Vs(l,$,y));let M=ue(l[10]);const A=y=>y[31].id;for(let y=0;y<M.length;y+=1){let j=Os(l,M,y),B=A(j);b.set(B,_[y]=sl(B,j))}return{c(){e=h("div"),t=h("div"),K(s.$$.fragment),n=L(),i=h("div"),r=h("div"),o=E(a),d=L(),c=h("div");for(let y=0;y<k.length;y+=1)k[y].c();m=L();for(let y=0;y<_.length;y+=1)_[y].c();p=be(),u(t,"class","mx-3 my-2"),u(r,"class","py-2 mr-3"),u(c,"class","d-flex ml-auto mr-2"),u(i,"class","d-sm-flex align-items-center flex-grow-1"),u(e,"class","list-group-item d-flex align-items-sm-center p-0")},m(y,j){S(y,e,j),g(e,t),Y(s,t,null),g(e,n),g(e,i),g(i,r),g(r,o),g(i,d),g(i,c);for(let B=0;B<k.length;B+=1)k[B]&&k[B].m(c,null);S(y,m,j);for(let B=0;B<_.length;B+=1)_[B]&&_[B].m(y,j);S(y,p,j),v=!0,w||(C=De(f=Re.call(null,r,l[14].strings.allusers)),w=!0)},p(y,j){if((!v||j[0]&16384)&&a!==(a=y[14].strings.allusers+"")&&R(o,a),f&&Ce(f.update)&&j[0]&16384&&f.update.call(null,y[14].strings.allusers),j[0]&17420){$=ue(Object.values(Ae));let B;for(B=0;B<$.length;B+=1){const q=Vs(y,$,B);k[B]?k[B].p(q,j):(k[B]=el(q),k[B].c(),k[B].m(c,null))}for(;B<k.length;B+=1)k[B].d(1);k.length=$.length}j[0]&17420&&(M=ue(y[10]),ie(),_=Le(_,j,A,1,y,M,b,p.parentNode,Ge,sl,p,Os),re())},i(y){if(!v){T(s.$$.fragment,y);for(let j=0;j<M.length;j+=1)T(_[j]);v=!0}},o(y){z(s.$$.fragment,y);for(let j=0;j<_.length;j+=1)z(_[j]);v=!1},d(y){y&&(D(e),D(m),D(p)),W(s),qe(k,y);for(let j=0;j<_.length;j+=1)_[j].d(y);w=!1,C()}}}function Br(l){let e,t=l[14].strings.toomanyusersfound+"",s;return{c(){e=h("div"),s=E(t),u(e,"class","list-group-item text-danger")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.toomanyusersfound+"")&&R(s,t)},i:F,o:F,d(n){n&&D(e)}}}function qr(l){let e,t=l[14].strings.nousersfound+"",s;return{c(){e=h("div"),s=E(t),u(e,"class","list-group-item text-danger")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.nousersfound+"")&&R(s,t)},i:F,o:F,d(n){n&&D(e)}}}function el(l){let e,t=l[14].strings[l[35]]+"",s,n,i,r,a;function o(){return l[27](l[38],l[35])}return{c(){e=h("button"),s=E(t),n=L(),u(e,"type","button"),u(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),u(e,"aria-pressed",i=l[38]),U(e,"btn-primary",l[38]),U(e,"btn-secondary",!l[38])},m(f,d){S(f,e,d),g(e,s),g(e,n),r||(a=J(e,"click",o),r=!0)},p(f,d){l=f,d[0]&16384&&t!==(t=l[14].strings[l[35]]+"")&&R(s,t),d[0]&1028&&i!==(i=l[38])&&u(e,"aria-pressed",i),d[0]&1028&&U(e,"btn-primary",l[38]),d[0]&1028&&U(e,"btn-secondary",!l[38])},d(f){f&&D(e),r=!1,a()}}}function tl(l){let e,t=l[14].strings[l[35]]+"",s,n,i,r,a;function o(){return l[29](l[31],l[32],l[35])}return{c(){e=h("button"),s=E(t),n=L(),u(e,"type","button"),u(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),u(e,"aria-pressed",i=l[32]==l[35]),U(e,"btn-primary",l[32]==l[35]),U(e,"btn-secondary",l[32]!=l[35])},m(f,d){S(f,e,d),g(e,s),g(e,n),r||(a=J(e,"click",o),r=!0)},p(f,d){l=f,d[0]&16384&&t!==(t=l[14].strings[l[35]]+"")&&R(s,t),d[0]&1028&&i!==(i=l[32]==l[35])&&u(e,"aria-pressed",i),d[0]&1028&&U(e,"btn-primary",l[32]==l[35]),d[0]&1028&&U(e,"btn-secondary",l[32]!=l[35])},d(f){f&&D(e),r=!1,a()}}}function sl(l,e){let t,s,n,i,r,a,o=e[31].fullname+"",f,d,c,m,_;n=new et({props:{user:e[31]}});let b=ue(Object.values(Ae)),p=[];for(let v=0;v<b.length;v+=1)p[v]=tl(Js(e,b,v));return{key:l,first:null,c(){t=h("div"),s=h("div"),K(n.$$.fragment),i=L(),r=h("div"),a=h("div"),f=E(o),d=L(),c=h("div");for(let v=0;v<p.length;v+=1)p[v].c();m=L(),u(s,"class","mx-3 my-2"),u(a,"class","py-2 mr-3 align-self-center"),u(c,"class","d-flex ml-auto mr-2 align-self-start"),u(r,"class","d-sm-flex flex-grow-1"),u(t,"class","list-group-item d-flex p-0"),this.first=t},m(v,w){S(v,t,w),g(t,s),Y(n,s,null),g(t,i),g(t,r),g(r,a),g(a,f),g(r,d),g(r,c);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(c,null);g(t,m),_=!0},p(v,w){e=v;const C={};if(w[0]&1024&&(C.user=e[31]),n.$set(C),(!_||w[0]&1024)&&o!==(o=e[31].fullname+"")&&R(f,o),w[0]&17420){b=ue(Object.values(Ae));let $;for($=0;$<b.length;$+=1){const k=Js(e,b,$);p[$]?p[$].p(k,w):(p[$]=tl(k),p[$].c(),p[$].m(c,null))}for(;$<p.length;$+=1)p[$].d(1);p.length=b.length}},i(v){_||(T(n.$$.fragment,v),_=!0)},o(v){z(n.$$.fragment,v),_=!1},d(v){v&&D(t),W(n),qe(p,v)}}}function Ir(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,w,C,$=l[4]&&Ws(l);return{c(){e=h("div"),t=h("div"),s=h("i"),i=L(),r=h("input"),f=L(),d=h("div"),c=h("button"),m=h("i"),p=L(),$&&$.c(),u(s,"class",n="fa fa-fw "+(l[7]?"fa-spinner fa-pulse":"fa-user")),u(s,"aria-hidden","true"),u(t,"class","position-absolute h-100 d-flex justify-content-center align-items-center px-2"),ge(t,"top","0"),ge(t,"left","0"),u(r,"type","text"),u(r,"class","form-control px-5"),u(r,"placeholder",a=l[14].strings.addrecipients),u(r,"aria-label",o=l[14].strings.addrecipients),u(r,"autocomplete","off"),U(r,"is-invalid",!l[2].size),u(m,"class",_="fa fa-fw "+(l[5]?"fa-times":l[4]?"fa-caret-up":"fa-caret-down")),u(m,"aria-hidden","true"),u(c,"type","button"),u(c,"aria-expanded",l[4]),u(c,"class","btn px-2"),u(c,"title",b=l[14].strings.addrecipients),u(d,"class","position-absolute h-100 d-flex align-items-center"),ge(d,"top","0"),ge(d,"right","0"),u(e,"class","local-mail-draft-form-user-search-input form-group position-relative")},m(k,M){S(k,e,M),g(e,t),g(t,s),g(e,i),g(e,r),$e(r,l[5]),l[21](r),g(e,f),g(e,d),g(d,c),g(c,m),g(e,p),$&&$.m(e,null),v=!0,w||(C=[J(r,"input",l[20]),J(r,"input",l[22]),J(r,"focus",l[18]),J(c,"click",Te(l[15])),De(Fe.call(null,e,l[17]))],w=!0)},p(k,M){(!v||M[0]&128&&n!==(n="fa fa-fw "+(k[7]?"fa-spinner fa-pulse":"fa-user")))&&u(s,"class",n),(!v||M[0]&16384&&a!==(a=k[14].strings.addrecipients))&&u(r,"placeholder",a),(!v||M[0]&16384&&o!==(o=k[14].strings.addrecipients))&&u(r,"aria-label",o),M[0]&32&&r.value!==k[5]&&$e(r,k[5]),(!v||M[0]&4)&&U(r,"is-invalid",!k[2].size),(!v||M[0]&48&&_!==(_="fa fa-fw "+(k[5]?"fa-times":k[4]?"fa-caret-up":"fa-caret-down")))&&u(m,"class",_),(!v||M[0]&16)&&u(c,"aria-expanded",k[4]),(!v||M[0]&16384&&b!==(b=k[14].strings.addrecipients))&&u(c,"title",b),k[4]?$?($.p(k,M),M[0]&16&&T($,1)):($=Ws(k),$.c(),T($,1),$.m(e,null)):$&&(ie(),z($,1,1,()=>{$=null}),re())},i(k){v||(T($),v=!0)},o(k){z($),v=!1},d(k){k&&D(e),l[21](null),$&&$.d(),w=!1,we(C)}}}const Er=500;function Pr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,N=>t(14,s=N)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{course:a}=e,{recipients:o}=e,{onChange:f}=e,d=!1,c="",m,_=!1,b,p=[],v=[],w=[],C=!1,$=a.id,k=0,M=0;const A=async()=>{d?(t(5,c=""),t(4,d=!1),window.clearTimeout(b)):(y(!1),m.focus())},y=async N=>{const I=s.settings.usersearchlimit;t(7,_=!0),window.clearTimeout(b),b=window.setTimeout(async()=>{var G;const se=[{methodname:"get_roles",courseid:a.id},{methodname:"get_groups",courseid:a.id},{methodname:"search_users",query:{courseid:a.id,fullname:c,roleid:k,groupid:M},limit:I+1}];let le;try{le=await Ye(se)}catch(fe){r.setError(fe),t(7,_=!1),t(4,d=!1),t(11,C=!1),t(10,w=[]);return}t(10,w=le.pop()),t(11,C=w.length>I),t(10,w=w.slice(0,I)),t(9,v=le.pop()),t(13,M=v.find(fe=>fe.id==M)?M:a.groupmode==nt.Separate&&((G=v[0])==null?void 0:G.id)||0),t(8,p=le.pop()),t(12,k=p.find(fe=>fe.id==k)?k:0),t(7,_=!1),t(4,d=!0)},N?Er:0)},j=()=>{t(5,c=""),t(4,d=!1)},B=()=>{d||y(!1)};function q(){c=this.value,t(5,c)}function H(N){Me[N?"unshift":"push"](()=>{m=N,t(6,m)})}const P=()=>y(!0);function O(){k=ut(this),t(12,k),t(19,$),t(1,a),t(8,p)}const x=()=>y(!1);function V(){M=ut(this),t(13,M),t(19,$),t(1,a),t(9,v)}const te=()=>y(!1),ae=(N,I)=>f(w,N?null:I),X=(N,I)=>{var se;return((se=o.get(I.id))==null?void 0:se.type)==N},Q=(N,I,se)=>f([N],I==se?null:se);return l.$$set=N=>{"store"in N&&i(t(0,r=N.store)),"course"in N&&t(1,a=N.course),"recipients"in N&&t(2,o=N.recipients),"onChange"in N&&t(3,f=N.onChange)},l.$$.update=()=>{l.$$.dirty[0]&524290&&$!=a.id&&(t(19,$=a.id),t(12,k=0),t(13,M=0))},[r,a,o,f,d,c,m,_,p,v,w,C,k,M,s,A,y,j,B,$,q,H,P,O,x,V,te,ae,X,Q]}class Rr extends ce{constructor(e){super(),me(this,e,Pr,Ir,oe,{store:0,course:1,recipients:2,onChange:3},null,[-1,-1])}}function Fr(l){let e,t,s,n=l[1].strings.send+"",i,r,a,o;return{c(){e=h("button"),t=h("i"),s=L(),i=E(n),u(t,"class","fa fa-send mr-2"),u(e,"type","button"),u(e,"class","local-mail-action-send btn btn-primary flex-shrink-0 text-nowrap px-3 text-truncate ml-auto"),u(e,"title",r=l[1].strings.send)},m(f,d){S(f,e,d),g(e,t),g(e,s),g(e,i),a||(o=J(e,"click",l[2]),a=!0)},p(f,[d]){d&2&&n!==(n=f[1].strings.send+"")&&R(i,n),d&2&&r!==(r=f[1].strings.send)&&u(e,"title",r)},i:F,o:F,d(f){f&&D(e),a=!1,o()}}}function Gr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.sendMessage();return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class _n extends ce{constructor(e){super(),me(this,e,Gr,Fr,oe,{store:0})}}const{Map:Ur}=xe;function ll(l,e,t){const s=l.slice();return s[20]=e[t],s}function nl(l){let e,t,s,n=l[7].strings.errorinvalidrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=E(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,a){S(r,e,a),g(e,t),g(e,s),g(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.errorinvalidrecipients+"")&&R(i,n)},d(r){r&&D(e)}}}function Hr(l){let e,t,s,n=Ne(l[7].strings.errortoomanyrecipients,l[7].settings.maxrecipients)+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=E(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,a){S(r,e,a),g(e,t),g(e,s),g(e,i)},p(r,a){a&128&&n!==(n=Ne(r[7].strings.errortoomanyrecipients,r[7].settings.maxrecipients)+"")&&R(i,n)},d(r){r&&D(e)}}}function Or(l){let e,t,s,n=l[7].strings.erroremptyrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=E(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,a){S(r,e,a),g(e,t),g(e,s),g(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.erroremptyrecipients+"")&&R(i,n)},d(r){r&&D(e)}}}function il(l){let e,t,s,n=l[7].strings.erroremptysubject+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=E(n),u(t,"class","fa fa-exclamation-circle mr-2"),u(e,"class","alert alert-danger")},m(r,a){S(r,e,a),g(e,t),g(e,s),g(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.erroremptysubject+"")&&R(i,n)},d(r){r&&D(e)}}}function rl(l){let e,t=l[7].strings.references+"",s,n,i=[],r=new Ur,a,o,f=ue(l[1].references);const d=c=>c[20].id;for(let c=0;c<f.length;c+=1){let m=ll(l,f,c),_=d(m);r.set(_,i[c]=al(_,m))}return{c(){e=h("div"),s=E(t),n=L();for(let c=0;c<i.length;c+=1)i[c].c();a=be(),u(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(c,m){S(c,e,m),g(e,s),S(c,n,m);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(c,m);S(c,a,m),o=!0},p(c,m){(!o||m&128)&&t!==(t=c[7].strings.references+"")&&R(s,t),m&130&&(f=ue(c[1].references),ie(),i=Le(i,m,d,1,c,f,r,a.parentNode,Ge,al,a,ll),re())},i(c){if(!o){for(let m=0;m<f.length;m+=1)T(i[m]);o=!0}},o(c){for(let m=0;m<i.length;m+=1)z(i[m]);o=!1},d(c){c&&(D(e),D(n),D(a));for(let m=0;m<i.length;m+=1)i[m].d(c)}}}function al(l,e){let t,s,n;return s=new dn({props:{strings:e[7].strings,reference:e[20]}}),{key:l,first:null,c(){t=be(),K(s.$$.fragment),this.first=t},m(i,r){S(i,t,r),Y(s,i,r),n=!0},p(i,r){e=i;const a={};r&128&&(a.strings=e[7].strings),r&2&&(a.reference=e[20]),s.$set(a)},i(i){n||(T(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(s,i)}}}function Jr(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,w,C,$,k,M=l[2].editorhtml+"",A,y,j=l[2].filemanagerhtml+"",B,q=Array.from(l[5].values()).some(ol),H,P,O=!l[4].trim(),x,V,te,ae,X,Q,N,I;n=new Nr({props:{store:l[0],message:l[1]}}),o=new Vl({props:{settings:l[7].settings,strings:l[7].strings,courses:l[7].courses,label:l[7].strings.course,selected:l[6].id,required:!0,readonly:l[1].references.length>0,style:"filter-left",onChange:l[8]}}),c=new Rr({props:{store:l[0],course:l[6],recipients:l[5],onChange:l[9]}}),_=new Dr({props:{store:l[0],recipients:l[5],onDelete:l[10]}});let se=q&&nl(l);function le(Z,ne){if(Z[5].size==0)return Or;if(Z[5].size>Z[7].settings.maxrecipients)return Hr}let G=le(l),fe=G&&G(l),ee=O&&il(l);te=new _n({props:{store:l[0]}});let he=l[1].references.length>0&&rl(l);return{c(){e=h("hr"),t=L(),s=h("form"),K(n.$$.fragment),i=L(),r=h("div"),a=h("div"),K(o.$$.fragment),f=L(),d=h("div"),K(c.$$.fragment),m=L(),K(_.$$.fragment),b=L(),p=h("div"),v=h("input"),$=L(),k=h("div"),A=L(),y=h("div"),B=L(),se&&se.c(),H=L(),fe&&fe.c(),P=L(),ee&&ee.c(),x=L(),V=h("div"),K(te.$$.fragment),ae=L(),he&&he.c(),X=be(),u(e,"class","d-lg-none mt-0 mb-3 mb-sm-2"),u(a,"class","form-group col-12 col-xl-5"),u(d,"class","col-12 col-xl-7"),u(r,"class","row"),u(v,"type","text"),u(v,"id","local-mail-message-form-subject"),u(v,"class","form-control"),u(v,"placeholder",w=l[7].strings.subject),u(v,"aria-label",C=l[7].strings.subject),u(v,"autocomplete","off"),u(v,"maxlength","100"),U(v,"is-invalid",!l[4].trim()),u(p,"class","form-group"),u(k,"class","form-group"),u(y,"class","form-group"),u(V,"class","d-flex justify-content-end align-items-center"),u(s,"class","pt-lg-2 pb-3 px-lg-4"),U(s,"card",l[7].viewportSize>=de.LG)},m(Z,ne){S(Z,e,ne),S(Z,t,ne),S(Z,s,ne),Y(n,s,null),g(s,i),g(s,r),g(r,a),Y(o,a,null),g(r,f),g(r,d),Y(c,d,null),g(s,m),Y(_,s,null),g(s,b),g(s,p),g(p,v),$e(v,l[4]),g(s,$),g(s,k),k.innerHTML=M,g(s,A),g(s,y),y.innerHTML=j,g(s,B),se&&se.m(s,null),g(s,H),fe&&fe.m(s,null),g(s,P),ee&&ee.m(s,null),g(s,x),g(s,V),Y(te,V,null),l[15](s),S(Z,ae,ne),he&&he.m(Z,ne),S(Z,X,ne),Q=!0,N||(I=[J(v,"input",l[12]),J(v,"input",l[13]),J(k,"change",l[14]),J(s,"submit",Te(l[16]))],N=!0)},p(Z,[ne]){const pe={};ne&1&&(pe.store=Z[0]),ne&2&&(pe.message=Z[1]),n.$set(pe);const Se={};ne&128&&(Se.settings=Z[7].settings),ne&128&&(Se.strings=Z[7].strings),ne&128&&(Se.courses=Z[7].courses),ne&128&&(Se.label=Z[7].strings.course),ne&64&&(Se.selected=Z[6].id),ne&2&&(Se.readonly=Z[1].references.length>0),o.$set(Se);const ze={};ne&1&&(ze.store=Z[0]),ne&64&&(ze.course=Z[6]),ne&32&&(ze.recipients=Z[5]),c.$set(ze);const ye={};ne&1&&(ye.store=Z[0]),ne&32&&(ye.recipients=Z[5]),_.$set(ye),(!Q||ne&128&&w!==(w=Z[7].strings.subject))&&u(v,"placeholder",w),(!Q||ne&128&&C!==(C=Z[7].strings.subject))&&u(v,"aria-label",C),ne&16&&v.value!==Z[4]&&$e(v,Z[4]),(!Q||ne&16)&&U(v,"is-invalid",!Z[4].trim()),(!Q||ne&4)&&M!==(M=Z[2].editorhtml+"")&&(k.innerHTML=M),(!Q||ne&4)&&j!==(j=Z[2].filemanagerhtml+"")&&(y.innerHTML=j),ne&32&&(q=Array.from(Z[5].values()).some(ol)),q?se?se.p(Z,ne):(se=nl(Z),se.c(),se.m(s,H)):se&&(se.d(1),se=null),G===(G=le(Z))&&fe?fe.p(Z,ne):(fe&&fe.d(1),fe=G&&G(Z),fe&&(fe.c(),fe.m(s,P))),ne&16&&(O=!Z[4].trim()),O?ee?ee.p(Z,ne):(ee=il(Z),ee.c(),ee.m(s,x)):ee&&(ee.d(1),ee=null);const ke={};ne&1&&(ke.store=Z[0]),te.$set(ke),(!Q||ne&128)&&U(s,"card",Z[7].viewportSize>=de.LG),Z[1].references.length>0?he?(he.p(Z,ne),ne&2&&T(he,1)):(he=rl(Z),he.c(),T(he,1),he.m(X.parentNode,X)):he&&(ie(),z(he,1,1,()=>{he=null}),re())},i(Z){Q||(T(n.$$.fragment,Z),T(o.$$.fragment,Z),T(c.$$.fragment,Z),T(_.$$.fragment,Z),T(te.$$.fragment,Z),T(he),Q=!0)},o(Z){z(n.$$.fragment,Z),z(o.$$.fragment,Z),z(c.$$.fragment,Z),z(_.$$.fragment,Z),z(te.$$.fragment,Z),z(he),Q=!1},d(Z){Z&&(D(e),D(t),D(s),D(ae),D(X)),W(n),W(o),W(c),W(_),se&&se.d(),fe&&fe.d(),ee&&ee.d(),W(te),l[15](null),he&&he.d(Z),N=!1,we(I)}}}const ol=l=>!l.isvalid;function Vr(l,e,t){let s,n,i,r,a=F,o=()=>(a(),a=_e(f,B=>t(7,r=B)),f);l.$$.on_destroy.push(()=>a());let{store:f}=e;o();let{message:d}=e,{form:c}=e,m,_;Qe(()=>{_==null||_.addEventListener("core_form/uploadChanged",()=>$(!1));const B=b();return()=>{m==null||m.remove(),B()}});const b=()=>{let B,q;const H=()=>{q==null||q.save(),$(!1)},P=O=>{O.editor.id==`local-mail-compose-editor-${d.id}`&&(q==null||q.off("input",H),q==null||q.off("ExecCommand",H),q=O.editor,O.editor.on("input",H),O.editor.on("ExecCommand",H))};return ft("editor_tiny/loader").then(async O=>{B=await O.getTinyMCE(),B.EditorManager.get().forEach(x=>P({editor:x})),B.EditorManager.on("SetupEditor",P)}),()=>{B==null||B.EditorManager.off("SetupEditor",P),q==null||q.off("input",H),q==null||q.off("ExecCommand",H)}},p=async B=>{const q=await ft("core/fragment");m==null||m.remove(),await Xe(),m=document.createElement("script"),m.setAttribute("type","text/javascript"),m.innerHTML=q.processCollectedJavascript(B),document.head.append(m)},v=B=>{t(6,s=r.courses.find(q=>q.id==B)||r.courses[0]),$(!0)},w=(B,q)=>{const H=new Map(i);for(const O of B)q?H.set(O.id,{...O,type:q,isvalid:!0}):H.delete(O.id);const P=Array.from(H.values());P.sort((O,x)=>O.sortorder.localeCompare(x.sortorder)),t(5,i=new Map(P.map(O=>[O.id,O]))),$(!1)},C=B=>{w([B],null)},$=async B=>{var P,O,x;if(!_)return;const q=new FormData(_),H={courseid:s.id,to:Array.from(i.values()).filter(V=>V.type=="to").map(V=>V.id),cc:Array.from(i.values()).filter(V=>V.type=="cc").map(V=>V.id),bcc:Array.from(i.values()).filter(V=>V.type=="bcc").map(V=>V.id),subject:n,content:((P=q.get("content[text]"))==null?void 0:P.toString())||"",format:parseInt(((O=q.get("content[format]"))==null?void 0:O.toString())||"")||1,draftitemid:parseInt(((x=q.get("content[itemid]"))==null?void 0:x.toString())||"")||0};await f.updateDraft(H,B)};function k(){n=this.value,t(4,n),t(1,d)}const M=()=>$(!1),A=()=>$(!1);function y(B){Me[B?"unshift":"push"](()=>{_=B,t(3,_)})}const j=()=>$(!0);return l.$$set=B=>{"store"in B&&o(t(0,f=B.store)),"message"in B&&t(1,d=B.message),"form"in B&&t(2,c=B.form)},l.$$.update=()=>{l.$$.dirty&2&&t(6,s=d.course),l.$$.dirty&2&&t(4,n=d.subject),l.$$.dirty&2&&t(5,i=new Map(d.recipients.map(B=>[B.id,B]))),l.$$.dirty&4&&p(c.javascript)},[f,d,c,_,n,i,s,r,v,w,C,$,k,M,A,y,j]}class Kr extends ce{constructor(e){super(),me(this,e,Vr,Jr,oe,{store:0,message:1,form:2})}}function fl(l,e,t){const s=l.slice();return s[7]=e[t],s}function ul(l){let e,t=l[7]+"",s,n;return{c(){e=h("option"),s=E(t),e.__value=n=l[7],$e(e,e.__value)},m(i,r){S(i,e,r),g(e,s)},p(i,r){r&8&&t!==(t=i[7]+"")&&R(s,t),r&8&&n!==(n=i[7])&&(e.__value=n,$e(e,e.__value))},d(i){i&&D(e)}}}function Yr(l){let e,t,s,n=l[1].strings.messagesperpage+"",i,r,a,o,f,d,c=ue(l[3]),m=[];for(let _=0;_<c.length;_+=1)m[_]=ul(fl(l,c,_));return{c(){e=h("div"),t=h("div"),s=h("label"),i=E(n),r=E(":"),a=L(),o=h("select");for(let _=0;_<m.length;_+=1)m[_].c();u(s,"for","local-mail-perpage-select"),u(o,"id","local-mail-perpage-select"),u(o,"class","custom-select"),l[2]===void 0&&je(()=>l[4].call(o)),u(t,"class","form-group"),u(e,"class","form-inline justify-content-end mt-3")},m(_,b){S(_,e,b),g(e,t),g(t,s),g(s,i),g(s,r),g(t,a),g(t,o);for(let p=0;p<m.length;p+=1)m[p]&&m[p].m(o,null);We(o,l[2],!0),f||(d=[J(o,"change",l[4]),J(o,"change",l[5])],f=!0)},p(_,[b]){if(b&2&&n!==(n=_[1].strings.messagesperpage+"")&&R(i,n),b&8){c=ue(_[3]);let p;for(p=0;p<c.length;p+=1){const v=fl(_,c,p);m[p]?m[p].p(v,b):(m[p]=ul(v),m[p].c(),m[p].m(o,null))}for(;p<m.length;p+=1)m[p].d(1);m.length=c.length}b&12&&We(o,_[2])},i:F,o:F,d(_){_&&D(e),qe(m,_),f=!1,we(d)}}}function Wr(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,m=>t(1,n=m)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();const o=[5,10,20,50,100];let f=n.preferences.perpage;function d(){f=ut(this),t(2,f),t(3,s),t(1,n)}const c=()=>a.savePreferences({perpage:f});return l.$$set=m=>{"store"in m&&r(t(0,a=m.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=o.includes(n.preferences.perpage)?o:o.concat([n.preferences.perpage]).sort((m,_)=>m-_))},[a,n,f,s,d,c]}class Xr extends ce{constructor(e){super(),me(this,e,Wr,Yr,oe,{store:0})}}function cl(l,e,t){const s=l.slice();return s[9]=e[t],s}function ml(l){let e,t,s=l[4].strings.locked+"",n,i;return{c(){e=h("span"),t=E("("),n=E(s),i=E(")"),u(e,"class","ml-1")},m(r,a){S(r,e,a),g(e,t),g(e,n),g(e,i)},p(r,a){a&16&&s!==(s=r[4].strings.locked+"")&&R(n,s)},d(r){r&&D(e)}}}function dl(l){let e,t,s,n,i,r,a,o=l[9].displayname+"",f,d,c,m,_;function b(){return l[8](l[9])}let p=l[9].locked&&ml(l);return{c(){e=h("div"),t=h("input"),r=L(),a=h("label"),f=E(o),d=L(),p&&p.c(),u(t,"id",s="local-mail-preferences-messageprocessor-"+l[9].name),u(t,"class","custom-control-input"),u(t,"type","checkbox"),t.checked=n=l[9].locked?l[9].enabled:l[3].includes(l[9].name),t.disabled=i=l[9].locked,u(a,"for",c="local-mail-preferences-messageprocessor-"+l[9].name),u(a,"class","custom-control-label pl-1"),u(e,"class","custom-control custom-switch my-2")},m(v,w){S(v,e,w),g(e,t),g(e,r),g(e,a),g(a,f),g(a,d),p&&p.m(a,null),m||(_=J(t,"click",b),m=!0)},p(v,w){l=v,w&16&&s!==(s="local-mail-preferences-messageprocessor-"+l[9].name)&&u(t,"id",s),w&24&&n!==(n=l[9].locked?l[9].enabled:l[3].includes(l[9].name))&&(t.checked=n),w&16&&i!==(i=l[9].locked)&&(t.disabled=i),w&16&&o!==(o=l[9].displayname+"")&&R(f,o),l[9].locked?p?p.p(l,w):(p=ml(l),p.c(),p.m(a,null)):p&&(p.d(1),p=null),w&16&&c!==(c="local-mail-preferences-messageprocessor-"+l[9].name)&&u(a,"for",c)},d(v){v&&D(e),p&&p.d(),m=!1,_()}}}function Qr(l){let e,t=l[4].strings.notifications+"",s,n,i,r,a,o,f,d,c,m=l[4].strings.markmessagesasread+"",_,b,p,v=ue(l[4].settings.messageprocessors),w=[];for(let C=0;C<v.length;C+=1)w[C]=dl(cl(l,v,C));return{c(){e=h("h6"),s=E(t),n=L();for(let C=0;C<w.length;C+=1)w[C].c();i=L(),r=h("div"),a=h("input"),d=L(),c=h("label"),_=E(m),u(e,"class","mb-3"),u(a,"id","local-mail-preferences-markasread"),u(a,"class","custom-control-input"),u(a,"type","checkbox"),a.checked=o=l[2]&&l[3].length>0,a.disabled=f=l[3].length==0,u(c,"for","local-mail-preferences-markasread"),u(c,"class","custom-control-label pl-1"),u(r,"class","custom-control custom-switch my-2 mt-3")},m(C,$){S(C,e,$),g(e,s),S(C,n,$);for(let k=0;k<w.length;k+=1)w[k]&&w[k].m(C,$);S(C,i,$),S(C,r,$),g(r,a),g(r,d),g(r,c),g(c,_),b||(p=J(a,"click",l[6]),b=!0)},p(C,$){if($&16&&t!==(t=C[4].strings.notifications+"")&&R(s,t),$&152){v=ue(C[4].settings.messageprocessors);let k;for(k=0;k<v.length;k+=1){const M=cl(C,v,k);w[k]?w[k].p(M,$):(w[k]=dl(M),w[k].c(),w[k].m(i.parentNode,i))}for(;k<w.length;k+=1)w[k].d(1);w.length=v.length}$&12&&o!==(o=C[2]&&C[3].length>0)&&(a.checked=o),$&8&&f!==(f=C[3].length==0)&&(a.disabled=f),$&16&&m!==(m=C[4].strings.markmessagesasread+"")&&R(_,m)},d(C){C&&(D(e),D(n),D(i),D(r)),qe(w,C),b=!1,p()}}}function Zr(l){let e,t;return e=new Ue({props:{title:l[4].strings.preferences,confirmText:l[4].strings.save,cancelText:l[4].strings.cancel,onConfirm:l[5],onCancel:l[1],$$slots:{default:[Qr]},$$scope:{ctx:l}}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,[n]){const i={};n&16&&(i.title=s[4].strings.preferences),n&16&&(i.confirmText=s[4].strings.save),n&16&&(i.cancelText=s[4].strings.cancel),n&2&&(i.onCancel=s[1]),n&4124&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function xr(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,b=>t(4,s=b)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{onCancel:a}=e,o=s.preferences.markasread,f=s.settings.messageprocessors.map(b=>b.name).filter(b=>s.preferences.notifications.includes(b));const d=()=>{a(),r.savePreferences({markasread:o,notifications:f})},c=()=>{t(2,o=!o)},m=b=>{t(3,f=f.includes(b)?f.filter(p=>p!=b):[...f,b])},_=b=>m(b.name);return l.$$set=b=>{"store"in b&&i(t(0,r=b.store)),"onCancel"in b&&t(1,a=b.onCancel)},[r,a,o,f,s,d,c,m,_]}class ea extends ce{constructor(e){super(),me(this,e,xr,Zr,oe,{store:0,onCancel:1})}}function ta(l){let e,t,s,n;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-question-circle text-info"),u(t,"role","img"),u(t,"title",s=l[2].strings.help),u(e,"type","button"),u(e,"class","btn btn-help p-0"),u(e,"data-container","body"),u(e,"data-toggle","popover"),u(e,"data-placement","top"),u(e,"data-content",l[1]),u(e,"data-trigger","focus"),u(e,"aria-label",n=l[2].strings.help)},m(i,r){S(i,e,r),g(e,t)},p(i,[r]){r&4&&s!==(s=i[2].strings.help)&&u(t,"title",s),r&2&&u(e,"data-content",i[1]),r&4&&n!==(n=i[2].strings.help)&&u(e,"aria-label",n)},i:F,o:F,d(i){i&&D(e)}}}function sa(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class la extends ce{constructor(e){super(),me(this,e,sa,ta,oe,{store:0,message:1})}}function na(l){let e,t,s,n=l[9].strings.searchfrom+"",i,r,a,o,f,d,c,m=l[9].strings.searchto+"",_,b,p,v,w,C,$,k=l[9].strings.searchdate+"",M,A,y,j,B,q,H,P,O,x,V,te,ae=l[9].strings.searchunreadonly+"",X,Q,N,I,se,le,G=l[9].strings.searchhasattachments+"",fe,ee,he,Z,ne,pe,Se,ze;return y=new la({props:{store:l[4],message:l[9].strings.searchdatehelp}}),{c(){e=h("div"),t=h("div"),s=h("label"),i=E(n),r=L(),a=h("div"),o=h("input"),f=L(),d=h("div"),c=h("label"),_=E(m),b=L(),p=h("div"),v=h("input"),w=L(),C=h("div"),$=h("label"),M=E(k),A=L(),K(y.$$.fragment),j=L(),B=h("div"),q=h("input"),H=L(),P=h("div"),O=h("div"),x=h("input"),V=L(),te=h("label"),X=E(ae),Q=L(),N=h("div"),I=h("input"),se=L(),le=h("label"),fe=E(G),ee=L(),he=h("input"),u(s,"for","local-mail-search-input-sendername"),u(s,"class","col-4 col-form-label pr-0"),u(o,"type","text"),u(o,"class","form-control"),u(o,"id","local-mail-search-input-sendername"),u(a,"class","col-8"),u(t,"class","form-group row"),u(c,"for","local-mail-search-input-recipientname"),u(c,"class","col-4 col-form-label pr-0"),u(v,"type","text"),u(v,"class","form-control"),u(v,"id","local-mail-search-input-recipientname"),u(p,"class","col-8 p"),u(d,"class","form-group row"),u($,"for","local-mail-search-input-maxdate"),u($,"class","col-4 col-form-label pr-0"),u(q,"type","date"),u(q,"class","form-control"),u(q,"id","local-mail-search-input-maxdate"),u(q,"max",l[10]),q.value=l[8],u(B,"class","col-8"),u(C,"class","form-group row"),u(x,"class","form-check-input"),u(x,"type","checkbox"),u(x,"id","local-mail-search-input-unread"),u(te,"class","form-check-label"),u(te,"for","local-mail-search-input-unread"),u(O,"class","form-check"),u(I,"class","form-check-input"),u(I,"type","checkbox"),u(I,"id","local-mail-search-input-withfilesonly"),u(le,"class","form-check-label"),u(le,"for","local-mail-search-input-withfilesonly"),u(N,"class","form-check"),u(he,"type","submit"),he.disabled=Z=!l[6],u(he,"class","btn btn-primary px-3 ml-auto"),he.value=ne=l[9].strings.search,u(P,"class","d-flex flex-wrap align-items-center"),ge(P,"column-gap","2rem"),ge(P,"row-gap","1rem"),u(e,"class","dropdown-menu dropdown-menu-left show p-3 w-100"),ge(e,"min-width","18rem")},m(ye,ke){S(ye,e,ke),g(e,t),g(t,s),g(s,i),g(t,r),g(t,a),g(a,o),$e(o,l[0]),l[15](o),g(e,f),g(e,d),g(d,c),g(c,_),g(d,b),g(d,p),g(p,v),$e(v,l[1]),g(e,w),g(e,C),g(C,$),g($,M),g($,A),Y(y,$,null),g(C,j),g(C,B),g(B,q),g(e,H),g(e,P),g(P,O),g(O,x),x.checked=l[2],g(O,V),g(O,te),g(te,X),g(P,Q),g(P,N),g(N,I),I.checked=l[3],g(N,se),g(N,le),g(le,fe),g(P,ee),g(P,he),pe=!0,Se||(ze=[J(o,"input",l[14]),J(v,"input",l[16]),J(q,"input",l[11]),J(x,"change",l[17]),J(I,"change",l[18]),J(he,"click",Te(function(){Ce(l[5])&&l[5].apply(this,arguments)}))],Se=!0)},p(ye,[ke]){l=ye,(!pe||ke&512)&&n!==(n=l[9].strings.searchfrom+"")&&R(i,n),ke&1&&o.value!==l[0]&&$e(o,l[0]),(!pe||ke&512)&&m!==(m=l[9].strings.searchto+"")&&R(_,m),ke&2&&v.value!==l[1]&&$e(v,l[1]),(!pe||ke&512)&&k!==(k=l[9].strings.searchdate+"")&&R(M,k);const He={};ke&16&&(He.store=l[4]),ke&512&&(He.message=l[9].strings.searchdatehelp),y.$set(He),(!pe||ke&256)&&(q.value=l[8]),ke&4&&(x.checked=l[2]),(!pe||ke&512)&&ae!==(ae=l[9].strings.searchunreadonly+"")&&R(X,ae),ke&8&&(I.checked=l[3]),(!pe||ke&512)&&G!==(G=l[9].strings.searchhasattachments+"")&&R(fe,G),(!pe||ke&64&&Z!==(Z=!l[6]))&&(he.disabled=Z),(!pe||ke&512&&ne!==(ne=l[9].strings.search))&&(he.value=ne)},i(ye){pe||(T(y.$$.fragment,ye),pe=!0)},o(ye){z(y.$$.fragment,ye),pe=!1},d(ye){ye&&D(e),l[15](null),W(y),Se=!1,we(ze)}}}function ia(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,j=>t(9,n=j)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{sendername:o=""}=e,{recipientname:f=""}=e,{unread:d=!1}=e,{withfilesonly:c=!1}=e,{maxtime:m=0}=e,{submit:_}=e,{submitEnabled:b}=e;function p(){v.focus()}let v,w=St(Math.floor(new Date().getTime()/1e3));const C=j=>{t(12,m=zn(j.target.value))};function $(){o=this.value,t(0,o)}function k(j){Me[j?"unshift":"push"](()=>{v=j,t(7,v)})}function M(){f=this.value,t(1,f)}function A(){d=this.checked,t(2,d)}function y(){c=this.checked,t(3,c)}return l.$$set=j=>{"store"in j&&r(t(4,a=j.store)),"sendername"in j&&t(0,o=j.sendername),"recipientname"in j&&t(1,f=j.recipientname),"unread"in j&&t(2,d=j.unread),"withfilesonly"in j&&t(3,c=j.withfilesonly),"maxtime"in j&&t(12,m=j.maxtime),"submit"in j&&t(5,_=j.submit),"submitEnabled"in j&&t(6,b=j.submitEnabled)},l.$$.update=()=>{l.$$.dirty&4096&&t(8,s=St(m))},[o,f,d,c,a,_,b,v,s,n,w,C,m,p,$,k,M,A,y]}class ra extends ce{constructor(e){super(),me(this,e,ia,na,oe,{store:4,sendername:0,recipientname:1,unread:2,withfilesonly:3,maxtime:12,submit:5,submitEnabled:6,focus:13})}get focus(){return this.$$.ctx[13]}}const{Boolean:aa}=xe;function _l(l,e,t){const s=l.slice();return s[14]=e[t],s[16]=t,s}function gl(l){let e,t,s,n=ue(l[4]),i=[];for(let d=0;d<n.length;d+=1)i[d]=pl(_l(l,n,d));const r=d=>z(i[d],1,1,()=>{i[d]=null});function a(d,c){if(d[5])return ua;if(!d[4].length)return fa}let o=a(l),f=o&&o(l);return{c(){e=h("div");for(let d=0;d<i.length;d+=1)i[d].c();t=L(),f&&f.c(),u(e,"class","dropdown-menu dropdown-menu-left overflow-hidden show p-0 w-100"),ge(e,"min-width","18rem")},m(d,c){S(d,e,c);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(e,null);g(e,t),f&&f.m(e,null),s=!0},p(d,c){if(c&401){n=ue(d[4]);let m;for(m=0;m<n.length;m+=1){const _=_l(d,n,m);i[m]?(i[m].p(_,c),T(i[m],1)):(i[m]=pl(_),i[m].c(),T(i[m],1),i[m].m(e,t))}for(ie(),m=n.length;m<i.length;m+=1)r(m);re()}o===(o=a(d))&&f?f.p(d,c):(f&&f.d(1),f=o&&o(d),f&&(f.c(),f.m(e,null)))},i(d){if(!s){for(let c=0;c<n.length;c+=1)T(i[c]);s=!0}},o(d){i=i.filter(aa);for(let c=0;c<i.length;c+=1)z(i[c]);s=!1},d(d){d&&D(e),qe(i,d),f&&f.d()}}}function oa(l){let e;return{c(){e=h("div"),u(e,"class","dropdown-divider my-0")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function pl(l){let e,t,s,n,i,r,a,o,f=l[14].shorttime+"",d,c,m,_,b,p,v=l[16]>0&&oa();return s=new _t({props:{store:l[0],message:l[14]}}),r=new dt({props:{store:l[0],message:l[14]}}),{c(){v&&v.c(),e=L(),t=h("a"),K(s.$$.fragment),n=L(),i=h("div"),K(r.$$.fragment),a=L(),o=h("div"),d=E(f),u(o,"title",c=l[14].fulltime),u(o,"class","ml-auto"),u(i,"class","local-mail-incremental-search-muted d-flex"),u(t,"class","dropdown-item local-mail-incremental-search-item"),u(t,"href",m=Ee(l[7](l[14],l[16]))),U(t,"font-weight-bold",l[14].unread)},m(w,C){v&&v.m(w,C),S(w,e,C),S(w,t,C),Y(s,t,null),g(t,n),g(t,i),Y(r,i,null),g(i,a),g(i,o),g(o,d),_=!0,b||(p=J(t,"click",function(){Ce(l[8](l[14],l[16]))&&l[8](l[14],l[16]).apply(this,arguments)}),b=!0)},p(w,C){l=w;const $={};C&1&&($.store=l[0]),C&16&&($.message=l[14]),s.$set($);const k={};C&1&&(k.store=l[0]),C&16&&(k.message=l[14]),r.$set(k),(!_||C&16)&&f!==(f=l[14].shorttime+"")&&R(d,f),(!_||C&16&&c!==(c=l[14].fulltime))&&u(o,"title",c),(!_||C&144&&m!==(m=Ee(l[7](l[14],l[16]))))&&u(t,"href",m),(!_||C&16)&&U(t,"font-weight-bold",l[14].unread)},i(w){_||(T(s.$$.fragment,w),T(r.$$.fragment,w),_=!0)},o(w){z(s.$$.fragment,w),z(r.$$.fragment,w),_=!1},d(w){w&&(D(e),D(t)),v&&v.d(w),W(s),W(r),b=!1,p()}}}function fa(l){let e,t=l[3].strings.nomessagesfound+"",s;return{c(){e=h("div"),s=E(t),u(e,"class","px-4 py-2 text-danger")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i&8&&t!==(t=n[3].strings.nomessagesfound+"")&&R(s,t)},d(n){n&&D(e)}}}function ua(l){let e,t,s,n=l[3].strings.searchallmessages+"",i,r,a,o;return{c(){e=h("div"),t=L(),s=h("a"),i=E(n),u(e,"class","dropdown-divider my-0"),u(s,"class","dropdown-item py-2"),u(s,"href",r=Ee(l[6]))},m(f,d){S(f,e,d),S(f,t,d),S(f,s,d),g(s,i),a||(o=J(s,"click",Te(l[12])),a=!0)},p(f,d){d&8&&n!==(n=f[3].strings.searchallmessages+"")&&R(i,n),d&64&&r!==(r=Ee(f[6]))&&u(s,"href",r)},d(f){f&&(D(e),D(t),D(s)),a=!1,o()}}}function ca(l){let e,t,s=l[1]&&l[4]!=null&&gl(l);return{c(){s&&s.c(),e=be()},m(n,i){s&&s.m(n,i),S(n,e,i),t=!0},p(n,[i]){n[1]&&n[4]!=null?s?(s.p(n,i),i&18&&T(s,1)):(s=gl(n),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(ie(),z(s,1,1,()=>{s=null}),re())},i(n){t||(T(s),t=!0)},o(n){z(s),t=!1},d(n){n&&D(e),s&&s.d(n)}}}const ot=10,ma=500;function da(l,e,t){let s,n,i,r=F,a=()=>(r(),r=_e(o,$=>t(3,i=$)),o);l.$$.on_destroy.push(()=>r());let{store:o}=e;a();let{enabled:f}=e,{content:d}=e,{loading:c=!1}=e,{onClick:m}=e,_,b,p=!1;const v=async $=>{t(9,c=!0),window.clearTimeout(_),t(11,_=window.setTimeout(async()=>{const k=i.params,A={methodname:"search_messages",query:{courseid:k.courseid,labelid:k.tray=="label"?k.labelid:void 0,draft:k.tray=="drafts"?!0:k.tray=="sent"?!1:void 0,roles:k.tray=="inbox"?Object.values(Ae):k.tray=="sent"?["from"]:void 0,starred:k.tray=="starred"?!0:void 0,deleted:k.tray=="trash",content:$.trim(),stopid:i.incrementalSearchStopId},limit:ot+1};let y;try{y=await Ye([A])}catch(j){o.setError(j),t(9,c=!1),t(4,b=void 0);return}t(9,c=!1),t(4,b=y[0]),t(5,p=b.length>ot||!!i.incrementalSearchStopId),t(4,b=b.slice(0,ot))},ma))},w=($,k)=>M=>{$.draft||(M.preventDefault(),m(s($,k)))};Ul(()=>{window.clearTimeout(_)});const C=()=>m(n);return l.$$set=$=>{"store"in $&&a(t(0,o=$.store)),"enabled"in $&&t(1,f=$.enabled),"content"in $&&t(10,d=$.content),"loading"in $&&t(9,c=$.loading),"onClick"in $&&t(2,m=$.onClick)},l.$$.update=()=>{l.$$.dirty&3074&&(f?v(d):(t(4,b=void 0),t(9,c=!1),window.clearTimeout(_))),l.$$.dirty&1032&&t(7,s=($,k)=>({...i.params,messageid:$.id,offset:k,search:{content:d.trim()}})),l.$$.dirty&1032&&t(6,n={...i.params,messageid:void 0,offset:0,search:{content:d.trim()}})},[o,f,m,i,b,p,n,s,w,c,d,_,C]}class _a extends ce{constructor(e){super(),me(this,e,da,ca,oe,{store:0,enabled:1,content:10,loading:9,onClick:2})}}function bl(l,e,t){const s=l.slice();return s[35]=e[t].label,s[36]=e[t].value,s[38]=t,s}function ga(l){let e,t,s,n=ue(l[15]),i=[];for(let r=0;r<n.length;r+=1)i[r]=kl(bl(l,n,r));return{c(){e=h("button");for(let r=0;r<i.length;r+=1)i[r].c();u(e,"type","button"),u(e,"class","local-mail-search-box-input-enabled alert-primary form-control text-left text-truncate")},m(r,a){S(r,e,a);for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(e,null);t||(s=J(e,"click",l[16]),t=!0)},p(r,a){if(a[0]&32768){n=ue(r[15]);let o;for(o=0;o<n.length;o+=1){const f=bl(r,n,o);i[o]?i[o].p(f,a):(i[o]=kl(f),i[o].c(),i[o].m(e,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d(r){r&&D(e),qe(i,r),t=!1,s()}}}function pa(l){let e,t,s,n,i;return{c(){e=h("input"),u(e,"type","text"),u(e,"class","local-mail-search-box-input form-control"),u(e,"placeholder",t=l[7].strings.search),u(e,"aria-label",s=l[7].strings.search),u(e,"autocomplete","off"),U(e,"local-mail-search-box-input-enabled",l[14]||l[13])},m(r,a){S(r,e,a),$e(e,l[1]),l[26](e),n||(i=[J(e,"input",l[25]),J(e,"keypress",l[21])],n=!0)},p(r,a){a[0]&128&&t!==(t=r[7].strings.search)&&u(e,"placeholder",t),a[0]&128&&s!==(s=r[7].strings.search)&&u(e,"aria-label",s),a[0]&2&&e.value!==r[1]&&$e(e,r[1]),a[0]&24576&&U(e,"local-mail-search-box-input-enabled",r[14]||r[13])},d(r){r&&D(e),l[26](null),n=!1,we(i)}}}function ba(l){let e;return{c(){e=h("span"),e.textContent=", ",u(e,"class","dimmed_text")},m(t,s){S(t,e,s)},d(t){t&&D(e)}}}function ha(l){let e,t=l[36]+"",s,n=l[35]&&hl(l);return{c(){n&&n.c(),e=L(),s=E(t)},m(i,r){n&&n.m(i,r),S(i,e,r),S(i,s,r)},p(i,r){i[35]?n?n.p(i,r):(n=hl(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),r[0]&32768&&t!==(t=i[36]+"")&&R(s,t)},d(i){i&&(D(e),D(s)),n&&n.d(i)}}}function ka(l){let e,t=l[35]+"",s;return{c(){e=h("span"),s=E(t),u(e,"class","dimmed_text")},m(n,i){S(n,e,i),g(e,s)},p(n,i){i[0]&32768&&t!==(t=n[35]+"")&&R(s,t)},d(n){n&&D(e)}}}function hl(l){let e,t=l[35]+"",s,n;return{c(){e=h("span"),s=E(t),n=E(":"),u(e,"class","dimmed_text")},m(i,r){S(i,e,r),g(e,s),g(e,n)},p(i,r){r[0]&32768&&t!==(t=i[35]+"")&&R(s,t)},d(i){i&&D(e)}}}function kl(l){let e,t,s=l[38]>0&&ba();function n(a,o){return a[36]===!0?ka:ha}let i=n(l),r=i(l);return{c(){s&&s.c(),e=L(),r.c(),t=be()},m(a,o){s&&s.m(a,o),S(a,e,o),r.m(a,o),S(a,t,o)},p(a,o){i===(i=n(a))&&r?r.p(a,o):(r.d(1),r=i(a),r&&(r.c(),r.m(t.parentNode,t)))},d(a){a&&(D(e),D(t)),s&&s.d(a),r.d(a)}}}function vl(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa-fw fa-times"),u(t,"aria-hidden","true"),u(e,"type","button"),u(e,"class","local-mail-search-box-icon btn px-0"),u(e,"title",s=l[7].strings.clearsearch)},m(r,a){S(r,e,a),g(e,t),n||(i=J(e,"click",Te(l[19])),n=!0)},p(r,a){a[0]&128&&s!==(s=r[7].strings.clearsearch)&&u(e,"title",s)},d(r){r&&D(e),n=!1,i()}}}function wl(l){let e,t,s,n,i,r,a;function o(b){l[28](b)}function f(b){l[29](b)}function d(b){l[30](b)}function c(b){l[31](b)}function m(b){l[32](b)}let _={store:l[0],submit:l[20],submitEnabled:l[13]};return l[2]!==void 0&&(_.sendername=l[2]),l[3]!==void 0&&(_.recipientname=l[3]),l[4]!==void 0&&(_.unread=l[4]),l[5]!==void 0&&(_.withfilesonly=l[5]),l[6]!==void 0&&(_.maxtime=l[6]),e=new ra({props:_}),l[27](e),Me.push(()=>Ve(e,"sendername",o)),Me.push(()=>Ve(e,"recipientname",f)),Me.push(()=>Ve(e,"unread",d)),Me.push(()=>Ve(e,"withfilesonly",c)),Me.push(()=>Ve(e,"maxtime",m)),{c(){K(e.$$.fragment)},m(b,p){Y(e,b,p),a=!0},p(b,p){const v={};p[0]&1&&(v.store=b[0]),p[0]&8192&&(v.submitEnabled=b[13]),!t&&p[0]&4&&(t=!0,v.sendername=b[2],Ke(()=>t=!1)),!s&&p[0]&8&&(s=!0,v.recipientname=b[3],Ke(()=>s=!1)),!n&&p[0]&16&&(n=!0,v.unread=b[4],Ke(()=>n=!1)),!i&&p[0]&32&&(i=!0,v.withfilesonly=b[5],Ke(()=>i=!1)),!r&&p[0]&64&&(r=!0,v.maxtime=b[6],Ke(()=>r=!1)),e.$set(v)},i(b){a||(T(e.$$.fragment,b),a=!0)},o(b){z(e.$$.fragment,b),a=!1},d(b){l[27](null),W(e,b)}}}function $l(l){let e,t,s;function n(r){l[33](r)}let i={store:l[0],enabled:l[8]&&!l[9]&&!!l[1].trim(),content:l[1],onClick:l[22]};return l[12]!==void 0&&(i.loading=l[12]),e=new _a({props:i}),Me.push(()=>Ve(e,"loading",n)),{c(){K(e.$$.fragment)},m(r,a){Y(e,r,a),s=!0},p(r,a){const o={};a[0]&1&&(o.store=r[0]),a[0]&770&&(o.enabled=r[8]&&!r[9]&&!!r[1].trim()),a[0]&2&&(o.content=r[1]),!t&&a[0]&4096&&(t=!0,o.loading=r[12],Ke(()=>t=!1)),e.$set(o)},i(r){s||(T(e.$$.fragment,r),s=!0)},o(r){z(e.$$.fragment,r),s=!1},d(r){W(e,r)}}}function va(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,w;function C(j,B){return j[8]?pa:ga}let $=C(l),k=$(l),M=(l[14]||l[13])&&vl(l),A=l[9]&&wl(l),y=l[7].settings.incrementalsearch&&$l(l);return{c(){e=h("form"),t=h("div"),s=h("i"),i=L(),k.c(),r=L(),a=h("div"),M&&M.c(),o=L(),f=h("button"),d=h("i"),_=L(),A&&A.c(),b=L(),y&&y.c(),u(s,"class",n="fa fa-fw "+(l[12]?"fa-spinner fa-pulse":"fa-search")),u(s,"aria-hidden","true"),u(t,"class","local-mail-search-box-icon position-absolute h-100 d-flex justify-content-center align-items-center px-0"),ge(t,"top","0"),ge(t,"left","0"),u(d,"class",c="fa fa-fw "+(l[9]?"fa-caret-up":"fa-sliders")),u(d,"aria-hidden","true"),u(f,"type","button"),u(f,"aria-expanded",l[9]),u(f,"class","local-mail-search-box-icon btn px-0"),u(f,"title",m=l[7].strings.searchoptions),u(a,"class","position-absolute h-100 d-flex align-items-center"),ge(a,"top","0"),ge(a,"right","0"),u(e,"class","local-mail-search-box position-relative")},m(j,B){S(j,e,B),g(e,t),g(t,s),g(e,i),k.m(e,null),g(e,r),g(e,a),M&&M.m(a,null),g(a,o),g(a,f),g(f,d),g(e,_),A&&A.m(e,null),g(e,b),y&&y.m(e,null),p=!0,v||(w=[J(f,"click",Te(l[18])),De(Fe.call(null,e,l[17]))],v=!0)},p(j,B){(!p||B[0]&4096&&n!==(n="fa fa-fw "+(j[12]?"fa-spinner fa-pulse":"fa-search")))&&u(s,"class",n),$===($=C(j))&&k?k.p(j,B):(k.d(1),k=$(j),k&&(k.c(),k.m(e,r))),j[14]||j[13]?M?M.p(j,B):(M=vl(j),M.c(),M.m(a,o)):M&&(M.d(1),M=null),(!p||B[0]&512&&c!==(c="fa fa-fw "+(j[9]?"fa-caret-up":"fa-sliders")))&&u(d,"class",c),(!p||B[0]&512)&&u(f,"aria-expanded",j[9]),(!p||B[0]&128&&m!==(m=j[7].strings.searchoptions))&&u(f,"title",m),j[9]?A?(A.p(j,B),B[0]&512&&T(A,1)):(A=wl(j),A.c(),T(A,1),A.m(e,b)):A&&(ie(),z(A,1,1,()=>{A=null}),re()),j[7].settings.incrementalsearch?y?(y.p(j,B),B[0]&128&&T(y,1)):(y=$l(j),y.c(),T(y,1),y.m(e,null)):y&&(ie(),z(y,1,1,()=>{y=null}),re())},i(j){p||(T(A),T(y),p=!0)},o(j){z(A),z(y),p=!1},d(j){j&&D(e),k.d(),M&&M.d(),A&&A.d(),y&&y.d(),v=!1,we(w)}}}function wa(l,e,t){let s,n,i,r,a,o,f=F,d=()=>(f(),f=_e(c,G=>t(7,o=G)),c);l.$$.on_destroy.push(()=>f());let{store:c}=e;d();let m=!o.params.search,_=!1,b,p,v="",w="",C="",$=!1,k=!1,M=0,A=!1;const y=G=>{t(1,v=(G==null?void 0:G.content)||""),t(2,w=(G==null?void 0:G.sendername)||""),t(3,C=(G==null?void 0:G.recipientname)||""),t(4,$=(G==null?void 0:G.unread)||!1),t(5,k=(G==null?void 0:G.withfilesonly)||!1),t(6,M=(G==null?void 0:G.maxtime)||0)},j=async()=>{t(8,m=!0),n&&t(9,_=!0),await Xe(),b.focus()},B=async()=>{t(8,m=!i),t(9,_=!1),y(s)},q=async()=>{_?(t(9,_=!1),await Xe(),b.focus()):(t(9,_=!0),j(),await Xe(),p.focus())},H=async()=>{t(8,m=!0),t(9,_=!1),y(),await c.navigate({...o.params,offset:void 0,search:void 0}),await Xe(),b.focus()},P=async()=>{await c.navigate({...o.params,messageid:void 0,offset:void 0,search:_?{content:v.trim(),sendername:w.trim(),recipientname:C.trim(),unread:$,withfilesonly:k,maxtime:M}:{content:v.trim()}}),t(9,_=!1),t(8,m=!1)},O=G=>{G.key=="Enter"&&(G.preventDefault(),r?P():H())},x=async G=>{await c.navigate(G),t(9,_=!1),t(8,m=!1)};function V(){v=this.value,t(1,v)}function te(G){Me[G?"unshift":"push"](()=>{b=G,t(10,b)})}function ae(G){Me[G?"unshift":"push"](()=>{p=G,t(11,p)})}function X(G){w=G,t(2,w)}function Q(G){C=G,t(3,C)}function N(G){$=G,t(4,$)}function I(G){k=G,t(5,k)}function se(G){M=G,t(6,M)}function le(G){A=G,t(12,A)}return l.$$set=G=>{"store"in G&&d(t(0,c=G.store))},l.$$.update=()=>{l.$$.dirty[0]&128&&t(23,s=o.params.search),l.$$.dirty[0]&8388608&&y(s),l.$$.dirty[0]&8388608&&t(24,n=!!(s!=null&&s.sendername||s!=null&&s.recipientname||s!=null&&s.unread||s!=null&&s.withfilesonly||s!=null&&s.maxtime)),l.$$.dirty[0]&25165824&&t(14,i=!!(s!=null&&s.content)||n),l.$$.dirty[0]&126&&t(13,r=!!(v.trim()||w.trim()||C.trim()||$||k||M)),l.$$.dirty[0]&254&&t(15,a=[{label:"",value:v},{label:o.strings.searchfrom,value:w},{label:o.strings.searchto,value:C},{label:o.strings.searchdate,value:M>0?new Date(M*1e3).toLocaleDateString():""},{label:o.strings.searchunreadonly,value:$},{label:o.strings.searchhasattachments,value:k}].filter(({value:G})=>!!G))},[c,v,w,C,$,k,M,o,m,_,b,p,A,r,i,a,j,B,q,H,P,O,x,s,n,V,te,ae,X,Q,N,I,se,le]}class $a extends ce{constructor(e){super(),me(this,e,wa,va,oe,{store:0},null,[-1,-1])}}function yl(l,e,t){const s=l.slice();return s[4]=e[t],s}function Ml(l){let e,t=l[1].strings.undo+"",s,n,i;function r(){return l[2](l[4])}return{c(){e=h("button"),s=E(t),u(e,"type","button"),u(e,"class","local-mail-toast-undo btn font-weight-bold px-2 py-0 ml-3")},m(a,o){S(a,e,o),g(e,s),n||(i=J(e,"click",r),n=!0)},p(a,o){l=a,o&2&&t!==(t=l[1].strings.undo+"")&&R(s,t)},d(a){a&&D(e),n=!1,i()}}}function Cl(l,e){let t,s,n,i=e[4].text+"",r,a,o,f,d,c,m,_,b,p,v=F,w,C,$,k=e[4].undo&&Ml(e);function M(){return e[3](e[4])}return{key:l,first:null,c(){t=h("div"),s=h("div"),n=h("div"),r=E(i),a=L(),k&&k.c(),o=L(),f=h("button"),d=h("i"),m=L(),u(n,"class","px-1 mr-auto"),u(d,"class","fa fa-times"),u(f,"type","button"),u(f,"class","btn px-2 py-0 ml-2 text-white-50"),u(f,"title",c=e[1].strings.close),u(s,"class","toast-body d-flex align-items-center p-2"),u(t,"class","toast mt-2 mb-0"),u(t,"role","alert"),u(t,"aria-live","assertive"),u(t,"aria-atomic","true"),u(t,"data-autohide","false"),this.first=t},m(A,y){S(A,t,y),g(t,s),g(s,n),g(n,r),g(s,a),k&&k.m(s,null),g(s,o),g(s,f),g(f,d),g(t,m),w=!0,C||($=J(f,"click",M),C=!0)},p(A,y){e=A,(!w||y&2)&&i!==(i=e[4].text+"")&&R(r,i),e[4].undo?k?k.p(e,y):(k=Ml(e),k.c(),k.m(s,o)):k&&(k.d(1),k=null),(!w||y&2&&c!==(c=e[1].strings.close))&&u(f,"title",c)},r(){p=t.getBoundingClientRect()},f(){Xl(t),v(),mt(t,p)},a(){v(),v=Wl(t,p,rn,{})},i(A){w||(je(()=>{w&&(b&&b.end(1),_=ct(t,rt,{y:50,delay:200}),_.start())}),w=!0)},o(A){_&&_.invalidate(),b=Jl(t,rt,{y:50,duration:400}),w=!1},d(A){A&&D(t),k&&k.d(),A&&b&&b.end(),C=!1,$()}}}function ya(l){let e,t=[],s=new Map,n,i=ue(l[1].toasts);const r=a=>a[4];for(let a=0;a<i.length;a+=1){let o=yl(l,i,a),f=r(o);s.set(f,t[a]=Cl(f,o))}return{c(){e=h("div");for(let a=0;a<t.length;a+=1)t[a].c();u(e,"aria-live","polite"),u(e,"aria-atomic","true"),u(e,"class","local-mail-toasts position-fixed d-flex flex-column-reverse p-3")},m(a,o){S(a,e,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,[o]){if(o&3){i=ue(a[1].toasts),ie();for(let f=0;f<t.length;f+=1)t[f].r();t=Le(t,o,r,1,a,i,s,e,Ol,Cl,null,yl);for(let f=0;f<t.length;f+=1)t[f].a();re()}},i(a){if(!n){for(let o=0;o<i.length;o+=1)T(t[o]);n=!0}},o(a){for(let o=0;o<t.length;o+=1)z(t[o]);n=!1},d(a){a&&D(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Ma(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=f=>r.undo(f),o=f=>r.hideToast(f);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,a,o]}class Ca extends ce{constructor(e){super(),me(this,e,Ma,ya,oe,{store:0})}}function Sa(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),u(t,"class","fa fa fa-fw fa-arrow-left"),u(e,"type","button"),u(e,"class","local-mail-back-button btn btn-secondary"),u(e,"title",s=l[1].strings.messagelist)},m(r,a){S(r,e,a),g(e,t),n||(i=J(e,"click",l[2]),n=!0)},p(r,[a]){a&2&&s!==(s=r[1].strings.messagelist)&&u(e,"title",s)},i:F,o:F,d(r){r&&D(e),n=!1,i()}}}function Da(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.navigateToList();return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class Ta extends ce{constructor(e){super(),me(this,e,Da,Sa,oe,{store:0})}}function Sl(l){let e,t,s=l[1].strings.all+"",n,i,r,a=l[1].strings.none+"",o,f,d,c=l[1].strings.read+"",m,_,b,p=l[1].strings.unread+"",v,w,C,$=l[1].strings.starred+"",k,M,A,y=l[1].strings.unstarred+"",j,B,q;return{c(){e=h("div"),t=h("button"),n=E(s),i=L(),r=h("button"),o=E(a),f=L(),d=h("button"),m=E(c),_=L(),b=h("button"),v=E(p),w=L(),C=h("button"),k=E($),M=L(),A=h("button"),j=E(y),u(t,"type","button"),u(t,"class","dropdown-item"),u(r,"type","button"),u(r,"class","dropdown-item"),u(d,"type","button"),u(d,"class","dropdown-item"),u(b,"type","button"),u(b,"class","dropdown-item"),u(C,"type","button"),u(C,"class","dropdown-item"),u(A,"type","button"),u(A,"class","dropdown-item"),u(e,"class","dropdown-menu show")},m(H,P){S(H,e,P),g(e,t),g(t,n),g(e,i),g(e,r),g(r,o),g(e,f),g(e,d),g(d,m),g(e,_),g(e,b),g(b,v),g(e,w),g(e,C),g(C,k),g(e,M),g(e,A),g(A,j),B||(q=[J(t,"click",l[7]),J(r,"click",l[8]),J(d,"click",l[9]),J(b,"click",l[10]),J(C,"click",l[11]),J(A,"click",l[12])],B=!0)},p(H,P){P&2&&s!==(s=H[1].strings.all+"")&&R(n,s),P&2&&a!==(a=H[1].strings.none+"")&&R(o,a),P&2&&c!==(c=H[1].strings.read+"")&&R(m,c),P&2&&p!==(p=H[1].strings.unread+"")&&R(v,p),P&2&&$!==($=H[1].strings.starred+"")&&R(k,$),P&2&&y!==(y=H[1].strings.unstarred+"")&&R(j,y)},d(H){H&&D(e),B=!1,we(q)}}}function La(l){let e,t,s,n,i,r,a,o,f=l[2]&&Sl(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=L(),f&&f.c(),u(s,"class",n="fa fa-fw "+l[3]),u(t,"class","btn btn-secondary dropdown-toggle"),u(t,"aria-expanded",l[2]),u(t,"title",i=l[1].strings.select),u(e,"class","btn-group"),u(e,"role","group")},m(d,c){S(d,e,c),g(e,t),g(t,s),g(e,r),f&&f.m(e,null),a||(o=[J(t,"click",l[5]),De(Fe.call(null,e,l[4]))],a=!0)},p(d,[c]){c&8&&n!==(n="fa fa-fw "+d[3])&&u(s,"class",n),c&4&&u(t,"aria-expanded",d[2]),c&2&&i!==(i=d[1].strings.select)&&u(t,"title",i),d[2]?f?f.p(d,c):(f=Sl(d),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:F,o:F,d(d){d&&D(e),f&&f.d(),a=!1,we(o)}}}function za(l,e,t){let s,n,i=F,r=()=>(i(),i=_e(a,C=>t(1,n=C)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let o=!1;const f=()=>{t(2,o=!1)},d=()=>{t(2,o=!o)},c=C=>{f(),a.selectAll(C)},m=()=>c("all"),_=()=>c("none"),b=()=>c("read"),p=()=>c("unread"),v=()=>c("starred"),w=()=>c("unstarred");return l.$$set=C=>{"store"in C&&r(t(0,a=C.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=n.selectedMessages.size==0?"fa-square-o":n.selectedMessages.size<n.listMessages.length?"fa-minus-square-o":"fa-check-square-o")},[a,n,o,s,f,d,c,m,_,b,p,v,w]}class ja extends ce{constructor(e){super(),me(this,e,za,La,oe,{store:0})}}function Na(l){let e,t;return e=new ja({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Aa(l){let e,t;return e=new Ta({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Dl(l){let e,t,s,n,i,r;const a=[qa,Ba],o=[];function f(d,c){return d[1].params.tray=="trash"?0:1}return t=f(l),s=o[t]=a[t](l),i=new sn({props:{store:l[0]}}),{c(){e=h("div"),s.c(),n=L(),K(i.$$.fragment),u(e,"class","btn-group"),u(e,"role","group")},m(d,c){S(d,e,c),o[t].m(e,null),g(e,n),Y(i,e,null),r=!0},p(d,c){let m=t;t=f(d),t===m?o[t].p(d,c):(ie(),z(o[m],1,1,()=>{o[m]=null}),re(),s=o[t],s?s.p(d,c):(s=o[t]=a[t](d),s.c()),T(s,1),s.m(e,n));const _={};c&1&&(_.store=d[0]),i.$set(_)},i(d){r||(T(s),T(i.$$.fragment,d),r=!0)},o(d){z(s),z(i.$$.fragment,d),r=!1},d(d){d&&D(e),o[t].d(),W(i)}}}function Ba(l){let e,t,s,n;return e=new tn({props:{store:l[0]}}),s=new Zl({props:{store:l[0]}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){Y(e,i,r),S(i,t,r),Y(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function qa(l){let e,t,s,n;return e=new nn({props:{store:l[0]}}),s=new xl({props:{store:l[0]}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){Y(e,i,r),S(i,t,r),Y(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function Tl(l){let e,t,s;return t=new Vl({props:{settings:l[1].settings,strings:l[1].strings,courses:l[1].courses,label:l[1].strings.allcourses,selected:l[1].params.courseid,readonly:l[1].params.tray=="course",onChange:l[2],primary:!0,style:l[1].viewportSize>=de.MD?"filter-left":"filter-right"}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","d-flex flex-grow-1 ml-auto mr-0 ml-md-0 mr-md-auto"),ge(e,"max-width","20rem"),ge(e,"min-width","0")},m(n,i){S(n,e,i),Y(t,e,null),s=!0},p(n,i){const r={};i&2&&(r.settings=n[1].settings),i&2&&(r.strings=n[1].strings),i&2&&(r.courses=n[1].courses),i&2&&(r.label=n[1].strings.allcourses),i&2&&(r.selected=n[1].params.courseid),i&2&&(r.readonly=n[1].params.tray=="course"),i&1&&(r.onChange=n[2]),i&2&&(r.style=n[1].viewportSize>=de.MD?"filter-left":"filter-right"),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function Ia(l){let e,t;return e=new _n({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Ea(l){let e,t;return e=new ln({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Pa(l){var $;let e,t,s,n,i,r=!(($=l[1].message)!=null&&$.draft)&&["shortname","fullname"].includes(l[1].settings.filterbycourse)&&l[1].viewportSize<de.LG,a,o,f,d;const c=[Aa,Na],m=[];function _(k,M){return k[1].message?0:1}t=_(l),s=m[t]=c[t](l);let b=l[1].viewportSize>=de.MD&&Dl(l),p=r&&Tl(l);const v=[Ea,Ia],w=[];function C(k,M){var A;return k[1].viewportSize>=de.MD?0:(A=k[1].message)!=null&&A.draft?1:-1}return~(o=C(l))&&(f=w[o]=v[o](l)),{c(){e=h("div"),s.c(),n=L(),b&&b.c(),i=L(),p&&p.c(),a=L(),f&&f.c(),u(e,"role","toolbar"),u(e,"class","local-mail-toolbar d-flex w-100")},m(k,M){S(k,e,M),m[t].m(e,null),g(e,n),b&&b.m(e,null),g(e,i),p&&p.m(e,null),g(e,a),~o&&w[o].m(e,null),d=!0},p(k,[M]){var j;let A=t;t=_(k),t===A?m[t].p(k,M):(ie(),z(m[A],1,1,()=>{m[A]=null}),re(),s=m[t],s?s.p(k,M):(s=m[t]=c[t](k),s.c()),T(s,1),s.m(e,n)),k[1].viewportSize>=de.MD?b?(b.p(k,M),M&2&&T(b,1)):(b=Dl(k),b.c(),T(b,1),b.m(e,i)):b&&(ie(),z(b,1,1,()=>{b=null}),re()),M&2&&(r=!((j=k[1].message)!=null&&j.draft)&&["shortname","fullname"].includes(k[1].settings.filterbycourse)&&k[1].viewportSize<de.LG),r?p?(p.p(k,M),M&2&&T(p,1)):(p=Tl(k),p.c(),T(p,1),p.m(e,a)):p&&(ie(),z(p,1,1,()=>{p=null}),re());let y=o;o=C(k),o===y?~o&&w[o].p(k,M):(f&&(ie(),z(w[y],1,1,()=>{w[y]=null}),re()),~o?(f=w[o],f?f.p(k,M):(f=w[o]=v[o](k),f.c()),T(f,1),f.m(e,null)):f=null)},i(k){d||(T(s),T(b),T(p),T(f),d=!0)},o(k){z(s),z(b),z(p),z(f),d=!1},d(k){k&&D(e),m[t].d(),b&&b.d(),p&&p.d(),~o&&w[o].d()}}}function Ra(l,e,t){let s,n=F,i=()=>(n(),n=_e(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=o=>r.selectCourse(o);return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class Fa extends ce{constructor(e){super(),me(this,e,Ra,Pa,oe,{store:0})}}const{window:st}=xe;function Ll(l){let e,t;return e=new qn({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Ga(l){let e,t=l[3].strings.pluginname+"",s,n,i=l[2]&&l[3].viewportSize<de.LG&&zl(l);return{c(){e=h("h1"),s=E(t),n=L(),i&&i.c(),u(e,"class","h2 local-mail-view-side-column text-truncate mb-4")},m(r,a){S(r,e,a),g(e,s),g(e,n),i&&i.m(e,null)},p(r,a){a&8&&t!==(t=r[3].strings.pluginname+"")&&R(s,t),r[2]&&r[3].viewportSize<de.LG?i?i.p(r,a):(i=zl(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(r){r&&D(e),i&&i.d()}}}function Ua(l){let e;return{c(){e=h("div"),u(e,"class","local-mail-view-side-column")},m(t,s){S(t,e,s)},p:F,d(t){t&&D(e)}}}function zl(l){let e,t,s;return{c(){e=h("i"),t=L(),s=E(l[2]),u(e,"class","fa fa-angle-right mx-1"),u(e,"aria-hidden","true")},m(n,i){S(n,e,i),S(n,t,i),S(n,s,i)},p(n,i){i&4&&R(s,n[2])},d(n){n&&(D(e),D(t),D(s))}}}function jl(l){let e,t,s;return t=new $a({props:{store:l[0]}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","local-mail-view-search")},m(n,i){S(n,e,i),Y(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function Nl(l){let e,t,s,n;e=new Kl({props:{strings:l[3].strings,iconOnly:l[1]&&l[3].viewportSize<de.SM,onClick:l[12]}});let i=!l[1]&&Al(l);return{c(){K(e.$$.fragment),t=L(),i&&i.c(),s=be()},m(r,a){Y(e,r,a),S(r,t,a),i&&i.m(r,a),S(r,s,a),n=!0},p(r,a){const o={};a&8&&(o.strings=r[3].strings),a&10&&(o.iconOnly=r[1]&&r[3].viewportSize<de.SM),a&1&&(o.onClick=r[12]),e.$set(o),r[1]?i&&(ie(),z(i,1,1,()=>{i=null}),re()):i?(i.p(r,a),a&2&&T(i,1)):(i=Al(r),i.c(),T(i,1),i.m(s.parentNode,s))},i(r){n||(T(e.$$.fragment,r),T(i),n=!0)},o(r){z(e.$$.fragment,r),z(i),n=!1},d(r){r&&(D(t),D(s)),W(e,r),i&&i.d(r)}}}function Al(l){let e,t,s;return t=new Sn({props:{strings:l[3].strings,onClick:l[13]}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","ml-auto")},m(n,i){S(n,e,i),Y(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[13]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function Bl(l){let e,t,s,n=l[3].viewportSize>=de.LG&&ql(l),i=l[1]&&Il(l);return{c(){e=h("div"),n&&n.c(),t=L(),i&&i.c(),u(e,"class","row mb-3")},m(r,a){S(r,e,a),n&&n.m(e,null),g(e,t),i&&i.m(e,null),s=!0},p(r,a){r[3].viewportSize>=de.LG?n?(n.p(r,a),a&8&&T(n,1)):(n=ql(r),n.c(),T(n,1),n.m(e,t)):n&&(ie(),z(n,1,1,()=>{n=null}),re()),r[1]?i?(i.p(r,a),a&2&&T(i,1)):(i=Il(r),i.c(),T(i,1),i.m(e,null)):i&&(ie(),z(i,1,1,()=>{i=null}),re())},i(r){s||(T(n),T(i),s=!0)},o(r){z(n),z(i),s=!1},d(r){r&&D(e),n&&n.d(),i&&i.d()}}}function ql(l){let e,t,s;return t=new Kl({props:{strings:l[3].strings,onClick:l[14]}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","local-mail-view-side-column")},m(n,i){S(n,e,i),Y(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[14]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function Il(l){let e,t,s;return t=new Fa({props:{store:l[0]}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","local-mail-view-main-column d-flex")},m(n,i){S(n,e,i),Y(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function El(l){let e,t,s;return t=new Dn({props:{settings:l[3].settings,strings:l[3].strings,courses:l[3].courses,labels:l[3].labels,params:l[3].params,onClick:l[0].navigate,onCourseChange:l[0].selectCourse}}),{c(){e=h("div"),K(t.$$.fragment),u(e,"class","local-mail-view-side-column")},m(n,i){S(n,e,i),Y(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.settings=n[3].settings),i&8&&(r.strings=n[3].strings),i&8&&(r.courses=n[3].courses),i&8&&(r.labels=n[3].labels),i&8&&(r.params=n[3].params),i&1&&(r.onClick=n[0].navigate),i&1&&(r.onCourseChange=n[0].selectCourse),t.$set(r)},i(n){s||(T(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&D(e),W(t)}}}function Pl(l){let e,t,s,n;const i=[Ja,Oa,Ha],r=[];function a(o,f){var d;return(d=o[3].message)!=null&&d.draft&&o[3].draftForm?0:o[3].message?1:2}return t=a(l),s=r[t]=i[t](l),{c(){e=h("div"),s.c(),u(e,"class","local-mail-view-main-column")},m(o,f){S(o,e,f),r[t].m(e,null),n=!0},p(o,f){let d=t;t=a(o),t===d?r[t].p(o,f):(ie(),z(r[d],1,1,()=>{r[d]=null}),re(),s=r[t],s?s.p(o,f):(s=r[t]=i[t](o),s.c()),T(s,1),s.m(e,null))},i(o){n||(T(s),n=!0)},o(o){z(s),n=!1},d(o){o&&D(e),r[t].d()}}}function Ha(l){let e,t,s,n;return e=new Qi({props:{store:l[0]}}),s=new Xr({props:{store:l[0]}}),{c(){K(e.$$.fragment),t=L(),K(s.$$.fragment)},m(i,r){Y(e,i,r),S(i,t,r),Y(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(T(e.$$.fragment,i),T(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&D(t),W(e,i),W(s,i)}}}function Oa(l){let e,t;return e=new $r({props:{store:l[0],message:l[3].message}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Ja(l){let e,t;return e=new Kr({props:{store:l[0],message:l[3].message,form:l[3].draftForm}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),n&8&&(i.form=s[3].draftForm),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Rl(l){let e,t;return e=new Ci({props:{store:l[0]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Fl(l){let e,t;return e=new ea({props:{store:l[0],onCancel:l[15]}}),{c(){K(e.$$.fragment)},m(s,n){Y(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[15]),e.$set(i)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){W(e,s)}}}function Va(l){let e,t,s,n,i,r,a,o,f,d,c,m,_,b,p,v,w,C,$,k,M,A;document.title=t=l[5]+" - "+l[3].strings.pluginname;let y=!l[3].mobile&&Ll(l);function j(X,Q){return X[3].mobile&&X[3].viewportSize<de.LG?Ua:Ga}let B=j(l),q=B(l),H=l[1]&&jl(l),P=l[3].viewportSize<de.LG&&Nl(l),O=(l[1]||l[3].viewportSize>=de.LG)&&Bl(l),x=(!l[1]||l[3].viewportSize>=de.LG)&&El(l),V=l[1]&&Pl(l),te=l[1]&&l[3].viewportSize<de.MD&&Rl(l),ae=l[3].params.dialog=="preferences"&&Fl(l);return w=new Ca({props:{store:l[0]}}),$=new Un({props:{store:l[0]}}),{c(){e=L(),s=L(),n=h("div"),y&&y.c(),i=L(),r=h("div"),q.c(),a=L(),o=h("div"),H&&H.c(),f=L(),P&&P.c(),d=L(),O&&O.c(),c=L(),m=h("div"),x&&x.c(),_=L(),V&&V.c(),b=L(),te&&te.c(),p=L(),ae&&ae.c(),v=L(),K(w.$$.fragment),C=L(),K($.$$.fragment),u(o,"class","local-mail-view-main-column d-flex mb-3"),U(o,"mb-4",l[3].viewportSize>=de.LG),u(r,"class","row align-items-center"),u(m,"class","row mb-3"),u(n,"class","local-mail local-mail-view container-fluid pt-2"),U(n,"p-4",!l[3].mobile),U(n,"local-mail-loading",l[3].loading)},m(X,Q){S(X,e,Q),S(X,s,Q),S(X,n,Q),y&&y.m(n,null),g(n,i),g(n,r),q.m(r,null),g(r,a),g(r,o),H&&H.m(o,null),g(o,f),P&&P.m(o,null),g(n,d),O&&O.m(n,null),g(n,c),g(n,m),x&&x.m(m,null),g(m,_),V&&V.m(m,null),g(n,b),te&&te.m(n,null),g(n,p),ae&&ae.m(n,null),g(n,v),Y(w,n,null),g(n,C),Y($,n,null),l[16](n),k=!0,M||(A=[J(st,"resize",l[10]),J(st,"popstate",l[11]),J(st,"beforeunload",l[6]),J(st,"message",l[7]),J(document,"click",function(){Ce(l[3].mobile?l[8]:void 0)&&(l[3].mobile?l[8]:void 0).apply(this,arguments)})],M=!0)},p(X,[Q]){l=X,(!k||Q&40)&&t!==(t=l[5]+" - "+l[3].strings.pluginname)&&(document.title=t),l[3].mobile?y&&(ie(),z(y,1,1,()=>{y=null}),re()):y?(y.p(l,Q),Q&8&&T(y,1)):(y=Ll(l),y.c(),T(y,1),y.m(n,i)),B===(B=j(l))&&q?q.p(l,Q):(q.d(1),q=B(l),q&&(q.c(),q.m(r,a))),l[1]?H?(H.p(l,Q),Q&2&&T(H,1)):(H=jl(l),H.c(),T(H,1),H.m(o,f)):H&&(ie(),z(H,1,1,()=>{H=null}),re()),l[3].viewportSize<de.LG?P?(P.p(l,Q),Q&8&&T(P,1)):(P=Nl(l),P.c(),T(P,1),P.m(o,null)):P&&(ie(),z(P,1,1,()=>{P=null}),re()),(!k||Q&8)&&U(o,"mb-4",l[3].viewportSize>=de.LG),l[1]||l[3].viewportSize>=de.LG?O?(O.p(l,Q),Q&10&&T(O,1)):(O=Bl(l),O.c(),T(O,1),O.m(n,c)):O&&(ie(),z(O,1,1,()=>{O=null}),re()),!l[1]||l[3].viewportSize>=de.LG?x?(x.p(l,Q),Q&10&&T(x,1)):(x=El(l),x.c(),T(x,1),x.m(m,_)):x&&(ie(),z(x,1,1,()=>{x=null}),re()),l[1]?V?(V.p(l,Q),Q&2&&T(V,1)):(V=Pl(l),V.c(),T(V,1),V.m(m,null)):V&&(ie(),z(V,1,1,()=>{V=null}),re()),l[1]&&l[3].viewportSize<de.MD?te?(te.p(l,Q),Q&10&&T(te,1)):(te=Rl(l),te.c(),T(te,1),te.m(n,p)):te&&(ie(),z(te,1,1,()=>{te=null}),re()),l[3].params.dialog=="preferences"?ae?(ae.p(l,Q),Q&8&&T(ae,1)):(ae=Fl(l),ae.c(),T(ae,1),ae.m(n,v)):ae&&(ie(),z(ae,1,1,()=>{ae=null}),re());const N={};Q&1&&(N.store=l[0]),w.$set(N);const I={};Q&1&&(I.store=l[0]),$.$set(I),(!k||Q&8)&&U(n,"p-4",!l[3].mobile),(!k||Q&8)&&U(n,"local-mail-loading",l[3].loading)},i(X){k||(T(y),T(H),T(P),T(O),T(x),T(V),T(te),T(ae),T(w.$$.fragment,X),T($.$$.fragment,X),k=!0)},o(X){z(y),z(H),z(P),z(O),z(x),z(V),z(te),z(ae),z(w.$$.fragment,X),z($.$$.fragment,X),k=!1},d(X){X&&(D(e),D(s),D(n)),y&&y.d(),q.d(),H&&H.d(),P&&P.d(),O&&O.d(),x&&x.d(),V&&V.d(),te&&te.d(),ae&&ae.d(),W(w),W($),l[16](null),M=!1,we(A)}}}function Ka(l,e,t){let s,n,i,r,a,o=F,f=()=>(o(),o=_e(d,y=>t(3,a=y)),d);l.$$.on_destroy.push(()=>o());let{store:d}=e;f();let c,m=0;Qe(()=>{d.setViewportSize(window.innerWidth)}),Cn(()=>{if(m!=a.navigationId){m=a.navigationId;let y=c.parentElement;for(;y;)y.scrollTop>0&&y.scrollTo({top:0}),y=y.parentElement}});const _=y=>{if(a.draftData)return y.preventDefault(),d.updateDraft(a.draftData,!0),""},b=y=>{a.mobile&&y.data.addon=="local_mail"&&y.data.backClicked&&d.navigateToMenu()},p=y=>{var j;if(a.mobile&&!y.defaultPrevented&&y.target instanceof HTMLElement){const B=y.target.closest("a");B&&((j=window.parent)==null||j.postMessage({addon:"local_mail",openUrl:B.href},"*")),y.defaultPrevented||y.preventDefault()}},v=()=>d.setViewportSize(window.innerWidth),w=()=>d.navigate(Yl()),C=()=>d.createMessage(),$=()=>d.showDialog("preferences"),k=()=>d.createMessage(),M=()=>d.hideDialog();function A(y){Me[y?"unshift":"push"](()=>{c=y,t(4,c)})}return l.$$set=y=>{"store"in y&&f(t(0,d=y.store))},l.$$.update=()=>{var y,j,B;l.$$.dirty&8&&t(1,s=a.params.tray),l.$$.dirty&10&&t(2,n=s=="inbox"?a.strings.inbox:s=="starred"?a.strings.starredplural:s=="sent"?a.strings.sentplural:s=="drafts"?a.strings.drafts:s=="trash"?a.strings.trash:s=="label"?((y=a.labels.find(q=>q.id==a.params.labelid))==null?void 0:y.name)||"":s=="course"&&((j=a.courses.find(q=>q.id==a.params.courseid))==null?void 0:j.fullname)||""),l.$$.dirty&12&&t(5,i=a.message?a.message.subject.trim()||a.strings.nosubject:n),l.$$.dirty&12&&t(9,r=a.viewportSize<de.LG?n||a.strings.pluginname:""),l.$$.dirty&514&&((B=window.parent)==null||B.postMessage({addon:"local_mail",setTitle:r,captureBack:s!=null},"*"))},[d,s,n,a,c,i,_,b,p,r,v,w,C,$,k,M,A]}class Ya extends ce{constructor(e){super(),me(this,e,Ka,Va,oe,{store:0})}}const Je=[];function Wa(l,e=F){let t;const s=new Set;function n(a){if(Tn(l,a)&&(l=a,t)){const o=!Je.length;for(const f of s)f[1](),Je.push(f,l);if(o){for(let f=0;f<Je.length;f+=2)Je[f][0](Je[f+1]);Je.length=0}}}function i(a){n(a(l))}function r(a,o=F){const f=[a,o];return s.add(f),s.size===1&&(t=e(n,i)||F),a(l),()=>{s.delete(f),s.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:r}}async function Xa(l){let e=0,t=0,s={userid:l.userid,settings:l.settings,preferences:l.preferences,strings:l.strings,mobile:l.mobile,params:{},unread:0,drafts:0,courses:[],labels:[],totalCount:0,listMessages:[],loading:!0,selectedMessages:new Map,toasts:[],navigationId:0,viewportSize:0};const{subscribe:n,set:i}=Wa(s),r=N=>i({...s,...N});n(N=>{s=N});const a=async(N,I,se=!1)=>{var kt,vt,wt,$t,yt;const le=++e,G=(kt=s.message)==null?void 0:kt.id,fe=s.draftData,ee=I||s.params,he=!se&&(ee.tray!=s.params.tray||ee.messageid!=s.params.messageid||ee.courseid!=s.params.courseid||ee.labelid!=s.params.labelid||ee.search!=s.params.search)?{...s.params,dialog:void 0}:s.prevParams,Z=s.preferences.perpage;if(r({loading:!0,error:void 0}),at(ee,se),G&&fe&&(window.clearTimeout(t),N.unshift({methodname:"update_message",messageid:G,data:fe})),N.push({methodname:"get_courses"}),N.push({methodname:"get_labels"}),ee.tray){const ve={courseid:ee.courseid,labelid:ee.tray=="label"?ee.labelid:void 0,draft:ee.tray=="drafts"?!0:ee.tray=="sent"?!1:void 0,roles:ee.tray=="inbox"?["to","cc","bcc"]:ee.tray=="sent"?["from"]:void 0,starred:ee.tray=="starred"?!0:void 0,deleted:ee.tray=="trash"};N.push({methodname:"count_messages",query:ve}),ee.messageid?(N.push({methodname:"get_message",messageid:ee.messageid}),N.push({methodname:"search_messages",query:{...ve,...ee.search,startid:ee.messageid,reverse:!1},limit:1}),N.push({methodname:"search_messages",query:{...ve,...ee.search,startid:ee.messageid,reverse:!0},limit:1}),ee.search||N.push({methodname:"count_messages",query:{...ve,startid:ee.messageid,reverse:!0}})):N.push({methodname:"search_messages",query:{...ve,...ee.search},offset:ee.search?void 0:ee.offset,limit:ee.search?Z+1:Z})}let ne;try{ne=await Ye(N)}catch(ve){return j(ve),null}let pe,Se,ze,ye,ke=[],He=0;ee.tray&&(ee.messageid?(ee.search||(Se=ne.pop()),ye=(vt=ne.pop()[0])==null?void 0:vt.id,ze=(wt=ne.pop()[0])==null?void 0:wt.id,pe=ne.pop()):(ke=ne.pop(),ee.search&&(ee.search.reverse?(ye=($t=ke[Z])==null?void 0:$t.id,ze=ee.search.startid,ke=ke.slice(0,Z).reverse()):(ye=ee.search.startid,ze=(yt=ke[Z])==null?void 0:yt.id,ke=ke.slice(0,Z)))),He=ne.pop());const bt=ne.pop(),tt=ne.pop();if(G&&fe&&ne.shift(),ee.tray=="course"&&!tt.find(ve=>ve.id==ee.courseid)||ee.tray=="label"&&!bt.find(ve=>ve.id==ee.labelid))return await p({tray:"inbox"},!0),ne;let ht;if(pe!=null&&pe.draft&&(pe==null?void 0:pe.id)!=G){const ve=[{methodname:"get_message_form",messageid:pe.id}];let Oe;try{Oe=await Ye(ve)}catch(gn){return j(gn),null}ht=Oe.pop()}return le!=e||(r({params:ee,prevParams:he,unread:tt.reduce((ve,Oe)=>ve+Oe.unread,0),drafts:tt.reduce((ve,Oe)=>ve+Oe.drafts,0),courses:tt,labels:bt,messageOffset:Se,totalCount:He,listMessages:ke,message:pe,nextMessageId:ze,prevMessageId:ye,draftForm:(pe==null?void 0:pe.id)!=G?ht:s.draftForm,draftData:void 0,draftSaved:(pe==null?void 0:pe.id)==G?fe==null:!1,selectedMessages:new Map(pe?[[pe.id,pe]]:s.message?[]:ke.filter(ve=>s.selectedMessages.has(ve.id)).map(ve=>[ve.id,ve])),loading:!1,navigationId:se||ee.tray!=s.params.tray||ee.courseid!=s.params.courseid||ee.labelid!=s.params.labelid||ee.messageid!=s.params.messageid||ee.offset!=s.params.offset?s.navigationId+1:s.navigationId}),G&&fe&&G!=(pe==null?void 0:pe.id)&&x({text:s.strings.draftsaved})),ne},o=async(N,I)=>{const le=await a([{methodname:"create_label",name:N,color:I}]);return le==null?void 0:le.pop()},f=async N=>{N=N||s.params.courseid||s.courses[0].id;const I={methodname:"create_message",courseid:N};let se;try{se=await Ye([I])}catch(le){j(le);return}await p({tray:"drafts",messageid:se.pop(),courseid:N})},d=async N=>{await a([{methodname:"delete_label",labelid:N}],{tray:"inbox"})},c=async N=>{await a([{methodname:"empty_trash",courseid:N}])},m=async N=>{const I=s.params,se={methodname:"forward_message",messageid:N.id},le=await a([se]);le!=null&&await p({tray:"drafts",messageid:le.pop(),courseid:I.courseid?N.course.id:void 0})},_=()=>{const N={...s.params,dialog:void 0};r({params:N}),at(N,!0)},b=N=>{r({toasts:s.toasts.filter(I=>I!=N)})},p=async(N,I=!1,se=!0)=>{var fe;const le=[];se&&s.settings.incrementalsearch&&le.push({methodname:"search_messages",query:{deleted:!1},offset:s.settings.incrementalsearchlimit,limit:1}),N!=null&&N.messageid&&le.push({methodname:"view_message",messageid:N.messageid});const G=await a(le,N,I);if(G!=null&&se&&s.settings.incrementalsearch){const ee=G[0];r({incrementalSearchStopId:(fe=ee[0])==null?void 0:fe.id})}},v=async(N=!1)=>{const I={...s.params,messageid:void 0,offset:Math.floor((s.params.offset||0)/s.preferences.perpage)*s.preferences.perpage||void 0};await a([],I,N)},w=async()=>{await a([],{})},C=async(N,I)=>{const se=s.params,le={methodname:"reply_message",messageid:N.id,all:I},G=await a([le]);G!=null&&await p({tray:"drafts",messageid:G.pop(),courseid:se.courseid?N.course.id:void 0})},$=async N=>{r({preferences:{...s.preferences,...N}});let I=s.params;N.perpage&&(I={...I,offset:s.params.offset?Math.trunc(s.params.offset/N.perpage)*N.perpage:void 0}),await a([{methodname:"set_preferences",preferences:N}],I,!0)},k=N=>{r({selectedMessages:new Map(s.listMessages.filter(I=>N=="all"||N=="read"&&!I.unread||N=="unread"&&I.unread||N=="starred"&&I.starred||N=="unstarred"&&!I.starred).map(I=>[I.id,I]))})},M=async N=>{await p({...s.params,courseid:N,offset:0,messageid:void 0,search:s.params.search?{...s.params.search,startid:void 0,reverse:void 0}:void 0})},A=async()=>{var le;if(!((le=s.message)!=null&&le.draft))return;const N={methodname:"send_message",messageid:s.message.id},I=s.prevParams?{...s.prevParams,messageid:void 0,offset:Math.floor((s.prevParams.offset||0)/s.preferences.perpage)*s.preferences.perpage||void 0}:["shortname","fullname"].includes(s.settings.filterbycourse)?{tray:"inbox",courseid:s.message.course.id}:{tray:"course",courseid:s.message.course.id};await a([N],I)!=null&&x({text:s.strings.messagesent})},y=async(N,I,se)=>{const le=N.map(ee=>({methodname:"set_deleted",messageid:ee,deleted:I})),G={...s.params,messageid:void 0};if(await a(le,G,!0)!=null&&I!=Pe.DeletedForever){const ee=I?N.length>1?"messagesmovedtotrash":"messagemovedtotrash":N.length>1?"messagesrestored":"messagerestored",he=Ne(s.strings[ee],N.length);x({text:he,undo:se?()=>{y(N,I?Pe.NotDeleted:Pe.Deleted,!1)}:void 0})}},j=async N=>{r({loading:s.loading&&!N,error:N})},B=async(N,I)=>{Q(le=>s.selectedMessages.has(le.id)?{...le,labels:s.labels.filter(G=>N.includes(G.id)?!0:I.includes(G.id)?!1:le.labels.findIndex(fe=>fe.id==G.id)>=0)}:le);const se=[];s.selectedMessages.forEach(le=>{se.push({methodname:"set_labels",messageid:le.id,labelids:le.labels.map(G=>G.id)})}),await a(se)},q=async(N,I)=>{Q(le=>N.includes(le.id)?{...le,starred:I}:le);const se=N.map(le=>({methodname:"set_starred",messageid:le,starred:I}));await a(se)},H=async(N,I)=>{Q(G=>N.includes(G.id)?{...G,unread:I}:G);const se=N.map(G=>({methodname:"set_unread",messageid:G,unread:I})),le={...s.params,messageid:void 0};await a(se,le)},P=N=>{r({viewportSize:N,navigationId:s.navigationId+1}),!s.params.tray&&N>=de.LG&&!s.error&&p({tray:"inbox",dialog:s.params.dialog},!0)},O=async N=>{const I={...s.params,dialog:N};at(I,s.params.dialog!=null),r({params:I})},x=async N=>{r({toasts:[N]}),N&&window.setTimeout(()=>b(N),1e4)},V=N=>{r({selectedMessages:new Map(s.listMessages.filter(I=>I.id==N?!s.selectedMessages.has(I.id):s.selectedMessages.has(I.id)).map(I=>[I.id,I]))})},te=async N=>{N.undo&&(b(N),N.undo())},ae=(N,I)=>{if(!s.message)return;const se=++e,le=s.message,G=s.draftData;r({draftData:N,draftSaved:!1});let fe=3e3;I?fe=0:G&&(fe=Math.max(0,le.time*1e3+fe-Date.now())),window.clearTimeout(t),t=window.setTimeout(async()=>{const ee=[{methodname:"update_message",messageid:le.id,data:N},{methodname:"get_message",messageid:le.id}];let he;try{he=await Ye(ee)}catch(ne){j(ne);return}const Z=he.pop();se==e&&r({message:Z,draftData:void 0,draftSaved:!0})},fe)},X=async(N,I,se)=>{await a([{methodname:"update_label",labelid:N,name:I,color:se}])},Q=N=>{r({listMessages:s.listMessages.map(I=>N(I)),message:s.message?N(s.message):void 0,selectedMessages:new Map(Array.from(s.selectedMessages.entries()).map(([I,se])=>[I,N(se)]))})};return await p(Yl(),!0,!0),{createLabel:o,createMessage:f,deleteLabel:d,emptyTrash:c,forward:m,get:()=>s,hideDialog:_,hideToast:b,navigate:p,navigateToList:v,navigateToMenu:w,reply:C,savePreferences:$,selectAll:k,selectCourse:M,sendMessage:A,setDeleted:y,setError:j,setLabels:B,setStarred:q,setUnread:H,setViewportSize:P,showDialog:O,subscribe:n,toggleSelected:V,undo:te,updateDraft:ae,updateLabel:X}}async function Qa(){const l=document.getElementById("local-mail-view"),e=document.getElementById("local-mail-navbar"),t=window.local_mail_view_data;if(!t)return;const s=await Xa({userid:t.userid,settings:t.settings,preferences:t.preferences,strings:t.strings,mobile:!!t.mobile});if(l&&new Ya({target:l,props:{store:s}}),e){e.innerHTML="";const n=s.get(),i=new Ln({target:e,props:{settings:n.settings,strings:n.strings,courses:n.courses,labels:n.labels,params:n.params,onClick:s.navigate,onComposeClick:s.createMessage,onCourseChange:s.selectCourse}});s.subscribe(r=>{i.$set({settings:r.settings,strings:r.strings,courses:r.courses,labels:r.labels,params:r.params})})}}Qa();
//# sourceMappingURL=view-fRNUNKdx.js.map
