{"version":3,"file":"navigation-ccab1f47.js","sources":["../src/components/UserListSendButton.svelte","../src/components/UserProfileSendButton.svelte","../src/navigation.ts"],"sourcesContent":["<!--\nSPDX-FileCopyrightText: 2023 SEIDOR <https://www.seidor.com>\n\nSPDX-License-Identifier: GPL-3.0-or-later\n-->\n<svelte:options immutable={true} />\n\n<script lang=\"ts\">\n    import { onDestroy, onMount } from 'svelte';\n    import { require, type CorePubSub } from '../lib/amd';\n    import type { Course, Strings } from '../lib/state';\n    import { createUrl } from '../lib/url';\n\n    export let strings: Strings;\n    export let courses: ReadonlyArray<Course>;\n    export let userid: number;\n    export let courseid: number;\n    export let form: HTMLFormElement;\n\n    $: course = courses.find((course) => course.id == courseid);\n    let recipients: number[] = [];\n\n    onMount(async () => {\n        const pubsub = (await require('core/pubsub')) as CorePubSub;\n        pubsub.subscribe('core/checkbox-toggleall:checkboxToggled', updateRecipients);\n        updateRecipients();\n    });\n\n    onDestroy(async () => {\n        const pubsub = (await require('core/pubsub')) as CorePubSub;\n        pubsub.unsubscribe('core/checkbox-toggleall:checkboxToggled', updateRecipients);\n    });\n\n    const updateRecipients = async () => {\n        recipients = [];\n        const formData = new FormData(form);\n        for (const name of formData.keys()) {\n            const match = /^user(\\d+)$/.exec(name);\n            if (match) {\n                const id = parseInt(match[1]);\n                if (id != userid) {\n                    recipients.push(id);\n                }\n            }\n        }\n    };\n</script>\n\n{#if course}\n    <div class=\"btn-group ml-3\">\n        <button\n            type=\"button\"\n            class=\"btn btn-outline-secondary text-dark bg-white dropdown-toggle\"\n            data-toggle=\"dropdown\"\n            aria-expanded=\"false\"\n            disabled={!recipients.length}\n        >\n            <i class=\"fa fa-envelope-o mr-1\" aria-hidden=\"true\" />\n            {strings.sendmail}\n        </button>\n        <div class=\"dropdown-menu\">\n            {#each ['to', 'cc', 'bcc'] as role (role)}\n                <a class=\"dropdown-item\" href={createUrl(course.id, recipients, role)}>\n                    {strings[role]}\n                </a>\n            {/each}\n        </div>\n    </div>\n{/if}\n","<!--\nSPDX-FileCopyrightText: 2023 SEIDOR <https://www.seidor.com>\n\nSPDX-License-Identifier: GPL-3.0-or-later\n-->\n<svelte:options immutable={true} />\n\n<script lang=\"ts\">\n    import type { Course, Strings } from '../lib/state';\n    import { createUrl } from '../lib/url';\n\n    export let userid: number;\n    export let strings: Strings;\n    export let courses: ReadonlyArray<Course>;\n    export let id: number;\n    export let courseid: number;\n\n    $: course = courses.find((course) => course.id == courseid);\n</script>\n\n{#if id != userid && course}\n    <a class=\"btn\" href={createUrl(courseid, [id], 'to')}>\n        <i class=\"fa fa-envelope-o mr-1\" aria-hidden=\"true\" />\n        {strings.sendmail}\n    </a>\n{/if}\n","/*\n * SPDX-FileCopyrightText: 2023 SEIDOR <https://www.seidor.com>\n *\n * SPDX-License-Identifier: GPL-3.0-or-later\n */\n\nimport Navbar from './components/Navbar.svelte';\nimport UserListSendButton from './components/UserListSendButton.svelte';\nimport UserProfileSendButton from './components/UserProfileSendButton.svelte';\nimport type { Course, Label, Settings, Strings, ViewParams } from './lib/state';\nimport { createUrl, viewUrl } from './lib/url';\nimport './global.css';\n\nasync function init() {\n    // Get needed data from script tag, to avoid doing web service requests.\n    const data = window.local_mail_navbar_data;\n    if (!data) {\n        return;\n    }\n\n    initNavbar(data);\n\n    const url = window.location.origin + window.location.pathname;\n    const params = new URLSearchParams(window.location.search);\n\n    if (url == window.M.cfg.wwwroot + '/user/view.php') {\n        initUserProfile(\n            data,\n            parseInt(params.get('id') || ''),\n            parseInt(params.get('course') || ''),\n        );\n    } else if (url == window.M.cfg.wwwroot + '/user/index.php') {\n        initUserList(data, parseInt(params.get('id') || ''));\n    } else if (url == window.M.cfg.wwwroot + '/blocks/completion_progress/overview.php') {\n        initUserList(data, parseInt(params.get('courseid') || ''));\n    }\n}\n\nfunction initNavbar(data: Record<string, unknown>) {\n    const target = document.getElementById('local-mail-navbar');\n    if (target) {\n        // Remove fallback link created in local_mail_render_navbar_output.\n        target.innerHTML = '';\n\n        const navbar = new Navbar({\n            target,\n            props: {\n                settings: data.settings as Settings,\n                strings: data.strings as Strings,\n                courses: data.courses as Course[],\n                labels: data.labels as Label[],\n                params: { courseid: data.courseid as number },\n                onClick: (params: ViewParams) => {\n                    window.location.href = viewUrl(params);\n                },\n                onComposeClick: (courseid: number) => {\n                    window.location.href = createUrl(courseid);\n                },\n                onCourseChange: (courseid?: number) => {\n                    navbar.$set({ params: { courseid } });\n                },\n            },\n        });\n    }\n}\n\nfunction initUserList(data: Record<string, unknown>, courseid: number) {\n    const target = document.querySelector('#formactionid')?.parentElement;\n    const form = document.querySelector('#participantsform') as HTMLFormElement;\n    if (courseid && target && form) {\n        new UserListSendButton({\n            target,\n            props: {\n                userid: data.userid as number,\n                strings: data.strings as Strings,\n                courses: data.courses as Course[],\n                courseid,\n                form: document.querySelector('#participantsform') as HTMLFormElement,\n            },\n        });\n    }\n}\n\nfunction initUserProfile(data: Record<string, unknown>, id: number, courseid: number) {\n    const target = document.querySelector('.userprofile .header-button-group');\n    if (id && courseid && target) {\n        new UserProfileSendButton({\n            target,\n            props: {\n                userid: data.userid as number,\n                strings: data.strings as Strings,\n                courses: data.courses as Course[],\n                id,\n                courseid,\n            },\n        });\n    }\n}\n\ninit();\n"],"names":["t1_value","ctx","button","button_disabled_value","insert","target","div1","anchor","append","i","div0","dirty","set_data","t1","t0_value","attr","a","a_href_value","createUrl","t0","create_if_block","strings","$$props","courses","userid","courseid","form","recipients","onMount","require","updateRecipients","onDestroy","formData","name","match","id","$$invalidate","course","init","data","initNavbar","url","params","initUserProfile","initUserList","navbar","Navbar","viewUrl","_a","UserListSendButton","UserProfileSendButton"],"mappings":"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"}